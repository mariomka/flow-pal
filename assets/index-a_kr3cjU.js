var e_=Object.defineProperty;var t_=(r,e,t)=>e in r?e_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Hr=(r,e,t)=>t_(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function xc(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const $e={},es=[],vr=()=>{},r_=()=>!1,ho=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),Ec=r=>r.startsWith("onUpdate:"),mt=Object.assign,Sc=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},n_=Object.prototype.hasOwnProperty,ke=(r,e)=>n_.call(r,e),ne=Array.isArray,ts=r=>$a(r)==="[object Map]",_s=r=>$a(r)==="[object Set]",Ld=r=>$a(r)==="[object Date]",fe=r=>typeof r=="function",qe=r=>typeof r=="string",Er=r=>typeof r=="symbol",Fe=r=>r!==null&&typeof r=="object",Lp=r=>(Fe(r)||fe(r))&&fe(r.then)&&fe(r.catch),Mp=Object.prototype.toString,$a=r=>Mp.call(r),s_=r=>$a(r).slice(8,-1),Fp=r=>$a(r)==="[object Object]",Oc=r=>qe(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,Gs=xc(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),po=r=>{const e=Object.create(null);return t=>e[t]||(e[t]=r(t))},a_=/-(\w)/g,en=po(r=>r.replace(a_,(e,t)=>t?t.toUpperCase():"")),i_=/\B([A-Z])/g,jn=po(r=>r.replace(i_,"-$1").toLowerCase()),Dp=po(r=>r.charAt(0).toUpperCase()+r.slice(1)),Jo=po(r=>r?`on${Dp(r)}`:""),Qr=(r,e)=>!Object.is(r,e),vi=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},Up=(r,e,t,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:t})},ji=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let Md;const mo=()=>Md||(Md=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ia(r){if(ne(r)){const e={};for(let t=0;t<r.length;t++){const n=r[t],s=qe(n)?c_(n):ia(n);if(s)for(const a in s)e[a]=s[a]}return e}else if(qe(r)||Fe(r))return r}const o_=/;(?![^(]*\))/g,l_=/:([^]+)/,u_=/\/\*[^]*?\*\//g;function c_(r){const e={};return r.replace(u_,"").split(o_).forEach(t=>{if(t){const n=t.split(l_);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Na(r){let e="";if(qe(r))e=r;else if(ne(r))for(let t=0;t<r.length;t++){const n=Na(r[t]);n&&(e+=n+" ")}else if(Fe(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const d_="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",f_=xc(d_);function Bp(r){return!!r||r===""}function h_(r,e){if(r.length!==e.length)return!1;let t=!0;for(let n=0;t&&n<r.length;n++)t=Tn(r[n],e[n]);return t}function Tn(r,e){if(r===e)return!0;let t=Ld(r),n=Ld(e);if(t||n)return t&&n?r.getTime()===e.getTime():!1;if(t=Er(r),n=Er(e),t||n)return r===e;if(t=ne(r),n=ne(e),t||n)return t&&n?h_(r,e):!1;if(t=Fe(r),n=Fe(e),t||n){if(!t||!n)return!1;const s=Object.keys(r).length,a=Object.keys(e).length;if(s!==a)return!1;for(const i in r){const o=r.hasOwnProperty(i),l=e.hasOwnProperty(i);if(o&&!l||!o&&l||!Tn(r[i],e[i]))return!1}}return String(r)===String(e)}function kc(r,e){return r.findIndex(t=>Tn(t,e))}const Hp=r=>!!(r&&r.__v_isRef===!0),Je=r=>qe(r)?r:r==null?"":ne(r)||Fe(r)&&(r.toString===Mp||!fe(r.toString))?Hp(r)?Je(r.value):JSON.stringify(r,qp,2):String(r),qp=(r,e)=>Hp(e)?qp(r,e.value):ts(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],a)=>(t[Ko(n,a)+" =>"]=s,t),{})}:_s(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Ko(t))}:Er(e)?Ko(e):Fe(e)&&!ne(e)&&!Fp(e)?String(e):e,Ko=(r,e="")=>{var t;return Er(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Nt;class p_{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Nt,!e&&Nt&&(this.index=(Nt.scopes||(Nt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Nt;try{return Nt=this,e()}finally{Nt=t}}}on(){Nt=this}off(){Nt=this.parent}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function m_(){return Nt}let Le;const Xo=new WeakSet;class Zp{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Nt&&Nt.active&&Nt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Xo.has(this)&&(Xo.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Vp(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Fd(this),Gp(this);const e=Le,t=er;Le=this,er=!0;try{return this.fn()}finally{Wp(this),Le=e,er=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Pc(e);this.deps=this.depsTail=void 0,Fd(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Xo.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Cu(this)&&this.run()}get dirty(){return Cu(this)}}let zp=0,Ws,Js;function Vp(r,e=!1){if(r.flags|=8,e){r.next=Js,Js=r;return}r.next=Ws,Ws=r}function Tc(){zp++}function Ac(){if(--zp>0)return;if(Js){let e=Js;for(Js=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;Ws;){let e=Ws;for(Ws=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=t}}if(r)throw r}function Gp(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Wp(r){let e,t=r.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),Pc(n),g_(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}r.deps=e,r.depsTail=t}function Cu(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Jp(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function Jp(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===oa))return;r.globalVersion=oa;const e=r.dep;if(r.flags|=2,e.version>0&&!r.isSSR&&r.deps&&!Cu(r)){r.flags&=-3;return}const t=Le,n=er;Le=r,er=!0;try{Gp(r);const s=r.fn(r._value);(e.version===0||Qr(s,r._value))&&(r._value=s,e.version++)}catch(s){throw e.version++,s}finally{Le=t,er=n,Wp(r),r.flags&=-3}}function Pc(r,e=!1){const{dep:t,prevSub:n,nextSub:s}=r;if(n&&(n.nextSub=s,r.prevSub=void 0),s&&(s.prevSub=n,r.nextSub=void 0),t.subs===r&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let a=t.computed.deps;a;a=a.nextDep)Pc(a,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function g_(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let er=!0;const Kp=[];function cn(){Kp.push(er),er=!1}function dn(){const r=Kp.pop();er=r===void 0?!0:r}function Fd(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=Le;Le=void 0;try{e()}finally{Le=t}}}let oa=0;class y_{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ic{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Le||!er||Le===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Le)t=this.activeLink=new y_(Le,this),Le.deps?(t.prevDep=Le.depsTail,Le.depsTail.nextDep=t,Le.depsTail=t):Le.deps=Le.depsTail=t,Xp(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=Le.depsTail,t.nextDep=void 0,Le.depsTail.nextDep=t,Le.depsTail=t,Le.deps===t&&(Le.deps=n)}return t}trigger(e){this.version++,oa++,this.notify(e)}notify(e){Tc();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ac()}}}function Xp(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Xp(n)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const $u=new WeakMap,xn=Symbol(""),Nu=Symbol(""),la=Symbol("");function nt(r,e,t){if(er&&Le){let n=$u.get(r);n||$u.set(r,n=new Map);let s=n.get(t);s||(n.set(t,s=new Ic),s.map=n,s.key=t),s.track()}}function jr(r,e,t,n,s,a){const i=$u.get(r);if(!i){oa++;return}const o=l=>{l&&l.trigger()};if(Tc(),e==="clear")i.forEach(o);else{const l=ne(r),u=l&&Oc(t);if(l&&t==="length"){const c=Number(n);i.forEach((d,f)=>{(f==="length"||f===la||!Er(f)&&f>=c)&&o(d)})}else switch((t!==void 0||i.has(void 0))&&o(i.get(t)),u&&o(i.get(la)),e){case"add":l?u&&o(i.get("length")):(o(i.get(xn)),ts(r)&&o(i.get(Nu)));break;case"delete":l||(o(i.get(xn)),ts(r)&&o(i.get(Nu)));break;case"set":ts(r)&&o(i.get(xn));break}}Ac()}function Fn(r){const e=Oe(r);return e===r?e:(nt(e,"iterate",la),Ht(r)?e:e.map(st))}function go(r){return nt(r=Oe(r),"iterate",la),r}const __={__proto__:null,[Symbol.iterator](){return Yo(this,Symbol.iterator,st)},concat(...r){return Fn(this).concat(...r.map(e=>ne(e)?Fn(e):e))},entries(){return Yo(this,"entries",r=>(r[1]=st(r[1]),r))},every(r,e){return Ar(this,"every",r,e,void 0,arguments)},filter(r,e){return Ar(this,"filter",r,e,t=>t.map(st),arguments)},find(r,e){return Ar(this,"find",r,e,st,arguments)},findIndex(r,e){return Ar(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return Ar(this,"findLast",r,e,st,arguments)},findLastIndex(r,e){return Ar(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return Ar(this,"forEach",r,e,void 0,arguments)},includes(...r){return Qo(this,"includes",r)},indexOf(...r){return Qo(this,"indexOf",r)},join(r){return Fn(this).join(r)},lastIndexOf(...r){return Qo(this,"lastIndexOf",r)},map(r,e){return Ar(this,"map",r,e,void 0,arguments)},pop(){return Is(this,"pop")},push(...r){return Is(this,"push",r)},reduce(r,...e){return Dd(this,"reduce",r,e)},reduceRight(r,...e){return Dd(this,"reduceRight",r,e)},shift(){return Is(this,"shift")},some(r,e){return Ar(this,"some",r,e,void 0,arguments)},splice(...r){return Is(this,"splice",r)},toReversed(){return Fn(this).toReversed()},toSorted(r){return Fn(this).toSorted(r)},toSpliced(...r){return Fn(this).toSpliced(...r)},unshift(...r){return Is(this,"unshift",r)},values(){return Yo(this,"values",st)}};function Yo(r,e,t){const n=go(r),s=n[e]();return n!==r&&!Ht(r)&&(s._next=s.next,s.next=()=>{const a=s._next();return a.value&&(a.value=t(a.value)),a}),s}const b_=Array.prototype;function Ar(r,e,t,n,s,a){const i=go(r),o=i!==r&&!Ht(r),l=i[e];if(l!==b_[e]){const d=l.apply(r,a);return o?st(d):d}let u=t;i!==r&&(o?u=function(d,f){return t.call(this,st(d),f,r)}:t.length>2&&(u=function(d,f){return t.call(this,d,f,r)}));const c=l.call(i,u,n);return o&&s?s(c):c}function Dd(r,e,t,n){const s=go(r);let a=t;return s!==r&&(Ht(r)?t.length>3&&(a=function(i,o,l){return t.call(this,i,o,l,r)}):a=function(i,o,l){return t.call(this,i,st(o),l,r)}),s[e](a,...n)}function Qo(r,e,t){const n=Oe(r);nt(n,"iterate",la);const s=n[e](...t);return(s===-1||s===!1)&&Nc(t[0])?(t[0]=Oe(t[0]),n[e](...t)):s}function Is(r,e,t=[]){cn(),Tc();const n=Oe(r)[e].apply(r,t);return Ac(),dn(),n}const w_=xc("__proto__,__v_isRef,__isVue"),Yp=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(Er));function v_(r){Er(r)||(r=String(r));const e=Oe(this);return nt(e,"has",r),e.hasOwnProperty(r)}class Qp{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,a=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return a;if(t==="__v_raw")return n===(s?a?R_:nm:a?rm:tm).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const i=ne(e);if(!s){let l;if(i&&(l=__[t]))return l;if(t==="hasOwnProperty")return v_}const o=Reflect.get(e,t,it(e)?e:n);return(Er(t)?Yp.has(t):w_(t))||(s||nt(e,"get",t),a)?o:it(o)?i&&Oc(t)?o:o.value:Fe(o)?s?sm(o):Cc(o):o}}class em extends Qp{constructor(e=!1){super(!1,e)}set(e,t,n,s){let a=e[t];if(!this._isShallow){const l=An(a);if(!Ht(n)&&!An(n)&&(a=Oe(a),n=Oe(n)),!ne(e)&&it(a)&&!it(n))return l?!1:(a.value=n,!0)}const i=ne(e)&&Oc(t)?Number(t)<e.length:ke(e,t),o=Reflect.set(e,t,n,it(e)?e:s);return e===Oe(s)&&(i?Qr(n,a)&&jr(e,"set",t,n):jr(e,"add",t,n)),o}deleteProperty(e,t){const n=ke(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&jr(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!Er(t)||!Yp.has(t))&&nt(e,"has",t),n}ownKeys(e){return nt(e,"iterate",ne(e)?"length":xn),Reflect.ownKeys(e)}}class x_ extends Qp{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const E_=new em,S_=new x_,O_=new em(!0);const ju=r=>r,Ka=r=>Reflect.getPrototypeOf(r);function k_(r,e,t){return function(...n){const s=this.__v_raw,a=Oe(s),i=ts(a),o=r==="entries"||r===Symbol.iterator&&i,l=r==="keys"&&i,u=s[r](...n),c=t?ju:e?Lu:st;return!e&&nt(a,"iterate",l?Nu:xn),{next(){const{value:d,done:f}=u.next();return f?{value:d,done:f}:{value:o?[c(d[0]),c(d[1])]:c(d),done:f}},[Symbol.iterator](){return this}}}}function Xa(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function T_(r,e){const t={get(s){const a=this.__v_raw,i=Oe(a),o=Oe(s);r||(Qr(s,o)&&nt(i,"get",s),nt(i,"get",o));const{has:l}=Ka(i),u=e?ju:r?Lu:st;if(l.call(i,s))return u(a.get(s));if(l.call(i,o))return u(a.get(o));a!==i&&a.get(s)},get size(){const s=this.__v_raw;return!r&&nt(Oe(s),"iterate",xn),Reflect.get(s,"size",s)},has(s){const a=this.__v_raw,i=Oe(a),o=Oe(s);return r||(Qr(s,o)&&nt(i,"has",s),nt(i,"has",o)),s===o?a.has(s):a.has(s)||a.has(o)},forEach(s,a){const i=this,o=i.__v_raw,l=Oe(o),u=e?ju:r?Lu:st;return!r&&nt(l,"iterate",xn),o.forEach((c,d)=>s.call(a,u(c),u(d),i))}};return mt(t,r?{add:Xa("add"),set:Xa("set"),delete:Xa("delete"),clear:Xa("clear")}:{add(s){!e&&!Ht(s)&&!An(s)&&(s=Oe(s));const a=Oe(this);return Ka(a).has.call(a,s)||(a.add(s),jr(a,"add",s,s)),this},set(s,a){!e&&!Ht(a)&&!An(a)&&(a=Oe(a));const i=Oe(this),{has:o,get:l}=Ka(i);let u=o.call(i,s);u||(s=Oe(s),u=o.call(i,s));const c=l.call(i,s);return i.set(s,a),u?Qr(a,c)&&jr(i,"set",s,a):jr(i,"add",s,a),this},delete(s){const a=Oe(this),{has:i,get:o}=Ka(a);let l=i.call(a,s);l||(s=Oe(s),l=i.call(a,s)),o&&o.call(a,s);const u=a.delete(s);return l&&jr(a,"delete",s,void 0),u},clear(){const s=Oe(this),a=s.size!==0,i=s.clear();return a&&jr(s,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=k_(s,r,e)}),t}function Rc(r,e){const t=T_(r,e);return(n,s,a)=>s==="__v_isReactive"?!r:s==="__v_isReadonly"?r:s==="__v_raw"?n:Reflect.get(ke(t,s)&&s in n?t:n,s,a)}const A_={get:Rc(!1,!1)},P_={get:Rc(!1,!0)},I_={get:Rc(!0,!1)};const tm=new WeakMap,rm=new WeakMap,nm=new WeakMap,R_=new WeakMap;function C_(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function $_(r){return r.__v_skip||!Object.isExtensible(r)?0:C_(s_(r))}function Cc(r){return An(r)?r:$c(r,!1,E_,A_,tm)}function N_(r){return $c(r,!1,O_,P_,rm)}function sm(r){return $c(r,!0,S_,I_,nm)}function $c(r,e,t,n,s){if(!Fe(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const a=s.get(r);if(a)return a;const i=$_(r);if(i===0)return r;const o=new Proxy(r,i===2?n:t);return s.set(r,o),o}function rs(r){return An(r)?rs(r.__v_raw):!!(r&&r.__v_isReactive)}function An(r){return!!(r&&r.__v_isReadonly)}function Ht(r){return!!(r&&r.__v_isShallow)}function Nc(r){return r?!!r.__v_raw:!1}function Oe(r){const e=r&&r.__v_raw;return e?Oe(e):r}function j_(r){return!ke(r,"__v_skip")&&Object.isExtensible(r)&&Up(r,"__v_skip",!0),r}const st=r=>Fe(r)?Cc(r):r,Lu=r=>Fe(r)?sm(r):r;function it(r){return r?r.__v_isRef===!0:!1}function _e(r){return L_(r,!1)}function L_(r,e){return it(r)?r:new M_(r,e)}class M_{constructor(e,t){this.dep=new Ic,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Oe(e),this._value=t?e:st(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||Ht(e)||An(e);e=n?e:Oe(e),Qr(e,t)&&(this._rawValue=e,this._value=n?e:st(e),this.dep.trigger())}}function F_(r){return it(r)?r.value:r}const D_={get:(r,e,t)=>e==="__v_raw"?r:F_(Reflect.get(r,e,t)),set:(r,e,t,n)=>{const s=r[e];return it(s)&&!it(t)?(s.value=t,!0):Reflect.set(r,e,t,n)}};function am(r){return rs(r)?r:new Proxy(r,D_)}class U_{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Ic(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=oa-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Le!==this)return Vp(this,!0),!0}get value(){const e=this.dep.track();return Jp(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function B_(r,e,t=!1){let n,s;return fe(r)?n=r:(n=r.get,s=r.set),new U_(n,s,t)}const Ya={},Li=new WeakMap;let yn;function H_(r,e=!1,t=yn){if(t){let n=Li.get(t);n||Li.set(t,n=[]),n.push(r)}}function q_(r,e,t=$e){const{immediate:n,deep:s,once:a,scheduler:i,augmentJob:o,call:l}=t,u=b=>s?b:Ht(b)||s===!1||s===0?Lr(b,1):Lr(b);let c,d,f,h,p=!1,m=!1;if(it(r)?(d=()=>r.value,p=Ht(r)):rs(r)?(d=()=>u(r),p=!0):ne(r)?(m=!0,p=r.some(b=>rs(b)||Ht(b)),d=()=>r.map(b=>{if(it(b))return b.value;if(rs(b))return u(b);if(fe(b))return l?l(b,2):b()})):fe(r)?e?d=l?()=>l(r,2):r:d=()=>{if(f){cn();try{f()}finally{dn()}}const b=yn;yn=c;try{return l?l(r,3,[h]):r(h)}finally{yn=b}}:d=vr,e&&s){const b=d,E=s===!0?1/0:s;d=()=>Lr(b(),E)}const g=m_(),_=()=>{c.stop(),g&&g.active&&Sc(g.effects,c)};if(a&&e){const b=e;e=(...E)=>{b(...E),_()}}let v=m?new Array(r.length).fill(Ya):Ya;const y=b=>{if(!(!(c.flags&1)||!c.dirty&&!b))if(e){const E=c.run();if(s||p||(m?E.some((S,O)=>Qr(S,v[O])):Qr(E,v))){f&&f();const S=yn;yn=c;try{const O=[E,v===Ya?void 0:m&&v[0]===Ya?[]:v,h];l?l(e,3,O):e(...O),v=E}finally{yn=S}}}else c.run()};return o&&o(y),c=new Zp(d),c.scheduler=i?()=>i(y,!1):y,h=b=>H_(b,!1,c),f=c.onStop=()=>{const b=Li.get(c);if(b){if(l)l(b,4);else for(const E of b)E();Li.delete(c)}},e?n?y(!0):v=c.run():i?i(y.bind(null,!0),!0):c.run(),_.pause=c.pause.bind(c),_.resume=c.resume.bind(c),_.stop=_,_}function Lr(r,e=1/0,t){if(e<=0||!Fe(r)||r.__v_skip||(t=t||new Set,t.has(r)))return r;if(t.add(r),e--,it(r))Lr(r.value,e,t);else if(ne(r))for(let n=0;n<r.length;n++)Lr(r[n],e,t);else if(_s(r)||ts(r))r.forEach(n=>{Lr(n,e,t)});else if(Fp(r)){for(const n in r)Lr(r[n],e,t);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&Lr(r[n],e,t)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ja(r,e,t,n){try{return n?r(...n):r()}catch(s){yo(s,e,t)}}function Sr(r,e,t,n){if(fe(r)){const s=ja(r,e,t,n);return s&&Lp(s)&&s.catch(a=>{yo(a,e,t)}),s}if(ne(r)){const s=[];for(let a=0;a<r.length;a++)s.push(Sr(r[a],e,t,n));return s}}function yo(r,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:a,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||$e;if(e){let o=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const c=o.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](r,l,u)===!1)return}o=o.parent}if(a){cn(),ja(a,null,10,[r,l,u]),dn();return}}Z_(r,t,s,n,i)}function Z_(r,e,t,n=!0,s=!1){if(s)throw r;console.error(r)}const dt=[];let pr=-1;const ns=[];let Wr=null,Zn=0;const im=Promise.resolve();let Mi=null;function om(r){const e=Mi||im;return r?e.then(this?r.bind(this):r):e}function z_(r){let e=pr+1,t=dt.length;for(;e<t;){const n=e+t>>>1,s=dt[n],a=ua(s);a<r||a===r&&s.flags&2?e=n+1:t=n}return e}function jc(r){if(!(r.flags&1)){const e=ua(r),t=dt[dt.length-1];!t||!(r.flags&2)&&e>=ua(t)?dt.push(r):dt.splice(z_(e),0,r),r.flags|=1,lm()}}function lm(){Mi||(Mi=im.then(cm))}function V_(r){ne(r)?ns.push(...r):Wr&&r.id===-1?Wr.splice(Zn+1,0,r):r.flags&1||(ns.push(r),r.flags|=1),lm()}function Ud(r,e,t=pr+1){for(;t<dt.length;t++){const n=dt[t];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;dt.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function um(r){if(ns.length){const e=[...new Set(ns)].sort((t,n)=>ua(t)-ua(n));if(ns.length=0,Wr){Wr.push(...e);return}for(Wr=e,Zn=0;Zn<Wr.length;Zn++){const t=Wr[Zn];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Wr=null,Zn=0}}const ua=r=>r.id==null?r.flags&2?-1:1/0:r.id;function cm(r){try{for(pr=0;pr<dt.length;pr++){const e=dt[pr];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),ja(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;pr<dt.length;pr++){const e=dt[pr];e&&(e.flags&=-2)}pr=-1,dt.length=0,um(),Mi=null,(dt.length||ns.length)&&cm()}}let Bt=null,dm=null;function Fi(r){const e=Bt;return Bt=r,dm=r&&r.type.__scopeId||null,e}function G_(r,e=Bt,t){if(!e||r._n)return r;const n=(...s)=>{n._d&&Jd(-1);const a=Fi(e);let i;try{i=r(...s)}finally{Fi(a),n._d&&Jd(1)}return i};return n._n=!0,n._c=!0,n._d=!0,n}function mr(r,e){if(Bt===null)return r;const t=xo(Bt),n=r.dirs||(r.dirs=[]);for(let s=0;s<e.length;s++){let[a,i,o,l=$e]=e[s];a&&(fe(a)&&(a={mounted:a,updated:a}),a.deep&&Lr(i),n.push({dir:a,instance:t,value:i,oldValue:void 0,arg:o,modifiers:l}))}return r}function hn(r,e,t,n){const s=r.dirs,a=e&&e.dirs;for(let i=0;i<s.length;i++){const o=s[i];a&&(o.oldValue=a[i].value);let l=o.dir[n];l&&(cn(),Sr(l,t,8,[r.el,o,r,e]),dn())}}const W_=Symbol("_vte"),J_=r=>r.__isTeleport;function Lc(r,e){r.shapeFlag&6&&r.component?(r.transition=e,Lc(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function fm(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function Di(r,e,t,n,s=!1){if(ne(r)){r.forEach((p,m)=>Di(p,e&&(ne(e)?e[m]:e),t,n,s));return}if(Ks(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Di(r,e,t,n.component.subTree);return}const a=n.shapeFlag&4?xo(n.component):n.el,i=s?null:a,{i:o,r:l}=r,u=e&&e.r,c=o.refs===$e?o.refs={}:o.refs,d=o.setupState,f=Oe(d),h=d===$e?()=>!1:p=>ke(f,p);if(u!=null&&u!==l&&(qe(u)?(c[u]=null,h(u)&&(d[u]=null)):it(u)&&(u.value=null)),fe(l))ja(l,o,12,[i,c]);else{const p=qe(l),m=it(l);if(p||m){const g=()=>{if(r.f){const _=p?h(l)?d[l]:c[l]:l.value;s?ne(_)&&Sc(_,a):ne(_)?_.includes(a)||_.push(a):p?(c[l]=[a],h(l)&&(d[l]=c[l])):(l.value=[a],r.k&&(c[r.k]=l.value))}else p?(c[l]=i,h(l)&&(d[l]=i)):m&&(l.value=i,r.k&&(c[r.k]=i))};i?(g.id=-1,Ct(g,t)):g()}}}mo().requestIdleCallback;mo().cancelIdleCallback;const Ks=r=>!!r.type.__asyncLoader,hm=r=>r.type.__isKeepAlive;function K_(r,e){pm(r,"a",e)}function X_(r,e){pm(r,"da",e)}function pm(r,e,t=pt){const n=r.__wdc||(r.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return r()});if(_o(e,n,t),t){let s=t.parent;for(;s&&s.parent;)hm(s.parent.vnode)&&Y_(n,e,t,s),s=s.parent}}function Y_(r,e,t,n){const s=_o(e,r,n,!0);Mc(()=>{Sc(n[e],s)},t)}function _o(r,e,t=pt,n=!1){if(t){const s=t[r]||(t[r]=[]),a=e.__weh||(e.__weh=(...i)=>{cn();const o=La(t),l=Sr(e,t,r,i);return o(),dn(),l});return n?s.unshift(a):s.push(a),a}}const Br=r=>(e,t=pt)=>{(!da||r==="sp")&&_o(r,(...n)=>e(...n),t)},Q_=Br("bm"),bo=Br("m"),eb=Br("bu"),tb=Br("u"),rb=Br("bum"),Mc=Br("um"),nb=Br("sp"),sb=Br("rtg"),ab=Br("rtc");function ib(r,e=pt){_o("ec",r,e)}const ob=Symbol.for("v-ndc");function zn(r,e,t,n){let s;const a=t,i=ne(r);if(i||qe(r)){const o=i&&rs(r);let l=!1;o&&(l=!Ht(r),r=go(r)),s=new Array(r.length);for(let u=0,c=r.length;u<c;u++)s[u]=e(l?st(r[u]):r[u],u,void 0,a)}else if(typeof r=="number"){s=new Array(r);for(let o=0;o<r;o++)s[o]=e(o+1,o,void 0,a)}else if(Fe(r))if(r[Symbol.iterator])s=Array.from(r,(o,l)=>e(o,l,void 0,a));else{const o=Object.keys(r);s=new Array(o.length);for(let l=0,u=o.length;l<u;l++){const c=o[l];s[l]=e(r[c],c,l,a)}}else s=[];return s}const Mu=r=>r?Lm(r)?xo(r):Mu(r.parent):null,Xs=mt(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>Mu(r.parent),$root:r=>Mu(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>gm(r),$forceUpdate:r=>r.f||(r.f=()=>{jc(r.update)}),$nextTick:r=>r.n||(r.n=om.bind(r.proxy)),$watch:r=>Pb.bind(r)}),el=(r,e)=>r!==$e&&!r.__isScriptSetup&&ke(r,e),lb={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:a,accessCache:i,type:o,appContext:l}=r;let u;if(e[0]!=="$"){const h=i[e];if(h!==void 0)switch(h){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return a[e]}else{if(el(n,e))return i[e]=1,n[e];if(s!==$e&&ke(s,e))return i[e]=2,s[e];if((u=r.propsOptions[0])&&ke(u,e))return i[e]=3,a[e];if(t!==$e&&ke(t,e))return i[e]=4,t[e];Fu&&(i[e]=0)}}const c=Xs[e];let d,f;if(c)return e==="$attrs"&&nt(r.attrs,"get",""),c(r);if((d=o.__cssModules)&&(d=d[e]))return d;if(t!==$e&&ke(t,e))return i[e]=4,t[e];if(f=l.config.globalProperties,ke(f,e))return f[e]},set({_:r},e,t){const{data:n,setupState:s,ctx:a}=r;return el(s,e)?(s[e]=t,!0):n!==$e&&ke(n,e)?(n[e]=t,!0):ke(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(a[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:a}},i){let o;return!!t[i]||r!==$e&&ke(r,i)||el(e,i)||(o=a[0])&&ke(o,i)||ke(n,i)||ke(Xs,i)||ke(s.config.globalProperties,i)},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:ke(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function Bd(r){return ne(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let Fu=!0;function ub(r){const e=gm(r),t=r.proxy,n=r.ctx;Fu=!1,e.beforeCreate&&Hd(e.beforeCreate,r,"bc");const{data:s,computed:a,methods:i,watch:o,provide:l,inject:u,created:c,beforeMount:d,mounted:f,beforeUpdate:h,updated:p,activated:m,deactivated:g,beforeDestroy:_,beforeUnmount:v,destroyed:y,unmounted:b,render:E,renderTracked:S,renderTriggered:O,errorCaptured:A,serverPrefetch:se,expose:oe,inheritAttrs:z,components:K,directives:Ee,filters:F}=e;if(u&&cb(u,n,null),i)for(const R in i){const C=i[R];fe(C)&&(n[R]=C.bind(t))}if(s){const R=s.call(t,t);Fe(R)&&(r.data=Cc(R))}if(Fu=!0,a)for(const R in a){const C=a[R],D=fe(C)?C.bind(t,t):fe(C.get)?C.get.bind(t,t):vr,X=!fe(C)&&fe(C.set)?C.set.bind(t):vr,ae=fa({get:D,set:X});Object.defineProperty(n,R,{enumerable:!0,configurable:!0,get:()=>ae.value,set:q=>ae.value=q})}if(o)for(const R in o)mm(o[R],n,t,R);if(l){const R=fe(l)?l.call(t):l;Reflect.ownKeys(R).forEach(C=>{gb(C,R[C])})}c&&Hd(c,r,"c");function U(R,C){ne(C)?C.forEach(D=>R(D.bind(t))):C&&R(C.bind(t))}if(U(Q_,d),U(bo,f),U(eb,h),U(tb,p),U(K_,m),U(X_,g),U(ib,A),U(ab,S),U(sb,O),U(rb,v),U(Mc,b),U(nb,se),ne(oe))if(oe.length){const R=r.exposed||(r.exposed={});oe.forEach(C=>{Object.defineProperty(R,C,{get:()=>t[C],set:D=>t[C]=D})})}else r.exposed||(r.exposed={});E&&r.render===vr&&(r.render=E),z!=null&&(r.inheritAttrs=z),K&&(r.components=K),Ee&&(r.directives=Ee),se&&fm(r)}function cb(r,e,t=vr){ne(r)&&(r=Du(r));for(const n in r){const s=r[n];let a;Fe(s)?"default"in s?a=xi(s.from||n,s.default,!0):a=xi(s.from||n):a=xi(s),it(a)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>a.value,set:i=>a.value=i}):e[n]=a}}function Hd(r,e,t){Sr(ne(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,t)}function mm(r,e,t,n){let s=n.includes(".")?Im(t,n):()=>t[n];if(qe(r)){const a=e[r];fe(a)&&Be(s,a)}else if(fe(r))Be(s,r.bind(t));else if(Fe(r))if(ne(r))r.forEach(a=>mm(a,e,t,n));else{const a=fe(r.handler)?r.handler.bind(t):e[r.handler];fe(a)&&Be(s,a,r)}}function gm(r){const e=r.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:a,config:{optionMergeStrategies:i}}=r.appContext,o=a.get(e);let l;return o?l=o:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(u=>Ui(l,u,i,!0)),Ui(l,e,i)),Fe(e)&&a.set(e,l),l}function Ui(r,e,t,n=!1){const{mixins:s,extends:a}=e;a&&Ui(r,a,t,!0),s&&s.forEach(i=>Ui(r,i,t,!0));for(const i in e)if(!(n&&i==="expose")){const o=db[i]||t&&t[i];r[i]=o?o(r[i],e[i]):e[i]}return r}const db={data:qd,props:Zd,emits:Zd,methods:Ms,computed:Ms,beforeCreate:ct,created:ct,beforeMount:ct,mounted:ct,beforeUpdate:ct,updated:ct,beforeDestroy:ct,beforeUnmount:ct,destroyed:ct,unmounted:ct,activated:ct,deactivated:ct,errorCaptured:ct,serverPrefetch:ct,components:Ms,directives:Ms,watch:hb,provide:qd,inject:fb};function qd(r,e){return e?r?function(){return mt(fe(r)?r.call(this,this):r,fe(e)?e.call(this,this):e)}:e:r}function fb(r,e){return Ms(Du(r),Du(e))}function Du(r){if(ne(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function ct(r,e){return r?[...new Set([].concat(r,e))]:e}function Ms(r,e){return r?mt(Object.create(null),r,e):e}function Zd(r,e){return r?ne(r)&&ne(e)?[...new Set([...r,...e])]:mt(Object.create(null),Bd(r),Bd(e??{})):e}function hb(r,e){if(!r)return e;if(!e)return r;const t=mt(Object.create(null),r);for(const n in e)t[n]=ct(r[n],e[n]);return t}function ym(){return{app:null,config:{isNativeTag:r_,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let pb=0;function mb(r,e){return function(n,s=null){fe(n)||(n=mt({},n)),s!=null&&!Fe(s)&&(s=null);const a=ym(),i=new WeakSet,o=[];let l=!1;const u=a.app={_uid:pb++,_component:n,_props:s,_container:null,_context:a,_instance:null,version:Kb,get config(){return a.config},set config(c){},use(c,...d){return i.has(c)||(c&&fe(c.install)?(i.add(c),c.install(u,...d)):fe(c)&&(i.add(c),c(u,...d))),u},mixin(c){return a.mixins.includes(c)||a.mixins.push(c),u},component(c,d){return d?(a.components[c]=d,u):a.components[c]},directive(c,d){return d?(a.directives[c]=d,u):a.directives[c]},mount(c,d,f){if(!l){const h=u._ceVNode||Ot(n,s);return h.appContext=a,f===!0?f="svg":f===!1&&(f=void 0),r(h,c,f),l=!0,u._container=c,c.__vue_app__=u,xo(h.component)}},onUnmount(c){o.push(c)},unmount(){l&&(Sr(o,u._instance,16),r(null,u._container),delete u._container.__vue_app__)},provide(c,d){return a.provides[c]=d,u},runWithContext(c){const d=ss;ss=u;try{return c()}finally{ss=d}}};return u}}let ss=null;function gb(r,e){if(pt){let t=pt.provides;const n=pt.parent&&pt.parent.provides;n===t&&(t=pt.provides=Object.create(n)),t[r]=e}}function xi(r,e,t=!1){const n=pt||Bt;if(n||ss){const s=ss?ss._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&r in s)return s[r];if(arguments.length>1)return t&&fe(e)?e.call(n&&n.proxy):e}}const _m={},bm=()=>Object.create(_m),wm=r=>Object.getPrototypeOf(r)===_m;function yb(r,e,t,n=!1){const s={},a=bm();r.propsDefaults=Object.create(null),vm(r,e,s,a);for(const i in r.propsOptions[0])i in s||(s[i]=void 0);t?r.props=n?s:N_(s):r.type.props?r.props=s:r.props=a,r.attrs=a}function _b(r,e,t,n){const{props:s,attrs:a,vnode:{patchFlag:i}}=r,o=Oe(s),[l]=r.propsOptions;let u=!1;if((n||i>0)&&!(i&16)){if(i&8){const c=r.vnode.dynamicProps;for(let d=0;d<c.length;d++){let f=c[d];if(wo(r.emitsOptions,f))continue;const h=e[f];if(l)if(ke(a,f))h!==a[f]&&(a[f]=h,u=!0);else{const p=en(f);s[p]=Uu(l,o,p,h,r,!1)}else h!==a[f]&&(a[f]=h,u=!0)}}}else{vm(r,e,s,a)&&(u=!0);let c;for(const d in o)(!e||!ke(e,d)&&((c=jn(d))===d||!ke(e,c)))&&(l?t&&(t[d]!==void 0||t[c]!==void 0)&&(s[d]=Uu(l,o,d,void 0,r,!0)):delete s[d]);if(a!==o)for(const d in a)(!e||!ke(e,d))&&(delete a[d],u=!0)}u&&jr(r.attrs,"set","")}function vm(r,e,t,n){const[s,a]=r.propsOptions;let i=!1,o;if(e)for(let l in e){if(Gs(l))continue;const u=e[l];let c;s&&ke(s,c=en(l))?!a||!a.includes(c)?t[c]=u:(o||(o={}))[c]=u:wo(r.emitsOptions,l)||(!(l in n)||u!==n[l])&&(n[l]=u,i=!0)}if(a){const l=Oe(t),u=o||$e;for(let c=0;c<a.length;c++){const d=a[c];t[d]=Uu(s,l,d,u[d],r,!ke(u,d))}}return i}function Uu(r,e,t,n,s,a){const i=r[t];if(i!=null){const o=ke(i,"default");if(o&&n===void 0){const l=i.default;if(i.type!==Function&&!i.skipFactory&&fe(l)){const{propsDefaults:u}=s;if(t in u)n=u[t];else{const c=La(s);n=u[t]=l.call(null,e),c()}}else n=l;s.ce&&s.ce._setProp(t,n)}i[0]&&(a&&!o?n=!1:i[1]&&(n===""||n===jn(t))&&(n=!0))}return n}const bb=new WeakMap;function xm(r,e,t=!1){const n=t?bb:e.propsCache,s=n.get(r);if(s)return s;const a=r.props,i={},o=[];let l=!1;if(!fe(r)){const c=d=>{l=!0;const[f,h]=xm(d,e,!0);mt(i,f),h&&o.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(c),r.extends&&c(r.extends),r.mixins&&r.mixins.forEach(c)}if(!a&&!l)return Fe(r)&&n.set(r,es),es;if(ne(a))for(let c=0;c<a.length;c++){const d=en(a[c]);zd(d)&&(i[d]=$e)}else if(a)for(const c in a){const d=en(c);if(zd(d)){const f=a[c],h=i[d]=ne(f)||fe(f)?{type:f}:mt({},f),p=h.type;let m=!1,g=!0;if(ne(p))for(let _=0;_<p.length;++_){const v=p[_],y=fe(v)&&v.name;if(y==="Boolean"){m=!0;break}else y==="String"&&(g=!1)}else m=fe(p)&&p.name==="Boolean";h[0]=m,h[1]=g,(m||ke(h,"default"))&&o.push(d)}}const u=[i,o];return Fe(r)&&n.set(r,u),u}function zd(r){return r[0]!=="$"&&!Gs(r)}const Em=r=>r[0]==="_"||r==="$stable",Fc=r=>ne(r)?r.map(_r):[_r(r)],wb=(r,e,t)=>{if(e._n)return e;const n=G_((...s)=>Fc(e(...s)),t);return n._c=!1,n},Sm=(r,e,t)=>{const n=r._ctx;for(const s in r){if(Em(s))continue;const a=r[s];if(fe(a))e[s]=wb(s,a,n);else if(a!=null){const i=Fc(a);e[s]=()=>i}}},Om=(r,e)=>{const t=Fc(e);r.slots.default=()=>t},km=(r,e,t)=>{for(const n in e)(t||n!=="_")&&(r[n]=e[n])},vb=(r,e,t)=>{const n=r.slots=bm();if(r.vnode.shapeFlag&32){const s=e._;s?(km(n,e,t),t&&Up(n,"_",s,!0)):Sm(e,n)}else e&&Om(r,e)},xb=(r,e,t)=>{const{vnode:n,slots:s}=r;let a=!0,i=$e;if(n.shapeFlag&32){const o=e._;o?t&&o===1?a=!1:km(s,e,t):(a=!e.$stable,Sm(e,s)),i=e}else e&&(Om(r,e),i={default:1});if(a)for(const o in s)!Em(o)&&i[o]==null&&delete s[o]},Ct=Lb;function Eb(r){return Sb(r)}function Sb(r,e){const t=mo();t.__VUE__=!0;const{insert:n,remove:s,patchProp:a,createElement:i,createText:o,createComment:l,setText:u,setElementText:c,parentNode:d,nextSibling:f,setScopeId:h=vr,insertStaticContent:p}=r,m=(w,x,T,L=null,P=null,j=null,V=void 0,H=null,B=!!x.dynamicChildren)=>{if(w===x)return;w&&!Rs(w,x)&&(L=Zt(w),q(w,P,j,!0),w=null),x.patchFlag===-2&&(B=!1,x.dynamicChildren=null);const{type:M,ref:te,shapeFlag:G}=x;switch(M){case vo:g(w,x,T,L);break;case Pn:_(w,x,T,L);break;case Ei:w==null&&v(x,T,L,V);break;case ft:K(w,x,T,L,P,j,V,H,B);break;default:G&1?E(w,x,T,L,P,j,V,H,B):G&6?Ee(w,x,T,L,P,j,V,H,B):(G&64||G&128)&&M.process(w,x,T,L,P,j,V,H,B,Tr)}te!=null&&P&&Di(te,w&&w.ref,j,x||w,!x)},g=(w,x,T,L)=>{if(w==null)n(x.el=o(x.children),T,L);else{const P=x.el=w.el;x.children!==w.children&&u(P,x.children)}},_=(w,x,T,L)=>{w==null?n(x.el=l(x.children||""),T,L):x.el=w.el},v=(w,x,T,L)=>{[w.el,w.anchor]=p(w.children,x,T,L,w.el,w.anchor)},y=({el:w,anchor:x},T,L)=>{let P;for(;w&&w!==x;)P=f(w),n(w,T,L),w=P;n(x,T,L)},b=({el:w,anchor:x})=>{let T;for(;w&&w!==x;)T=f(w),s(w),w=T;s(x)},E=(w,x,T,L,P,j,V,H,B)=>{x.type==="svg"?V="svg":x.type==="math"&&(V="mathml"),w==null?S(x,T,L,P,j,V,H,B):se(w,x,P,j,V,H,B)},S=(w,x,T,L,P,j,V,H)=>{let B,M;const{props:te,shapeFlag:G,transition:ee,dirs:le}=w;if(B=w.el=i(w.type,j,te&&te.is,te),G&8?c(B,w.children):G&16&&A(w.children,B,null,L,P,tl(w,j),V,H),le&&hn(w,null,L,"created"),O(B,w,w.scopeId,V,L),te){for(const je in te)je!=="value"&&!Gs(je)&&a(B,je,null,te[je],j,L);"value"in te&&a(B,"value",null,te.value,j),(M=te.onVnodeBeforeMount)&&fr(M,L,w)}le&&hn(w,null,L,"beforeMount");const ve=Ob(P,ee);ve&&ee.beforeEnter(B),n(B,x,T),((M=te&&te.onVnodeMounted)||ve||le)&&Ct(()=>{M&&fr(M,L,w),ve&&ee.enter(B),le&&hn(w,null,L,"mounted")},P)},O=(w,x,T,L,P)=>{if(T&&h(w,T),L)for(let j=0;j<L.length;j++)h(w,L[j]);if(P){let j=P.subTree;if(x===j||Cm(j.type)&&(j.ssContent===x||j.ssFallback===x)){const V=P.vnode;O(w,V,V.scopeId,V.slotScopeIds,P.parent)}}},A=(w,x,T,L,P,j,V,H,B=0)=>{for(let M=B;M<w.length;M++){const te=w[M]=H?Jr(w[M]):_r(w[M]);m(null,te,x,T,L,P,j,V,H)}},se=(w,x,T,L,P,j,V)=>{const H=x.el=w.el;let{patchFlag:B,dynamicChildren:M,dirs:te}=x;B|=w.patchFlag&16;const G=w.props||$e,ee=x.props||$e;let le;if(T&&pn(T,!1),(le=ee.onVnodeBeforeUpdate)&&fr(le,T,x,w),te&&hn(x,w,T,"beforeUpdate"),T&&pn(T,!0),(G.innerHTML&&ee.innerHTML==null||G.textContent&&ee.textContent==null)&&c(H,""),M?oe(w.dynamicChildren,M,H,T,L,tl(x,P),j):V||C(w,x,H,null,T,L,tl(x,P),j,!1),B>0){if(B&16)z(H,G,ee,T,P);else if(B&2&&G.class!==ee.class&&a(H,"class",null,ee.class,P),B&4&&a(H,"style",G.style,ee.style,P),B&8){const ve=x.dynamicProps;for(let je=0;je<ve.length;je++){const Pe=ve[je],Tt=G[Pe],wt=ee[Pe];(wt!==Tt||Pe==="value")&&a(H,Pe,Tt,wt,P,T)}}B&1&&w.children!==x.children&&c(H,x.children)}else!V&&M==null&&z(H,G,ee,T,P);((le=ee.onVnodeUpdated)||te)&&Ct(()=>{le&&fr(le,T,x,w),te&&hn(x,w,T,"updated")},L)},oe=(w,x,T,L,P,j,V)=>{for(let H=0;H<x.length;H++){const B=w[H],M=x[H],te=B.el&&(B.type===ft||!Rs(B,M)||B.shapeFlag&70)?d(B.el):T;m(B,M,te,null,L,P,j,V,!0)}},z=(w,x,T,L,P)=>{if(x!==T){if(x!==$e)for(const j in x)!Gs(j)&&!(j in T)&&a(w,j,x[j],null,P,L);for(const j in T){if(Gs(j))continue;const V=T[j],H=x[j];V!==H&&j!=="value"&&a(w,j,H,V,P,L)}"value"in T&&a(w,"value",x.value,T.value,P)}},K=(w,x,T,L,P,j,V,H,B)=>{const M=x.el=w?w.el:o(""),te=x.anchor=w?w.anchor:o("");let{patchFlag:G,dynamicChildren:ee,slotScopeIds:le}=x;le&&(H=H?H.concat(le):le),w==null?(n(M,T,L),n(te,T,L),A(x.children||[],T,te,P,j,V,H,B)):G>0&&G&64&&ee&&w.dynamicChildren?(oe(w.dynamicChildren,ee,T,P,j,V,H),(x.key!=null||P&&x===P.subTree)&&Tm(w,x,!0)):C(w,x,T,te,P,j,V,H,B)},Ee=(w,x,T,L,P,j,V,H,B)=>{x.slotScopeIds=H,w==null?x.shapeFlag&512?P.ctx.activate(x,T,L,V,B):F(x,T,L,P,j,V,B):I(w,x,B)},F=(w,x,T,L,P,j,V)=>{const H=w.component=Zb(w,L,P);if(hm(w)&&(H.ctx.renderer=Tr),zb(H,!1,V),H.asyncDep){if(P&&P.registerDep(H,U,V),!w.el){const B=H.subTree=Ot(Pn);_(null,B,x,T)}}else U(H,w,x,T,P,j,V)},I=(w,x,T)=>{const L=x.component=w.component;if(Nb(w,x,T))if(L.asyncDep&&!L.asyncResolved){R(L,x,T);return}else L.next=x,L.update();else x.el=w.el,L.vnode=x},U=(w,x,T,L,P,j,V)=>{const H=()=>{if(w.isMounted){let{next:G,bu:ee,u:le,parent:ve,vnode:je}=w;{const cr=Am(w);if(cr){G&&(G.el=je.el,R(w,G,V)),cr.asyncDep.then(()=>{w.isUnmounted||H()});return}}let Pe=G,Tt;pn(w,!1),G?(G.el=je.el,R(w,G,V)):G=je,ee&&vi(ee),(Tt=G.props&&G.props.onVnodeBeforeUpdate)&&fr(Tt,ve,G,je),pn(w,!0);const wt=Gd(w),ur=w.subTree;w.subTree=wt,m(ur,wt,d(ur.el),Zt(ur),w,P,j),G.el=wt.el,Pe===null&&jb(w,wt.el),le&&Ct(le,P),(Tt=G.props&&G.props.onVnodeUpdated)&&Ct(()=>fr(Tt,ve,G,je),P)}else{let G;const{el:ee,props:le}=x,{bm:ve,m:je,parent:Pe,root:Tt,type:wt}=w,ur=Ks(x);pn(w,!1),ve&&vi(ve),!ur&&(G=le&&le.onVnodeBeforeMount)&&fr(G,Pe,x),pn(w,!0);{Tt.ce&&Tt.ce._injectChildStyle(wt);const cr=w.subTree=Gd(w);m(null,cr,T,L,w,P,j),x.el=cr.el}if(je&&Ct(je,P),!ur&&(G=le&&le.onVnodeMounted)){const cr=x;Ct(()=>fr(G,Pe,cr),P)}(x.shapeFlag&256||Pe&&Ks(Pe.vnode)&&Pe.vnode.shapeFlag&256)&&w.a&&Ct(w.a,P),w.isMounted=!0,x=T=L=null}};w.scope.on();const B=w.effect=new Zp(H);w.scope.off();const M=w.update=B.run.bind(B),te=w.job=B.runIfDirty.bind(B);te.i=w,te.id=w.uid,B.scheduler=()=>jc(te),pn(w,!0),M()},R=(w,x,T)=>{x.component=w;const L=w.vnode.props;w.vnode=x,w.next=null,_b(w,x.props,L,T),xb(w,x.children,T),cn(),Ud(w),dn()},C=(w,x,T,L,P,j,V,H,B=!1)=>{const M=w&&w.children,te=w?w.shapeFlag:0,G=x.children,{patchFlag:ee,shapeFlag:le}=x;if(ee>0){if(ee&128){X(M,G,T,L,P,j,V,H,B);return}else if(ee&256){D(M,G,T,L,P,j,V,H,B);return}}le&8?(te&16&&bt(M,P,j),G!==M&&c(T,G)):te&16?le&16?X(M,G,T,L,P,j,V,H,B):bt(M,P,j,!0):(te&8&&c(T,""),le&16&&A(G,T,L,P,j,V,H,B))},D=(w,x,T,L,P,j,V,H,B)=>{w=w||es,x=x||es;const M=w.length,te=x.length,G=Math.min(M,te);let ee;for(ee=0;ee<G;ee++){const le=x[ee]=B?Jr(x[ee]):_r(x[ee]);m(w[ee],le,T,null,P,j,V,H,B)}M>te?bt(w,P,j,!0,!1,G):A(x,T,L,P,j,V,H,B,G)},X=(w,x,T,L,P,j,V,H,B)=>{let M=0;const te=x.length;let G=w.length-1,ee=te-1;for(;M<=G&&M<=ee;){const le=w[M],ve=x[M]=B?Jr(x[M]):_r(x[M]);if(Rs(le,ve))m(le,ve,T,null,P,j,V,H,B);else break;M++}for(;M<=G&&M<=ee;){const le=w[G],ve=x[ee]=B?Jr(x[ee]):_r(x[ee]);if(Rs(le,ve))m(le,ve,T,null,P,j,V,H,B);else break;G--,ee--}if(M>G){if(M<=ee){const le=ee+1,ve=le<te?x[le].el:L;for(;M<=ee;)m(null,x[M]=B?Jr(x[M]):_r(x[M]),T,ve,P,j,V,H,B),M++}}else if(M>ee)for(;M<=G;)q(w[M],P,j,!0),M++;else{const le=M,ve=M,je=new Map;for(M=ve;M<=ee;M++){const At=x[M]=B?Jr(x[M]):_r(x[M]);At.key!=null&&je.set(At.key,M)}let Pe,Tt=0;const wt=ee-ve+1;let ur=!1,cr=0;const Ps=new Array(wt);for(M=0;M<wt;M++)Ps[M]=0;for(M=le;M<=G;M++){const At=w[M];if(Tt>=wt){q(At,P,j,!0);continue}let dr;if(At.key!=null)dr=je.get(At.key);else for(Pe=ve;Pe<=ee;Pe++)if(Ps[Pe-ve]===0&&Rs(At,x[Pe])){dr=Pe;break}dr===void 0?q(At,P,j,!0):(Ps[dr-ve]=M+1,dr>=cr?cr=dr:ur=!0,m(At,x[dr],T,null,P,j,V,H,B),Tt++)}const Nd=ur?kb(Ps):es;for(Pe=Nd.length-1,M=wt-1;M>=0;M--){const At=ve+M,dr=x[At],jd=At+1<te?x[At+1].el:L;Ps[M]===0?m(null,dr,T,jd,P,j,V,H,B):ur&&(Pe<0||M!==Nd[Pe]?ae(dr,T,jd,2):Pe--)}}},ae=(w,x,T,L,P=null)=>{const{el:j,type:V,transition:H,children:B,shapeFlag:M}=w;if(M&6){ae(w.component.subTree,x,T,L);return}if(M&128){w.suspense.move(x,T,L);return}if(M&64){V.move(w,x,T,Tr);return}if(V===ft){n(j,x,T);for(let G=0;G<B.length;G++)ae(B[G],x,T,L);n(w.anchor,x,T);return}if(V===Ei){y(w,x,T);return}if(L!==2&&M&1&&H)if(L===0)H.beforeEnter(j),n(j,x,T),Ct(()=>H.enter(j),P);else{const{leave:G,delayLeave:ee,afterLeave:le}=H,ve=()=>n(j,x,T),je=()=>{G(j,()=>{ve(),le&&le()})};ee?ee(j,ve,je):je()}else n(j,x,T)},q=(w,x,T,L=!1,P=!1)=>{const{type:j,props:V,ref:H,children:B,dynamicChildren:M,shapeFlag:te,patchFlag:G,dirs:ee,cacheIndex:le}=w;if(G===-2&&(P=!1),H!=null&&Di(H,null,T,w,!0),le!=null&&(x.renderCache[le]=void 0),te&256){x.ctx.deactivate(w);return}const ve=te&1&&ee,je=!Ks(w);let Pe;if(je&&(Pe=V&&V.onVnodeBeforeUnmount)&&fr(Pe,x,w),te&6)Me(w.component,T,L);else{if(te&128){w.suspense.unmount(T,L);return}ve&&hn(w,null,x,"beforeUnmount"),te&64?w.type.remove(w,x,T,Tr,L):M&&!M.hasOnce&&(j!==ft||G>0&&G&64)?bt(M,x,T,!1,!0):(j===ft&&G&384||!P&&te&16)&&bt(B,x,T),L&&ue(w)}(je&&(Pe=V&&V.onVnodeUnmounted)||ve)&&Ct(()=>{Pe&&fr(Pe,x,w),ve&&hn(w,null,x,"unmounted")},T)},ue=w=>{const{type:x,el:T,anchor:L,transition:P}=w;if(x===ft){Ne(T,L);return}if(x===Ei){b(w);return}const j=()=>{s(T),P&&!P.persisted&&P.afterLeave&&P.afterLeave()};if(w.shapeFlag&1&&P&&!P.persisted){const{leave:V,delayLeave:H}=P,B=()=>V(T,j);H?H(w.el,j,B):B()}else j()},Ne=(w,x)=>{let T;for(;w!==x;)T=f(w),s(w),w=T;s(x)},Me=(w,x,T)=>{const{bum:L,scope:P,job:j,subTree:V,um:H,m:B,a:M}=w;Vd(B),Vd(M),L&&vi(L),P.stop(),j&&(j.flags|=8,q(V,w,x,T)),H&&Ct(H,x),Ct(()=>{w.isUnmounted=!0},x),x&&x.pendingBranch&&!x.isUnmounted&&w.asyncDep&&!w.asyncResolved&&w.suspenseId===x.pendingId&&(x.deps--,x.deps===0&&x.resolve())},bt=(w,x,T,L=!1,P=!1,j=0)=>{for(let V=j;V<w.length;V++)q(w[V],x,T,L,P)},Zt=w=>{if(w.shapeFlag&6)return Zt(w.component.subTree);if(w.shapeFlag&128)return w.suspense.next();const x=f(w.anchor||w.el),T=x&&x[W_];return T?f(T):x};let Ln=!1;const Mn=(w,x,T)=>{w==null?x._vnode&&q(x._vnode,null,null,!0):m(x._vnode||null,w,x,null,null,null,T),x._vnode=w,Ln||(Ln=!0,Ud(),um(),Ln=!1)},Tr={p:m,um:q,m:ae,r:ue,mt:F,mc:A,pc:C,pbc:oe,n:Zt,o:r};return{render:Mn,hydrate:void 0,createApp:mb(Mn)}}function tl({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function pn({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function Ob(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function Tm(r,e,t=!1){const n=r.children,s=e.children;if(ne(n)&&ne(s))for(let a=0;a<n.length;a++){const i=n[a];let o=s[a];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[a]=Jr(s[a]),o.el=i.el),!t&&o.patchFlag!==-2&&Tm(i,o)),o.type===vo&&(o.el=i.el)}}function kb(r){const e=r.slice(),t=[0];let n,s,a,i,o;const l=r.length;for(n=0;n<l;n++){const u=r[n];if(u!==0){if(s=t[t.length-1],r[s]<u){e[n]=s,t.push(n);continue}for(a=0,i=t.length-1;a<i;)o=a+i>>1,r[t[o]]<u?a=o+1:i=o;u<r[t[a]]&&(a>0&&(e[n]=t[a-1]),t[a]=n)}}for(a=t.length,i=t[a-1];a-- >0;)t[a]=i,i=e[i];return t}function Am(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Am(e)}function Vd(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const Tb=Symbol.for("v-scx"),Ab=()=>xi(Tb);function Be(r,e,t){return Pm(r,e,t)}function Pm(r,e,t=$e){const{immediate:n,deep:s,flush:a,once:i}=t,o=mt({},t),l=e&&n||!e&&a!=="post";let u;if(da){if(a==="sync"){const h=Ab();u=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=vr,h.resume=vr,h.pause=vr,h}}const c=pt;o.call=(h,p,m)=>Sr(h,c,p,m);let d=!1;a==="post"?o.scheduler=h=>{Ct(h,c&&c.suspense)}:a!=="sync"&&(d=!0,o.scheduler=(h,p)=>{p?h():jc(h)}),o.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,c&&(h.id=c.uid,h.i=c))};const f=q_(r,e,o);return da&&(u?u.push(f):l&&f()),f}function Pb(r,e,t){const n=this.proxy,s=qe(r)?r.includes(".")?Im(n,r):()=>n[r]:r.bind(n,n);let a;fe(e)?a=e:(a=e.handler,t=e);const i=La(this),o=Pm(s,a.bind(n),t);return i(),o}function Im(r,e){const t=e.split(".");return()=>{let n=r;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const Ib=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${en(e)}Modifiers`]||r[`${jn(e)}Modifiers`];function Rb(r,e,...t){if(r.isUnmounted)return;const n=r.vnode.props||$e;let s=t;const a=e.startsWith("update:"),i=a&&Ib(n,e.slice(7));i&&(i.trim&&(s=t.map(c=>qe(c)?c.trim():c)),i.number&&(s=t.map(ji)));let o,l=n[o=Jo(e)]||n[o=Jo(en(e))];!l&&a&&(l=n[o=Jo(jn(e))]),l&&Sr(l,r,6,s);const u=n[o+"Once"];if(u){if(!r.emitted)r.emitted={};else if(r.emitted[o])return;r.emitted[o]=!0,Sr(u,r,6,s)}}function Rm(r,e,t=!1){const n=e.emitsCache,s=n.get(r);if(s!==void 0)return s;const a=r.emits;let i={},o=!1;if(!fe(r)){const l=u=>{const c=Rm(u,e,!0);c&&(o=!0,mt(i,c))};!t&&e.mixins.length&&e.mixins.forEach(l),r.extends&&l(r.extends),r.mixins&&r.mixins.forEach(l)}return!a&&!o?(Fe(r)&&n.set(r,null),null):(ne(a)?a.forEach(l=>i[l]=null):mt(i,a),Fe(r)&&n.set(r,i),i)}function wo(r,e){return!r||!ho(e)?!1:(e=e.slice(2).replace(/Once$/,""),ke(r,e[0].toLowerCase()+e.slice(1))||ke(r,jn(e))||ke(r,e))}function Gd(r){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[a],slots:i,attrs:o,emit:l,render:u,renderCache:c,props:d,data:f,setupState:h,ctx:p,inheritAttrs:m}=r,g=Fi(r);let _,v;try{if(t.shapeFlag&4){const b=s||n,E=b;_=_r(u.call(E,b,c,d,h,f,p)),v=o}else{const b=e;_=_r(b.length>1?b(d,{attrs:o,slots:i,emit:l}):b(d,null)),v=e.props?o:Cb(o)}}catch(b){Ys.length=0,yo(b,r,1),_=Ot(Pn)}let y=_;if(v&&m!==!1){const b=Object.keys(v),{shapeFlag:E}=y;b.length&&E&7&&(a&&b.some(Ec)&&(v=$b(v,a)),y=cs(y,v,!1,!0))}return t.dirs&&(y=cs(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(t.dirs):t.dirs),t.transition&&Lc(y,t.transition),_=y,Fi(g),_}const Cb=r=>{let e;for(const t in r)(t==="class"||t==="style"||ho(t))&&((e||(e={}))[t]=r[t]);return e},$b=(r,e)=>{const t={};for(const n in r)(!Ec(n)||!(n.slice(9)in e))&&(t[n]=r[n]);return t};function Nb(r,e,t){const{props:n,children:s,component:a}=r,{props:i,children:o,patchFlag:l}=e,u=a.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?Wd(n,i,u):!!i;if(l&8){const c=e.dynamicProps;for(let d=0;d<c.length;d++){const f=c[d];if(i[f]!==n[f]&&!wo(u,f))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:n===i?!1:n?i?Wd(n,i,u):!0:!!i;return!1}function Wd(r,e,t){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let s=0;s<n.length;s++){const a=n[s];if(e[a]!==r[a]&&!wo(t,a))return!0}return!1}function jb({vnode:r,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=t,e=e.parent;else break}}const Cm=r=>r.__isSuspense;function Lb(r,e){e&&e.pendingBranch?ne(r)?e.effects.push(...r):e.effects.push(r):V_(r)}const ft=Symbol.for("v-fgt"),vo=Symbol.for("v-txt"),Pn=Symbol.for("v-cmt"),Ei=Symbol.for("v-stc"),Ys=[];let Lt=null;function me(r=!1){Ys.push(Lt=r?null:[])}function Mb(){Ys.pop(),Lt=Ys[Ys.length-1]||null}let ca=1;function Jd(r,e=!1){ca+=r,r<0&&Lt&&e&&(Lt.hasOnce=!0)}function $m(r){return r.dynamicChildren=ca>0?Lt||es:null,Mb(),ca>0&&Lt&&Lt.push(r),r}function be(r,e,t,n,s,a){return $m($(r,e,t,n,s,a,!0))}function Si(r,e,t,n,s){return $m(Ot(r,e,t,n,s,!0))}function Nm(r){return r?r.__v_isVNode===!0:!1}function Rs(r,e){return r.type===e.type&&r.key===e.key}const jm=({key:r})=>r??null,Oi=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?qe(r)||it(r)||fe(r)?{i:Bt,r,k:e,f:!!t}:r:null);function $(r,e=null,t=null,n=0,s=null,a=r===ft?0:1,i=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&jm(e),ref:e&&Oi(e),scopeId:dm,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bt};return o?(Uc(l,t),a&128&&r.normalize(l)):t&&(l.shapeFlag|=qe(t)?8:16),ca>0&&!i&&Lt&&(l.patchFlag>0||a&6)&&l.patchFlag!==32&&Lt.push(l),l}const Ot=Fb;function Fb(r,e=null,t=null,n=0,s=null,a=!1){if((!r||r===ob)&&(r=Pn),Nm(r)){const o=cs(r,e,!0);return t&&Uc(o,t),ca>0&&!a&&Lt&&(o.shapeFlag&6?Lt[Lt.indexOf(r)]=o:Lt.push(o)),o.patchFlag=-2,o}if(Jb(r)&&(r=r.__vccOpts),e){e=Db(e);let{class:o,style:l}=e;o&&!qe(o)&&(e.class=Na(o)),Fe(l)&&(Nc(l)&&!ne(l)&&(l=mt({},l)),e.style=ia(l))}const i=qe(r)?1:Cm(r)?128:J_(r)?64:Fe(r)?4:fe(r)?2:0;return $(r,e,t,n,s,i,a,!0)}function Db(r){return r?Nc(r)||wm(r)?mt({},r):r:null}function cs(r,e,t=!1,n=!1){const{props:s,ref:a,patchFlag:i,children:o,transition:l}=r,u=e?Bb(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:r.type,props:u,key:u&&jm(u),ref:e&&e.ref?t&&a?ne(a)?a.concat(Oi(e)):[a,Oi(e)]:Oi(e):a,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:o,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==ft?i===-1?16:i|16:i,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:l,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&cs(r.ssContent),ssFallback:r.ssFallback&&cs(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return l&&n&&Lc(c,l.clone(c)),c}function Bu(r=" ",e=0){return Ot(vo,null,r,e)}function Ub(r,e){const t=Ot(Ei,null,r);return t.staticCount=e,t}function Dc(r="",e=!1){return e?(me(),Si(Pn,null,r)):Ot(Pn,null,r)}function _r(r){return r==null||typeof r=="boolean"?Ot(Pn):ne(r)?Ot(ft,null,r.slice()):Nm(r)?Jr(r):Ot(vo,null,String(r))}function Jr(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:cs(r)}function Uc(r,e){let t=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(ne(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),Uc(r,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!wm(e)?e._ctx=Bt:s===3&&Bt&&(Bt.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else fe(e)?(e={default:e,_ctx:Bt},t=32):(e=String(e),n&64?(t=16,e=[Bu(e)]):t=8);r.children=e,r.shapeFlag|=t}function Bb(...r){const e={};for(let t=0;t<r.length;t++){const n=r[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=Na([e.class,n.class]));else if(s==="style")e.style=ia([e.style,n.style]);else if(ho(s)){const a=e[s],i=n[s];i&&a!==i&&!(ne(a)&&a.includes(i))&&(e[s]=a?[].concat(a,i):i)}else s!==""&&(e[s]=n[s])}return e}function fr(r,e,t,n=null){Sr(r,e,7,[t,n])}const Hb=ym();let qb=0;function Zb(r,e,t){const n=r.type,s=(e?e.appContext:r.appContext)||Hb,a={uid:qb++,vnode:r,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new p_(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:xm(n,s),emitsOptions:Rm(n,s),emit:null,emitted:null,propsDefaults:$e,inheritAttrs:n.inheritAttrs,ctx:$e,data:$e,props:$e,attrs:$e,slots:$e,refs:$e,setupState:$e,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=Rb.bind(null,a),r.ce&&r.ce(a),a}let pt=null,Bi,Hu;{const r=mo(),e=(t,n)=>{let s;return(s=r[t])||(s=r[t]=[]),s.push(n),a=>{s.length>1?s.forEach(i=>i(a)):s[0](a)}};Bi=e("__VUE_INSTANCE_SETTERS__",t=>pt=t),Hu=e("__VUE_SSR_SETTERS__",t=>da=t)}const La=r=>{const e=pt;return Bi(r),r.scope.on(),()=>{r.scope.off(),Bi(e)}},Kd=()=>{pt&&pt.scope.off(),Bi(null)};function Lm(r){return r.vnode.shapeFlag&4}let da=!1;function zb(r,e=!1,t=!1){e&&Hu(e);const{props:n,children:s}=r.vnode,a=Lm(r);yb(r,n,a,e),vb(r,s,t);const i=a?Vb(r,e):void 0;return e&&Hu(!1),i}function Vb(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,lb);const{setup:n}=t;if(n){cn();const s=r.setupContext=n.length>1?Wb(r):null,a=La(r),i=ja(n,r,0,[r.props,s]),o=Lp(i);if(dn(),a(),(o||r.sp)&&!Ks(r)&&fm(r),o){if(i.then(Kd,Kd),e)return i.then(l=>{Xd(r,l)}).catch(l=>{yo(l,r,0)});r.asyncDep=i}else Xd(r,i)}else Mm(r)}function Xd(r,e,t){fe(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Fe(e)&&(r.setupState=am(e)),Mm(r)}function Mm(r,e,t){const n=r.type;r.render||(r.render=n.render||vr);{const s=La(r);cn();try{ub(r)}finally{dn(),s()}}}const Gb={get(r,e){return nt(r,"get",""),r[e]}};function Wb(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,Gb),slots:r.slots,emit:r.emit,expose:e}}function xo(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(am(j_(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in Xs)return Xs[t](r)},has(e,t){return t in e||t in Xs}})):r.proxy}function Jb(r){return fe(r)&&"__vccOpts"in r}const fa=(r,e)=>B_(r,e,da),Kb="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let qu;const Yd=typeof window<"u"&&window.trustedTypes;if(Yd)try{qu=Yd.createPolicy("vue",{createHTML:r=>r})}catch{}const Fm=qu?r=>qu.createHTML(r):r=>r,Xb="http://www.w3.org/2000/svg",Yb="http://www.w3.org/1998/Math/MathML",$r=typeof document<"u"?document:null,Qd=$r&&$r.createElement("template"),Qb={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,n)=>{const s=e==="svg"?$r.createElementNS(Xb,r):e==="mathml"?$r.createElementNS(Yb,r):t?$r.createElement(r,{is:t}):$r.createElement(r);return r==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:r=>$r.createTextNode(r),createComment:r=>$r.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>$r.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,n,s,a){const i=t?t.previousSibling:e.lastChild;if(s&&(s===a||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===a||!(s=s.nextSibling)););else{Qd.innerHTML=Fm(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const o=Qd.content;if(n==="svg"||n==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}e.insertBefore(o,t)}return[i?i.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},ew=Symbol("_vtc");function tw(r,e,t){const n=r[ew];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const ef=Symbol("_vod"),rw=Symbol("_vsh"),nw=Symbol(""),sw=/(^|;)\s*display\s*:/;function aw(r,e,t){const n=r.style,s=qe(t);let a=!1;if(t&&!s){if(e)if(qe(e))for(const i of e.split(";")){const o=i.slice(0,i.indexOf(":")).trim();t[o]==null&&ki(n,o,"")}else for(const i in e)t[i]==null&&ki(n,i,"");for(const i in t)i==="display"&&(a=!0),ki(n,i,t[i])}else if(s){if(e!==t){const i=n[nw];i&&(t+=";"+i),n.cssText=t,a=sw.test(t)}}else e&&r.removeAttribute("style");ef in r&&(r[ef]=a?n.display:"",r[rw]&&(n.display="none"))}const tf=/\s*!important$/;function ki(r,e,t){if(ne(t))t.forEach(n=>ki(r,e,n));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const n=iw(r,e);tf.test(t)?r.setProperty(jn(n),t.replace(tf,""),"important"):r[n]=t}}const rf=["Webkit","Moz","ms"],rl={};function iw(r,e){const t=rl[e];if(t)return t;let n=en(e);if(n!=="filter"&&n in r)return rl[e]=n;n=Dp(n);for(let s=0;s<rf.length;s++){const a=rf[s]+n;if(a in r)return rl[e]=a}return e}const nf="http://www.w3.org/1999/xlink";function sf(r,e,t,n,s,a=f_(e)){n&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(nf,e.slice(6,e.length)):r.setAttributeNS(nf,e,t):t==null||a&&!Bp(t)?r.removeAttribute(e):r.setAttribute(e,a?"":Er(t)?String(t):t)}function af(r,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?Fm(t):t);return}const a=r.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){const o=a==="OPTION"?r.getAttribute("value")||"":r.value,l=t==null?r.type==="checkbox"?"on":"":String(t);(o!==l||!("_value"in r))&&(r.value=l),t==null&&r.removeAttribute(e),r._value=t;return}let i=!1;if(t===""||t==null){const o=typeof r[e];o==="boolean"?t=Bp(t):t==null&&o==="string"?(t="",i=!0):o==="number"&&(t=0,i=!0)}try{r[e]=t}catch{}i&&r.removeAttribute(s||e)}function Mr(r,e,t,n){r.addEventListener(e,t,n)}function ow(r,e,t,n){r.removeEventListener(e,t,n)}const of=Symbol("_vei");function lw(r,e,t,n,s=null){const a=r[of]||(r[of]={}),i=a[e];if(n&&i)i.value=n;else{const[o,l]=uw(e);if(n){const u=a[e]=fw(n,s);Mr(r,o,u,l)}else i&&(ow(r,o,i,l),a[e]=void 0)}}const lf=/(?:Once|Passive|Capture)$/;function uw(r){let e;if(lf.test(r)){e={};let n;for(;n=r.match(lf);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):jn(r.slice(2)),e]}let nl=0;const cw=Promise.resolve(),dw=()=>nl||(cw.then(()=>nl=0),nl=Date.now());function fw(r,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;Sr(hw(n,t.value),e,5,[n])};return t.value=r,t.attached=dw(),t}function hw(r,e){if(ne(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const uf=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,pw=(r,e,t,n,s,a)=>{const i=s==="svg";e==="class"?tw(r,n,i):e==="style"?aw(r,t,n):ho(e)?Ec(e)||lw(r,e,t,n,a):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):mw(r,e,n,i))?(af(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&sf(r,e,n,i,a,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!qe(n))?af(r,en(e),n,a,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),sf(r,e,n,i))};function mw(r,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&uf(e)&&fe(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=r.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return uf(e)&&qe(t)?!1:e in r}const tn=r=>{const e=r.props["onUpdate:modelValue"]||!1;return ne(e)?t=>vi(e,t):e};function gw(r){r.target.composing=!0}function cf(r){const e=r.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const qt=Symbol("_assign"),Hi={created(r,{modifiers:{lazy:e,trim:t,number:n}},s){r[qt]=tn(s);const a=n||s.props&&s.props.type==="number";Mr(r,e?"change":"input",i=>{if(i.target.composing)return;let o=r.value;t&&(o=o.trim()),a&&(o=ji(o)),r[qt](o)}),t&&Mr(r,"change",()=>{r.value=r.value.trim()}),e||(Mr(r,"compositionstart",gw),Mr(r,"compositionend",cf),Mr(r,"change",cf))},mounted(r,{value:e}){r.value=e??""},beforeUpdate(r,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:a}},i){if(r[qt]=tn(i),r.composing)return;const o=(a||r.type==="number")&&!/^0\d/.test(r.value)?ji(r.value):r.value,l=e??"";o!==l&&(document.activeElement===r&&r.type!=="range"&&(n&&e===t||s&&r.value.trim()===l)||(r.value=l))}},Dm={deep:!0,created(r,e,t){r[qt]=tn(t),Mr(r,"change",()=>{const n=r._modelValue,s=ds(r),a=r.checked,i=r[qt];if(ne(n)){const o=kc(n,s),l=o!==-1;if(a&&!l)i(n.concat(s));else if(!a&&l){const u=[...n];u.splice(o,1),i(u)}}else if(_s(n)){const o=new Set(n);a?o.add(s):o.delete(s),i(o)}else i(Um(r,a))})},mounted:df,beforeUpdate(r,e,t){r[qt]=tn(t),df(r,e,t)}};function df(r,{value:e,oldValue:t},n){r._modelValue=e;let s;if(ne(e))s=kc(e,n.props.value)>-1;else if(_s(e))s=e.has(n.props.value);else{if(e===t)return;s=Tn(e,Um(r,!0))}r.checked!==s&&(r.checked=s)}const yw={created(r,{value:e},t){r.checked=Tn(e,t.props.value),r[qt]=tn(t),Mr(r,"change",()=>{r[qt](ds(r))})},beforeUpdate(r,{value:e,oldValue:t},n){r[qt]=tn(n),e!==t&&(r.checked=Tn(e,n.props.value))}},_n={deep:!0,created(r,{value:e,modifiers:{number:t}},n){const s=_s(e);Mr(r,"change",()=>{const a=Array.prototype.filter.call(r.options,i=>i.selected).map(i=>t?ji(ds(i)):ds(i));r[qt](r.multiple?s?new Set(a):a:a[0]),r._assigning=!0,om(()=>{r._assigning=!1})}),r[qt]=tn(n)},mounted(r,{value:e}){ff(r,e)},beforeUpdate(r,e,t){r[qt]=tn(t)},updated(r,{value:e}){r._assigning||ff(r,e)}};function ff(r,e){const t=r.multiple,n=ne(e);if(!(t&&!n&&!_s(e))){for(let s=0,a=r.options.length;s<a;s++){const i=r.options[s],o=ds(i);if(t)if(n){const l=typeof o;l==="string"||l==="number"?i.selected=e.some(u=>String(u)===String(o)):i.selected=kc(e,o)>-1}else i.selected=e.has(o);else if(Tn(ds(i),e)){r.selectedIndex!==s&&(r.selectedIndex=s);return}}!t&&r.selectedIndex!==-1&&(r.selectedIndex=-1)}}function ds(r){return"_value"in r?r._value:r.value}function Um(r,e){const t=e?"_trueValue":"_falseValue";return t in r?r[t]:e}const _w={created(r,e,t){Qa(r,e,t,null,"created")},mounted(r,e,t){Qa(r,e,t,null,"mounted")},beforeUpdate(r,e,t,n){Qa(r,e,t,n,"beforeUpdate")},updated(r,e,t,n){Qa(r,e,t,n,"updated")}};function bw(r,e){switch(r){case"SELECT":return _n;case"TEXTAREA":return Hi;default:switch(e){case"checkbox":return Dm;case"radio":return yw;default:return Hi}}}function Qa(r,e,t,n,s){const i=bw(r.tagName,t.props&&t.props.type)[s];i&&i(r,e,t,n)}const ww=mt({patchProp:pw},Qb);let hf;function vw(){return hf||(hf=Eb(ww))}const xw=(...r)=>{const e=vw().createApp(...r),{mount:t}=e;return e.mount=n=>{const s=Sw(n);if(!s)return;const a=e._component;!fe(a)&&!a.render&&!a.template&&(a.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=t(s,!1,Ew(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},e};function Ew(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function Sw(r){return qe(r)?document.querySelector(r):r}const Et={LIGHT:"light",DARK:"dark",SYSTEM:"system"},Bm="flowpal-theme-preference";function Hm(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}function Zu(r){r===Et.DARK||r===Et.SYSTEM&&Hm()?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))}function Ow(r){Object.values(Et).includes(r)&&(localStorage.setItem(Bm,r),Zu(r))}function zu(){return localStorage.getItem(Bm)||Et.SYSTEM}function kw(){const r=zu();if(Zu(r),window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{zu()===Et.SYSTEM&&Zu(Et.SYSTEM)};e.addEventListener?e.addEventListener("change",t):e.addListener&&e.addListener(t)}}const Eo=(r,e)=>{const t=r.__vccOpts||r;for(const[n,s]of e)t[n]=s;return t},Tw={},Aw={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Pw(r,e){return me(),be("svg",Aw,e[0]||(e[0]=[Ub('<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>',9)]))}const Iw=Eo(Tw,[["render",Pw]]),Rw={},Cw={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function $w(r,e){return me(),be("svg",Cw,e[0]||(e[0]=[$("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},null,-1)]))}const Nw=Eo(Rw,[["render",$w]]),jw={},Lw={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Mw(r,e){return me(),be("svg",Lw,e[0]||(e[0]=[$("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"},null,-1),$("line",{x1:"8",y1:"21",x2:"16",y2:"21"},null,-1),$("line",{x1:"12",y1:"17",x2:"12",y2:"21"},null,-1)]))}const Fw=Eo(jw,[["render",Mw]]),Dw={__name:"ThemeSwitcher",setup(r){const e=_e(zu()),t=()=>{e.value===Et.LIGHT?e.value=Et.DARK:e.value===Et.DARK?e.value=Et.SYSTEM:e.value=Et.LIGHT,Ow(e.value)},n=fa(()=>e.value===Et.LIGHT?"sun":e.value===Et.DARK?"moon":e.value===Et.SYSTEM?"monitor":Hm()?"moon":"sun");return(s,a)=>(me(),be("button",{onClick:t,class:"flex items-center rounded-md p-1.5 text-xs transition-colors text-gray-600/60 hover:text-gray-800 dark:text-gray-400/60 dark:hover:text-white hover:bg-gray-100 focus:outline-none dark:hover:bg-gray-800","aria-label":"Toggle theme"},[n.value==="sun"?(me(),Si(Iw,{key:0,class:"h-4 w-4"})):n.value==="moon"?(me(),Si(Nw,{key:1,class:"h-4 w-4"})):(me(),Si(Fw,{key:2,class:"h-4 w-4"}))]))}},Uw={class:"sticky top-0 z-10 bg-transparent dark:bg-transparent backdrop-blur-sm"},Bw={class:"flex items-center justify-between p-1.5 sm:p-1.5"},Hw={class:"flex items-center space-x-2"},qw=["value"],Zw={__name:"Header",props:{writingStyle:{type:String,default:"preserve"},writingStyles:{type:Array,default:()=>[{id:"preserve",label:"Default"},{id:"business",label:"Business"},{id:"technical",label:"Technical"},{id:"casual",label:"Casual"},{id:"marketing",label:"Marketing"},{id:"simple",label:"Simple"}]}},emits:["toggle-settings","update:writing-style","clear-text"],setup(r,{emit:e}){const t=r,n=e,s=_e(t.writingStyle);function a(){n("toggle-settings")}function i(){n("update:writing-style",s.value)}function o(){n("clear-text")}return(l,u)=>(me(),be("header",Uw,[$("div",Bw,[u[3]||(u[3]=$("h1",{class:"text-sm font-normal text-gray-500/60 dark:text-gray-400/60 cursor-default uppercase tracking-wider"},"FlowPal",-1)),$("div",Hw,[mr($("select",{"onUpdate:modelValue":u[0]||(u[0]=c=>s.value=c),onChange:i,class:Na(["h-6 rounded-md border-0 bg-transparent px-2 py-0 text-xs text-gray-600/90 ring-0 focus:ring-0 dark:text-gray-400/90 appearance-none focus:outline-none cursor-pointer",{"opacity-70":s.value==="preserve"}])},[(me(!0),be(ft,null,zn(r.writingStyles,c=>(me(),be("option",{key:c.id,value:c.id},Je(c.label),9,qw))),128))],34),[[_n,s.value]]),$("button",{onClick:o,class:"flex items-center rounded-md p-1.5 text-xs transition-colors text-gray-600/60 hover:text-gray-800 dark:text-gray-400/60 dark:hover:text-white hover:bg-gray-100 focus:outline-none dark:hover:bg-gray-800","aria-label":"Clear text"},u[1]||(u[1]=[$("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[$("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])),$("button",{onClick:a,class:"flex items-center rounded-md p-1.5 text-xs transition-colors text-gray-600/60 hover:text-gray-800 dark:text-gray-400/60 dark:hover:text-white hover:bg-gray-100 focus:outline-none dark:hover:bg-gray-800","aria-label":"Settings"},u[2]||(u[2]=[$("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[$("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),$("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])),Ot(Dw)])])]))}},zw=Eo(Zw,[["__scopeId","data-v-befc1e0b"]]);var Vw=typeof global=="object"&&global&&global.Object===Object&&global,Gw=typeof self=="object"&&self&&self.Object===Object&&self,qm=Vw||Gw||Function("return this")(),qi=qm.Symbol,Zm=Object.prototype,Ww=Zm.hasOwnProperty,Jw=Zm.toString,Cs=qi?qi.toStringTag:void 0;function Kw(r){var e=Ww.call(r,Cs),t=r[Cs];try{r[Cs]=void 0;var n=!0}catch{}var s=Jw.call(r);return n&&(e?r[Cs]=t:delete r[Cs]),s}var Xw=Object.prototype,Yw=Xw.toString;function Qw(r){return Yw.call(r)}var ev="[object Null]",tv="[object Undefined]",pf=qi?qi.toStringTag:void 0;function rv(r){return r==null?r===void 0?tv:ev:pf&&pf in Object(r)?Kw(r):Qw(r)}function nv(r){return r!=null&&typeof r=="object"}var sv="[object Symbol]";function av(r){return typeof r=="symbol"||nv(r)&&rv(r)==sv}var iv=/\s/;function ov(r){for(var e=r.length;e--&&iv.test(r.charAt(e)););return e}var lv=/^\s+/;function uv(r){return r&&r.slice(0,ov(r)+1).replace(lv,"")}function Vu(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var mf=NaN,cv=/^[-+]0x[0-9a-f]+$/i,dv=/^0b[01]+$/i,fv=/^0o[0-7]+$/i,hv=parseInt;function gf(r){if(typeof r=="number")return r;if(av(r))return mf;if(Vu(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Vu(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=uv(r);var t=dv.test(r);return t||fv.test(r)?hv(r.slice(2),t?2:8):cv.test(r)?mf:+r}var sl=function(){return qm.Date.now()},pv="Expected a function",mv=Math.max,gv=Math.min;function yv(r,e,t){var n,s,a,i,o,l,u=0,c=!1,d=!1,f=!0;if(typeof r!="function")throw new TypeError(pv);e=gf(e)||0,Vu(t)&&(c=!!t.leading,d="maxWait"in t,a=d?mv(gf(t.maxWait)||0,e):a,f="trailing"in t?!!t.trailing:f);function h(S){var O=n,A=s;return n=s=void 0,u=S,i=r.apply(A,O),i}function p(S){return u=S,o=setTimeout(_,e),c?h(S):i}function m(S){var O=S-l,A=S-u,se=e-O;return d?gv(se,a-A):se}function g(S){var O=S-l,A=S-u;return l===void 0||O>=e||O<0||d&&A>=a}function _(){var S=sl();if(g(S))return v(S);o=setTimeout(_,m(S))}function v(S){return o=void 0,f&&n?h(S):(n=s=void 0,i)}function y(){o!==void 0&&clearTimeout(o),u=0,n=l=s=o=void 0}function b(){return o===void 0?i:v(sl())}function E(){var S=sl(),O=g(S);if(n=arguments,s=this,l=S,O){if(o===void 0)return p(l);if(d)return clearTimeout(o),o=setTimeout(_,e),h(l)}return o===void 0&&(o=setTimeout(_,e)),i}return E.cancel=y,E.flush=b,E}const Gu="RFC3986",Wu={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},_v="RFC1738",bv=Array.isArray,hr=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),al=1024,wv=(r,e,t,n,s)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=al){const l=a.length>=al?a.slice(o,o+al):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===_v&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=hr[d];continue}if(d<2048){u[u.length]=hr[192|d>>6]+hr[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=hr[224|d>>12]+hr[128|d>>6&63]+hr[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=hr[240|d>>18]+hr[128|d>>12&63]+hr[128|d>>6&63]+hr[128|d&63]}i+=u.join("")}return i};function vv(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function yf(r,e){if(bv(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const xv=Object.prototype.hasOwnProperty,zm={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},gr=Array.isArray,Ev=Array.prototype.push,Vm=function(r,e){Ev.apply(r,gr(e)?e:[e])},Sv=Date.prototype.toISOString,ze={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:wv,encodeValuesOnly:!1,format:Gu,formatter:Wu[Gu],indices:!1,serializeDate(r){return Sv.call(r)},skipNulls:!1,strictNullHandling:!1};function Ov(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const il={};function Gm(r,e,t,n,s,a,i,o,l,u,c,d,f,h,p,m,g,_){let v=r,y=_,b=0,E=!1;for(;(y=y.get(il))!==void 0&&!E;){const oe=y.get(r);if(b+=1,typeof oe<"u"){if(oe===b)throw new RangeError("Cyclic object value");E=!0}typeof y.get(il)>"u"&&(b=0)}if(typeof u=="function"?v=u(e,v):v instanceof Date?v=f==null?void 0:f(v):t==="comma"&&gr(v)&&(v=yf(v,function(oe){return oe instanceof Date?f==null?void 0:f(oe):oe})),v===null){if(a)return l&&!m?l(e,ze.encoder,g,"key",h):e;v=""}if(Ov(v)||vv(v)){if(l){const oe=m?e:l(e,ze.encoder,g,"key",h);return[(p==null?void 0:p(oe))+"="+(p==null?void 0:p(l(v,ze.encoder,g,"value",h)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(v)))]}const S=[];if(typeof v>"u")return S;let O;if(t==="comma"&&gr(v))m&&l&&(v=yf(v,l)),O=[{value:v.length>0?v.join(",")||null:void 0}];else if(gr(u))O=u;else{const oe=Object.keys(v);O=c?oe.sort(c):oe}const A=o?String(e).replace(/\./g,"%2E"):String(e),se=n&&gr(v)&&v.length===1?A+"[]":A;if(s&&gr(v)&&v.length===0)return se+"[]";for(let oe=0;oe<O.length;++oe){const z=O[oe],K=typeof z=="object"&&typeof z.value<"u"?z.value:v[z];if(i&&K===null)continue;const Ee=d&&o?z.replace(/\./g,"%2E"):z,F=gr(v)?typeof t=="function"?t(se,Ee):se:se+(d?"."+Ee:"["+Ee+"]");_.set(r,b);const I=new WeakMap;I.set(il,_),Vm(S,Gm(K,F,t,n,s,a,i,o,t==="comma"&&m&&gr(v)?null:l,u,c,d,f,h,p,m,g,I))}return S}function kv(r=ze){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||ze.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Gu;if(typeof r.format<"u"){if(!xv.call(Wu,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Wu[t];let s=ze.filter;(typeof r.filter=="function"||gr(r.filter))&&(s=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in zm?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=ze.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:ze.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:ze.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:ze.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:ze.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?ze.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:ze.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:ze.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:ze.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:ze.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:ze.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:ze.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:ze.strictNullHandling}}function Tv(r,e={}){let t=r;const n=kv(e);let s,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):gr(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof t!="object"||t===null)return"";const o=zm[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];n.skipNulls&&t[h]===null||Vm(i,Gm(t[h],h,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}const c=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const Vn="4.90.0";let _f=!1,Qs,Wm,Jm,Ju,Km,Xm,Ym,Qm,eg;function Av(r,e={auto:!1}){if(_f)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Qs)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Qs}'\``);_f=e.auto,Qs=r.kind,Wm=r.fetch,Jm=r.FormData,Ju=r.File,Km=r.ReadableStream,Xm=r.getMultipartRequestOptions,Ym=r.getDefaultAgent,Qm=r.fileFromPath,eg=r.isFsReadStream}class Pv{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Iv({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Pv(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const tg=()=>{Qs||Av(Iv(),{auto:!0})};tg();class re extends Error{}class tt extends re{constructor(e,t,n,s){super(`${tt.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new So({message:n,cause:Xu(t)});const a=t==null?void 0:t.error;return e===400?new rg(e,a,n,s):e===401?new ng(e,a,n,s):e===403?new sg(e,a,n,s):e===404?new ag(e,a,n,s):e===409?new ig(e,a,n,s):e===422?new og(e,a,n,s):e===429?new lg(e,a,n,s):e>=500?new ug(e,a,n,s):new tt(e,a,n,s)}}class Mt extends tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class So extends tt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Oo extends So{constructor({message:e}={}){super({message:e??"Request timed out."})}}class rg extends tt{}class ng extends tt{}class sg extends tt{}class ag extends tt{}class ig extends tt{}class og extends tt{}class lg extends tt{}class ug extends tt{}class cg extends re{constructor(){super("Could not parse response content as the length limit was reached")}}class dg extends re{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var ei=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},mn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},It;class ko{constructor(){It.set(this,void 0),this.buffer=new Uint8Array,ei(this,It,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let a;for(;(a=Rv(this.buffer,mn(this,It,"f")))!=null;){if(a.carriage&&mn(this,It,"f")==null){ei(this,It,a.index,"f");continue}if(mn(this,It,"f")!=null&&(a.index!==mn(this,It,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,mn(this,It,"f")-1))),this.buffer=this.buffer.slice(mn(this,It,"f")),ei(this,It,null,"f");continue}const i=mn(this,It,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),ei(this,It,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new re(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new re(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new re("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}It=new WeakMap;ko.NEWLINE_CHARS=new Set([`
`,"\r"]);ko.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Rv(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Cv(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function fg(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class br{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of $v(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new tt(void 0,o.error,void 0,bg(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new tt(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new br(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new ko,o=fg(e);for await(const l of o)for(const u of i.decode(l))yield u;for(const l of i.flush())yield l}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new br(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new br(()=>s(e),this.controller),new br(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Km({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*$v(r,e){if(!r.body)throw e.abort(),new re("Attempted to iterate over a response with no body");const t=new jv,n=new ko,s=fg(r.body);for await(const a of Nv(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Nv(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=Cv(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class jv{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Lv(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Lv(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const hg=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",pg=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&To(r),To=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Mv=r=>pg(r)||hg(r)||eg(r);async function mg(r,e,t){var s;if(r=await r,pg(r))return r;if(hg(r)){const a=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=To(a)?[await a.arrayBuffer()]:[a];return new Ju(i,e,t)}const n=await Fv(r);if(e||(e=Uv(r)??"unknown_file"),!(t!=null&&t.type)){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new Ju(n,e,t)}async function Fv(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(To(r))e.push(await r.arrayBuffer());else if(Bv(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Dv(r)}`);return e}function Dv(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Uv(r){var e;return ol(r.name)||ol(r.filename)||((e=ol(r.path))==null?void 0:e.split(/[\\/]/).pop())}const ol=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Bv=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",bf=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",fs=async r=>{const e=await Hv(r.body);return Xm(e,r)},Hv=async r=>{const e=new Jm;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Ku(e,t,n))),e},Ku=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Mv(t)){const n=await mg(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Ku(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Ku(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var as={},qv=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},Zv=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ti;tg();async function gg(r){var i;const{response:e}=r;if(r.options.stream)return is("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):br.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return is("response",e.status,e.url,e.headers,o),yg(o,e)}const a=await e.text();return is("response",e.status,e.url,e.headers,a),a}function yg(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Ao extends Promise{constructor(e,t=gg){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Ao(this.responsePromise,async t=>yg(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class zv{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=ll("maxRetries",t),this.timeout=ll("timeout",n),this.httpAgent=s,this.fetch=a??Wm}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Kv(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${e0()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const a=s&&To(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:bf(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(s,a);"timeout"in e&&ll("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const c=e.httpAgent??this.httpAgent??Ym(u),d=e.timeout+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:e,headers:i,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:f,...c&&{agent:c},signal:e.signal??null},url:u,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return Ef(a,i),Ef(a,t),bf(e.body)&&Qs!=="node"&&delete a["content-type"],ni(i,"x-stainless-retry-count")===void 0&&ni(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),ni(i,"x-stainless-timeout")===void 0&&ni(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return tt.generate(e,t,n,s)}request(e,t=null){return new Ao(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:n}),is("request",i,n,a.headers),(d=n.signal)!=null&&d.aborted)throw new Mt;const l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(Xu);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new Mt;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new Oo:new So({cause:u})}const c=bg(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const v=`retrying, ${t} attempts remaining`;return is(`response (error; ${v})`,u.status,i,c),this.retryRequest(n,t,c)}const h=await u.text().catch(v=>Xu(v).message),p=Xv(h),m=p?void 0:h;throw is(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Vv(this,n,e)}buildURL(e,t){const n=Qv(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return wg(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new re(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Ma(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Vn}`}}class _g{constructor(e,t,n,s){ti.set(this,void 0),qv(this,ti,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new re("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await Zv(this,ti,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ti=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Vv extends Ao{constructor(e,t,n){super(t,async s=>new n(e,s.response,await gg(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const bg=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Gv={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ye=r=>typeof r=="object"&&r!==null&&!wg(r)&&Object.keys(r).every(e=>vg(Gv,e)),Wv=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":vf(Deno.build.os),"X-Stainless-Arch":wf(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":vf(process.platform),"X-Stainless-Arch":wf(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Jv();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Jv(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const wf=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",vf=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let xf;const Kv=()=>xf??(xf=Wv()),Xv=r=>{try{return JSON.parse(r)}catch{return}},Yv=/^[a-z][a-z0-9+.-]*:/i,Qv=r=>Yv.test(r),Ma=r=>new Promise(e=>setTimeout(e,r)),ll=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new re(`${r} must be an integer`);if(e<0)throw new re(`${r} must be a positive integer`);return e},Xu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},ri=r=>{var e,t,n,s;if(typeof process<"u")return((e=as==null?void 0:as[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function wg(r){if(!r)return!0;for(const e in r)return!1;return!0}function vg(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Ef(r,e){for(const t in e){if(!vg(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const Sf=new Set(["authorization","api-key"]);function is(r,...e){if(typeof process<"u"&&(as==null?void 0:as.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const a={...n,headers:{...n.headers}};for(const i in n.headers)Sf.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(const a in n)Sf.has(a.toLowerCase())&&(s??(s={...n}),s[a]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const e0=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),t0=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",r0=r=>typeof(r==null?void 0:r.get)=="function",ni=(r,e)=>{var n;const t=e.toLowerCase();if(r0(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),s]){const i=r.get(a);if(i)return i}}for(const[s,a]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function ul(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class Bc extends _g{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class kt extends _g{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class we{constructor(e){this._client=e}}let xg=class extends we{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,n0,{query:t,...n})}},Po=class extends we{constructor(){super(...arguments),this.messages=new xg(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/chat/completions",Io,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Io extends kt{}class n0 extends kt{}Po.ChatCompletionsPage=Io;Po.Messages=xg;let Ro=class extends we{constructor(){super(...arguments),this.completions=new Po(this._client)}};Ro.Completions=Po;Ro.ChatCompletionsPage=Io;class Eg extends we{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class Sg extends we{create(e,t){return this._client.post("/audio/transcriptions",fs({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Og extends we{create(e,t){return this._client.post("/audio/translations",fs({body:e,...t,__metadata:{model:e.model}}))}}class Fa extends we{constructor(){super(...arguments),this.transcriptions=new Sg(this._client),this.translations=new Og(this._client),this.speech=new Eg(this._client)}}Fa.Transcriptions=Sg;Fa.Translations=Og;Fa.Speech=Eg;class Hc extends we{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/batches",qc,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class qc extends kt{}Hc.BatchesPage=qc;class Zc extends we{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/assistants",zc,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class zc extends kt{}Zc.AssistantsPage=zc;function Of(r){return typeof r.parse=="function"}const os=r=>(r==null?void 0:r.role)==="assistant",kg=r=>(r==null?void 0:r.role)==="function",Tg=r=>(r==null?void 0:r.role)==="tool";var Kt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},De=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Yu,Ti,Ai,Fs,Ds,Pi,Us,Rr,Bs,Zi,zi,Gn,Ag;class Vc{constructor(){Yu.add(this),this.controller=new AbortController,Ti.set(this,void 0),Ai.set(this,()=>{}),Fs.set(this,()=>{}),Ds.set(this,void 0),Pi.set(this,()=>{}),Us.set(this,()=>{}),Rr.set(this,{}),Bs.set(this,!1),Zi.set(this,!1),zi.set(this,!1),Gn.set(this,!1),Kt(this,Ti,new Promise((e,t)=>{Kt(this,Ai,e,"f"),Kt(this,Fs,t,"f")}),"f"),Kt(this,Ds,new Promise((e,t)=>{Kt(this,Pi,e,"f"),Kt(this,Us,t,"f")}),"f"),De(this,Ti,"f").catch(()=>{}),De(this,Ds,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},De(this,Yu,"m",Ag).bind(this))},0)}_connected(){this.ended||(De(this,Ai,"f").call(this),this._emit("connect"))}get ended(){return De(this,Bs,"f")}get errored(){return De(this,Zi,"f")}get aborted(){return De(this,zi,"f")}abort(){this.controller.abort()}on(e,t){return(De(this,Rr,"f")[e]||(De(this,Rr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=De(this,Rr,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(De(this,Rr,"f")[e]||(De(this,Rr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Kt(this,Gn,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Kt(this,Gn,!0,"f"),await De(this,Ds,"f")}_emit(e,...t){if(De(this,Bs,"f"))return;e==="end"&&(Kt(this,Bs,!0,"f"),De(this,Pi,"f").call(this));const n=De(this,Rr,"f")[e];if(n&&(De(this,Rr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!De(this,Gn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),De(this,Fs,"f").call(this,s),De(this,Us,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!De(this,Gn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),De(this,Fs,"f").call(this,s),De(this,Us,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Ti=new WeakMap,Ai=new WeakMap,Fs=new WeakMap,Ds=new WeakMap,Pi=new WeakMap,Us=new WeakMap,Rr=new WeakMap,Bs=new WeakMap,Zi=new WeakMap,zi=new WeakMap,Gn=new WeakMap,Yu=new WeakSet,Ag=function(e){if(Kt(this,Zi,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Mt),e instanceof Mt)return Kt(this,zi,!0,"f"),this._emit("abort",e);if(e instanceof re)return this._emit("error",e);if(e instanceof Error){const t=new re(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new re(String(e)))};function s0(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Gc(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function a0(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function Da(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function i0(r,e){return!e||!Pg(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Wc(r,e)}function Wc(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new cg;if(n.finish_reason==="content_filter")throw new dg;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>l0(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?o0(e,n.message.content):null}}});return{...r,choices:t}}function o0(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function l0(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Da(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function u0(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return Da(t)||(t==null?void 0:t.function.strict)||!1}function Pg(r){var e;return Gc(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>Da(t)||t.type==="function"&&t.function.strict===!0))??!1}function c0(r){for(const e of r??[]){if(e.type!=="function")throw new re(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new re(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var xt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},rt,Qu,Vi,ec,tc,rc,Ig,nc;const kf=10;class Rg extends Vc{constructor(){super(...arguments),rt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(kg(e)||Tg(e))&&e.content)this._emit("functionCallResult",e.content);else if(os(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(os(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new re("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),xt(this,rt,"m",Qu).call(this)}async finalMessage(){return await this.done(),xt(this,rt,"m",Vi).call(this)}async finalFunctionCall(){return await this.done(),xt(this,rt,"m",ec).call(this)}async finalFunctionCallResult(){return await this.done(),xt(this,rt,"m",tc).call(this)}async totalUsage(){return await this.done(),xt(this,rt,"m",rc).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=xt(this,rt,"m",Vi).call(this);t&&this._emit("finalMessage",t);const n=xt(this,rt,"m",Qu).call(this);n&&this._emit("finalContent",n);const s=xt(this,rt,"m",ec).call(this);s&&this._emit("finalFunctionCall",s);const a=xt(this,rt,"m",tc).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",xt(this,rt,"m",rc).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),xt(this,rt,"m",Ig).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Wc(a,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;const s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=kf}=n||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!m)throw new re("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:_}=m.function_call,v=c[g];if(v){if(l&&l!==g){const S=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:S});continue}}else{const S=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(O=>JSON.stringify(O.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:S});continue}let y;try{y=Of(v)?await v.parse(_):_}catch(S){this._addMessage({role:s,name:g,content:S instanceof Error?S.message:String(S)});continue}const b=await v.function(y,this),E=xt(this,rt,"m",nc).call(this,b);if(this._addMessage({role:s,name:g,content:E}),l)return}}async _runTools(e,t,n){var h,p,m;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((h=a==null?void 0:a.function)==null?void 0:h.name),{maxChatCompletions:u=kf}=n||{},c=t.tools.map(g=>{if(Da(g)){if(!g.$callback)throw new re("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of c)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const f="tools"in t?c.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<u;++g){const v=(p=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!v)throw new re("missing message in ChatCompletion response");if(!((m=v.tool_calls)!=null&&m.length))return;for(const y of v.tool_calls){if(y.type!=="function")continue;const b=y.id,{name:E,arguments:S}=y.function,O=d[E];if(O){if(l&&l!==E){const z=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:z});continue}}else{const z=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(d).map(K=>JSON.stringify(K)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:z});continue}let A;try{A=Of(O)?await O.parse(S):S}catch(z){const K=z instanceof Error?z.message:String(z);this._addMessage({role:s,tool_call_id:b,content:K});continue}const se=await O.function(A,this),oe=xt(this,rt,"m",nc).call(this,se);if(this._addMessage({role:s,tool_call_id:b,content:oe}),l)return}}}}rt=new WeakSet,Qu=function(){return xt(this,rt,"m",Vi).call(this).content??null},Vi=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(os(t)){const{function_call:n,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new re("stream ended without producing a ChatCompletionMessage with role=assistant")},ec=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(os(s)&&(s!=null&&s.function_call))return s.function_call;if(os(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},tc=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(kg(t)&&t.content!=null||Tg(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},rc=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ig=function(e){if(e.n!=null&&e.n>1)throw new re("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},nc=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ha extends Rg{static runFunctions(e,t,n){const s=new ha,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new ha,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),os(e)&&e.content&&this._emit("content",e.content)}}const Cg=1,$g=2,Ng=4,jg=8,Lg=16,Mg=32,Fg=64,Dg=128,Ug=256,Bg=Dg|Ug,Hg=Lg|Mg|Bg|Fg,qg=Cg|$g|Hg,Zg=Ng|jg,d0=qg|Zg,We={STR:Cg,NUM:$g,ARR:Ng,OBJ:jg,NULL:Lg,BOOL:Mg,NAN:Fg,INFINITY:Dg,MINUS_INFINITY:Ug,INF:Bg,SPECIAL:Hg,ATOM:qg,COLLECTION:Zg,ALL:d0};class f0 extends Error{}class h0 extends Error{}function p0(r,e=We.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return m0(r.trim(),e)}const m0=(r,e)=>{const t=r.length;let n=0;const s=f=>{throw new f0(`${f} at position ${n}`)},a=f=>{throw new h0(`${f} at position ${n}`)},i=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?u():r.substring(n,n+4)==="null"||We.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||We.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||We.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||We.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||We.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||We.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):c()),o=()=>{const f=n;let h=!1;for(n++;n<t&&(r[n]!=='"'||h&&r[n-1]==="\\");)h=r[n]==="\\"?!h:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(h)))}catch(p){a(String(p))}else if(We.STR&e)try{return JSON.parse(r.substring(f,n-Number(h))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const f={};try{for(;r[n]!=="}";){if(d(),n>=t&&We.OBJ&e)return f;const h=o();d(),n++;try{const p=i();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(We.OBJ&e)return f;throw p}d(),r[n]===","&&n++}}catch{if(We.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},u=()=>{n++;const f=[];try{for(;r[n]!=="]";)f.push(i()),d(),r[n]===","&&n++}catch{if(We.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},c=()=>{if(n===0){r==="-"&&We.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(h){if(We.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(h))}}const f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(We.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&We.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(p){a(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},Tf=r=>p0(r,We.ALL^We.NUM);var Dn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ce=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ze,Pr,Un,qr,cl,si,dl,fl,hl,ai,pl,Af;class pa extends Rg{constructor(e){super(),Ze.add(this),Pr.set(this,void 0),Un.set(this,void 0),qr.set(this,void 0),Dn(this,Pr,e,"f"),Dn(this,Un,[],"f")}get currentChatCompletionSnapshot(){return Ce(this,qr,"f")}static fromReadableStream(e){const t=new pa(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new pa(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ce(this,Ze,"m",cl).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Ce(this,Ze,"m",dl).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Mt;return this._addChatCompletion(Ce(this,Ze,"m",ai).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ce(this,Ze,"m",cl).call(this),this._connected();const s=br.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(Ce(this,Ze,"m",ai).call(this)),Ce(this,Ze,"m",dl).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new Mt;return this._addChatCompletion(Ce(this,Ze,"m",ai).call(this))}[(Pr=new WeakMap,Un=new WeakMap,qr=new WeakMap,Ze=new WeakSet,cl=function(){this.ended||Dn(this,qr,void 0,"f")},si=function(t){let n=Ce(this,Un,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ce(this,Un,"f")[t.index]=n,n)},dl=function(t){var s,a,i,o,l,u,c,d,f,h,p,m,g,_,v;if(this.ended)return;const n=Ce(this,Ze,"m",Af).call(this,t);this._emit("chunk",t,n);for(const y of t.choices){const b=n.choices[y.index];y.delta.content!=null&&((s=b.message)==null?void 0:s.role)==="assistant"&&((a=b.message)!=null&&a.content)&&(this._emit("content",y.delta.content,b.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:b.message.content,parsed:b.message.parsed})),y.delta.refusal!=null&&((i=b.message)==null?void 0:i.role)==="assistant"&&((o=b.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:b.message.refusal}),((l=y.logprobs)==null?void 0:l.content)!=null&&((u=b.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=y.logprobs)==null?void 0:c.content,snapshot:((d=b.logprobs)==null?void 0:d.content)??[]}),((f=y.logprobs)==null?void 0:f.refusal)!=null&&((h=b.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=y.logprobs)==null?void 0:p.refusal,snapshot:((m=b.logprobs)==null?void 0:m.refusal)??[]});const E=Ce(this,Ze,"m",si).call(this,b);b.finish_reason&&(Ce(this,Ze,"m",hl).call(this,b),E.current_tool_call_index!=null&&Ce(this,Ze,"m",fl).call(this,b,E.current_tool_call_index));for(const S of y.delta.tool_calls??[])E.current_tool_call_index!==S.index&&(Ce(this,Ze,"m",hl).call(this,b),E.current_tool_call_index!=null&&Ce(this,Ze,"m",fl).call(this,b,E.current_tool_call_index)),E.current_tool_call_index=S.index;for(const S of y.delta.tool_calls??[]){const O=(g=b.message.tool_calls)==null?void 0:g[S.index];O!=null&&O.type&&((O==null?void 0:O.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=O.function)==null?void 0:_.name,index:S.index,arguments:O.function.arguments,parsed_arguments:O.function.parsed_arguments,arguments_delta:((v=S.function)==null?void 0:v.arguments)??""}):(O==null||O.type,void 0))}}},fl=function(t,n){var i,o,l;if(Ce(this,Ze,"m",si).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=Ce(this,Pr,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>c.type==="function"&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Da(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},hl=function(t){var s,a;const n=Ce(this,Ze,"m",si).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=Ce(this,Ze,"m",pl).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ai=function(){if(this.ended)throw new re("stream has ended, this shouldn't happen");const t=Ce(this,qr,"f");if(!t)throw new re("request ended without sending any chunks");return Dn(this,qr,void 0,"f"),Dn(this,Un,[],"f"),g0(t,Ce(this,Pr,"f"))},pl=function(){var n;const t=(n=Ce(this,Pr,"f"))==null?void 0:n.response_format;return Gc(t)?t:null},Af=function(t){var n,s,a,i;let o=Ce(this,qr,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=Dn(this,qr,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...p}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:S,refusal:O,...A}=h;Object.assign(m.logprobs,A),S&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...S)),O&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...O))}if(d&&(m.finish_reason=d,Ce(this,Pr,"f")&&Pg(Ce(this,Pr,"f")))){if(d==="length")throw new cg;if(d==="content_filter")throw new dg}if(Object.assign(m,p),!c)continue;const{content:g,refusal:_,function_call:v,role:y,tool_calls:b,...E}=c;if(Object.assign(m.message,E),_&&(m.message.refusal=(m.message.refusal||"")+_),y&&(m.message.role=y),v&&(m.message.function_call?(v.name&&(m.message.function_call.name=v.name),v.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=v.arguments)):m.message.function_call=v),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Ce(this,Ze,"m",pl).call(this)&&(m.message.parsed=Tf(m.message.content))),b){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:S,id:O,type:A,function:se,...oe}of b){const z=(i=m.message.tool_calls)[S]??(i[S]={});Object.assign(z,oe),O&&(z.id=O),A&&(z.type=A),se&&(z.function??(z.function={name:se.name??"",arguments:""})),se!=null&&se.name&&(z.function.name=se.name),se!=null&&se.arguments&&(z.function.arguments+=se.arguments,u0(Ce(this,Pr,"f"),z)&&(z.function.parsed_arguments=Tf(z.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function g0(r,e){const{id:t,choices:n,created:s,model:a,system_fingerprint:i,...o}=r,l={...o,id:t,choices:n.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new re(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,..._}=u,v=u.role;if(!v)throw new re(`missing role for choice ${d}`);if(m){const{arguments:y,name:b}=m;if(y==null)throw new re(`missing function_call.arguments for choice ${d}`);if(!b)throw new re(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:y,name:b},role:v,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return g?{...h,index:d,finish_reason:c,logprobs:f,message:{..._,role:v,content:p,refusal:u.refusal??null,tool_calls:g.map((y,b)=>{const{function:E,type:S,id:O,...A}=y,{arguments:se,name:oe,...z}=E||{};if(O==null)throw new re(`missing choices[${d}].tool_calls[${b}].id
${ii(r)}`);if(S==null)throw new re(`missing choices[${d}].tool_calls[${b}].type
${ii(r)}`);if(oe==null)throw new re(`missing choices[${d}].tool_calls[${b}].function.name
${ii(r)}`);if(se==null)throw new re(`missing choices[${d}].tool_calls[${b}].function.arguments
${ii(r)}`);return{...A,id:O,type:S,function:{...z,name:oe,arguments:se}}})}}:{...h,message:{..._,content:p,role:v,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return i0(l,e)}function ii(r){return JSON.stringify(r)}class ls extends pa{static fromReadableStream(e){const t=new ls(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ls(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new ls(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let zg=class extends we{parse(e,t){return c0(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Wc(n,e))}runFunctions(e,t){return e.stream?ls.runFunctions(this._client,e,t):ha.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ls.runTools(this._client,e,t):ha.runTools(this._client,e,t)}stream(e,t){return pa.createChatCompletion(this._client,e,t)}};class sc extends we{constructor(){super(...arguments),this.completions=new zg(this._client)}}(function(r){r.Completions=zg})(sc||(sc={}));class Vg extends we{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Gg extends we{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Co extends we{constructor(){super(...arguments),this.sessions=new Vg(this._client),this.transcriptionSessions=new Gg(this._client)}}Co.Sessions=Vg;Co.TranscriptionSessions=Gg;var Y=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},et,ac,yr,Ii,Xt,wn,Jn,bn,Gi,$t,Ri,Ci,ea,Hs,qs,Pf,If,Rf,Cf,$f,Nf,jf;class Yt extends Vc{constructor(){super(...arguments),et.add(this),ac.set(this,[]),yr.set(this,{}),Ii.set(this,{}),Xt.set(this,void 0),wn.set(this,void 0),Jn.set(this,void 0),bn.set(this,void 0),Gi.set(this,void 0),$t.set(this,void 0),Ri.set(this,void 0),Ci.set(this,void 0),ea.set(this,void 0)}[(ac=new WeakMap,yr=new WeakMap,Ii=new WeakMap,Xt=new WeakMap,wn=new WeakMap,Jn=new WeakMap,bn=new WeakMap,Gi=new WeakMap,$t=new WeakMap,Ri=new WeakMap,Ci=new WeakMap,ea=new WeakMap,et=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Yt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=br.fromReadableStream(e,this.controller);for await(const i of s)Y(this,et,"m",Hs).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Mt;return this._addRun(Y(this,et,"m",qs).call(this))}toReadableStream(){return new br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new Yt;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const c of l)Y(this,et,"m",Hs).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new Mt;return this._addRun(Y(this,et,"m",qs).call(this))}static createThreadAssistantStream(e,t,n){const s=new Yt;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new Yt;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return Y(this,Ri,"f")}currentRun(){return Y(this,Ci,"f")}currentMessageSnapshot(){return Y(this,Xt,"f")}currentRunStepSnapshot(){return Y(this,ea,"f")}async finalRunSteps(){return await this.done(),Object.values(Y(this,yr,"f"))}async finalMessages(){return await this.done(),Object.values(Y(this,Ii,"f"))}async finalRun(){if(await this.done(),!Y(this,wn,"f"))throw Error("Final run was not received.");return Y(this,wn,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)Y(this,et,"m",Hs).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new Mt;return this._addRun(Y(this,et,"m",qs).call(this))}async _createAssistantStream(e,t,n,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)Y(this,et,"m",Hs).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Mt;return this._addRun(Y(this,et,"m",qs).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(ul(a)&&ul(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!ul(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}}Hs=function(e){if(!this.ended)switch(Pt(this,Ri,e,"f"),Y(this,et,"m",Rf).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Y(this,et,"m",jf).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Y(this,et,"m",If).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Y(this,et,"m",Pf).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},qs=function(){if(this.ended)throw new re("stream has ended, this shouldn't happen");if(!Y(this,wn,"f"))throw Error("Final run has not been received");return Y(this,wn,"f")},Pf=function(e){const[t,n]=Y(this,et,"m",$f).call(this,e,Y(this,Xt,"f"));Pt(this,Xt,t,"f"),Y(this,Ii,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Y(this,Jn,"f")){if(Y(this,bn,"f"))switch(Y(this,bn,"f").type){case"text":this._emit("textDone",Y(this,bn,"f").text,Y(this,Xt,"f"));break;case"image_file":this._emit("imageFileDone",Y(this,bn,"f").image_file,Y(this,Xt,"f"));break}Pt(this,Jn,s.index,"f")}Pt(this,bn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Y(this,Jn,"f")!==void 0){const s=e.data.content[Y(this,Jn,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Y(this,Xt,"f"));break;case"text":this._emit("textDone",s.text,Y(this,Xt,"f"));break}}Y(this,Xt,"f")&&this._emit("messageDone",e.data),Pt(this,Xt,void 0,"f")}},If=function(e){const t=Y(this,et,"m",Cf).call(this,e);switch(Pt(this,ea,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==Y(this,Gi,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(Y(this,$t,"f")&&this._emit("toolCallDone",Y(this,$t,"f")),Pt(this,Gi,a.index,"f"),Pt(this,$t,t.step_details.tool_calls[a.index],"f"),Y(this,$t,"f")&&this._emit("toolCallCreated",Y(this,$t,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Pt(this,ea,void 0,"f"),e.data.step_details.type=="tool_calls"&&Y(this,$t,"f")&&(this._emit("toolCallDone",Y(this,$t,"f")),Pt(this,$t,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Rf=function(e){Y(this,ac,"f").push(e),this._emit("event",e)},Cf=function(e){switch(e.event){case"thread.run.step.created":return Y(this,yr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Y(this,yr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Yt.accumulateDelta(t,n.delta);Y(this,yr,"f")[e.data.id]=s}return Y(this,yr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Y(this,yr,"f")[e.data.id]=e.data;break}if(Y(this,yr,"f")[e.data.id])return Y(this,yr,"f")[e.data.id];throw new Error("No snapshot available")},$f=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=Y(this,et,"m",Nf).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Nf=function(e,t){return Yt.accumulateDelta(t,e)},jf=function(e){switch(Pt(this,Ci,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Pt(this,wn,e.data,"f"),Y(this,$t,"f")&&(this._emit("toolCallDone",Y(this,$t,"f")),Pt(this,$t,void 0,"f"));break}};class Jc extends we{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Kc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Kc extends kt{}Jc.MessagesPage=Kc;class Xc extends we{retrieve(e,t,n,s={},a){return Ye(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},s){return Ye(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Yc,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Yc extends kt{}Xc.RunStepsPage=Yc;class Ua extends we{constructor(){super(...arguments),this.steps=new Xc(this._client)}create(e,t,n){const{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Qc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Yt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Yt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return Yt.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Qc extends kt{}Ua.RunsPage=Qc;Ua.Steps=Xc;Ua.RunStepsPage=Yc;class bs extends we{constructor(){super(...arguments),this.runs=new Ua(this._client),this.messages=new Jc(this._client)}create(e={},t){return Ye(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Yt.createThreadAssistantStream(e,this._client.beta.threads,t)}}bs.Runs=Ua;bs.RunsPage=Qc;bs.Messages=Jc;bs.MessagesPage=Kc;class ws extends we{constructor(){super(...arguments),this.realtime=new Co(this._client),this.chat=new sc(this._client),this.assistants=new Zc(this._client),this.threads=new bs(this._client)}}ws.Realtime=Co;ws.Assistants=Zc;ws.AssistantsPage=zc;ws.Threads=bs;class Wg extends we{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Jg extends we{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}let ed=class extends we{create(e,t){return this._client.post("/files",fs({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/files",td,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Ma(t),i=await this.retrieve(e),Date.now()-a>n)throw new Oo({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class td extends kt{}ed.FileObjectsPage=td;class rd extends we{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,nd,{query:t,...n})}}class nd extends kt{}rd.FineTuningJobCheckpointsPage=nd;class vs extends we{constructor(){super(...arguments),this.checkpoints=new rd(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",sd,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Ye(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ad,{query:t,...n})}}class sd extends kt{}class ad extends kt{}vs.FineTuningJobsPage=sd;vs.FineTuningJobEventsPage=ad;vs.Checkpoints=rd;vs.FineTuningJobCheckpointsPage=nd;class Ba extends we{constructor(){super(...arguments),this.jobs=new vs(this._client)}}Ba.Jobs=vs;Ba.FineTuningJobsPage=sd;Ba.FineTuningJobEventsPage=ad;class Kg extends we{createVariation(e,t){return this._client.post("/images/variations",fs({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",fs({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class id extends we{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",od,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class od extends Bc{}id.ModelsPage=od;class Xg extends we{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function y0(r,e){return!e||!b0(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Yg(r,e)}function Yg(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:x0(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:_0(e,i.text)}:i);return{...s,content:a}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||Qg(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function _0(r,e){var t,n,s,a;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((a=r.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function b0(r){var e;return!!Gc((e=r.text)==null?void 0:e.format)}function w0(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function v0(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function x0(r,e){const t=v0(r.tools??[],e.name);return{...e,...e,parsed_arguments:w0(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Qg(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class ey extends we{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,S0,{query:t,...n})}}var Bn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Zr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Hn,oi,zr,li,Lf,Mf,Ff,Df;class ld extends Vc{constructor(e){super(),Hn.add(this),oi.set(this,void 0),zr.set(this,void 0),li.set(this,void 0),Bn(this,oi,e,"f")}static createResponse(e,t,n){const s=new ld(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Zr(this,Hn,"m",Lf).call(this);const a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Zr(this,Hn,"m",Mf).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Mt;return Zr(this,Hn,"m",Ff).call(this)}[(oi=new WeakMap,zr=new WeakMap,li=new WeakMap,Hn=new WeakSet,Lf=function(){this.ended||Bn(this,zr,void 0,"f")},Mf=function(t){if(this.ended)return;const n=Zr(this,Hn,"m",Df).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new re(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new re(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new re(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new re(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},Ff=function(){if(this.ended)throw new re("stream has ended, this shouldn't happen");const t=Zr(this,zr,"f");if(!t)throw new re("request ended without sending any events");Bn(this,zr,void 0,"f");const n=E0(t,Zr(this,oi,"f"));return Bn(this,li,n,"f"),n},Df=function(t){let n=Zr(this,zr,"f");if(!n){if(t.type!=="response.created")throw new re(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Bn(this,zr,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new re(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new re(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new re(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new re(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new re(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Bn(this,zr,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Zr(this,li,"f");if(!e)throw new re("stream ended without producing a ChatCompletion");return e}}function E0(r,e){return y0(r,e)}class ud extends we{constructor(){super(...arguments),this.inputItems=new ey(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Qg(n),n))}retrieve(e,t={},n){return Ye(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Yg(n,e))}stream(e,t){return ld.createResponse(this._client,e,t)}}class S0 extends kt{}ud.InputItems=ey;class ty extends we{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,fs({body:t,...n}))}}class cd extends we{constructor(){super(...arguments),this.parts=new ty(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}cd.Parts=ty;const O0=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class $o extends we{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,No,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,dd,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class No extends kt{}class dd extends Bc{}$o.VectorStoreFilesPage=No;$o.FileContentResponsesPage=dd;class ry extends we{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Ye(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,No,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),u=[...n];async function c(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},s);u.push(p.id)}}const d=Array(i).fill(l).map(c);return await O0(d),await this.createAndPoll(e,{file_ids:u})}}class fn extends we{constructor(){super(...arguments),this.files=new $o(this._client),this.fileBatches=new ry(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/vector_stores",fd,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,hd,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class fd extends kt{}class hd extends Bc{}fn.VectorStoresPage=fd;fn.VectorStoreSearchResponsesPage=hd;fn.Files=$o;fn.VectorStoreFilesPage=No;fn.FileContentResponsesPage=dd;fn.FileBatches=ry;var ny;let ge=class extends zv{constructor({baseURL:e=ri("OPENAI_BASE_URL"),apiKey:t=ri("OPENAI_API_KEY"),organization:n=ri("OPENAI_ORG_ID")??null,project:s=ri("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new re("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&t0())throw new re(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Wg(this),this.chat=new Ro(this),this.embeddings=new Jg(this),this.files=new ed(this),this.images=new Kg(this),this.audio=new Fa(this),this.moderations=new Xg(this),this.models=new id(this),this.fineTuning=new Ba(this),this.vectorStores=new fn(this),this.beta=new ws(this),this.batches=new Hc(this),this.uploads=new cd(this),this.responses=new ud(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Tv(e,{arrayFormat:"brackets"})}};ny=ge;ge.OpenAI=ny;ge.DEFAULT_TIMEOUT=6e5;ge.OpenAIError=re;ge.APIError=tt;ge.APIConnectionError=So;ge.APIConnectionTimeoutError=Oo;ge.APIUserAbortError=Mt;ge.NotFoundError=ag;ge.ConflictError=ig;ge.RateLimitError=lg;ge.BadRequestError=rg;ge.AuthenticationError=ng;ge.InternalServerError=ug;ge.PermissionDeniedError=sg;ge.UnprocessableEntityError=og;ge.toFile=mg;ge.fileFromPath=Qm;ge.Completions=Wg;ge.Chat=Ro;ge.ChatCompletionsPage=Io;ge.Embeddings=Jg;ge.Files=ed;ge.FileObjectsPage=td;ge.Images=Kg;ge.Audio=Fa;ge.Moderations=Xg;ge.Models=id;ge.ModelsPage=od;ge.FineTuning=Ba;ge.VectorStores=fn;ge.VectorStoresPage=fd;ge.VectorStoreSearchResponsesPage=hd;ge.Beta=ws;ge.Batches=Hc;ge.BatchesPage=qc;ge.Uploads=cd;ge.Responses=ud;function Uf(r,e=pd){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function pd(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let a of r){if(n)a==='"'&&!s?n=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')n=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}n&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}function Ha(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ml,Bf;function k0(){return Bf||(Bf=1,ml=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),ml}var T0=k0();const A0=Ha(T0);var ui={exports:{}},Hf;function P0(){if(Hf)return ui.exports;Hf=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(f,h,p)=>{let m=!1,g=!1,_=!1;for(let v=0;v<f.length;v++){const y=f[v];m&&r.test(y)?(f=f.slice(0,v)+"-"+f.slice(v),m=!1,_=g,g=!0,v++):g&&_&&e.test(y)?(f=f.slice(0,v-1)+"-"+f.slice(v-1),_=g,g=!1,m=!0):(m=h(y)===y&&p(y)!==y,_=g,g=p(y)===y&&h(y)!==y)}return f},u=(f,h)=>(t.lastIndex=0,f.replace(t,p=>h(p))),c=(f,h)=>(i.lastIndex=0,o.lastIndex=0,f.replace(i,(p,m)=>h(m)).replace(o,p=>h(p))),d=(f,h)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(h={pascalCase:!1,preserveConsecutiveUppercase:!1,...h},Array.isArray(f)?f=f.map(_=>_.trim()).filter(_=>_.length).join("-"):f=f.trim(),f.length===0)return"";const p=h.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(h.locale),m=h.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(h.locale);return f.length===1?h.pascalCase?m(f):p(f):(f!==p(f)&&(f=l(f,p,m)),f=f.replace(a,""),h.preserveConsecutiveUppercase?f=u(f,p):f=p(f),h.pascalCase&&(f=m(f.charAt(0))+f.slice(1)),c(f,m))};return ui.exports=d,ui.exports.default=d,ui.exports}P0();function I0(r,e){return(e==null?void 0:e[r])||A0(r)}function R0(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function qf(r){return Array.isArray(r)?[...r]:{...r}}function C0(r,e){const t=qf(r);for(const[n,s]of Object.entries(e)){const[a,...i]=n.split(".").reverse();let o=t;for(const l of i.reverse()){if(o[l]===void 0)break;o[l]=qf(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function sy(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class In{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,sy(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof In||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=n;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?i[u]={}:Array.isArray(a[u])&&(i[u]=[])),a=a[u],i=i[u]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:R0(Object.keys(t).length?C0(n,t):n,I0,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function xs(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?jo(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function $0(r,e){return r==="error"||e==="error"?"error":"success"}function N0(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,s+1));const a={};for(const i of Object.keys(n))a[i]=t(n[i],s+1);return a}return JSON.stringify(t(r,0),null,2)}class Es extends In{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=N0(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function gt(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=gt(t[n],s);else if(Array.isArray(t[n]))t[n]=jo(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function jo(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(a=>a.index===n.index);s!==-1?t[s]=gt(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function j0(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return jo(r,e);if(typeof r=="object"&&typeof e=="object")return gt(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Ss extends Es{}function L0(r){return typeof r.role=="string"}function Lo(r){return typeof(r==null?void 0:r._getType)=="function"}function M0(r){return Lo(r)&&typeof r.concat=="function"}class F0 extends Es{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class md extends Ss{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new md({content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),artifact:j0(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:$0(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function D0(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const a=JSON.parse(n.function.arguments),i={name:s||"",args:a||{},id:n.id};e.push(i)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class ma extends Es{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const a=(s=n.additional_kwargs)==null?void 0:s.tool_calls,i=n.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,l]=D0(a);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function qa(r){return r._getType()==="ai"}function Zf(r){return r._getType()==="ai"}class rn extends Ss{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=pd(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,a,i,o,l,u,c,d,f,h,p,m,g,_,v,y,b,E,S,O,A,se,oe,z,K,Ee,F,I,U,R,C,D,X,ae,q,ue,Ne,Me,bt;const t={content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Zt=jo(this.tool_call_chunks,e.tool_call_chunks);Zt!==void 0&&Zt.length>0&&(t.tool_call_chunks=Zt)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Zt={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((i=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((c=(u=e.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:c.audio)??0)},...(((f=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:f.cache_read)!==void 0||((p=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((v=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:v.cache_read)??0)},...(((b=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:b.cache_creation)!==void 0||((S=(E=e.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:S.cache_creation)!==void 0)&&{cache_creation:(((A=(O=this.usage_metadata)==null?void 0:O.input_token_details)==null?void 0:A.cache_creation)??0)+(((oe=(se=e.usage_metadata)==null?void 0:se.input_token_details)==null?void 0:oe.cache_creation)??0)}},Ln={...(((K=(z=this.usage_metadata)==null?void 0:z.output_token_details)==null?void 0:K.audio)!==void 0||((F=(Ee=e.usage_metadata)==null?void 0:Ee.output_token_details)==null?void 0:F.audio)!==void 0)&&{audio:(((U=(I=this.usage_metadata)==null?void 0:I.output_token_details)==null?void 0:U.audio)??0)+(((C=(R=e.usage_metadata)==null?void 0:R.output_token_details)==null?void 0:C.audio)??0)},...(((X=(D=this.usage_metadata)==null?void 0:D.output_token_details)==null?void 0:X.reasoning)!==void 0||((q=(ae=e.usage_metadata)==null?void 0:ae.output_token_details)==null?void 0:q.reasoning)!==void 0)&&{reasoning:(((Ne=(ue=this.usage_metadata)==null?void 0:ue.output_token_details)==null?void 0:Ne.reasoning)??0)+(((bt=(Me=e.usage_metadata)==null?void 0:Me.output_token_details)==null?void 0:bt.reasoning)??0)}},Mn=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Tr=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},$d={input_tokens:Mn.input_tokens+Tr.input_tokens,output_tokens:Mn.output_tokens+Tr.output_tokens,total_tokens:Mn.total_tokens+Tr.total_tokens,...Object.keys(Zt).length>0&&{input_token_details:Zt},...Object.keys(Ln).length>0&&{output_token_details:Ln}};t.usage_metadata=$d}return new rn(t)}}class Za extends Es{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Za}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Mo extends Ss{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Mo({content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Fo extends Ss{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Fo({content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Do extends Es{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Uo extends Ss{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Uo({content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class zf extends Es{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class ga extends Ss{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new ga({content:xs(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function ay(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function iy(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class U0 extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function B0(r){return iy(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function H0(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function gl(r){let e,t;if(H0(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new Do(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new ma(t);const a=n.map(B0);return new ma({...s,tool_calls:a})}else{if(e==="system")return new zf(t);if(e==="developer")return new zf({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new F0({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw ay(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Zs(r){if(typeof r=="string")return new Do(r);if(Lo(r))return r;if(Array.isArray(r)){const[e,t]=r;return gl({type:e,content:t})}else if(L0(r)){const{role:e,...t}=r;return gl({...t,type:e})}else return gl(r)}function oy(r,e="Human",t="AI"){const n=[];for(const s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${a}: ${i}${o}`)}return n.join(`
`)}function q0(r){var t;const e=r._getType();if(e==="human")return new Uo({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new rn({...n})}else{if(e==="system")return new ga({...r});if(e==="function")return new Fo({...r});if(Za.isInstance(r))return new Mo({...r});throw new Error("Unknown message type.")}}var xe;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(xe||(xe={}));var ic;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(ic||(ic={}));const W=xe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nr=r=>{switch(typeof r){case"undefined":return W.undefined;case"string":return W.string;case"number":return isNaN(r)?W.nan:W.number;case"boolean":return W.boolean;case"function":return W.function;case"bigint":return W.bigint;case"symbol":return W.symbol;case"object":return Array.isArray(r)?W.array:r===null?W.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?W.promise:typeof Map<"u"&&r instanceof Map?W.map:typeof Set<"u"&&r instanceof Set?W.set:typeof Date<"u"&&r instanceof Date?W.date:W.object;default:return W.unknown}},N=xe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Z0=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Ft extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,l=0;for(;l<i.path.length;){const u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),n}static assert(e){if(!(e instanceof Ft))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,xe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ft.create=r=>new Ft(r);const hs=(r,e)=>{let t;switch(r.code){case N.invalid_type:r.received===W.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case N.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,xe.jsonStringifyReplacer)}`;break;case N.unrecognized_keys:t=`Unrecognized key(s) in object: ${xe.joinValues(r.keys,", ")}`;break;case N.invalid_union:t="Invalid input";break;case N.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${xe.joinValues(r.options)}`;break;case N.invalid_enum_value:t=`Invalid enum value. Expected ${xe.joinValues(r.options)}, received '${r.received}'`;break;case N.invalid_arguments:t="Invalid function arguments";break;case N.invalid_return_type:t="Invalid function return type";break;case N.invalid_date:t="Invalid date";break;case N.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:xe.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case N.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case N.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case N.custom:t="Invalid input";break;case N.invalid_intersection_types:t="Intersection results could not be merged";break;case N.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case N.not_finite:t="Number must be finite";break;default:t=e.defaultError,xe.assertNever(r)}return{message:t}};let ly=hs;function z0(r){ly=r}function Wi(){return ly}const Ji=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=n.filter(u=>!!u).slice().reverse();for(const u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},V0=[];function Z(r,e){const t=Wi(),n=Ji({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===hs?void 0:hs].filter(s=>!!s)});r.common.issues.push(n)}class ot{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return ie;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return ot.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return ie;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const ie=Object.freeze({status:"aborted"}),Kn=r=>({status:"dirty",value:r}),yt=r=>({status:"valid",value:r}),oc=r=>r.status==="aborted",lc=r=>r.status==="dirty",Rn=r=>r.status==="valid",ya=r=>typeof Promise<"u"&&r instanceof Promise;function Ki(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function uy(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var J;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(J||(J={}));var zs,Vs;class Or{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Vf=(r,e)=>{if(Rn(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ft(r.common.issues);return this._error=t,this._error}}};function ce(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var l,u;const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??n)!==null&&l!==void 0?l:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:s}}class pe{get description(){return this._def.description}_getType(e){return Nr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Nr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ot,ctx:{common:e.parent.common,data:e.data,parsedType:Nr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ya(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)},a=this._parseSync({data:e,path:s.path,parent:s});return Vf(s,a)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return Rn(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((n=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>Rn(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nr(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(ya(s)?s:Promise.resolve(s));return Vf(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:N.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new ar({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return rr.create(this,this._def)}nullable(){return on.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tr.create(this)}promise(){return ms.create(this,this._def)}or(e){return va.create([this,e],this._def)}and(e){return xa.create(this,e,this._def)}transform(e){return new ar({...ce(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ta({...ce(this._def),innerType:this,defaultValue:t,typeName:k.ZodDefault})}brand(){return new gd({typeName:k.ZodBranded,type:this,...ce(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Aa({...ce(this._def),innerType:this,catchValue:t,typeName:k.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return za.create(this,e)}readonly(){return Pa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const G0=/^c[^\s-]{8,}$/i,W0=/^[0-9a-z]+$/,J0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,K0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,X0=/^[a-z0-9_-]{21}$/i,Y0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Q0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tx="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let yl;const rx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,nx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ax=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ix=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ox=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,cy="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",lx=new RegExp(`^${cy}$`);function dy(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function ux(r){return new RegExp(`^${dy(r)}$`)}function fy(r){let e=`${cy}T${dy(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function cx(r,e){return!!((e==="v4"||!e)&&rx.test(r)||(e==="v6"||!e)&&sx.test(r))}function dx(r,e){if(!Y0.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function fx(r,e){return!!((e==="v4"||!e)&&nx.test(r)||(e==="v6"||!e)&&ax.test(r))}class Qt extends pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==W.string){const a=this._getOrReturnCtx(e);return Z(a,{code:N.invalid_type,expected:W.string,received:a.parsedType}),ie}const n=new ot;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),Z(s,{code:N.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),Z(s,{code:N.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?Z(s,{code:N.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&Z(s,{code:N.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")ex.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"email",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")yl||(yl=new RegExp(tx,"u")),yl.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"emoji",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")K0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"uuid",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")X0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"nanoid",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")G0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"cuid",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")W0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"cuid2",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")J0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"ulid",code:N.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),Z(s,{validation:"url",code:N.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"regex",code:N.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?fy(a).test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?lx.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?ux(a).test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{code:N.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?Q0.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"duration",code:N.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?cx(e.data,a.version)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"ip",code:N.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dx(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"jwt",code:N.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fx(e.data,a.version)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"cidr",code:N.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?ix.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"base64",code:N.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?ox.test(e.data)||(s=this._getOrReturnCtx(e,s),Z(s,{validation:"base64url",code:N.invalid_string,message:a.message}),n.dirty()):xe.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:N.invalid_string,...J.errToObj(n)})}_addCheck(e){return new Qt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...J.errToObj(e)})}url(e){return this._addCheck({kind:"url",...J.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...J.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...J.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...J.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...J.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...J.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...J.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...J.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...J.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...J.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...J.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...J.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...J.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...J.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...J.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...J.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...J.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...J.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...J.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...J.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...J.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...J.errToObj(t)})}nonempty(e){return this.min(1,J.errToObj(e))}trim(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Qt.create=r=>{var e;return new Qt({checks:[],typeName:k.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...ce(r)})};function hx(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class nn extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==W.number){const a=this._getOrReturnCtx(e);return Z(a,{code:N.invalid_type,expected:W.number,received:a.parsedType}),ie}let n;const s=new ot;for(const a of this._def.checks)a.kind==="int"?xe.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),Z(n,{code:N.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?hx(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),Z(n,{code:N.not_finite,message:a.message}),s.dirty()):xe.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,n,s){return new nn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:J.toString(s)}]})}_addCheck(e){return new nn({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:J.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:J.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:J.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:J.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&xe.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}nn.create=r=>new nn({checks:[],typeName:k.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...ce(r)});class sn extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==W.bigint)return this._getInvalidInput(e);let n;const s=new ot;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),Z(n,{code:N.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):xe.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Z(t,{code:N.invalid_type,expected:W.bigint,received:t.parsedType}),ie}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,n,s){return new sn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:J.toString(s)}]})}_addCheck(e){return new sn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}sn.create=r=>{var e;return new sn({checks:[],typeName:k.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...ce(r)})};class _a extends pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==W.boolean){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.boolean,received:n.parsedType}),ie}return yt(e.data)}}_a.create=r=>new _a({typeName:k.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...ce(r)});class Cn extends pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==W.date){const a=this._getOrReturnCtx(e);return Z(a,{code:N.invalid_type,expected:W.date,received:a.parsedType}),ie}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return Z(a,{code:N.invalid_date}),ie}const n=new ot;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),Z(s,{code:N.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),Z(s,{code:N.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):xe.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Cn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:J.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:J.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Cn.create=r=>new Cn({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:k.ZodDate,...ce(r)});class Xi extends pe{_parse(e){if(this._getType(e)!==W.symbol){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.symbol,received:n.parsedType}),ie}return yt(e.data)}}Xi.create=r=>new Xi({typeName:k.ZodSymbol,...ce(r)});class ba extends pe{_parse(e){if(this._getType(e)!==W.undefined){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.undefined,received:n.parsedType}),ie}return yt(e.data)}}ba.create=r=>new ba({typeName:k.ZodUndefined,...ce(r)});class wa extends pe{_parse(e){if(this._getType(e)!==W.null){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.null,received:n.parsedType}),ie}return yt(e.data)}}wa.create=r=>new wa({typeName:k.ZodNull,...ce(r)});class ps extends pe{constructor(){super(...arguments),this._any=!0}_parse(e){return yt(e.data)}}ps.create=r=>new ps({typeName:k.ZodAny,...ce(r)});class En extends pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return yt(e.data)}}En.create=r=>new En({typeName:k.ZodUnknown,...ce(r)});class Ur extends pe{_parse(e){const t=this._getOrReturnCtx(e);return Z(t,{code:N.invalid_type,expected:W.never,received:t.parsedType}),ie}}Ur.create=r=>new Ur({typeName:k.ZodNever,...ce(r)});class Yi extends pe{_parse(e){if(this._getType(e)!==W.undefined){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.void,received:n.parsedType}),ie}return yt(e.data)}}Yi.create=r=>new Yi({typeName:k.ZodVoid,...ce(r)});class tr extends pe{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==W.array)return Z(t,{code:N.invalid_type,expected:W.array,received:t.parsedType}),ie;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(Z(t,{code:i?N.too_big:N.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(Z(t,{code:N.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(Z(t,{code:N.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new Or(t,i,t.path,o)))).then(i=>ot.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new Or(t,i,t.path,o)));return ot.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new tr({...this._def,minLength:{value:e,message:J.toString(t)}})}max(e,t){return new tr({...this._def,maxLength:{value:e,message:J.toString(t)}})}length(e,t){return new tr({...this._def,exactLength:{value:e,message:J.toString(t)}})}nonempty(e){return this.min(1,e)}}tr.create=(r,e)=>new tr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...ce(e)});function Wn(r){if(r instanceof Ue){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=rr.create(Wn(n))}return new Ue({...r._def,shape:()=>e})}else return r instanceof tr?new tr({...r._def,type:Wn(r.element)}):r instanceof rr?rr.create(Wn(r.unwrap())):r instanceof on?on.create(Wn(r.unwrap())):r instanceof kr?kr.create(r.items.map(e=>Wn(e))):r}class Ue extends pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=xe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==W.object){const u=this._getOrReturnCtx(e);return Z(u,{code:N.invalid_type,expected:W.object,received:u.parsedType}),ie}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ur&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const l=[];for(const u of i){const c=a[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Or(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ur){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(Z(s,{code:N.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Or(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>ot.mergeObjectSync(n,u)):ot.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return J.errToObj,new Ue({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,i,o;const l=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=J.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Ue({...this._def,unknownKeys:"strip"})}passthrough(){return new Ue({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ue({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ue({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ue({...this._def,catchall:e})}pick(e){const t={};return xe.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new Ue({...this._def,shape:()=>t})}omit(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new Ue({...this._def,shape:()=>t})}deepPartial(){return Wn(this)}partial(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new Ue({...this._def,shape:()=>t})}required(e){const t={};return xe.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof rr;)a=a._def.innerType;t[n]=a}}),new Ue({...this._def,shape:()=>t})}keyof(){return hy(xe.objectKeys(this.shape))}}Ue.create=(r,e)=>new Ue({shape:()=>r,unknownKeys:"strip",catchall:Ur.create(),typeName:k.ZodObject,...ce(e)});Ue.strictCreate=(r,e)=>new Ue({shape:()=>r,unknownKeys:"strict",catchall:Ur.create(),typeName:k.ZodObject,...ce(e)});Ue.lazycreate=(r,e)=>new Ue({shape:r,unknownKeys:"strip",catchall:Ur.create(),typeName:k.ZodObject,...ce(e)});class va extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new Ft(o.ctx.common.issues));return Z(t,{code:N.invalid_union,unionErrors:i}),ie}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of n){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new Ft(l));return Z(t,{code:N.invalid_union,unionErrors:o}),ie}}get options(){return this._def.options}}va.create=(r,e)=>new va({options:r,typeName:k.ZodUnion,...ce(e)});const Cr=r=>r instanceof Sa?Cr(r.schema):r instanceof ar?Cr(r.innerType()):r instanceof Oa?[r.value]:r instanceof an?r.options:r instanceof ka?xe.objectValues(r.enum):r instanceof Ta?Cr(r._def.innerType):r instanceof ba?[void 0]:r instanceof wa?[null]:r instanceof rr?[void 0,...Cr(r.unwrap())]:r instanceof on?[null,...Cr(r.unwrap())]:r instanceof gd||r instanceof Pa?Cr(r.unwrap()):r instanceof Aa?Cr(r._def.innerType):[];class Bo extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.object)return Z(t,{code:N.invalid_type,expected:W.object,received:t.parsedType}),ie;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(Z(t,{code:N.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ie)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const i=Cr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Bo({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...ce(n)})}}function uc(r,e){const t=Nr(r),n=Nr(e);if(r===e)return{valid:!0,data:r};if(t===W.object&&n===W.object){const s=xe.objectKeys(e),a=xe.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const l=uc(r[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===W.array&&n===W.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],l=uc(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===W.date&&n===W.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class xa extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(oc(a)||oc(i))return ie;const o=uc(a.value,i.value);return o.valid?((lc(a)||lc(i))&&t.dirty(),{status:t.value,value:o.data}):(Z(n,{code:N.invalid_intersection_types}),ie)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}xa.create=(r,e,t)=>new xa({left:r,right:e,typeName:k.ZodIntersection,...ce(t)});class kr extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==W.array)return Z(n,{code:N.invalid_type,expected:W.array,received:n.parsedType}),ie;if(n.data.length<this._def.items.length)return Z(n,{code:N.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ie;!this._def.rest&&n.data.length>this._def.items.length&&(Z(n,{code:N.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Or(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>ot.mergeArray(t,i)):ot.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new kr({...this._def,rest:e})}}kr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new kr({items:r,typeName:k.ZodTuple,rest:null,...ce(e)})};class Ea extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==W.object)return Z(n,{code:N.invalid_type,expected:W.object,received:n.parsedType}),ie;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in n.data)s.push({key:a._parse(new Or(n,o,n.path,o)),value:i._parse(new Or(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?ot.mergeObjectAsync(t,s):ot.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof pe?new Ea({keyType:e,valueType:t,typeName:k.ZodRecord,...ce(n)}):new Ea({keyType:Qt.create(),valueType:e,typeName:k.ZodRecord,...ce(t)})}}class Qi extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==W.map)return Z(n,{code:N.invalid_type,expected:W.map,received:n.parsedType}),ie;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,l],u)=>({key:s._parse(new Or(n,o,n.path,[u,"key"])),value:a._parse(new Or(n,l,n.path,[u,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return ie;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of i){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return ie;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}Qi.create=(r,e,t)=>new Qi({valueType:e,keyType:r,typeName:k.ZodMap,...ce(t)});class $n extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==W.set)return Z(n,{code:N.invalid_type,expected:W.set,received:n.parsedType}),ie;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(Z(n,{code:N.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(Z(n,{code:N.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(l){const u=new Set;for(const c of l){if(c.status==="aborted")return ie;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...n.data.values()].map((l,u)=>a._parse(new Or(n,l,n.path,u)));return n.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new $n({...this._def,minSize:{value:e,message:J.toString(t)}})}max(e,t){return new $n({...this._def,maxSize:{value:e,message:J.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}$n.create=(r,e)=>new $n({valueType:r,minSize:null,maxSize:null,typeName:k.ZodSet,...ce(e)});class us extends pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.function)return Z(t,{code:N.invalid_type,expected:W.function,received:t.parsedType}),ie;function n(o,l){return Ji({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wi(),hs].filter(u=>!!u),issueData:{code:N.invalid_arguments,argumentsError:l}})}function s(o,l){return Ji({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wi(),hs].filter(u=>!!u),issueData:{code:N.invalid_return_type,returnTypeError:l}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof ms){const o=this;return yt(async function(...l){const u=new Ft([]),c=await o._def.args.parseAsync(l,a).catch(h=>{throw u.addIssue(n(l,h)),u}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw u.addIssue(s(d,h)),u})})}else{const o=this;return yt(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new Ft([n(l,u.error)]);const c=Reflect.apply(i,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new Ft([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new us({...this._def,args:kr.create(e).rest(En.create())})}returns(e){return new us({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new us({args:e||kr.create([]).rest(En.create()),returns:t||En.create(),typeName:k.ZodFunction,...ce(n)})}}class Sa extends pe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Sa.create=(r,e)=>new Sa({getter:r,typeName:k.ZodLazy,...ce(e)});class Oa extends pe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Z(t,{received:t.data,code:N.invalid_literal,expected:this._def.value}),ie}return{status:"valid",value:e.data}}get value(){return this._def.value}}Oa.create=(r,e)=>new Oa({value:r,typeName:k.ZodLiteral,...ce(e)});function hy(r,e){return new an({values:r,typeName:k.ZodEnum,...ce(e)})}class an extends pe{constructor(){super(...arguments),zs.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return Z(t,{expected:xe.joinValues(n),received:t.parsedType,code:N.invalid_type}),ie}if(Ki(this,zs)||uy(this,zs,new Set(this._def.values)),!Ki(this,zs).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Z(t,{received:t.data,code:N.invalid_enum_value,options:n}),ie}return yt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return an.create(e,{...this._def,...t})}exclude(e,t=this._def){return an.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}zs=new WeakMap;an.create=hy;class ka extends pe{constructor(){super(...arguments),Vs.set(this,void 0)}_parse(e){const t=xe.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==W.string&&n.parsedType!==W.number){const s=xe.objectValues(t);return Z(n,{expected:xe.joinValues(s),received:n.parsedType,code:N.invalid_type}),ie}if(Ki(this,Vs)||uy(this,Vs,new Set(xe.getValidEnumValues(this._def.values))),!Ki(this,Vs).has(e.data)){const s=xe.objectValues(t);return Z(n,{received:n.data,code:N.invalid_enum_value,options:s}),ie}return yt(e.data)}get enum(){return this._def.values}}Vs=new WeakMap;ka.create=(r,e)=>new ka({values:r,typeName:k.ZodNativeEnum,...ce(e)});class ms extends pe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==W.promise&&t.common.async===!1)return Z(t,{code:N.invalid_type,expected:W.promise,received:t.parsedType}),ie;const n=t.parsedType===W.promise?t.data:Promise.resolve(t.data);return yt(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ms.create=(r,e)=>new ms({type:r,typeName:k.ZodPromise,...ce(e)});class ar extends pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{Z(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return ie;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?ie:l.status==="dirty"||t.value==="dirty"?Kn(l.value):l});{if(t.value==="aborted")return ie;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?ie:o.status==="dirty"||t.value==="dirty"?Kn(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ie:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?ie:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Rn(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Rn(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);xe.assertNever(s)}}ar.create=(r,e,t)=>new ar({schema:r,typeName:k.ZodEffects,effect:e,...ce(t)});ar.createWithPreprocess=(r,e,t)=>new ar({schema:e,effect:{type:"preprocess",transform:r},typeName:k.ZodEffects,...ce(t)});class rr extends pe{_parse(e){return this._getType(e)===W.undefined?yt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rr.create=(r,e)=>new rr({innerType:r,typeName:k.ZodOptional,...ce(e)});class on extends pe{_parse(e){return this._getType(e)===W.null?yt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}on.create=(r,e)=>new on({innerType:r,typeName:k.ZodNullable,...ce(e)});class Ta extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===W.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ta.create=(r,e)=>new Ta({innerType:r,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ce(e)});class Aa extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ya(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ft(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ft(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Aa.create=(r,e)=>new Aa({innerType:r,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ce(e)});class eo extends pe{_parse(e){if(this._getType(e)!==W.nan){const n=this._getOrReturnCtx(e);return Z(n,{code:N.invalid_type,expected:W.nan,received:n.parsedType}),ie}return{status:"valid",value:e.data}}}eo.create=r=>new eo({typeName:k.ZodNaN,...ce(r)});const px=Symbol("zod_brand");class gd extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class za extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ie:a.status==="dirty"?(t.dirty(),Kn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ie:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new za({in:e,out:t,typeName:k.ZodPipeline})}}class Pa extends pe{_parse(e){const t=this._def.innerType._parse(e),n=s=>(Rn(s)&&(s.value=Object.freeze(s.value)),s);return ya(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Pa.create=(r,e)=>new Pa({innerType:r,typeName:k.ZodReadonly,...ce(e)});function Gf(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function py(r,e={},t){return r?ps.create().superRefine((n,s)=>{var a,i;const o=r(n);if(o instanceof Promise)return o.then(l=>{var u,c;if(!l){const d=Gf(e,n),f=(c=(u=d.fatal)!==null&&u!==void 0?u:t)!==null&&c!==void 0?c:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const l=Gf(e,n),u=(i=(a=l.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0;s.addIssue({code:"custom",...l,fatal:u})}}):ps.create()}const mx={object:Ue.lazycreate};var k;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(k||(k={}));const gx=(r,e={message:`Input not instance of ${r.name}`})=>py(t=>t instanceof r,e),my=Qt.create,gy=nn.create,yx=eo.create,_x=sn.create,yy=_a.create,bx=Cn.create,wx=Xi.create,vx=ba.create,xx=wa.create,Ex=ps.create,Sx=En.create,Ox=Ur.create,kx=Yi.create,Tx=tr.create,Ax=Ue.create,Px=Ue.strictCreate,Ix=va.create,Rx=Bo.create,Cx=xa.create,$x=kr.create,Nx=Ea.create,jx=Qi.create,Lx=$n.create,Mx=us.create,Fx=Sa.create,Dx=Oa.create,Ux=an.create,Bx=ka.create,Hx=ms.create,Wf=ar.create,qx=rr.create,Zx=on.create,zx=ar.createWithPreprocess,Vx=za.create,Gx=()=>my().optional(),Wx=()=>gy().optional(),Jx=()=>yy().optional(),Kx={string:r=>Qt.create({...r,coerce:!0}),number:r=>nn.create({...r,coerce:!0}),boolean:r=>_a.create({...r,coerce:!0}),bigint:r=>sn.create({...r,coerce:!0}),date:r=>Cn.create({...r,coerce:!0})},Xx=ie;var Sn=Object.freeze({__proto__:null,defaultErrorMap:hs,setErrorMap:z0,getErrorMap:Wi,makeIssue:Ji,EMPTY_PATH:V0,addIssueToContext:Z,ParseStatus:ot,INVALID:ie,DIRTY:Kn,OK:yt,isAborted:oc,isDirty:lc,isValid:Rn,isAsync:ya,get util(){return xe},get objectUtil(){return ic},ZodParsedType:W,getParsedType:Nr,ZodType:pe,datetimeRegex:fy,ZodString:Qt,ZodNumber:nn,ZodBigInt:sn,ZodBoolean:_a,ZodDate:Cn,ZodSymbol:Xi,ZodUndefined:ba,ZodNull:wa,ZodAny:ps,ZodUnknown:En,ZodNever:Ur,ZodVoid:Yi,ZodArray:tr,ZodObject:Ue,ZodUnion:va,ZodDiscriminatedUnion:Bo,ZodIntersection:xa,ZodTuple:kr,ZodRecord:Ea,ZodMap:Qi,ZodSet:$n,ZodFunction:us,ZodLazy:Sa,ZodLiteral:Oa,ZodEnum:an,ZodNativeEnum:ka,ZodPromise:ms,ZodEffects:ar,ZodTransformer:ar,ZodOptional:rr,ZodNullable:on,ZodDefault:Ta,ZodCatch:Aa,ZodNaN:eo,BRAND:px,ZodBranded:gd,ZodPipeline:za,ZodReadonly:Pa,custom:py,Schema:pe,ZodSchema:pe,late:mx,get ZodFirstPartyTypeKind(){return k},coerce:Kx,any:Ex,array:Tx,bigint:_x,boolean:yy,date:bx,discriminatedUnion:Rx,effect:Wf,enum:Ux,function:Mx,instanceof:gx,intersection:Cx,lazy:Fx,literal:Dx,map:jx,nan:yx,nativeEnum:Bx,never:Ox,null:xx,nullable:Zx,number:gy,object:Ax,oboolean:Jx,onumber:Wx,optional:qx,ostring:Gx,pipeline:Vx,preprocess:zx,promise:Hx,record:Nx,set:Lx,strictObject:Px,string:my,symbol:wx,transformer:Wf,tuple:$x,undefined:vx,union:Ix,unknown:Sx,void:kx,NEVER:Xx,ZodIssueCode:N,quotelessJson:Z0,ZodError:Ft}),$s={exports:{}},_l={},bl,Jf;function Yx(){if(Jf)return bl;Jf=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return bl=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var a=this._errors[s],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=n&&(t=a,n=o)}return t},bl}var Kf;function Qx(){return Kf||(Kf=1,function(r){var e=Yx();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<n.retries;i++)a.push(this.createTimeout(i,n));return t&&t.forever&&!a.length&&a.push(this.createTimeout(i,n)),a.sort(function(o,l){return o-l}),a},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,a=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return a=Math.min(a,n.maxTimeout),a},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],l=t[o];t[o]=(function(c){var d=r.operation(n),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(t,f)})}).bind(t,l),t[o].options=n}}}(_l)),_l}var wl,Xf;function eE(){return Xf||(Xf=1,wl=Qx()),wl}var Yf;function tE(){if(Yf)return $s.exports;Yf=1;const r=eE(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(i,o,l)=>{const u=l.retries-(o-1);return i.attemptNumber=o,i.retriesLeft=u,i},s=i=>e.includes(i),a=(i,o)=>new Promise((l,u)=>{o={onFailedAttempt:()=>{},retries:10,...o};const c=r.operation(o);c.attempt(async d=>{try{l(await i(d))}catch(f){if(!(f instanceof Error)){u(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)c.stop(),u(f.originalError);else if(f instanceof TypeError&&!s(f.message))c.stop(),u(f);else{n(f,d,o);try{await o.onFailedAttempt(f)}catch(h){u(h);return}c.retry(f)||u(c.mainError())}}})});return $s.exports=a,$s.exports.default=a,$s.exports.AbortError=t,$s.exports}var rE=tE();const to=Ha(rE),nE=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ta(r){return typeof r=="string"&&nE.test(r)}var Qe=[];for(var vl=0;vl<256;++vl)Qe.push((vl+256).toString(16).slice(1));function sE(r,e=0){return(Qe[r[e+0]]+Qe[r[e+1]]+Qe[r[e+2]]+Qe[r[e+3]]+"-"+Qe[r[e+4]]+Qe[r[e+5]]+"-"+Qe[r[e+6]]+Qe[r[e+7]]+"-"+Qe[r[e+8]]+Qe[r[e+9]]+"-"+Qe[r[e+10]]+Qe[r[e+11]]+Qe[r[e+12]]+Qe[r[e+13]]+Qe[r[e+14]]+Qe[r[e+15]]).toLowerCase()}var ci,aE=new Uint8Array(16);function iE(){if(!ci&&(ci=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ci))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ci(aE)}var oE=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Qf={randomUUID:oE};function ht(r,e,t){if(Qf.randomUUID&&!r)return Qf.randomUUID();r=r||{};var n=r.random||(r.rng||iE)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,sE(n)}var di={},xl={exports:{}},eh;function lE(){return eh||(eh=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,p){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,v,y;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,f),!0;case 5:return g.fn.call(g.context,c,d,f,h),!0;case 6:return g.fn.call(g.context,c,d,f,h,p),!0}for(y=1,v=new Array(_-1);y<_;y++)v[y-1]=arguments[y];g.fn.apply(g.context,v)}else{var b=g.length,E;for(y=0;y<b;y++)switch(g[y].once&&this.removeListener(u,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,c);break;case 3:g[y].fn.call(g[y].context,c,d);break;case 4:g[y].fn.call(g[y].context,c,d,f);break;default:if(!v)for(E=1,v=new Array(_-1);E<_;E++)v[E-1]=arguments[E];g[y].fn.apply(g[y].context,v)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==c||f&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[h]=g.length===1?g[0]:g:i(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(xl)),xl.exports}var Ns={exports:{}},El,th;function uE(){return th||(th=1,El=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),El}var rh;function cE(){if(rh)return Ns.exports;rh=1;const r=uE();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(n);return}const l=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const u=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,c=a instanceof Error?a:new e(u);typeof n.cancel=="function"&&n.cancel(),o(c)},s);r(n.then(i,o),()=>{clearTimeout(l)})});return Ns.exports=t,Ns.exports.default=t,Ns.exports.TimeoutError=e,Ns.exports}var fi={},hi={},nh;function dE(){if(nh)return hi;nh=1,Object.defineProperty(hi,"__esModule",{value:!0});function r(e,t,n){let s=0,a=e.length;for(;a>0;){const i=a/2|0;let o=s+i;n(e[o],t)<=0?(s=++o,a-=i+1):a=i}return s}return hi.default=r,hi}var sh;function fE(){if(sh)return fi;sh=1,Object.defineProperty(fi,"__esModule",{value:!0});const r=dE();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=r.default(this._queue,a,(o,l)=>l.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return fi.default=e,fi}var ah;function hE(){if(ah)return di;ah=1,Object.defineProperty(di,"__esModule",{value:!0});const r=lE(),e=cE(),t=fE(),n=()=>{},s=new e.TimeoutError;class a extends r{constructor(o){var l,u,c,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(u=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(c=o.interval)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((u,c)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&c(s)});u(await f)}catch(f){c(f)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async u=>this.add(u,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return di.default=a,di}var pE=hE();const Dr=Ha(pE),mE=(...r)=>fetch(...r),gE=Symbol.for("ls:fetch_implementation"),Q=()=>globalThis[gE]??mE,yE=[400,401,403,404,405,406,407,408],_E=[409];let ih=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Dr?this.queue=new Dr.default({concurrency:this.maxConcurrency}):this.queue=new Dr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>to(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(yE.includes(+i))throw s;if(_E.includes(+i))return;n&&await n(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>Q()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function oh(r){return typeof(r==null?void 0:r._getType)=="function"}function lh(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function de(r,e){if(!ta(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const uh={};function _y(r){uh[r]||(console.warn(r),uh[r]=!0)}var pi={exports:{}},Sl,ch;function Ho(){if(ch)return Sl;ch=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return Sl={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Sl}var Ol,dh;function qo(){if(dh)return Ol;dh=1;var r={};return Ol=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},Ol}var fh;function Va(){return fh||(fh=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Ho(),a=qo();e=r.exports={};const i=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[f,n]],p=g=>{for(const[_,v]of h)g=g.split(`${_}*`).join(`${_}{0,${v}}`).split(`${_}+`).join(`${_}{1,${v}}`);return g},m=(g,_,v)=>{const y=p(_),b=d++;a(g,b,_),c[g]=b,l[b]=_,u[b]=y,i[b]=new RegExp(_,v?"g":void 0),o[b]=new RegExp(y,v?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(pi,pi.exports)),pi.exports}var kl,hh;function yd(){if(hh)return kl;hh=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return kl=n=>n?typeof n!="object"?r:n:e,kl}var Tl,ph;function by(){if(ph)return Tl;ph=1;const r=/^[0-9]+$/,e=(n,s)=>{const a=r.test(n),i=r.test(s);return a&&i&&(n=+n,s=+s),n===s?0:a&&!i?-1:i&&!a?1:n<s?-1:1};return Tl={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},Tl}var Al,mh;function _t(){if(mh)return Al;mh=1;const r=qo(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Ho(),{safeRe:n,safeSrc:s,t:a}=Va(),i=yd(),{compareIdentifiers:o}=by();class l{constructor(c,d){if(d=i(d),c instanceof l){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const f=c.trim().match(d.loose?n[a.LOOSE]:n[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<t)return p}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(r("SemVer.compare",this.version,this.options,c),!(c instanceof l)){if(typeof c=="string"&&c===this.version)return 0;c=new l(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof l||(c=new l(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof l||(c=new l(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const f=this.prerelease[d],h=c.prerelease[d];if(r("prerelease compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}compareBuild(c){c instanceof l||(c=new l(c,this.options));let d=0;do{const f=this.build[d],h=c.build[d];if(r("build compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}inc(c,d,f){if(c.startsWith("pre")){if(!d&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const h=new RegExp(`^${this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]}$`),p=`-${d}`.match(h);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,f),this.inc("pre",d,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,f),this.inc("pre",d,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(d){let p=[d,h];f===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Al=l,Al}var Pl,gh;function Os(){if(gh)return Pl;gh=1;const r=_t();return Pl=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(a){if(!s)return null;throw a}},Pl}var Il,yh;function bE(){if(yh)return Il;yh=1;const r=Os();return Il=(t,n)=>{const s=r(t,n);return s?s.version:null},Il}var Rl,_h;function wE(){if(_h)return Rl;_h=1;const r=Os();return Rl=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Rl}var Cl,bh;function vE(){if(bh)return Cl;bh=1;const r=_t();return Cl=(t,n,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,a,i).version}catch{return null}},Cl}var $l,wh;function xE(){if(wh)return $l;wh=1;const r=Os();return $l=(t,n)=>{const s=r(t,null,!0),a=r(n,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,l=o?s:a,u=o?a:s,c=!!l.prerelease.length;if(!!u.prerelease.length&&!c){if(!u.patch&&!u.minor)return"major";if(u.compareMain(l)===0)return u.minor&&!u.patch?"minor":"patch"}const f=c?"pre":"";return s.major!==a.major?f+"major":s.minor!==a.minor?f+"minor":s.patch!==a.patch?f+"patch":"prerelease"},$l}var Nl,vh;function EE(){if(vh)return Nl;vh=1;const r=_t();return Nl=(t,n)=>new r(t,n).major,Nl}var jl,xh;function SE(){if(xh)return jl;xh=1;const r=_t();return jl=(t,n)=>new r(t,n).minor,jl}var Ll,Eh;function OE(){if(Eh)return Ll;Eh=1;const r=_t();return Ll=(t,n)=>new r(t,n).patch,Ll}var Ml,Sh;function kE(){if(Sh)return Ml;Sh=1;const r=Os();return Ml=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Ml}var Fl,Oh;function or(){if(Oh)return Fl;Oh=1;const r=_t();return Fl=(t,n,s)=>new r(t,s).compare(new r(n,s)),Fl}var Dl,kh;function TE(){if(kh)return Dl;kh=1;const r=or();return Dl=(t,n,s)=>r(n,t,s),Dl}var Ul,Th;function AE(){if(Th)return Ul;Th=1;const r=or();return Ul=(t,n)=>r(t,n,!0),Ul}var Bl,Ah;function _d(){if(Ah)return Bl;Ah=1;const r=_t();return Bl=(t,n,s)=>{const a=new r(t,s),i=new r(n,s);return a.compare(i)||a.compareBuild(i)},Bl}var Hl,Ph;function PE(){if(Ph)return Hl;Ph=1;const r=_d();return Hl=(t,n)=>t.sort((s,a)=>r(s,a,n)),Hl}var ql,Ih;function IE(){if(Ih)return ql;Ih=1;const r=_d();return ql=(t,n)=>t.sort((s,a)=>r(a,s,n)),ql}var Zl,Rh;function Zo(){if(Rh)return Zl;Rh=1;const r=or();return Zl=(t,n,s)=>r(t,n,s)>0,Zl}var zl,Ch;function bd(){if(Ch)return zl;Ch=1;const r=or();return zl=(t,n,s)=>r(t,n,s)<0,zl}var Vl,$h;function wy(){if($h)return Vl;$h=1;const r=or();return Vl=(t,n,s)=>r(t,n,s)===0,Vl}var Gl,Nh;function vy(){if(Nh)return Gl;Nh=1;const r=or();return Gl=(t,n,s)=>r(t,n,s)!==0,Gl}var Wl,jh;function wd(){if(jh)return Wl;jh=1;const r=or();return Wl=(t,n,s)=>r(t,n,s)>=0,Wl}var Jl,Lh;function vd(){if(Lh)return Jl;Lh=1;const r=or();return Jl=(t,n,s)=>r(t,n,s)<=0,Jl}var Kl,Mh;function xy(){if(Mh)return Kl;Mh=1;const r=wy(),e=vy(),t=Zo(),n=wd(),s=bd(),a=vd();return Kl=(o,l,u,c)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return r(o,u,c);case"!=":return e(o,u,c);case">":return t(o,u,c);case">=":return n(o,u,c);case"<":return s(o,u,c);case"<=":return a(o,u,c);default:throw new TypeError(`Invalid operator: ${l}`)}},Kl}var Xl,Fh;function RE(){if(Fh)return Xl;Fh=1;const r=_t(),e=Os(),{safeRe:t,t:n}=Va();return Xl=(a,i)=>{if(a instanceof r)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const h=i.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const l=o[2],u=o[3]||"0",c=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",f=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${u}.${c}${d}${f}`,i)},Xl}var Yl,Dh;function CE(){if(Dh)return Yl;Dh=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,n)}return this}}return Yl=r,Yl}var Ql,Uh;function lr(){if(Uh)return Ql;Uh=1;const r=/\s+/g;class e{constructor(I,U){if(U=s(U),I instanceof e)return I.loose===!!U.loose&&I.includePrerelease===!!U.includePrerelease?I:new e(I.raw,U);if(I instanceof a)return this.raw=I.value,this.set=[[I]],this.formatted=void 0,this;if(this.options=U,this.loose=!!U.loose,this.includePrerelease=!!U.includePrerelease,this.raw=I.trim().replace(r," "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(C=>!m(C[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const C of this.set)if(C.length===1&&g(C[0])){this.set=[C];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let I=0;I<this.set.length;I++){I>0&&(this.formatted+="||");const U=this.set[I];for(let R=0;R<U.length;R++)R>0&&(this.formatted+=" "),this.formatted+=U[R].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(I){const R=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+I,C=n.get(R);if(C)return C;const D=this.options.loose,X=D?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];I=I.replace(X,K(this.options.includePrerelease)),i("hyphen replace",I),I=I.replace(l[u.COMPARATORTRIM],c),i("comparator trim",I),I=I.replace(l[u.TILDETRIM],d),i("tilde trim",I),I=I.replace(l[u.CARETTRIM],f),i("caret trim",I);let ae=I.split(" ").map(Me=>v(Me,this.options)).join(" ").split(/\s+/).map(Me=>z(Me,this.options));D&&(ae=ae.filter(Me=>(i("loose invalid filter",Me,this.options),!!Me.match(l[u.COMPARATORLOOSE])))),i("range list",ae);const q=new Map,ue=ae.map(Me=>new a(Me,this.options));for(const Me of ue){if(m(Me))return[Me];q.set(Me.value,Me)}q.size>1&&q.has("")&&q.delete("");const Ne=[...q.values()];return n.set(R,Ne),Ne}intersects(I,U){if(!(I instanceof e))throw new TypeError("a Range is required");return this.set.some(R=>_(R,U)&&I.set.some(C=>_(C,U)&&R.every(D=>C.every(X=>D.intersects(X,U)))))}test(I){if(!I)return!1;if(typeof I=="string")try{I=new o(I,this.options)}catch{return!1}for(let U=0;U<this.set.length;U++)if(Ee(this.set[U],I,this.options))return!0;return!1}}Ql=e;const t=CE(),n=new t,s=yd(),a=zo(),i=qo(),o=_t(),{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=Va(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=Ho(),m=F=>F.value==="<0.0.0-0",g=F=>F.value==="",_=(F,I)=>{let U=!0;const R=F.slice();let C=R.pop();for(;U&&R.length;)U=R.every(D=>C.intersects(D,I)),C=R.pop();return U},v=(F,I)=>(i("comp",F,I),F=S(F,I),i("caret",F),F=b(F,I),i("tildes",F),F=A(F,I),i("xrange",F),F=oe(F,I),i("stars",F),F),y=F=>!F||F.toLowerCase()==="x"||F==="*",b=(F,I)=>F.trim().split(/\s+/).map(U=>E(U,I)).join(" "),E=(F,I)=>{const U=I.loose?l[u.TILDELOOSE]:l[u.TILDE];return F.replace(U,(R,C,D,X,ae)=>{i("tilde",F,R,C,D,X,ae);let q;return y(C)?q="":y(D)?q=`>=${C}.0.0 <${+C+1}.0.0-0`:y(X)?q=`>=${C}.${D}.0 <${C}.${+D+1}.0-0`:ae?(i("replaceTilde pr",ae),q=`>=${C}.${D}.${X}-${ae} <${C}.${+D+1}.0-0`):q=`>=${C}.${D}.${X} <${C}.${+D+1}.0-0`,i("tilde return",q),q})},S=(F,I)=>F.trim().split(/\s+/).map(U=>O(U,I)).join(" "),O=(F,I)=>{i("caret",F,I);const U=I.loose?l[u.CARETLOOSE]:l[u.CARET],R=I.includePrerelease?"-0":"";return F.replace(U,(C,D,X,ae,q)=>{i("caret",F,C,D,X,ae,q);let ue;return y(D)?ue="":y(X)?ue=`>=${D}.0.0${R} <${+D+1}.0.0-0`:y(ae)?D==="0"?ue=`>=${D}.${X}.0${R} <${D}.${+X+1}.0-0`:ue=`>=${D}.${X}.0${R} <${+D+1}.0.0-0`:q?(i("replaceCaret pr",q),D==="0"?X==="0"?ue=`>=${D}.${X}.${ae}-${q} <${D}.${X}.${+ae+1}-0`:ue=`>=${D}.${X}.${ae}-${q} <${D}.${+X+1}.0-0`:ue=`>=${D}.${X}.${ae}-${q} <${+D+1}.0.0-0`):(i("no pr"),D==="0"?X==="0"?ue=`>=${D}.${X}.${ae}${R} <${D}.${X}.${+ae+1}-0`:ue=`>=${D}.${X}.${ae}${R} <${D}.${+X+1}.0-0`:ue=`>=${D}.${X}.${ae} <${+D+1}.0.0-0`),i("caret return",ue),ue})},A=(F,I)=>(i("replaceXRanges",F,I),F.split(/\s+/).map(U=>se(U,I)).join(" ")),se=(F,I)=>{F=F.trim();const U=I.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return F.replace(U,(R,C,D,X,ae,q)=>{i("xRange",F,R,C,D,X,ae,q);const ue=y(D),Ne=ue||y(X),Me=Ne||y(ae),bt=Me;return C==="="&&bt&&(C=""),q=I.includePrerelease?"-0":"",ue?C===">"||C==="<"?R="<0.0.0-0":R="*":C&&bt?(Ne&&(X=0),ae=0,C===">"?(C=">=",Ne?(D=+D+1,X=0,ae=0):(X=+X+1,ae=0)):C==="<="&&(C="<",Ne?D=+D+1:X=+X+1),C==="<"&&(q="-0"),R=`${C+D}.${X}.${ae}${q}`):Ne?R=`>=${D}.0.0${q} <${+D+1}.0.0-0`:Me&&(R=`>=${D}.${X}.0${q} <${D}.${+X+1}.0-0`),i("xRange return",R),R})},oe=(F,I)=>(i("replaceStars",F,I),F.trim().replace(l[u.STAR],"")),z=(F,I)=>(i("replaceGTE0",F,I),F.trim().replace(l[I.includePrerelease?u.GTE0PRE:u.GTE0],"")),K=F=>(I,U,R,C,D,X,ae,q,ue,Ne,Me,bt)=>(y(R)?U="":y(C)?U=`>=${R}.0.0${F?"-0":""}`:y(D)?U=`>=${R}.${C}.0${F?"-0":""}`:X?U=`>=${U}`:U=`>=${U}${F?"-0":""}`,y(ue)?q="":y(Ne)?q=`<${+ue+1}.0.0-0`:y(Me)?q=`<${ue}.${+Ne+1}.0-0`:bt?q=`<=${ue}.${Ne}.${Me}-${bt}`:F?q=`<${ue}.${Ne}.${+Me+1}-0`:q=`<=${q}`,`${U} ${q}`.trim()),Ee=(F,I,U)=>{for(let R=0;R<F.length;R++)if(!F[R].test(I))return!1;if(I.prerelease.length&&!U.includePrerelease){for(let R=0;R<F.length;R++)if(i(F[R].semver),F[R].semver!==a.ANY&&F[R].semver.prerelease.length>0){const C=F[R].semver;if(C.major===I.major&&C.minor===I.minor&&C.patch===I.patch)return!0}return!1}return!0};return Ql}var eu,Bh;function zo(){if(Bh)return eu;Bh=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}eu=e;const t=yd(),{safeRe:n,t:s}=Va(),a=xy(),i=qo(),o=_t(),l=lr();return eu}var tu,Hh;function Vo(){if(Hh)return tu;Hh=1;const r=lr();return tu=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},tu}var ru,qh;function $E(){if(qh)return ru;qh=1;const r=lr();return ru=(t,n)=>new r(t,n).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),ru}var nu,Zh;function NE(){if(Zh)return nu;Zh=1;const r=_t(),e=lr();return nu=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===-1)&&(i=u,o=new r(i,a))}),i},nu}var su,zh;function jE(){if(zh)return su;zh=1;const r=_t(),e=lr();return su=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===1)&&(i=u,o=new r(i,a))}),i},su}var au,Vh;function LE(){if(Vh)return au;Vh=1;const r=_t(),e=lr(),t=Zo();return au=(s,a)=>{s=new e(s,a);let i=new r("0.0.0");if(s.test(i)||(i=new r("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let u=null;l.forEach(c=>{const d=new r(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!u||t(d,u))&&(u=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),u&&(!i||t(i,u))&&(i=u)}return i&&s.test(i)?i:null},au}var iu,Gh;function ME(){if(Gh)return iu;Gh=1;const r=lr();return iu=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},iu}var ou,Wh;function xd(){if(Wh)return ou;Wh=1;const r=_t(),e=zo(),{ANY:t}=e,n=lr(),s=Vo(),a=Zo(),i=bd(),o=vd(),l=wd();return ou=(c,d,f,h)=>{c=new r(c,h),d=new n(d,h);let p,m,g,_,v;switch(f){case">":p=a,m=o,g=i,_=">",v=">=";break;case"<":p=i,m=l,g=a,_="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(c,d,h))return!1;for(let y=0;y<d.set.length;++y){const b=d.set[y];let E=null,S=null;if(b.forEach(O=>{O.semver===t&&(O=new e(">=0.0.0")),E=E||O,S=S||O,p(O.semver,E.semver,h)?E=O:g(O.semver,S.semver,h)&&(S=O)}),E.operator===_||E.operator===v||(!S.operator||S.operator===_)&&m(c,S.semver))return!1;if(S.operator===v&&g(c,S.semver))return!1}return!0},ou}var lu,Jh;function FE(){if(Jh)return lu;Jh=1;const r=xd();return lu=(t,n,s)=>r(t,n,">",s),lu}var uu,Kh;function DE(){if(Kh)return uu;Kh=1;const r=xd();return uu=(t,n,s)=>r(t,n,"<",s),uu}var cu,Xh;function UE(){if(Xh)return cu;Xh=1;const r=lr();return cu=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),cu}var du,Yh;function BE(){if(Yh)return du;Yh=1;const r=Vo(),e=or();return du=(t,n,s)=>{const a=[];let i=null,o=null;const l=t.sort((f,h)=>e(f,h,s));for(const f of l)r(f,n,s)?(o=f,i||(i=f)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const u=[];for(const[f,h]of a)f===h?u.push(f):!h&&f===l[0]?u.push("*"):h?f===l[0]?u.push(`<=${h}`):u.push(`${f} - ${h}`):u.push(`>=${f}`);const c=u.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return c.length<d.length?c:n},du}var fu,Qh;function HE(){if(Qh)return fu;Qh=1;const r=lr(),e=zo(),{ANY:t}=e,n=Vo(),s=or(),a=(d,f,h={})=>{if(d===f)return!0;d=new r(d,h),f=new r(f,h);let p=!1;e:for(const m of d.set){for(const g of f.set){const _=l(m,g,h);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,f,h)=>{if(d===f)return!0;if(d.length===1&&d[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;h.includePrerelease?d=i:d=o}if(f.length===1&&f[0].semver===t){if(h.includePrerelease)return!0;f=o}const p=new Set;let m,g;for(const A of d)A.operator===">"||A.operator===">="?m=u(m,A,h):A.operator==="<"||A.operator==="<="?g=c(g,A,h):p.add(A.semver);if(p.size>1)return null;let _;if(m&&g){if(_=s(m.semver,g.semver,h),_>0)return null;if(_===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const A of p){if(m&&!n(A,String(m),h)||g&&!n(A,String(g),h))return null;for(const se of f)if(!n(A,String(se),h))return!1;return!0}let v,y,b,E,S=g&&!h.includePrerelease&&g.semver.prerelease.length?g.semver:!1,O=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;S&&S.prerelease.length===1&&g.operator==="<"&&S.prerelease[0]===0&&(S=!1);for(const A of f){if(E=E||A.operator===">"||A.operator===">=",b=b||A.operator==="<"||A.operator==="<=",m){if(O&&A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===O.major&&A.semver.minor===O.minor&&A.semver.patch===O.patch&&(O=!1),A.operator===">"||A.operator===">="){if(v=u(m,A,h),v===A&&v!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(A),h))return!1}if(g){if(S&&A.semver.prerelease&&A.semver.prerelease.length&&A.semver.major===S.major&&A.semver.minor===S.minor&&A.semver.patch===S.patch&&(S=!1),A.operator==="<"||A.operator==="<="){if(y=c(g,A,h),y===A&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(A),h))return!1}if(!A.operator&&(g||m)&&_!==0)return!1}return!(m&&b&&!g&&_!==0||g&&E&&!m&&_!==0||O||S)},u=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p>0?d:p<0||f.operator===">"&&d.operator===">="?f:d},c=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p<0?d:p>0||f.operator==="<"&&d.operator==="<="?f:d};return fu=a,fu}var hu,ep;function qE(){if(ep)return hu;ep=1;const r=Va(),e=Ho(),t=_t(),n=by(),s=Os(),a=bE(),i=wE(),o=vE(),l=xE(),u=EE(),c=SE(),d=OE(),f=kE(),h=or(),p=TE(),m=AE(),g=_d(),_=PE(),v=IE(),y=Zo(),b=bd(),E=wy(),S=vy(),O=wd(),A=vd(),se=xy(),oe=RE(),z=zo(),K=lr(),Ee=Vo(),F=$E(),I=NE(),U=jE(),R=LE(),C=ME(),D=xd(),X=FE(),ae=DE(),q=UE(),ue=BE(),Ne=HE();return hu={parse:s,valid:a,clean:i,inc:o,diff:l,major:u,minor:c,patch:d,prerelease:f,compare:h,rcompare:p,compareLoose:m,compareBuild:g,sort:_,rsort:v,gt:y,lt:b,eq:E,neq:S,gte:O,lte:A,cmp:se,coerce:oe,Comparator:z,Range:K,satisfies:Ee,toComparators:F,maxSatisfying:I,minSatisfying:U,minVersion:R,validRange:C,outside:D,gtr:X,ltr:ae,intersects:q,simplifyRange:ue,subset:Ne,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},hu}qE();function Vr(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${r}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class ZE extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function ye(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new ZE(s):new Error(s)}var tp="[...]",zE={result:"[Circular]"},ro=[],Xn=[];const VE=new TextEncoder;function GE(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function mi(r){return VE.encode(r)}function Rt(r,e,t,n){var s;try{const a=JSON.stringify(r,e,t);return mi(a)}catch(a){if(!((s=a.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),mi("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=GE()),cc(r,"",0,[],void 0,0,n);let i;try{Xn.length===0?i=JSON.stringify(r,e,t):i=JSON.stringify(r,WE(e),t)}catch{return mi("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ro.length!==0;){const o=ro.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return mi(i)}}function pu(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),ro.push([n,t,e,s])):Xn.push([e,t,r]):(n[t]=r,ro.push([n,t,e]))}function cc(r,e,t,n,s,a,i){a+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){pu(zE,r,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){pu(tp,r,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){pu(tp,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)cc(r[o],o,o,n,r,a,i);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var u=l[o];cc(r[u],u,o,n,r,a,i)}}n.pop()}}function WE(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Xn.length>0)for(var n=0;n<Xn.length;n++){var s=Xn[n];if(s[1]===e&&s[0]===t){t=s[2],Xn.splice(n,1);break}}return r.call(this,e,t)}}function rp(r){const e=Oy(),t=oS(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const JE=r=>{const e=(r==null?void 0:r.toString())??Yr("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},KE=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function XE(r){const e=[];for await(const t of r)e.push(t);return e}function mu(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const YE=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function np(r){return typeof r=="number"?Number(r.toFixed(4)):r}class QE{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(a=>{t=a}),s=Rt(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),n+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),n+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const eS=20971520,tS=2500;class Ia{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new QE}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:On("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Ia.getDefaultClientConfig();if(this.tracingSampleRate=JE(e.tracingSamplingRate),this.apiUrl=mu(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=mu(e.apiKey??t.apiKey),this.webUrl=mu(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new ih(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new ih({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:YE}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Yr("API_KEY"),t=Yr("ENDPOINT")??"https://api.smith.langchain.com",n=Yr("HIDE_INPUTS")==="true",s=Yr("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:KE(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Ey}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(Q(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(Q(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(Q(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?n.push(s):this.filteredPostUuids.add(a):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??eS}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const a=this._processBatch(n,s).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(n=a==null?void 0:a.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=rp(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await Q()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(tS),...this.fetchOptions});return await ye(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=rp(s),i=await this.caller.call(Q(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Rt(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((u,c)=>(c.id&&(u[c.id]=c),u),{}),l=[];for(const u of s)u.id!==void 0&&o[u.id]?o[u.id]={...o[u.id],...u}:l.push(u);n=Object.values(o),s=l}const a={post:n,patch:s};if(!a.post.length&&!a.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const l=o,u=a[l].reverse();let c=u.pop();for(;c!==void 0;)i[l].push(c),c=u.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(Rt(i))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(Q(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const c=s.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",s],["patch",a]])for(const f of d){const{inputs:h,outputs:p,events:m,attachments:g,..._}=f,v={inputs:h,outputs:p,events:m},y=Rt(_);u.push({name:`${c}.${_.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[b,E]of Object.entries(v)){if(E===void 0)continue;const S=Rt(E);u.push({name:`${c}.${_.id}.${b}`,payload:new Blob([S],{type:`application/json; length=${S.length}`})})}if(_.id!==void 0){const b=n[_.id];if(b){delete n[_.id];for(const[E,S]of Object.entries(b)){let O,A;if(Array.isArray(S)?[O,A]=S:(O=S.mimeType,A=S.data),E.includes(".")){console.warn(`Skipping attachment '${E}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${_.id}.${E}`,payload:new Blob([A],{type:`${O}; length=${A.byteLength}`})})}}}l.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const i=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(Q(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){de(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(Q(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:Rt(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){de(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:Yr("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await XE(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=n[e.id]||[];for(const a in n)a!==e.id&&(s[a].child_runs=n[a]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:g,limit:_,select:v}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const O=Array.isArray(n)?n:[n],A=await Promise.all(O.map(se=>this.readProject({projectName:se}).then(oe=>oe.id)));y.push(...A)}const b=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],E={session:y.length?y:null,run_type:c,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:_,trace:a,select:v||b,is_root:u};let S=0;for await(const O of this._getCursorPaginatedList("/runs/query",E))if(_){if(S>=_)break;if(O.length+S>_){yield*O.slice(0,_-S);break}S+=O.length,yield*O}else yield*O}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:g}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(S=>this.readProject({projectName:S}).then(O=>O.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:_,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:g}).filter(([S,O])=>O!==void 0));return await(await this.caller.call(Q(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||ht()};de(e);const a=await(await this.caller.call(Q(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){de(e);const t=await this.caller.call(Q(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(t,"unshare run",!0)}async readRunSharedLink(e){de(e);const n=await(await this.caller.call(Q(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)n.append("id",i);return de(e),await(await this.caller.call(Q(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),de(e);const s=await(await this.caller.call(Q(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};de(e);const a=await(await this.caller.call(Q(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){de(e);const t=await this.caller.call(Q(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(t,"unshare dataset",!0)}async readSharedDataset(e){return de(e),await(await this.caller.call(Q(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const a=await this.caller.call(Q(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};n&&(u.metadata=n);const c={name:e,extra:u,description:t};i!==null&&(c.reference_dataset_id=i);const d=await this.caller.call(Q(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;s&&(l={...l||{},metadata:s});const u={name:t,extra:l,description:n,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(Q(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)de(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(Q(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)de(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,de(n);const s=await this.caller.call(Q(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),n.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);const c=await this.caller.call(Q(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(Q(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)de(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const u of n)l.append("id",u);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;de(a);const i=await this.caller.call(Q(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;de(i);const o=await this.caller.call(Q(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)de(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(Q(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(a,`delete ${n}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),de(s);const a={tag:n},i=await this.caller.call(Q(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(i,"index dataset"),await i.json()}async similarExamples(e,t,n,{filter:s}={}){const a={limit:n,inputs:e};s!==void 0&&(a.filter=s),de(t);const i=await this.caller.call(Q(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,n){var c;if(sp(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const a=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;sp(e)?o=e:o={inputs:e,outputs:t,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??ht())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const v=e;let y=v[0].dataset_id;const b=v[0].dataset_name;if(y===void 0&&b===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&b!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:b})).id);const E=await this._uploadExamplesMultipart(y,v);return await Promise.all(E.example_ids.map(O=>this.readExample(O)))}const{inputs:t,outputs:n,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:u,exampleIds:c,datasetId:d,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let h=d;const p=f;if(h===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(await this.readDataset({datasetName:p})).id);const m=t.map((v,y)=>({dataset_id:h,inputs:v,outputs:n==null?void 0:n[y],metadata:s==null?void 0:s[y],split:a==null?void 0:a[y],id:c==null?void 0:c[y],attachments:u==null?void 0:u[y],source_run_id:i==null?void 0:i[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:l==null?void 0:l[y]})),g=await this._uploadExamplesMultipart(h,m);return await Promise.all(g.example_ids.map(v=>this.readExample(v)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(i=>oh(i)?lh(i):i),a=oh(t)?lh(t):t;return this.createExample({input:s},{output:a},n)}async readExample(e){de(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...a}=n,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:u,filter:c,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:f}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&h.append("as_of",p);const m=i??!0;if(h.append("inline_s3_urls",m.toString()),n!==void 0)for(const _ of n)h.append("id",_);if(a!==void 0)for(const _ of a)h.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);h.append("metadata",_)}l!==void 0&&h.append("limit",l.toString()),u!==void 0&&h.append("offset",u.toString()),c!==void 0&&h.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>h.append("select",_));let g=0;for await(const _ of this._getPaginated("/examples",h)){for(const v of _){const{attachment_urls:y,...b}=v,E=b;y&&(E.attachments=Object.entries(y).reduce((S,[O,A])=>(S[O.slice(11)]={presigned_url:A.presigned_url,mime_type:A.mime_type||void 0},S),{})),yield E,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){de(e);const t=`/examples/${e}`,n=await this.caller.call(Q(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,de(n);let s;t?s={id:n,...t}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,de(a),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(Q(),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,de(s);const a=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,de(i);const o={split_name:n,examples:s.map(u=>(de(u),u)),remove:a},l=await this.caller.call(Q(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){_y("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a),[l,u]=await this._logEvaluationFeedback(o,i,n);return u[0]}async createFeedback(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var v;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((v=p.metadata.__run)==null?void 0:v.run_id)!==void 0&&de(p.metadata.__run.run_id);const m={id:c??ht(),run_id:e,key:t,score:np(n),value:s,correction:a,comment:i,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},g=`${this.apiUrl}/feedback`,_=await this.caller.call(Q(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(_,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:a}){const i={};t!=null&&(i.score=np(t)),n!=null&&(i.value=n),s!=null&&(i.correction=s),a!=null&&(i.comment=a),de(e);const o=await this.caller.call(Q(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(o,"update feedback",!0)}async readFeedback(e){de(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){de(e);const t=`/feedback/${e}`,n=await this.caller.call(Q(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const a of t)s.append("key",a);if(n)for(const a of n)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const a={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?a.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(a.expires_in=n):a.expires_in={hours:3},await(await this.caller.call(Q(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:a,created_at:(c=s??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(Q(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){de(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((l,u)=>{de(l,`queueIds[${u}]`),i.append("ids",l)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,a={name:t,description:n,id:s||ht()},i=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,a=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(a,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>de(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${de(e,"queueId")}/run`,s=await this.caller.call(Q(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/runs/${de(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(Q(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(Q(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,a]=Vr(e),i=await this.caller.call(Q(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[t,n,s]=Vr(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=Vr(e),a=await this.caller.call(Q(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await ye(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=Vr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(Q(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=Vr(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(Q(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(u,"create commit");const c=await u.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const l of t){const u=l.id,c={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=Rt(c),f=new Blob([d],{type:"application/json"});if(n.append(u,f),l.inputs){const h=Rt(l.inputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.inputs`,p)}if(l.outputs){const h=Rt(l.outputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.outputs`,p)}if(l.attachments)for(const[h,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const _=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${u}.attachment.${h}`,_)}if(l.attachments_operations){const h=Rt(l.attachments_operations),p=new Blob([h],{type:"application/json"});n.append(`${u}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(Q(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const i of t){const o=(i.id??ht()).toString(),l={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=Rt(l),c=new Blob([u],{type:"application/json"});if(n.append(o,c),i.inputs){const d=Rt(i.inputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,f)}if(i.outputs){const d=Rt(i.outputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,f)}if(i.attachments)for(const[d,f]of Object.entries(i.attachments)){let h,p;Array.isArray(f)?[h,p]=f:(h=f.mimeType,p=f.data);const m=new Blob([p],{type:`${h}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}return await(await this.caller.call(Q(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=Vr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(Q(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ye(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=Vr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(Q(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,a]=Vr(e),i=await this.caller.call(Q(),`${this.apiUrl}/commits/${n}/${s}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ye(i,"pull prompt commit");const o=await i.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,n),o=new Ia({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(i),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return de(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function sp(r){return"dataset_id"in r||"dataset_name"in r}const Ey="0.3.15";var ra={};let Ir;const rS=()=>typeof window<"u"&&typeof window.document<"u",nS=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",sS=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Sy=()=>typeof Deno<"u",aS=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Sy(),iS=()=>Ir||(rS()?Ir="browser":aS()?Ir="node":nS()?Ir="webworker":sS()?Ir="jsdom":Sy()?Ir="deno":Ir="other",Ir);let gu;function Oy(){if(gu===void 0){const r=iS(),e=uS();gu={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Ey,...e}}return gu}function oS(){const r=lS()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function lS(){try{return typeof process<"u"&&ra?Object.entries(ra).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function On(r){try{return typeof process<"u"?ra==null?void 0:ra[r]:void 0}catch{return}}function Yr(r){return On(`LANGSMITH_${r}`)||On(`LANGCHAIN_${r}`)}let yu;function uS(){if(yu!==void 0)return yu;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=On(t);n!==void 0&&(e[t]=n)}return yu=e,e}const cS=r=>!!["TRACING_V2","TRACING"].find(t=>Yr(t)==="true"),_u=Symbol.for("lc:context_variables");function dS(r){return r.replace(/[-:.]/g,"")}function fS(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return dS(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class no{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let n={},s=[];for(const a of t){const[i,o]=a.split("="),l=decodeURIComponent(o);i==="langsmith-metadata"?n=JSON.parse(l):i==="langsmith-tags"&&(s=l.split(","))}return new no(n,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class jt{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),ky(e)){Object.assign(this,{...e});return}const t=jt.getDefaultConfig(),{metadata:n,...s}=e,a=s.client??jt.getSharedClient(),i={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=fS(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:ht(),run_type:"chain",project_name:Yr("PROJECT")??On("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:On("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:On("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return jt.sharedClient||(jt.sharedClient=new Ia),jt.sharedClient}createChild(e){var l,u,c,d,f,h;const t=this.child_execution_order+1,n=new jt({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});_u in this&&(n[_u]=this[_u]);const s=Symbol.for("lc:child_config"),a=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(pS(a)){const p={...a},m=hS(p.callbacks)?(c=(u=p.callbacks).copy)==null?void 0:c.call(u):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(h=(f=(d=m.handlers)==null?void 0:d.find(Ty))==null?void 0:f.updateFromRunTree)==null||h.call(f,n),p.callbacks=m),n.extra[s]=p}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[u,c]of Object.entries(t))s.runtime[u]||(s.runtime[u]=c);let a,i;return n?(i=(l=e.parent_run)==null?void 0:l.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=Oy(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){_y("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var u,c,d,f;const n=e==null?void 0:e.callbacks;let s,a,i,o=cS();if(n){const h=((u=n==null?void 0:n.getParentRunId)==null?void 0:u.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),a=p==null?void 0:p.projectName,i=p==null?void 0:p.client,o=o||!!p}return s?new jt({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=s==null?void 0:s.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new jt({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(c=>{const[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=i[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=i.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:a};if(n.baggage&&typeof n.baggage=="string"){const c=no.fromHeader(n.baggage);l.metadata=c.metadata,l.tags=c.tags}return new jt(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new no((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[s,a]of Object.entries(t))e.set(s,a);return t}}Object.defineProperty(jt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function ky(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function Ty(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function ap(r){return Array.isArray(r)&&r.some(e=>Ty(e))}function hS(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function pS(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(ap((e=r.callbacks)==null?void 0:e.handlers)||ap(r.callbacks))}let mS=class{getStore(){}run(e,t){return t()}};const bu=Symbol.for("ls:tracing_async_local_storage"),gS=new mS;let yS=class{getInstance(){return globalThis[bu]??gS}initializeGlobalInstance(e){globalThis[bu]===void 0&&(globalThis[bu]=e)}};const _S=new yS,bS=()=>{const r=_S.getInstance().getStore();if(!ky(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function Ed(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const wS=Object.prototype.hasOwnProperty;function dc(r,e){return wS.call(r,e)}function fc(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)dc(r,t)&&e.push(t);return e}function wr(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function hc(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function qn(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function vS(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function pc(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(pc(r[t]))return!0}else if(typeof r=="object"){const t=fc(r),n=t.length;for(var e=0;e<n;e++)if(pc(r[t[e]]))return!0}}return!1}function ip(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class xS extends Error{constructor(e,t,n,s,a){super(ip(e,{name:t,index:n,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=ip(e,{name:t,index:n,operation:s,tree:a})}}const He=xS,Yn={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=mc(t,this.path);n&&(n=wr(n));const s=na(t,{op:"remove",path:this.from}).removed;return na(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=mc(t,this.from);return na(t,{op:"add",path:this.path,value:wr(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:ao(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var ES={add:function(r,e,t){return hc(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Yn.move,copy:Yn.copy,test:Yn.test,_get:Yn._get};function mc(r,e){if(e=="")return r;var t={op:"_get",path:e};return na(r,t),t.value}function na(r,e,t=!1,n=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):gc(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=mc(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=ao(r,e.value),i.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new He("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,r);return i}}else{n||(r=wr(r));const o=(e.path||"").split("/");let l=r,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=gc;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=vS(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,r,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!hc(f))throw new He("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,r);hc(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new He("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,r);const p=ES[e.op].call(e,l,f,r);if(p.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}}else if(u>=c){const p=Yn[e.op].call(e,l,f,r);if(p.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new He("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,r)}}}function so(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new He("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=wr(r));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=na(r,e[i],t,!0,s,i),r=a[i].newDocument;return a.newDocument=r,a}function gc(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new He("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Yn[r.op]){if(typeof r.path!="string")throw new He("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new He('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new He("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new He("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&pc(r.value))throw new He("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new He("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new He("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=SS([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new He("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new He("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function SS(r,e,t){try{if(!Array.isArray(r))throw new He("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)so(wr(e),wr(r),t||!0);else{t=t||gc;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof He)return s;throw s}}function ao(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,a,i;if(t&&n){if(a=r.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!ao(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!ao(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function Ay(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=fc(e),i=fc(r),o=!1,l=i.length-1;l>=0;l--){var u=i[l],c=r[u];if(dc(e,u)&&!(e[u]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?Ay(c,d,t,n+"/"+qn(u),s):c!==d&&(s&&t.push({op:"test",path:n+"/"+qn(u),value:wr(c)}),t.push({op:"replace",path:n+"/"+qn(u),value:wr(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+qn(u),value:wr(c)}),t.push({op:"remove",path:n+"/"+qn(u)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&a.length==i.length))for(var l=0;l<a.length;l++){var u=a[l];!dc(r,u)&&e[u]!==void 0&&t.push({op:"add",path:n+"/"+qn(u),value:wr(e[u])})}}}function OS(r,e,t=!1){var n=[];return Ay(r,e,n,"",t),n}var wu={};const kS=()=>typeof window<"u"&&typeof window.document<"u",TS=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",AS=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Sd=()=>typeof Deno<"u",PS=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Sd(),IS=()=>{let r;return kS()?r="browser":PS()?r="node":TS()?r="webworker":AS()?r="jsdom":Sd()?r="deno":r="other",r};let vu;async function RS(){return vu===void 0&&(vu={library:"langchain-js",runtime:IS()}),vu}function xr(r){try{return typeof process<"u"?wu==null?void 0:wu[r]:Sd()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class CS{}function $S(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class Ga extends CS{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,sy(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:xr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return In.prototype.toJSON.call(this)}toJSONNotImplemented(){return In.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Ga{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}return new t}}const NS=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function xu(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function jS(r){return r.replace(/[-:.]/g,"")}function LS(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return jS(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function js(r){return typeof r._addRunToRunMap=="function"}class Wa extends Ga{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=LS(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=xu(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=xu(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=xu(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onToolStart)==null?void 0:c.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,a,i){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}var $i={exports:{}};$i.exports;var op;function MS(){return op||(op=1,function(r){const t=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,n=(a=0)=>(i,o,l)=>`\x1B[${38+a};2;${i};${o};${l}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,l]of Object.entries(i)){for(const[u,c]of Object.entries(l))i[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=i[u],a.set(c[0],c[1]);Object.defineProperty(i,o,{value:l,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=n(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}($i)),$i.exports}var FS=MS();const Py=Ha(FS);function lt(r,e){return`${r.open}${e}${r.close}`}function Ut(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function lp(r){return typeof r=="string"?r.trim():r==null?r:Ut(r,r.toString())}function Gr(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:vt}=Py;class up extends Wa{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?lt(Py.bold,o):o}).join(" > ");return lt(vt.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ut(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[chain/end]")} [${t}] [${Gr(e)}] Exiting Chain run with output: ${Ut(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[chain/error]")} [${t}] [${Gr(e)}] Chain run errored with error: ${Ut(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${lt(vt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ut(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[llm/end]")} [${t}] [${Gr(e)}] Exiting LLM run with output: ${Ut(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[llm/error]")} [${t}] [${Gr(e)}] LLM run errored with error: ${Ut(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${lp(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[tool/end]")} [${t}] [${Gr(e)}] Exiting Tool run with output: "${lp((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[tool/error]")} [${t}] [${Gr(e)}] Tool run errored with error: ${Ut(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ut(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[retriever/end]")} [${t}] [${Gr(e)}] Exiting Retriever run with output: ${Ut(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[retriever/error]")} [${t}] [${Gr(e)}] Retriever run errored with error: ${Ut(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${lt(vt.blue,"[agent/action]")} [${n}] Agent selected action: ${Ut(t.actions[t.actions.length-1],"[action]")}`)}}let Eu;const DS=()=>{if(Eu===void 0){const r=xr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Eu=new Ia(r)}return Eu};class sa extends Wa{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??xr("LANGCHAIN_PROJECT")??xr("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??DS();const a=sa.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await RS()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const a=s.shift();!a||n.has(a.id)||(n.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,a]of this.runMap){const i=new jt({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,n.push([s,a.dotted_order])}n.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(const[s]of n){const a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){const o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return bS()}catch{return}}}const Iy=Symbol.for("ls:tracing_async_local_storage"),Ni=Symbol.for("lc:context_variables"),US=r=>{globalThis[Iy]=r},Ra=()=>globalThis[Iy];let aa;function BS(){const r="default"in Dr?Dr.default:Dr;return new r({autoStart:!0,concurrency:1})}function HS(){return typeof aa>"u"&&(aa=BS()),aa}async function Ve(r,e){if(e===!0){const t=Ra();t!==void 0?await t.run(void 0,async()=>r()):await r()}else aa=HS(),aa.add(async()=>{const t=Ra();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const qS=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>xr(t)==="true");function Ry(r){var n;const e=Ra();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Ni])==null?void 0:n[r]}const ZS=Symbol("lc:configure_hooks"),zS=()=>Ry(ZS)||[];class VS{setHandler(e){return this.setHandlers([e])}}class Go{constructor(e,t,n,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class GS extends Go{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class cp extends Go{async handleLLMNewToken(e,t,n,s,a,i){await Promise.all(this.handlers.map(o=>Ve(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleLLMEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class WS extends Go{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class JS extends Go{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class St extends VS{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ht();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return js(f)&&f._createRunForLLMStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),Ve(async()=>{var h;try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new cp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ht();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return js(f)&&f._createRunForChatModelStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),Ve(async()=>{var h,p;try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=oy(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new cp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return js(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),Ve(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new WS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return js(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Ve(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new JS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return js(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Ve(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new GS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ve(async()=>{var o;if(!i.ignoreCustomEvent)try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,n,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new St(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);n.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);n.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)n.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends Ga{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,a,i,o){return this._configureSync(e,t,n,s,a,i,o)}static _configureSync(e,t,n,s,a,i,o){var f,h;let l;(e||t)&&(Array.isArray(e)||!e?(l=new St,l.setHandlers((e==null?void 0:e.map(io))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(io):t==null?void 0:t.handlers,!1));const u=xr("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=((f=sa.getTraceableRunTree())==null?void 0:f.tracingEnabled)||qS(),d=c||(xr("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new St),u&&!l.handlers.some(p=>p.name===up.prototype.name)){const p=new up;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new sa;l.addHandler(p,!0),l._parentRunId=((h=sa.getTraceableRunTree())==null?void 0:h.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:_}of zS()){const v=_&&xr(_)==="true"&&g;let y;const b=p!==void 0?Ry(p):void 0;b&&NS(b)?y=b:v&&(y=new g({})),y!==void 0&&(l||(l=new St),l.handlers.some(E=>E.name===y.name)||l.addHandler(y,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}function io(r){return"name"in r?r:Ga.fromMethods(r)}class KS{getStore(){}run(e,t){return t()}enterWith(e){}}const XS=new KS,dp=Symbol.for("lc:child_config");class YS{getInstance(){return Ra()??XS}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[dp]}runWithConfig(e,t,n){var c;const s=St._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),i=a.getStore(),o=s==null?void 0:s.getParentRunId(),l=(c=s==null?void 0:s.handlers)==null?void 0:c.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let u;return l&&o?u=l.convertToRunTree(o):n||(u=new jt({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[dp]:e}),i!==void 0&&i[Ni]!==void 0&&(u===void 0&&(u={}),u[Ni]=i[Ni]),a.run(u,t)}initializeGlobalInstance(e){Ra()===void 0&&US(e)}}const ln=new YS,Su=25;async function nr(r){return St._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function fp(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(io(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(io(o),!0);e.callbacks=i}else e.callbacks=new St(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const QS=new Set(["string","number","boolean"]);function Te(r){var n;const e=ln.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;t=Object.entries(i).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),t)}if(r&&(t=Object.entries(r).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))QS.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function at(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:a,runId:i}={}){const o=Te(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function gs(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function un(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Dt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Dt({start(n){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){n.close();return}return n.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Dt({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function Cy(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const a=await r.next();for(const i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function sr(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=sr(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class ks{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{ln.runWithConfig(gs(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(a=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?ln.runWithConfig(gs(this.config),this.signal?async()=>un(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function eO(r,e,t,n,...s){const a=new ks({generator:e,startSetup:t,signal:n}),i=await a.setup;return{output:r(a,i,...s),setup:i}}class Kr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=so({},t);return new Ca({ops:t,state:n[n.length-1].newDocument})}}class Ca extends Kr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=so(this.state,e.ops);return new Ca({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=so({},e.ops);return new Ca({ops:e.ops,state:t[t.length-1].newDocument})}}const tO=r=>r.name==="log_stream_tracer";async function hp(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function pp(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function rO(r){return r!==void 0&&r.message!==void 0}class mp extends Wa{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Dt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Kr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Kr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await hp(e,this._schemaFormat)),await this.writer.write(new Kr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await hp(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await pp(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Kr({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Kr({ops:[{op:"replace",path:"/final_output",value:await pp(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?rO(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new rn({id:`run-${e.id}`,content:t}):i=t;const o=new Kr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}const gp="__run";class ys{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ys({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Nn extends ys{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Nn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function gi({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const nO=r=>r.name==="event_stream_tracer";class sO extends Wa{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Dt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new ys({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(l=>{o=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:a(s.runType,n.value)}},s),yield n.value;for await(const u of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:a(s.runType,u)}},s),yield u}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var i,o;const t=gi(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?a=new rn({content:t,id:`run-${e.id}`}):a=n.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?a=new ys({text:t}):a=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(t.runType==="chat_model"){for(const u of s??[]){if(a!==void 0)break;a=(o=u[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")a={generations:s==null?void 0:s.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var i,o;const t=gi(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,a;const t=gi(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,i;const t=gi(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const aO=[400,401,402,403,404,405,406,407,409],iO=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&aO.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class Od{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??iO;const t="default"in Dr?Dr.default:Dr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>to(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class $y extends Wa{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function kd(r){return r?r.lc_runnable:!1}class oO{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),n}}const lO=Symbol("Let zodToJsonSchema decide on which parser to use"),uO={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},cO=r=>({...uO,...r}),dO=r=>{const e=cO(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Ny(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Ie(r,e,t,n,s){r[e]=t,Ny(r,e,n,s)}function fO(){return{}}function hO(r,e){var n,s,a;const t={type:"array"};return(n=r.type)!=null&&n._def&&((a=(s=r.type)==null?void 0:s._def)==null?void 0:a.typeName)!==k.ZodAny&&(t.items=Ae(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ie(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ie(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ie(t,"minItems",r.exactLength.value,r.exactLength.message,e),Ie(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function pO(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ie(t,"minimum",n.value,n.message,e):Ie(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ie(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(t,"maximum",n.value,n.message,e):Ie(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ie(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(t,"multipleOf",n.value,n.message,e);break}return t}function mO(){return{type:"boolean"}}function jy(r,e){return Ae(r.type._def,e)}const gO=(r,e)=>Ae(r.innerType._def,e);function Ly(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>Ly(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return yO(r,e)}}const yO=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Ie(t,"minimum",n.value,n.message,e);break;case"max":Ie(t,"maximum",n.value,n.message,e);break}return t};function _O(r,e){return{...Ae(r.innerType._def,e),default:r.defaultValue()}}function bO(r,e){return e.effectStrategy==="input"?Ae(r.schema._def,e):{}}function wO(r){return{type:"string",enum:Array.from(r.values)}}const vO=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function xO(r,e){const t=[Ae(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Ae(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(vO(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function EO(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Ou;const zt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ou===void 0&&(Ou=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ou),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function My(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Vt(t,"email",n.message,e);break;case"format:idn-email":Vt(t,"idn-email",n.message,e);break;case"pattern:zod":ut(t,zt.email,n.message,e);break}break;case"url":Vt(t,"uri",n.message,e);break;case"uuid":Vt(t,"uuid",n.message,e);break;case"regex":ut(t,n.regex,n.message,e);break;case"cuid":ut(t,zt.cuid,n.message,e);break;case"cuid2":ut(t,zt.cuid2,n.message,e);break;case"startsWith":ut(t,RegExp(`^${ku(n.value,e)}`),n.message,e);break;case"endsWith":ut(t,RegExp(`${ku(n.value,e)}$`),n.message,e);break;case"datetime":Vt(t,"date-time",n.message,e);break;case"date":Vt(t,"date",n.message,e);break;case"time":Vt(t,"time",n.message,e);break;case"duration":Vt(t,"duration",n.message,e);break;case"length":Ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{ut(t,RegExp(ku(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Vt(t,"ipv4",n.message,e),n.version!=="v4"&&Vt(t,"ipv6",n.message,e);break}case"base64url":ut(t,zt.base64url,n.message,e);break;case"jwt":ut(t,zt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&ut(t,zt.ipv4Cidr,n.message,e),n.version!=="v4"&&ut(t,zt.ipv6Cidr,n.message,e);break}case"emoji":ut(t,zt.emoji(),n.message,e);break;case"ulid":{ut(t,zt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Vt(t,"binary",n.message,e);break}case"contentEncoding:base64":{Ie(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{ut(t,zt.base64,n.message,e);break}}break}case"nanoid":ut(t,zt.nanoid,n.message,e)}return t}function ku(r,e){return e.patternStrategy==="escape"?OO(r):r}const SO=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function OO(r){let e="";for(let t=0;t<r.length;t++)SO.has(r[t])||(e+="\\"),e+=r[t];return e}function Vt(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Ie(r,"format",e,t,n)}function ut(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:yp(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Ie(r,"pattern",yp(e,n),t,n)}function yp(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",a=!1,i=!1,o=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(t.i){if(i){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&((l=n[u+2])!=null&&l.match(/[a-z]/))?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function Fy(r,e){var n,s,a,i,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===k.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>({...u,[c]:Ae(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Ae(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===k.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=My(r.keyType._def,e);return{...t,propertyNames:c}}else{if(((i=r.keyType)==null?void 0:i._def.typeName)===k.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===k.ZodBranded&&r.keyType._def.type._def.typeName===k.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=jy(r.keyType._def,e);return{...t,propertyNames:c}}}return t}function kO(r,e){if(e.mapStrategy==="record")return Fy(r,e);const t=Ae(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Ae(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function TO(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function AO(){return{not:{}}}function PO(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const oo={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function IO(r,e){if(e.target==="openApi3")return _p(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in oo&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=oo[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return _p(r,e)}const _p=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Ae(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function RO(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:oo[r.innerType._def.typeName],nullable:!0}:{type:[oo[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Ae(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Ae(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function CO(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",Ny(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ie(t,"minimum",n.value,n.message,e):Ie(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Ie(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ie(t,"maximum",n.value,n.message,e):Ie(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Ie(t,"maximum",n.value,n.message,e));break;case"multipleOf":Ie(t,"multipleOf",n.value,n.message,e);break}return t}function $O(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],a=r.shape();for(const o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let u=jO(l);u&&t&&(l instanceof rr&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=Ae(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(n.properties[o]=c,u||s.push(o))}s.length&&(n.required=s);const i=NO(r,e);return i!==void 0&&(n.additionalProperties=i),n}function NO(r,e){if(r.catchall._def.typeName!=="ZodNever")return Ae(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function jO(r){try{return r.isOptional()}catch{return!0}}const LO=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Ae(r.innerType._def,e);const t=Ae(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},MO=(r,e)=>{if(e.pipeStrategy==="input")return Ae(r.in._def,e);if(e.pipeStrategy==="output")return Ae(r.out._def,e);const t=Ae(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Ae(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function FO(r,e){return Ae(r.type._def,e)}function DO(r,e){const n={type:"array",uniqueItems:!0,items:Ae(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ie(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ie(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function UO(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Ae(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Ae(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Ae(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function BO(){return{not:{}}}function HO(){return{}}const qO=(r,e)=>Ae(r.innerType._def,e),ZO=(r,e,t)=>{switch(e){case k.ZodString:return My(r,t);case k.ZodNumber:return CO(r,t);case k.ZodObject:return $O(r,t);case k.ZodBigInt:return pO(r,t);case k.ZodBoolean:return mO();case k.ZodDate:return Ly(r,t);case k.ZodUndefined:return BO();case k.ZodNull:return PO(t);case k.ZodArray:return hO(r,t);case k.ZodUnion:case k.ZodDiscriminatedUnion:return IO(r,t);case k.ZodIntersection:return xO(r,t);case k.ZodTuple:return UO(r,t);case k.ZodRecord:return Fy(r,t);case k.ZodLiteral:return EO(r,t);case k.ZodEnum:return wO(r);case k.ZodNativeEnum:return TO(r);case k.ZodNullable:return RO(r,t);case k.ZodOptional:return LO(r,t);case k.ZodMap:return kO(r,t);case k.ZodSet:return DO(r,t);case k.ZodLazy:return()=>r.getter()._def;case k.ZodPromise:return FO(r,t);case k.ZodNaN:case k.ZodNever:return AO();case k.ZodEffects:return bO(r,t);case k.ZodAny:return fO();case k.ZodUnknown:return HO();case k.ZodDefault:return _O(r,t);case k.ZodBranded:return jy(r,t);case k.ZodReadonly:return qO(r,t);case k.ZodCatch:return gO(r,t);case k.ZodPipeline:return MO(r,t);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(n=>{})()}};function Ae(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==lO)return l}if(n&&!t){const l=zO(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=ZO(r,r.typeName,e),i=typeof a=="function"?Ae(a(),e):a;if(i&&GO(r,e,i),e.postProcess){const l=e.postProcess(i,r,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}const zO=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:VO(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},VO=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},GO=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),Ja=(r,e)=>{const t=dO(e),n=void 0,s=e==null?void 0:e.name,a=Ae(r._def,t,!1)??{},i=s===void 0?n?{...a,[t.definitionPath]:n}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:a}};return t.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function Tu(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const WO=["*","_","`"];function JO(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function KO(r,e,t){const{firstNode:n,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const h="default",p={[h]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const _=g.name.split(":").pop()??"";let y=WO.some(E=>_.startsWith(E)&&_.endsWith(E))?`<p>${_}</p>`:_;Object.keys(g.metadata??{}).length&&(y+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([E,S])=>`${E} = ${S}`).join(`
`)}</em></small>`);const b=(p[m]??p[h]).replace("{0}",Tu(m)).replace("{1}",y);u+=`	${b}
`}}const c={};for(const h of e){const p=h.source.split(":"),m=h.target.split(":"),g=p.filter((_,v)=>_===m[v]).join(":");c[g]||(c[g]=[]),c[g].push(h)}const d=new Set;function f(h,p){const m=h.length===1&&h[0].source===h[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),u+=`	subgraph ${g}
`}for(const g of h){const{source:_,target:v,data:y,conditional:b}=g;let E="";if(y!==void 0){let S=y;const O=S.split(" ");O.length>l&&(S=Array.from({length:Math.ceil(O.length/l)},(A,se)=>O.slice(se*l,(se+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),E=b?` -. &nbsp;${S}&nbsp; .-> `:` -- &nbsp;${S}&nbsp; --> `}else E=b?" -.-> ":" --> ";u+=`	${Tu(_)}${E}${Tu(v)};
`}for(const g in c)g.startsWith(`${p}:`)&&g!==p&&f(c[g],g);p&&!m&&(u+=`	end
`)}f(c[""]??[],"");for(const h in c)!h.includes(":")&&h!==""&&f(c[h],h);return i&&(u+=JO(a??{})),u}async function XO(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function YO(r,e){if(r!==void 0&&!ta(r))return r;if(kd(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function QO(r){return kd(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Ja(r.data.schema),title:r.data.name}}}class Wo{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=ta(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...QO(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??ht(),a={id:s,data:e,name:YO(t,e),metadata:n};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(a),a}firstNode(){return bp(this)}lastNode(){return wp(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(u=>u.id).every(ta)&&(n="");const a=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[a(u)]={...c,id:a(u)}});const i=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&bp(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&wp(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const a=e[s];return ta(s)&&t.get(a)===1?a:s};return new Wo({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[n(s),{...a,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),l=i.lastNode();return KO(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return XO(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function bp(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function wp(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function ek(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Dt.fromReadableStream(t)}function vp(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const tk=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function yc(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*xp(r,e){for(;;){const{value:t,done:n}=ln.runWithConfig(gs(r),e.next.bind(e),!0);if(n)break;yield t}}async function*_c(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await ln.runWithConfig(gs(r),t.next.bind(e),!0);if(s)break;yield n}}function Ke(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class Xe extends In{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new kn({bound:this,kwargs:e,config:{}})}map(){return new lo({bound:this})}withRetry(e){return new rk({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new kn({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new sk({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Te);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>Te(a===0?e:n))}return Array.from({length:t},()=>Te(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new Od({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>i.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Te(t),s=new ks({generator:this._streamIterator(e,n),config:n});return await s.setup,Dt.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Te(e):t=Te({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=Te(n),a=await nr(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Ke(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,i);o=await un(l,n==null?void 0:n.signal)}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(Ke(o,"output"))),o}async _batchWithConfig(e,t,n,s){var u;const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(nr)),o=await Promise.all(i.map(async(c,d)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),Ke(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,f}));let l;try{const c=e.call(this,t,a,o,s);l=await un(c,(u=a==null?void 0:a[0])==null?void 0:u.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(Ke(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,a=!0,i,o=!0;const l=Te(n),u=await nr(l);async function*c(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=sr(s,f)}catch{s=void 0,a=!1}yield f}}let d;try{const f=await eO(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=f.setup;const h=d==null?void 0:d.handlers.find(nO);let p=f.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(tO);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(i===void 0)i=g;else try{i=sr(i,g)}catch{i=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Ke(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:Ke(s,"input")}))}getGraph(e){const t=new Wo,n=t.addNode({name:`${this.getName()}Input`,schema:Sn.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Sn.any()});return t.addEdge(n,s),t.addEdge(s,a),t}pipe(e){return new Fr({first:this,last:vn(e)})}pick(e){return this.pipe(new ak(e))}assign(e){return this.pipe(new Dy(new Ts({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=sr(n,s);yield*this._streamIterator(n,Te(t))}async*streamLog(e,t,n){const s=new mp({...n,autoClose:!1,_schemaFormat:"original"}),a=Te(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const a=this.stream(e,n);async function i(){try{const l=await a;for await(const u of l){const c=new Kr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=i();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?ek(s):Dt.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new sO({...n,autoClose:!1}),a=Te(t),i=a.runId??ht();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),a.callbacks=m}const l=new AbortController,u=this;async function c(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await u.stream(e,{...a,signal:m}),_=s.tapOutputIterable(i,g);for await(const v of _)if(l.signal.aborted)break}finally{await s.finish()}}const d=c();let f=!1,h;try{for await(const m of s){if(!f){m.data.input=e,f=!0,h=m.run_id,yield m;continue}m.run_id===h&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,a=!1;const i=Te(t),o=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new mp({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new oO({...n}),f=this._streamLog(e,c,i);for await(const p of f){if(s?s=s.concat(p):s=Ca.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const v={...s.state},y={run_id:v.id,event:`on_${v.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,v.type)&&(yield y)}const m=p.ops.filter(v=>v.path.startsWith("/logs/")).map(v=>v.path.split("/")[2]),g=[...new Set(m)];for(const v of g){let y,b={};const E=s.state.logs[v];if(E.end_time===void 0?E.streamed_output.length>0?y="stream":y="start":y="end",y==="start")E.inputs!==void 0&&(b.input=E.inputs);else if(y==="end")E.inputs!==void 0&&(b.input=E.inputs),b.output=E.final_output;else if(y==="stream"){const S=E.streamed_output.length;if(S!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${S} instead. Encountered in: "${E.name}"`);b={chunk:E.streamed_output[0]},E.streamed_output=[]}yield{event:`on_${E.type}_${y}`,name:E.name,run_id:E.id,tags:E.tags,metadata:E.metadata,data:b}}const{state:_}=s;if(_.streamed_output.length>0){const v=_.streamed_output.length;if(v!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${v} instead. Encountered in: "${_.name}"`);const y={chunk:_.streamed_output[0]};_.streamed_output=[];const b={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:l,name:u,data:y};d.includeEvent(b,_.type)&&(yield b)}}const h=s==null?void 0:s.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return kd(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new kn({bound:this,config:{},configFactories:[s=>({callbacks:[new $y({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return ik(this,e)}}class kn extends Xe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=fp(this.config,...e);return fp(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Te(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Te(a),this.kwargs))):await this._mergeConfig(Te(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Te(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Te(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Te(t),this.kwargs))}streamEvents(e,t,n){const s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Te(t),s.kwargs),version:t.version},n)};return Dt.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&Xe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new kn({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new $y({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class lo extends Xe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new lo({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,at(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new lo({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class rk extends kn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return at(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return to(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const a={};try{await to(async i=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(i,t==null?void 0:t[f],n==null?void 0:n[f])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class Fr extends Xe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=Te(t),s=await nr(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let i=e,o;try{const u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){const f=u[c].invoke(i,at(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));i=await un(f,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(i,at(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(Ke(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(nr)),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Ke(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const d=this.steps[u].batch(o,i.map((f,h)=>{const p=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return at(s[h],{callbacks:p})}),n);o=await un(d,(l=s[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(i.map(u=>u==null?void 0:u.handleChainEnd(Ke(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await nr(t),{runId:s,...a}=t??{},i=await(n==null?void 0:n.handleChainStart(this.toJSON(),Ke(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let f=o[0].transform(c(),at(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<o.length;h+=1)f=await o[h].transform(f,at(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of f)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield h,l)if(u===void 0)u=h;else try{u=sr(u,h)}catch{u=void 0,l=!1}}catch(f){throw await(i==null?void 0:i.handleChainError(f)),f}await(i==null?void 0:i.handleChainEnd(Ke(u,"output")))}getGraph(e){const t=new Wo;let n=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=i.lastNode()}),t}pipe(e){return Fr.isRunnableSequence(e)?new Fr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Fr({first:this.first,middle:[...this.middle,this.last],last:vn(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Xe.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new Fr({...s,first:vn(e),middle:t.slice(0,-1).map(vn),last:vn(t[t.length-1])})}}class Ts extends Xe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=vn(n)}static from(e){return new Ts({steps:e})}async invoke(e,t){const n=Te(t),s=await nr(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const i={};try{const o=Object.entries(this.steps).map(async([l,u])=>{i[l]=await u.invoke(e,at(n,{callbacks:a==null?void 0:a.getChild(`map:key:${l}`)}))});await un(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,t,n){const s={...this.steps},a=Cy(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],u)=>{const c=l.transform(a[u],at(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:l,result:u,gen:c}=await un(o,n==null?void 0:n.signal);i.delete(l),u.done||(yield{[l]:u.value},i.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new ks({generator:this.transform(n(),s),config:s});return await a.setup,Dt.fromAsyncGenerator(a)}}class Td extends Xe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Ed(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await nr(n),a=this.func(at(n,{callbacks:s}),e);return un(a,n==null?void 0:n.signal)}async*_streamIterator(e,t){var a,i;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(yc(s)){for await(const o of s)(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),yield o;return}if(tk(s)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new Td({func:e})}}function nk(r){if(Ed(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class As extends Xe{static lc_name(){return"RunnableLambda"}constructor(e){if(Ed(e.func))return Td.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),nk(e.func),this.func=e.func}static from(e){return new As({func:e})}async _invoke(e,t,n){return new Promise((s,a)=>{const i=at(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Su)-1});ln.runWithConfig(gs(i),async()=>{var o,l;try{let u=await this.func(e,{...i});if(u&&Xe.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...i,recursionLimit:(i.recursionLimit??Su)-1})}else if(yc(u)){let c;for await(const d of _c(i,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),c===void 0)c=d;else try{c=sr(c,d)}catch{c=d}u=c}else if(vp(u)){let c;for(const d of xp(i,u))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),c===void 0)c=d;else try{c=sr(c,d)}catch{c=d}u=c}s(u)}catch(u){a(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const u of e)if(s===void 0)s=u;else try{s=sr(s,u)}catch{s=u}const a=at(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Su)-1}),i=await new Promise((u,c)=>{ln.runWithConfig(gs(a),async()=>{try{const d=await this.func(s,{...a,config:a});u(d)}catch(d){c(d)}})});if(i&&Xe.isRunnable(i)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await i.stream(s,a);for await(const c of u)yield c}else if(yc(i))for await(const u of _c(a,i))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield u;else if(vp(i))for(const u of xp(a,i))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield u;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new ks({generator:this.transform(n(),s),config:s});return await a.setup,Dt.fromAsyncGenerator(a)}}class sk extends Xe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Te(t),s=await nr(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),l=at(i,{callbacks:o==null?void 0:o.getChild()});return await ln.runWithConfig(l,async()=>{var d;let c;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const h=await f.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(Ke(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,t){var d;const n=Te(t),s=await nr(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let l,u;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const h=at(i,{callbacks:o==null?void 0:o.getChild()});try{const p=await f.stream(e,h);u=_c(h,p);break}catch(p){l===void 0&&(l=p)}}if(u===void 0){const f=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let c;try{for await(const f of u){yield f;try{c=c===void 0?c:sr(c,f)}catch{c=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Ke(c,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(u=>nr(u))),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Ke(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o;for(const u of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const c=await u.batch(e,i.map((d,f)=>at(s[f],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,f)=>d==null?void 0:d.handleChainEnd(Ke(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function vn(r){if(typeof r=="function")return new As({func:r});if(Xe.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=vn(n);return new Ts({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class Dy extends Xe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ts&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[a,i]=Cy(e),o=this.mapper.transform(i,at(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new ks({generator:this.transform(n(),s),config:s});return await a.setup,Dt.fromAsyncGenerator(a)}}class ak extends Xe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new ks({generator:this.transform(n(),s),config:s});return await a.setup,Dt.fromAsyncGenerator(a)}}class Ep extends kn{constructor(e){const t=Fr.from([As.from(async n=>{let s;if(iy(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new U0("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function ik(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===Sn.ZodString?new Ep({name:t,description:n,schema:Sn.object({input:Sn.string()}).transform(a=>a.input),bound:r}):new Ep({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var ok=typeof window=="object"?window:{},he="0123456789abcdef".split(""),lk=[-2147483648,8388608,32768,128],Gt=[24,16,8,0],Ge=[];function ir(r){r?(Ge[0]=Ge[16]=Ge[1]=Ge[2]=Ge[3]=Ge[4]=Ge[5]=Ge[6]=Ge[7]=Ge[8]=Ge[9]=Ge[10]=Ge[11]=Ge[12]=Ge[13]=Ge[14]=Ge[15]=0,this.blocks=Ge):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ir.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===ok.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,a=r.length||0,i=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;n<a&&s<64;++n)i[s>>2]|=r[n]<<Gt[s++&3];else for(s=this.start;n<a&&s<64;++n)t=r.charCodeAt(n),t<128?i[s>>2]|=t<<Gt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Gt[s++&3],i[s>>2]|=(128|t>>6&63)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),i[s>>2]|=(240|t>>18)<<Gt[s++&3],i[s>>2]|=(128|t>>12&63)<<Gt[s++&3],i[s>>2]|=(128|t>>6&63)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};ir.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=lk[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};ir.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&n,o=r<<5|r>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=r&e|~r&t,o=s<<5|s>>>27,n=o+a+n+1518500249+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|~s&e,o=n<<5|n>>>27,t=o+a+t+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|~n&r,o=t<<5|t>>>27,e=o+a+e+1518500249+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|~t&s,o=e<<5|e>>>27,r=o+a+r+1518500249+l[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n+1859775393+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e+1859775393+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r+1859775393+l[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+a+n-1894007588+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+a+t-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+a+e-1894007588+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+a+r-1894007588+l[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n-899497514+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e-899497514+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r-899497514+l[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};ir.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return he[r>>28&15]+he[r>>24&15]+he[r>>20&15]+he[r>>16&15]+he[r>>12&15]+he[r>>8&15]+he[r>>4&15]+he[r&15]+he[e>>28&15]+he[e>>24&15]+he[e>>20&15]+he[e>>16&15]+he[e>>12&15]+he[e>>8&15]+he[e>>4&15]+he[e&15]+he[t>>28&15]+he[t>>24&15]+he[t>>20&15]+he[t>>16&15]+he[t>>12&15]+he[t>>8&15]+he[t>>4&15]+he[t&15]+he[n>>28&15]+he[n>>24&15]+he[n>>20&15]+he[n>>16&15]+he[n>>12&15]+he[n>>8&15]+he[n>>4&15]+he[n&15]+he[s>>28&15]+he[s>>24&15]+he[s>>20&15]+he[s>>16&15]+he[s>>12&15]+he[s>>8&15]+he[s>>4&15]+he[s&15]};ir.prototype.toString=ir.prototype.hex;ir.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};ir.prototype.array=ir.prototype.digest;ir.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const uk=r=>new ir(!0).update(r).hex(),Sp=(...r)=>uk(r.join("_"));class ck{}const dk=new Map;class Ad extends ck{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Sp(e,t))??null)}async update(e,t,n){this.cache.set(Sp(e,t),n)}static global(){return new Ad(dk)}}class Uy extends In{}class fk extends Uy{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Do(this.value)]}}class hk extends Uy{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return oy(this.messages)}toChatMessages(){return this.messages}}var Ls={},Op;function pk(){if(Op)return Ls;Op=1,Ls.byteLength=o,Ls.toByteArray=u,Ls.fromByteArray=f;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=n.length;s<a;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function i(h){var p=h.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=h.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(h){var p=i(h),m=p[0],g=p[1];return(m+g)*3/4-g}function l(h,p,m){return(p+m)*3/4-m}function u(h){var p,m=i(h),g=m[0],_=m[1],v=new t(l(h,g,_)),y=0,b=_>0?g-4:g,E;for(E=0;E<b;E+=4)p=e[h.charCodeAt(E)]<<18|e[h.charCodeAt(E+1)]<<12|e[h.charCodeAt(E+2)]<<6|e[h.charCodeAt(E+3)],v[y++]=p>>16&255,v[y++]=p>>8&255,v[y++]=p&255;return _===2&&(p=e[h.charCodeAt(E)]<<2|e[h.charCodeAt(E+1)]>>4,v[y++]=p&255),_===1&&(p=e[h.charCodeAt(E)]<<10|e[h.charCodeAt(E+1)]<<4|e[h.charCodeAt(E+2)]>>2,v[y++]=p>>8&255,v[y++]=p&255),v}function c(h){return r[h>>18&63]+r[h>>12&63]+r[h>>6&63]+r[h&63]}function d(h,p,m){for(var g,_=[],v=p;v<m;v+=3)g=(h[v]<<16&16711680)+(h[v+1]<<8&65280)+(h[v+2]&255),_.push(c(g));return _.join("")}function f(h){for(var p,m=h.length,g=m%3,_=[],v=16383,y=0,b=m-g;y<b;y+=v)_.push(d(h,y,y+v>b?b:y+v));return g===1?(p=h[m-1],_.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(h[m-2]<<8)+h[m-1],_.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),_.join("")}return Ls}var mk=pk();const gk=Ha(mk);var yk=Object.defineProperty,_k=(r,e,t)=>e in r?yk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bk=(r,e,t)=>(_k(r,e+"",t),t);function wk(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const a=r.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function vk(r,e){return r.length===1?[e.get(r.join(","))]:wk(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function xk(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var bc=class{constructor(r,e){Hr(this,"specialTokens");Hr(this,"inverseSpecialTokens");Hr(this,"patStr");Hr(this,"textEncoder",new TextEncoder);Hr(this,"textDecoder",new TextDecoder("utf-8"));Hr(this,"rankMap",new Map);Hr(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((u,c)=>n[u]=l+c),n},{});for(const[n,s]of Object.entries(t)){const a=gk.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=bc.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){const u=bc.specialTokenRegex([...o]),c=r.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(r),!(u==null||i.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??r.length;for(const h of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(h[0]),m=this.rankMap.get(p.join(","));if(m!=null){a.push(m);continue}a.push(...vk(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),l=u.index+u[0].length}return a}decode(r){const e=[];let t=0;for(let a=0;a<r.length;++a){const i=r[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},By=bc;bk(By,"specialTokenRegex",r=>new RegExp(r.map(e=>xk(e)).join("|"),"g"));function Ek(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const yi={},Sk=new Od({});async function Ok(r){return r in yi||(yi[r]=Sk.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new By(e)).catch(e=>{throw delete yi[r],e})),await yi[r]}async function kk(r){return Ok(Ek(r))}const Tk=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Hy(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const Ak=()=>!1;class Pk extends Xe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Ak(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class Ik extends Pk{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...a}=n;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=Ad.global():this.cache=void 0,this.caller=new Od(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await kk("modelName"in this?Tk(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new fk(e):Array.isArray(e)?new hk(e.map(Zs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class uo extends Xe{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Te(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=Te(t);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,a)if(s===void 0)s=i;else try{s=sr(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new Dy(new Ts({steps:e}))}}function qy(r){return typeof(r==null?void 0:r.parse)=="function"}class Xr extends Ik{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=Xr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===Xr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const a=Xr._convertInputToPromptValue(e).toChatMessages(),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...i.metadata,...this.getLsParams(o)},u=await St.configure(i.callbacks,this.callbacks,i.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[a],i.runId,void 0,c,void 0,void 0,i.runName));let f,h;try{for await(const p of this._streamResponseChunks(a,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,f?f=f.concat(p):f=p,Zf(p.message)&&p.message.usage_metadata!==void 0&&(h={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[f]],llmOutput:h})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,f;const a=e.map(h=>h.map(Zs));let i;if(s!==void 0&&s.length===a.length)i=s;else{const h={...n.metadata,...this.getLsParams(t)},p=await St.configure(n.callbacks,this.callbacks,n.tags,this.tags,h,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};i=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),a,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(i!=null&&i[0].handlers.find($S))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==Xr.prototype._streamResponseChunks)try{const h=await this._streamResponseChunks(a[0],t,i==null?void 0:i[0]);let p,m;for await(const g of h){if(g.message.id==null){const _=(d=i==null?void 0:i.at(0))==null?void 0:d.runId;_!=null&&g.message._updateId(`run-${_}`)}p===void 0?p=g:p=sr(p,g),Zf(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(i==null?void 0:i[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(h){throw await(i==null?void 0:i[0].handleLLMError(h)),h}else{const h=await Promise.allSettled(a.map((p,m)=>this._generate(p,{...t,promptIndex:m},i==null?void 0:i[m])));await Promise.all(h.map(async(p,m)=>{var g,_,v;if(p.status==="fulfilled"){const y=p.value;for(const b of y.generations){if(b.message.id==null){const E=(g=i==null?void 0:i.at(0))==null?void 0:g.runId;E!=null&&b.message._updateId(`run-${E}`)}b.message.response_metadata={...b.generationInfo,...b.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[m]=y.generations,l[m]=y.llmOutput,(_=i==null?void 0:i[m])==null?void 0:_.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((v=i==null?void 0:i[m])==null?void 0:v.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const c={generations:o,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(c,gp,{value:i?{runIds:i==null?void 0:i.map(h=>h.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:a}){const i=e.map(g=>g.map(Zs)),o={...a.metadata,...this.getLsParams(s)},l=await St.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},c=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),i,a.runId,void 0,u,void 0,void 0,a.runName)),d=[],h=(await Promise.allSettled(i.map(async(g,_)=>{const v=Xr._convertInputToPromptValue(g).toString(),y=await t.lookup(v,n);return y==null&&d.push(_),y}))).map((g,_)=>({result:g,runManager:c==null?void 0:c[_]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(h.map(async({result:g,runManager:_},v)=>{if(g.status==="fulfilled"){const y=g.value;return p[v]=y.map(b=>("message"in b&&Lo(b.message)&&qa(b.message)&&(b.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),b.generationInfo={...b.generationInfo,tokenUsage:{}},b)),y.length&&await(_==null?void 0:_.handleLLMNewToken(y[0].text)),_==null?void 0:_.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,gp,{value:c?{runIds:c==null?void 0:c.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const a=e.map(p=>p.map(Zs)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(a,o,i);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:f}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:i});let h={};if(d.length>0){const p=await this._generateUncached(d.map(m=>a[m]),o,i,f!==void 0?d.map(m=>f==null?void 0:f[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const _=d[g];c[_]=m;const v=Xr._convertInputToPromptValue(a[_]).toString();return l.update(v,u,m)})),h=p.llmOutput??{}}return{generations:c,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(a=>a.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Zs)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new Do(e),a=await this.call([s],t,n);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,a=n.description??"A function available to call.",i=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;qy(n)?u=[{type:"function",function:{name:l,description:a,parameters:Ja(n)}}]:("name"in n&&(l=n.name),u=[{type:"function",function:{name:l,description:a,parameters:n}}]);const c=this.bindTools(u),d=As.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(_=>_.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});const f=uo.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),h=uo.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[h]});return Fr.from([{raw:c},p]).withConfig({runName:"StructuredOutputRunnable"})}}class Rk extends Xe{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class Zy extends Rk{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class Pd extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");ay(this,"OUTPUT_PARSING_FAILURE")}}function wc(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!wc(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!wc(r[i],e[i]))return!1;return!0}return r===e}class Ck extends Zy{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class zy extends Ck{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(M0(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Nn({message:s,text:s.content})}else if(Lo(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Nn({message:q0(s),text:s.content})}else a=new ys({text:s});n===void 0?n=a:n=n.concat(a);const i=await this.parsePartialResult([n]);i!=null&&!wc(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}}class kp extends Zy{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=Sn.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,Sn.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Ja(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new Pd(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Tp extends zy{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?OS(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Uf(e[0].text)}async parse(e){return Uf(e,JSON.parse)}getFormatInstructions(){return""}}function Id(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=pd(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new Pd([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function $k(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function Vy(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class Nk extends zy{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var i;const n=e[0].message;let s;if(qa(n)&&((i=n.tool_calls)!=null&&i.length)?s=n.tool_calls.map(o=>{const{id:l,...u}=o;return this.returnId?{id:l,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>Id(l,{returnId:this.returnId,partial:t}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};a.push(l)}return a}}class Ap extends Nk{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Pd(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}}const jk=Symbol("Let zodToJsonSchema decide on which parser to use"),Pp={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Lk=r=>typeof r=="string"?{...Pp,basePath:["#"],definitions:{},name:r}:{...Pp,basePath:["#"],definitions:{},...r},vc=r=>"_def"in r?r._def:r;function Mk(r){if(!r)return!0;for(const e in r)return!1;return!0}const Fk=r=>{const e=Lk(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[vc(s),{def:vc(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Gy(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Re(r,e,t,n,s){r[e]=t,Gy(r,e,n,s)}function Dk(){return{}}function Uk(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==k.ZodAny&&(t.items=Se(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Re(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Re(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Re(t,"minItems",r.exactLength.value,r.exactLength.message,e),Re(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Bk(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Re(t,"minimum",n.value,n.message,e):Re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Re(t,"maximum",n.value,n.message,e):Re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Re(t,"maximum",n.value,n.message,e));break;case"multipleOf":Re(t,"multipleOf",n.value,n.message,e);break}return t}function Hk(){return{type:"boolean"}}function qk(r,e){return Se(r.type._def,e)}const Zk=(r,e)=>Se(r.innerType._def,e);function Wy(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>Wy(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return zk(r,e)}}const zk=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Re(t,"minimum",n.value,n.message,e);break;case"max":Re(t,"maximum",n.value,n.message,e);break}return t};function Vk(r,e){return{...Se(r.innerType._def,e),default:r.defaultValue()}}function Gk(r,e,t){return e.effectStrategy==="input"?Se(r.schema._def,e,t):{}}function Wk(r){return{type:"string",enum:[...r.values]}}const Jk=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function Kk(r,e){const t=[Se(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Se(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(Jk(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function Xk(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Au;const gn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Au===void 0&&(Au=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Au),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Jy(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?Yk(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Wt(t,"email",s.message,e);break;case"format:idn-email":Wt(t,"idn-email",s.message,e);break;case"pattern:zod":Jt(t,gn.email,s.message,e);break}break;case"url":Wt(t,"uri",s.message,e);break;case"uuid":Wt(t,"uuid",s.message,e);break;case"regex":Jt(t,s.regex,s.message,e);break;case"cuid":Jt(t,gn.cuid,s.message,e);break;case"cuid2":Jt(t,gn.cuid2,s.message,e);break;case"startsWith":Jt(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":Jt(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Wt(t,"date-time",s.message,e);break;case"date":Wt(t,"date",s.message,e);break;case"time":Wt(t,"time",s.message,e);break;case"duration":Wt(t,"duration",s.message,e);break;case"length":Re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Jt(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Wt(t,"ipv4",s.message,e),s.version!=="v4"&&Wt(t,"ipv6",s.message,e);break}case"emoji":Jt(t,gn.emoji,s.message,e);break;case"ulid":{Jt(t,gn.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Wt(t,"binary",s.message,e);break}case"contentEncoding:base64":{Re(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Jt(t,gn.base64,s.message,e);break}}break}case"nanoid":Jt(t,gn.nanoid,s.message,e)}return t}const Yk=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Wt=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Re(r,"format",e,t,n)},Jt=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Ip(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Re(r,"pattern",Ip(e,n),t,n)},Ip=(r,e)=>{var u;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let a="",i=!1,o=!1,l=!1;for(let c=0;c<s.length;c++){if(i){a+=s[c],i=!1;continue}if(n.i){if(o){if(s[c].match(/[a-z]/)){l?(a+=s[c],a+=`${s[c-2]}-${s[c]}`.toUpperCase(),l=!1):s[c+1]==="-"&&((u=s[c+2])!=null&&u.match(/[a-z]/))?(a+=s[c],l=!0):a+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){a+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(n.m){if(s[c]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&s[c]==="."){a+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}a+=s[c],s[c]==="\\"?i=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{const c=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function Ky(r,e){var n,s,a,i;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===k.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===k.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const o=Object.entries(Jy(r.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...t,propertyNames:o}}else if(((i=r.keyType)==null?void 0:i._def.typeName)===k.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function Qk(r,e){if(e.mapStrategy==="record")return Ky(r,e);const t=Se(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function eT(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function tT(){return{not:{}}}function rT(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const co={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function nT(r,e){if(e.target==="openApi3")return Rp(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in co&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=co[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return Rp(r,e)}const Rp=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Se(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function sT(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:co[r.innerType._def.typeName],nullable:!0}:{type:[co[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Se(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Se(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function aT(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",Gy(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Re(t,"minimum",n.value,n.message,e):Re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Re(t,"maximum",n.value,n.message,e):Re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Re(t,"maximum",n.value,n.message,e));break;case"multipleOf":Re(t,"multipleOf",n.value,n.message,e);break}return t}function iT(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":Se(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":Se(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function oT(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,a])=>{if(a===void 0||a._def===void 0)return n;const i=Se(a._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return i===void 0?n:{properties:{...n.properties,[s]:i},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:iT(r,e)};return t.required.length||delete t.required,t}const lT=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Se(r.innerType._def,e);const t=Se(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},uT=(r,e)=>{if(e.pipeStrategy==="input")return Se(r.in._def,e);if(e.pipeStrategy==="output")return Se(r.out._def,e);const t=Se(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Se(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function cT(r,e){return Se(r.type._def,e)}function dT(r,e){const n={type:"array",uniqueItems:!0,items:Se(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Re(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Re(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function fT(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Se(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Se(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Se(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function hT(){return{not:{}}}function pT(){return{}}const mT=(r,e)=>Se(r.innerType._def,e);function Se(r,e,t=!1){var i;const n=e.seen.get(r);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,r,e,n,t);if(o!==jk)return o}if(n&&!t){const o=gT(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=_T(r,r.typeName,e,t);return a&&bT(r,e,a),s.jsonSchema=a,a}const gT=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:yT(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},yT=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},_T=(r,e,t,n)=>{switch(e){case k.ZodString:return Jy(r,t);case k.ZodNumber:return aT(r,t);case k.ZodObject:return oT(r,t);case k.ZodBigInt:return Bk(r,t);case k.ZodBoolean:return Hk();case k.ZodDate:return Wy(r,t);case k.ZodUndefined:return hT();case k.ZodNull:return rT(t);case k.ZodArray:return Uk(r,t);case k.ZodUnion:case k.ZodDiscriminatedUnion:return nT(r,t);case k.ZodIntersection:return Kk(r,t);case k.ZodTuple:return fT(r,t);case k.ZodRecord:return Ky(r,t);case k.ZodLiteral:return Xk(r,t);case k.ZodEnum:return Wk(r);case k.ZodNativeEnum:return eT(r);case k.ZodNullable:return sT(r,t);case k.ZodOptional:return lT(r,t);case k.ZodMap:return Qk(r,t);case k.ZodSet:return dT(r,t);case k.ZodLazy:return Se(r.getter()._def,t);case k.ZodPromise:return cT(r,t);case k.ZodNaN:case k.ZodNever:return tT();case k.ZodEffects:return Gk(r,t,n);case k.ZodAny:return Dk();case k.ZodUnknown:return pT();case k.ZodDefault:return Vk(r,t);case k.ZodBranded:return qk(r,t);case k.ZodReadonly:return mT(r,t);case k.ZodCatch:return Zk(r,t);case k.ZodPipeline:return uT(r,t);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(s=>{})()}},bT=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),wT=(r,e)=>{const t=Fk(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=Se(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(Mk(t.definitions))return;const l={},u=new Set;for(let c=0;c<500;c++){const d=Object.entries(t.definitions).filter(([f])=>!u.has(f));if(d.length===0)break;for(const[f,h]of d)l[f]=Se(vc(h),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},u.add(f)}return l})(),o=n===void 0?i?{...s,[t.definitionPath]:i}:s:t.nameStrategy==="duplicate-ref"?{...s,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Xy(r,e){return wT(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function vT(r,e,t){return s0({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Xy(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function xT(r){return a0({type:"function",function:{name:r.name,parameters:Xy(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function ET(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=r;if((n||i)&&s&&e)return`${s}/${e}`;if((n||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function ST(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:Ja(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function OT(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function kT(r){return r!==void 0&&Xe.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function TT(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&qy(r.schema)}function AT(r){return TT(r)||kT(r)||OT(r)}function _i(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Pu(r){let e;return r.constructor.name===Oo.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Mt.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=_i(r,"INVALID_TOOL_RESULTS"):r.status===401?e=_i(r,"MODEL_AUTHENTICATION"):r.status===429?e=_i(r,"MODEL_RATE_LIMIT"):r.status===404?e=_i(r,"MODEL_NOT_FOUND"):e=r,e}function Cp(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function PT(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function IT(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(Yy(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Yy(r,e){var n;const t=[];for(const[s,a]of Object.entries(r.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${fo(a,e)},`):t.push(`${s}?: ${fo(a,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function fo(r,e){if(PT(r))return r.anyOf.map(t=>fo(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Yy(r,e+2),"}"].join(`
`);case"array":return r.items?`${fo(r.items,e)}[]`:"any[]";default:return""}}function RT(r,e){let t;if(AT(r)){const n=xT({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:ST(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function CT(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Rd(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Za.isInstance(r))throw new Error("Invalid generic chat message");return CT(r)}default:throw new Error(`Unknown message type: ${e}`)}}function $p(r,e){return r.flatMap(t=>{var a;let n=Rd(t);n==="system"&&Cd(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),qa(t)&&((a=t.tool_calls)!=null&&a.length)?(s.tool_calls=t.tool_calls.map($k),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}const Qn="__openai_function_call_ids__";function Np(r,e){return r.flatMap(t=>{var s,a,i;let n=Rd(t);if(n==="system"&&Cd(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const o=t;return((s=o.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof o.content=="string")return{type:"computer_screenshot",image_url:o.content};if(Array.isArray(o.content)){const u=o.content.find(d=>d.type==="computer_screenshot");if(u)return u;const c=o.content.find(d=>d.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:o.tool_call_id}:{type:"function_call_output",call_id:o.tool_call_id,id:o.id,output:typeof o.content!="string"?JSON.stringify(o.content):o.content}}if(n==="assistant"){const o=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&o.push(t.additional_kwargs.reasoning);let{content:l}=t;t.additional_kwargs.refusal!=null&&(typeof l=="string"&&(l=[{type:"output_text",text:l,annotations:[]}]),l=[...l,{type:"refusal",refusal:t.additional_kwargs.refusal}]),o.push({type:"message",role:"assistant",content:typeof l=="string"?l:l.flatMap(d=>d.type==="text"?{type:"output_text",text:d.text,annotations:d.annotations??[]}:d.type==="output_text"||d.type==="refusal"?d:[])});const u=t.additional_kwargs[Qn];qa(t)&&((a=t.tool_calls)!=null&&a.length)?o.push(...t.tool_calls.map(d=>({type:"function_call",name:d.name,arguments:JSON.stringify(d.args),call_id:d.id,id:u==null?void 0:u[d.id]}))):t.additional_kwargs.tool_calls!=null&&o.push(...t.additional_kwargs.tool_calls.map(d=>({type:"function_call",name:d.function.name,call_id:d.id,id:u==null?void 0:u[d.id],arguments:d.function.arguments})));const c=(i=t.response_metadata.output)!=null&&i.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(c!=null){const d=c,f=d==null?void 0:d.filter(p=>p.type==="reasoning"),h=d==null?void 0:d.filter(p=>p.type==="computer_call");f.length>0&&h.length>0&&o.push(...f),h.length>0&&o.push(...h)}return o}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(o=>{if(o.type==="text")return{type:"input_text",text:o.text};if(o.type==="image_url"){const l=typeof o.image_url=="string"?o.image_url:o.image_url.url,u=typeof o.image_url=="string"?"auto":o.image_url.detail;return{type:"input_image",image_url:l,detail:u}}return o.type==="input_text"||o.type==="input_image"||o.type==="input_file"?o:[]})}:[]})}function Qy(r){if(r.error){const i=new Error(r.error.message);throw i.name=r.error.code,i}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},a={};for(const i of r.output)if(i.type==="message")e.push(...i.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(a.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(a.refusal=o.refusal,[]):o));else if(i.type==="function_call"){const o={function:{name:i.name,arguments:i.arguments},id:i.call_id};try{t.push(Id(o,{returnId:!0}))}catch(l){let u;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(u=l.message),n.push(Vy(o,u))}a[Qn]??(a[Qn]={}),a[Qn][i.call_id]=i.id}else i.type==="reasoning"?a.reasoning=i:(a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(i));return new ma({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:a,response_metadata:s})}function $T(r){var l,u;const e=[];let t={},n;const s=[],a={},i={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),i[Qn]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))i.tool_outputs=[r.item];else if(r.type==="response.created")a.id=r.response.id,a.model_name=r.response.model,a.model=r.response.model;else if(r.type==="response.completed"){const c=Qy(r.response);n=r.response.usage,((u=(l=r.response.text)==null?void 0:l.format)==null?void 0:u.type)==="json_schema"&&(i.parsed??(i.parsed=JSON.parse(c.text)));for(const[d,f]of Object.entries(r.response))d!=="id"&&(a[d]=f)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")i.refusal=r.refusal;else return null;return new Nn({text:e.map(c=>c.text).join(""),message:new rn({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:i,response_metadata:a}),generationInfo:t})}function Iu(r){return"type"in r&&r.type!=="function"}function NT(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function jp(r,e){return Hy(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:RT(r,e)}function Cd(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class jT extends Xr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??xr("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??xr("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Iu(s)?s:jp(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&bi(e.json_schema.schema)?vT(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const u={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Iu(d)?d:Hy(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:NT(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=Cp(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},c=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return c!==void 0&&(u.reasoning={effort:c}),u}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(u=>jp(u,{strict:n})):void 0,tool_choice:Cp(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction);const i=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(a.reasoning_effort=i),Cd(a.model)?a.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:a.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,a}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const l of n??[])try{s.push(Id(l,{returnId:!0}))}catch(u){a.push(Vy(l,u.message))}const i={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(i.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new ma({content:e.content||"",tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:t.id})}default:return new Za(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,u;const s=e.role??n,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Uo({content:a,response_metadata:o});if(s==="assistant"){const c=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)c.push({name:(l=d.function)==null?void 0:l.name,args:(u=d.function)==null?void 0:u.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new rn({content:a,tool_call_chunks:c,additional_kwargs:i,id:t.id,response_metadata:o})}else return s==="system"?new ga({content:a,response_metadata:o}):s==="developer"?new ga({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Fo({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new md({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new Mo({content:a,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var u,c,d,f,h,p,m,g,_,v;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:Np(e,this.model),stream:!0},t);for await(const b of y){const E=$T(b);E!=null&&(yield E)}return}const s=$p(e,this.model),a={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,t);let l;for await(const y of o){const b=(u=y==null?void 0:y.choices)==null?void 0:u[0];if(y.usage&&(l=y.usage),!b)continue;const{delta:E}=b;if(!E)continue;const S=this._convertOpenAIDeltaToBaseMessageChunk(E,y,i);i=E.role??i;const O={prompt:t.promptIndex??0,completion:b.index??0};if(typeof S.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const A={...O};b.finish_reason!=null&&(A.finish_reason=b.finish_reason,A.system_fingerprint=y.system_fingerprint,A.model_name=y.model),this.logprobs&&(A.logprobs=b.logprobs);const se=new Nn({message:S,text:S.content,generationInfo:A});yield se,await(n==null?void 0:n.handleLLMNewToken(se.text??"",O,void 0,void 0,void 0,{chunk:se}))}if(l){const y={...((c=l.prompt_tokens_details)==null?void 0:c.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((f=l.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(h=l.prompt_tokens_details)==null?void 0:h.cached_tokens}},b={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(_=l.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new Nn({message:new rn({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(b).length>0&&{output_token_details:b}}}),text:""})}if((v=t.signal)!=null&&v.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let u;for await(const c of l)c.message.response_metadata={...c.generationInfo,...c.message.response_metadata},u=(u==null?void 0:u.concat(c))??c;return{generations:u?[u]:[],llmOutput:{estimatedTokenUsage:(o=u==null?void 0:u.message)==null?void 0:o.usage_metadata}}}const a=Np(e,this.model),i=await this.responseApiWithRetry({input:a,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:i.output_text,message:Qy(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(Iu),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},a=this.invocationParams(t),i=$p(e,this.model);if(a.stream){const u=this._streamResponseChunks(e,t,n),c={};for await(const g of u){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const _=((o=g.generationInfo)==null?void 0:o.completion)??0;c[_]===void 0?c[_]=g:c[_]=c[_].concat(g)}const d=Object.entries(c).sort(([g],[_])=>parseInt(g,10)-parseInt(_,10)).map(([g,_])=>_),{functions:f,function_call:h}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,f,h),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let u;t.response_format&&t.response_format.type==="json_schema"?u=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):u=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:c,prompt_tokens:d,total_tokens:f,prompt_tokens_details:h,completion_tokens_details:p}=(u==null?void 0:u.usage)??{};c&&(s.output_tokens=(s.output_tokens??0)+c),d&&(s.input_tokens=(s.input_tokens??0)+d),f&&(s.total_tokens=(s.total_tokens??0)+f),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.cached_tokens)!==null)&&(s.input_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.cached_tokens)!==null&&{cache_read:h==null?void 0:h.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(u==null?void 0:u.choices)??[]){const v={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},u)};v.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},qa(v.message)&&(v.message.usage_metadata=s),v.message=new ma(Object.fromEntries(Object.entries(v.message).filter(([y])=>!y.startsWith("lc_")))),m.push(v)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const a=IT(t);s+=await this.getNumTokens(a),s+=9}return t&&e.find(a=>a._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const a=await Promise.all(e.map(async i=>{var f,h,p,m,g,_;const o=await this.getNumTokens(i.content),l=await this.getNumTokens(Rd(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0;let c=o+n+l+u;const d=i;if(d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(c+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(v){console.error("Error parsing function arguments",v,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Pu(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,a;const n=this._getClientOptions(t);try{return((a=(s=e.text)==null?void 0:s.format)==null?void 0:a.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(i){throw Pu(i)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Pu(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=ET(n),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new ge(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,a,i;LT(e)?(n=e.schema,s=e.name,a=e.method,i=e.includeRaw):(n=e,s=t==null?void 0:t.name,a=t==null?void 0:t.method,i=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),bi(n)?l=kp.fromZodSchema(n):l=new Tp;else if(a==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),bi(n)){const f=kp.fromZodSchema(n);l=As.from(h=>"parsed"in h.additional_kwargs?h.additional_kwargs.parsed:f)}else l=new Tp;else{let f=s??"extract";if(bi(n)){const h=Ja(n);o=this.bind({tools:[{type:"function",function:{name:f,description:h.description,parameters:h}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Ap({returnSingle:!0,keyName:f,zodSchema:n})}else{let h;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(h=n,f=n.name):(f=n.title??f,h={name:f,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:h}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new Ap({returnSingle:!0,keyName:f})}}if(!i)return o.pipe(l);const u=uo.assign({parsed:(f,h)=>l.invoke(f.raw,h)}),c=uo.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return Fr.from([{raw:o},d])}}function bi(r){return typeof(r==null?void 0:r.parse)=="function"}function LT(r){return r!==void 0&&typeof r.schema=="object"}const wi={openai:{modelName:"gpt-4",temperature:.3,get apiKey(){return localStorage.getItem("openai_api_key")||""}}};class MT{constructor(){if(!wi.openai.apiKey)throw new Error("OpenAI API key is not configured. Please enter your API key in the settings.");this.model=new jT({modelName:wi.openai.modelName,temperature:wi.openai.temperature,openAIApiKey:wi.openai.apiKey})}async process(e,t){try{const n=await this.model.invoke([{role:"system",content:t},{role:"user",content:e}]);if(!n.content)throw new Error("No response received from the language model");return n.content}catch(n){throw n.message.includes("API key")?new Error("Invalid API key. Please check your configuration."):n.message.includes("429")?new Error("Rate limit exceeded. Please try again in a moment."):n.message.includes("500")?new Error("OpenAI service is currently experiencing issues. Please try again later."):new Error(n.message||"Failed to process text. Please try again.")}}}async function FT(r,e={onlyGrammar:!1,customInstructions:"",writingStyle:"preserve",englishRegion:"default"}){const t=new MT,n={onlyGrammar:e.onlyGrammar??!1,customInstructions:e.customInstructions??"",writingStyle:e.writingStyle??"preserve",englishRegion:e.englishRegion??"default"},s={preserve:`
      - Maintain the original writing style, voice, and tone
      - Only fix errors while preserving the author's unique expression
      - Keep the same level of formality and complexity
    `,business:`
      - Use clear, concise, and professional language
      - Maintain a confident and direct tone
      - Focus on clarity and actionable information
      - Use business-appropriate terminology
      - Keep sentences brief and well-structured
      - Emphasize professionalism and efficiency
    `,technical:`
      - Use precise and specific terminology
      - Maintain a clear and methodical structure
      - Focus on accuracy and detail
      - Use technical terms appropriately
      - Ensure explanations are thorough and exact
      - Present information in a logical sequence
    `,casual:`
      - Use friendly and conversational language
      - Include natural expressions and colloquialisms
      - Keep sentences relatively simple and easy to read
      - Maintain an engaging and personal tone
      - Use contractions and informal phrases when appropriate
      - Write as if speaking to a friend
    `,marketing:`
      - Use engaging and benefit-focused language
      - Create emotional connections with readers
      - Include persuasive calls to action
      - Highlight unique value propositions
      - Use power words and emotional triggers
      - Maintain brand voice consistency
    `,simple:`
      - Use clear, straightforward language
      - Keep sentences short and direct
      - Avoid jargon and complex terminology
      - Explain concepts in simple terms
      - Use active voice consistently
      - Focus on readability for general audiences
    `},a={default:"",us:`
      - Use American English spelling (e.g., "color" instead of "colour")
      - Prefer American English vocabulary and expressions
      - Follow American English punctuation and grammar conventions
    `,uk:`
      - Use British English spelling (e.g., "colour" instead of "color")
      - Prefer British English vocabulary and expressions
      - Follow British English punctuation and grammar conventions
    `,au:`
      - Use Australian English spelling (mostly following British conventions with some exceptions)
      - Incorporate Australian English vocabulary and expressions where appropriate
      - Follow Australian English punctuation and grammar conventions
    `,ca:`
      - Use Canadian English spelling (a mix of British and American conventions, e.g., "colour" but "analyze")
      - Prefer Canadian English vocabulary and expressions
      - Follow Canadian English punctuation and grammar conventions
    `};let i=`You are an expert English language editor with native-level mastery.
    Your task is to ${n.onlyGrammar?"fix grammar and spelling errors only":"improve the provided text"} while:

    ${n.onlyGrammar?`
    1. Fixing grammar and spelling errors
    2. Making minimal changes to preserve the original writing style
    3. Not changing word choice or phrasing unless necessary for grammar
    `:`
    Writing Style Instructions:
    ${s[n.writingStyle]}
    
    ${n.englishRegion!=="default"?`English Region Instructions:
    ${a[n.englishRegion]}`:""}
    
    General Improvements:
    1. Enhancing clarity and flow while maintaining the intended meaning
    2. Using appropriate expressions based on the selected style
    3. Improving sentence structure for better readability
    4. Maintaining an appropriate tone for the selected style
    5. Fixing any grammar or spelling errors
    `}

    Foreign Language Handling:
    - Identify any non-English words, phrases, or sentences in the text
    - Translate them to natural, contextually appropriate English
    - Ensure the translations flow naturally with the rest of the text

    ${n.customInstructions?`
    Additional custom instructions:
    ${n.customInstructions}
    `:""}

    IMPORTANT FORMATTING RULES:
    - Preserve all line breaks exactly as they appear in the original text
    - Maintain paragraph structure and spacing
    - Keep any special formatting like bullet points, numbering, or indentation
    - Respect the original text's list formats and structural elements
    - If text has multiple paragraphs, maintain the same paragraph breaks
    
    The goal is to ${n.onlyGrammar?"fix grammar while preserving the original writing as much as possible":`improve the text according to the ${n.writingStyle==="preserve"?"original":n.writingStyle} style guidelines`}${n.englishRegion!=="default"?` using ${n.englishRegion.toUpperCase()} English conventions`:""} while keeping the exact same formatting.
    Return only the ${n.onlyGrammar?"corrected":"improved"} text without any explanations or comments.`;return await t.process(r,i)}const DT={name:"Improve Writing",processor:FT,description:"Enhances text to sound more natural and native-like while maintaining meaning"},UT={class:"text-editor relative w-full h-full flex flex-col flex-1"},BT={key:0,class:"flex flex-col gap-2"},HT={class:"text-xs text-gray-500 dark:text-gray-400"},qT={class:"flex gap-2"},ZT=["disabled"],zT={key:0},VT={key:1},GT=["disabled"],WT={key:0},JT={key:1},KT={key:1,class:"flex flex-col gap-2"},XT={key:0,class:"w-full"},YT={class:"mb-3 text-sm text-red-600 dark:text-red-300"},QT={key:1,class:"w-full"},eA={class:"mb-2 flex items-center justify-between"},tA={class:"flex items-center cursor-pointer"},rA={class:"max-h-48 overflow-y-auto rounded border border-gray-100 p-2 text-sm dark:border-gray-700"},nA=["innerHTML"],sA={key:1,class:"whitespace-pre-wrap"},Ru=768,aA={__name:"TextEditor",props:{text:{type:String,default:""},writingStyle:{type:String,default:"preserve"},englishRegion:{type:String,default:"default"},customInstructions:{type:String,default:""},fontFamily:{type:String,default:"serif"},fontSize:{type:String,default:"medium"},lineHeight:{type:String,default:"normal"}},emits:["update:text","error"],setup(r,{emit:e}){const t=r,n=e,s=_e(t.text),a=_e(null),i=_e(!1),o=_e(""),l=_e(!1),u=_e({top:0,left:0}),c=_e(!1),d=_e(""),f=_e(!1),h=_e(""),p=_e(null),m=_e(null),g=_e(!1),_=_e(!1);Be(()=>t.text,z=>{s.value=z});const v=z=>{n("update:text",z.target.value)},y=()=>{var K;if(l.value&&f.value){if(p.value&&a.value)try{a.value.setSelectionRange(p.value.start,p.value.end)}catch{}return}if(!a.value||document.activeElement!==a.value)return;const z=window.getSelection();z&&z.toString().trim()&&z.rangeCount?(o.value=z.toString().trim(),a.value&&(p.value={start:a.value.selectionStart,end:a.value.selectionEnd})):!f.value&&!((K=document.activeElement)!=null&&K.closest(".floating-menu"))&&(l.value=!1)},b=z=>{l.value&&f.value||setTimeout(()=>{if(a.value){const K=a.value.selectionStart,Ee=a.value.selectionEnd;if(K!==Ee){const F=a.value.value.substring(K,Ee).trim();F&&F.length>0&&(o.value=F,p.value={start:K,end:Ee},u.value={top:z.clientY+window.scrollY,left:z.clientX+window.scrollX},l.value=!0)}else!f.value&&!g.value&&O()}},10)},E=async()=>{if(o.value){c.value=!0,f.value=!1,h.value="";try{d.value=await DT.processor(o.value,{writingStyle:t.writingStyle,englishRegion:t.englishRegion,customInstructions:t.customInstructions}),f.value=!0}catch(z){let K=z.message||"An unknown error occurred";K.includes("API key")?K="API key is missing or invalid. Please check your settings.":K.includes("429")?K="Too many requests. Please try again later.":K.includes("Network")?K="Network error. Please check your internet connection.":K.includes("timeout")&&(K="Request timed out. Please try again."),h.value=K,f.value=!0,n("error",K)}finally{c.value=!1}}},S=()=>{if(!a.value||!d.value)return;const z=a.value.value;let K=a.value.selectionStart,Ee=a.value.selectionEnd;K===Ee&&p.value&&(K=p.value.start,Ee=p.value.end);const F=z.substring(0,K)+d.value+z.substring(Ee);s.value=F,n("update:text",F),O()},O=()=>{g.value=!1,l.value=!1,f.value=!1,d.value="",o.value="",i.value=!1,p.value=null,_.value=!1},A=z=>{!z.target.closest(".floating-menu")&&!z.target.closest("textarea")&&l.value&&!f.value&&!g.value&&O()},se=fa(()=>{if(!o.value||!d.value)return"";const z="___NEWLINE___",K=o.value.replace(/\n/g,z),Ee=d.value.replace(/\n/g,z),F=new RegExp(`(\\s+|[.,!?;:'"()\\[\\]{}]|${z})`,"g"),I=K.split(F).filter(X=>X!==""),U=Ee.split(F).filter(X=>X!=="");let R="",C=0,D=0;for(;C<I.length||D<U.length;)if(C<I.length&&D<U.length&&I[C]===U[D]){const X=I[C];X===z?R+=`
`:R+=oe(X),C++,D++}else{let ae=!1;for(let q=1;!ae&&q<=3&&C+q<I.length;q++)if(I[C+q]===U[D]){for(let ue=0;ue<q;ue++){const Ne=I[C+ue];Ne===z?R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through"></span>
`:R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through">${oe(Ne)}</span>`}C+=q,ae=!0}if(!ae){for(let q=1;!ae&&q<=3&&D+q<U.length;q++)if(U[D+q]===I[C]){for(let ue=0;ue<q;ue++){const Ne=U[D+ue];Ne===z?R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300"></span>
`:R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300">${oe(Ne)}</span>`}D+=q,ae=!0}}if(!ae){if(C<I.length&&D<U.length){const q=I[C],ue=U[D];q===z?R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through"></span>
`:R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through">${oe(q)}</span>`,ue===z?R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300"></span>
`:R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300">${oe(ue)}</span>`,C++,D++}else if(C<I.length){const q=I[C];q===z?R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through"></span>
`:R+=`<span class="bg-red-100 dark:bg-red-900 dark:text-red-300 line-through">${oe(q)}</span>`,C++}else if(D<U.length){const q=U[D];q===z?R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300"></span>
`:R+=`<span class="bg-green-100 dark:bg-green-900 dark:text-green-300">${oe(q)}</span>`,D++}}}return R});function oe(z){return z.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}return bo(()=>{a.value&&(m.value=yv(y,200),document.addEventListener("selectionchange",m.value),document.addEventListener("click",A))}),Mc(()=>{m.value&&(typeof m.value.cancel=="function"&&m.value.cancel(),document.removeEventListener("selectionchange",m.value)),document.removeEventListener("click",A)}),(z,K)=>(me(),be("div",UT,[mr($("textarea",{ref_key:"textareaElement",ref:a,"onUpdate:modelValue":K[0]||(K[0]=Ee=>s.value=Ee),onInput:v,onMouseup:b,placeholder:"Start writing...",class:Na(["w-full h-full resize-none bg-transparent px-4 py-4 text-gray-800 focus:outline-none dark:text-gray-200 mx-auto",{"select-none pointer-events-none":l.value&&f.value},{"font-serif":r.fontFamily==="serif"},{"font-sans":r.fontFamily==="sans"},{"font-mono":r.fontFamily==="mono"},{"text-sm":r.fontSize==="small"},{"text-lg":r.fontSize==="medium"},{"text-xl":r.fontSize==="large"},{"leading-tight":r.lineHeight==="dense"},{"leading-normal":r.lineHeight==="normal"},{"leading-relaxed":r.lineHeight==="relaxed"}]),style:ia({paddingLeft:`max(1rem, calc(50% - ${Ru/2}px))`,paddingRight:`max(1rem, calc(50% - ${Ru/2}px))`}),rows:"1"},null,38),[[Hi,s.value]]),l.value?(me(),be("div",{key:0,class:"floating-menu fixed z-50 rounded-lg border border-gray-200 bg-white p-3 shadow-lg dark:border-gray-700 dark:bg-gray-800",style:ia({top:u.value.top+20+"px",left:"50%",transform:"translateX(-50%)",maxWidth:f.value?`${Math.min(600,Ru-40)}px`:"300px",width:f.value?"calc(100% - 40px)":"auto"}),onMouseenter:K[2]||(K[2]=Ee=>g.value=!0),onMouseleave:K[3]||(K[3]=Ee=>g.value=!1)},[K[7]||(K[7]=$("div",{class:"absolute -top-[9px] left-1/2 -translate-x-1/2"},[$("div",{class:"absolute top-0 left-0 h-0 w-0 border-x-[9px] border-b-[9px] border-x-transparent border-b-gray-200 dark:border-b-gray-700"}),$("div",{class:"absolute top-[1px] left-[1px] h-0 w-0 border-x-[8px] border-b-[8px] border-x-transparent border-b-white dark:border-b-gray-800"})],-1)),f.value?(me(),be("div",KT,[h.value?(me(),be("div",XT,[K[4]||(K[4]=$("div",{class:"mb-2 text-xs text-red-500 dark:text-red-400"},"Error:",-1)),$("div",YT,Je(h.value),1),$("div",{class:"mt-3 flex justify-end gap-2"},[$("button",{onClick:O,class:"rounded bg-gray-100 px-3 py-1.5 text-xs font-medium text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}," Dismiss "),$("button",{onClick:E,class:"rounded bg-blue-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"}," Retry ")])])):(me(),be("div",QT,[$("div",eA,[K[6]||(K[6]=$("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"Result:",-1)),$("label",tA,[mr($("input",{type:"checkbox","onUpdate:modelValue":K[1]||(K[1]=Ee=>_.value=Ee),class:"h-3.5 w-3.5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"},null,512),[[Dm,_.value]]),K[5]||(K[5]=$("span",{class:"ml-1.5 text-xs text-gray-600 dark:text-gray-400"},"Show diff",-1))])]),$("div",rA,[_.value?(me(),be("div",{key:0,innerHTML:se.value,class:"whitespace-pre-wrap"},null,8,nA)):(me(),be("div",sA,Je(d.value),1))]),$("div",{class:"mt-3 flex justify-end gap-2"},[$("button",{onClick:O,class:"rounded bg-gray-100 px-3 py-1.5 text-xs font-medium text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}," Dismiss "),$("button",{onClick:S,class:"rounded bg-blue-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"}," Apply ")])]))])):(me(),be("div",BT,[$("div",HT,Je(o.value.length)+" characters selected ",1),$("div",qT,[$("button",{onClick:E,disabled:c.value,class:"rounded bg-gray-100 px-3 py-1.5 text-sm font-medium text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"},[c.value?(me(),be("span",zT,"Processing...")):(me(),be("span",VT,"Fix Grammar"))],8,ZT),$("button",{onClick:E,disabled:c.value,class:"rounded bg-blue-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700"},[c.value?(me(),be("span",WT,"Processing...")):(me(),be("span",JT,"Improve Writing"))],8,GT)])]))],36)):Dc("",!0)]))}},iA={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},oA={class:"flex items-center justify-center min-h-screen"},lA={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 relative z-10 transition-all"},uA={class:"p-3"},cA={class:"mb-4"},dA={class:"relative"},fA=["type"],hA={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},pA={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},mA={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},gA={class:"mb-4"},yA={class:"mb-4"},_A={class:"mb-3"},bA=["value"],wA={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},vA={class:"mb-3"},xA=["value"],EA={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},SA={class:"mb-4"},OA={class:"mb-3"},kA=["value"],TA={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},AA={class:"mb-3"},PA=["value"],IA={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},RA={class:"mb-3"},CA=["value"],$A={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},NA={__name:"SettingsModal",props:{show:{type:Boolean,default:!1},initialApiKey:{type:String,default:""},writingStyle:{type:String,default:"preserve"},englishRegion:{type:String,default:"default"},customInstructions:{type:String,default:""},fontFamily:{type:String,default:"serif"},fontSize:{type:String,default:"medium"},lineHeight:{type:String,default:"normal"},writingStyles:{type:Array,default:()=>[{id:"preserve",label:"Preserve Original Style",description:"Maintain the original writing style while fixing errors"},{id:"business",label:"Business",description:"Professional and clear tone for business communication"},{id:"technical",label:"Technical",description:"Precise and detailed tone for technical documentation"},{id:"casual",label:"Casual",description:"Friendly and conversational tone"},{id:"marketing",label:"Marketing",description:"Engaging and persuasive tone for promotional content"},{id:"simple",label:"Simple",description:"Clear and easy-to-understand language for general audiences"}]},englishRegions:{type:Array,default:()=>[{id:"default",label:"Default",description:"Default English without specific regional preferences"},{id:"us",label:"US English",description:"American English spelling and expressions"},{id:"uk",label:"UK English",description:"British English spelling and expressions"},{id:"au",label:"Australian English",description:"Australian English spelling and expressions"},{id:"ca",label:"Canadian English",description:"Canadian English spelling and expressions"}]},fontFamilies:{type:Array,default:()=>[{id:"serif",label:"Serif",description:"Traditional serif font for easier reading of long texts"},{id:"sans",label:"Sans-serif",description:"Clean sans-serif font for modern look"},{id:"mono",label:"Monospace",description:"Fixed-width font, good for code and technical content"}]},fontSizes:{type:Array,default:()=>[{id:"small",label:"Small",description:"Smaller text size for compact viewing"},{id:"medium",label:"Medium",description:"Standard comfortable reading size"},{id:"large",label:"Large",description:"Larger text size for improved readability"}]},lineHeights:{type:Array,default:()=>[{id:"dense",label:"Dense",description:"Compact line spacing"},{id:"normal",label:"Normal",description:"Standard line spacing for comfortable reading"},{id:"relaxed",label:"Relaxed",description:"More spacious line spacing for easier reading"}]}},emits:["update:api-key","update:writing-style","update:english-region","update:custom-instructions","update:font-family","update:font-size","update:line-height","close"],setup(r,{emit:e}){const t=r,n=e,s=_e(!1),a=_e(t.initialApiKey),i=_e(t.writingStyle),o=_e(t.englishRegion),l=_e(t.customInstructions),u=_e(t.fontFamily),c=_e(t.fontSize),d=_e(t.lineHeight);Be(()=>t.initialApiKey,y=>{a.value=y}),Be(()=>t.writingStyle,y=>{i.value=y}),Be(()=>t.englishRegion,y=>{o.value=y}),Be(()=>t.customInstructions,y=>{l.value=y}),Be(()=>t.fontFamily,y=>{u.value=y}),Be(()=>t.fontSize,y=>{c.value=y}),Be(()=>t.lineHeight,y=>{d.value=y});function f(){n("close")}function h(){n("update:api-key",a.value),n("update:writing-style",i.value),n("update:english-region",o.value),n("update:custom-instructions",l.value),n("update:font-family",u.value),n("update:font-size",c.value),n("update:line-height",d.value),f()}function p(){const y=t.writingStyles.find(b=>b.id===i.value);return y?y.description:""}function m(){const y=t.englishRegions.find(b=>b.id===o.value);return y?y.description:""}function g(){const y=t.fontFamilies.find(b=>b.id===u.value);return y?y.description:""}function _(){const y=t.fontSizes.find(b=>b.id===c.value);return y?y.description:""}function v(){const y=t.lineHeights.find(b=>b.id===d.value);return y?y.description:""}return bo(()=>{t.show&&(document.body.style.overflow="hidden")}),Be(()=>t.show,y=>{y?document.body.style.overflow="hidden":document.body.style.overflow=""}),(y,b)=>r.show?(me(),be("div",iA,[$("div",oA,[$("div",{class:"fixed inset-0 bg-black/50 transition-opacity backdrop-overlay",onClick:f}),$("div",lA,[$("div",{class:"flex justify-between items-center p-3 border-b border-gray-200 dark:border-gray-700"},[b[9]||(b[9]=$("h2",{class:"text-base font-medium text-gray-900 dark:text-white"},"Settings",-1)),$("button",{onClick:f,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},b[8]||(b[8]=[$("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[$("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),$("div",uA,[$("div",cA,[b[10]||(b[10]=$("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-1"},"OpenAI API Key",-1)),b[11]||(b[11]=$("p",{class:"text-xs text-gray-600 dark:text-gray-400 mb-2"},[Bu(" Enter your OpenAI API key to use the text processing features. "),$("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",class:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300"}," Get an API key here "),Bu(". Your key is stored securely in your browser and is never shared with anyone. ")],-1)),$("div",dA,[mr($("input",{type:s.value?"text":"password","onUpdate:modelValue":b[0]||(b[0]=E=>a.value=E),placeholder:"sk-...",class:"w-full p-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"},null,8,fA),[[_w,a.value]]),$("button",{onClick:b[1]||(b[1]=E=>s.value=!s.value),type:"button",class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},[(me(),be("svg",hA,[s.value?(me(),be("path",pA)):(me(),be("path",mA))]))])])]),$("div",gA,[b[12]||(b[12]=$("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-1"},"Custom Instructions",-1)),b[13]||(b[13]=$("p",{class:"text-xs text-gray-600 dark:text-gray-400 mb-2"}," Add specific instructions for improving your text. ",-1)),mr($("textarea",{"onUpdate:modelValue":b[2]||(b[2]=E=>l.value=E),placeholder:"E.g., Make my text more concise, avoid passive voice, etc.",class:"w-full p-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-vertical min-h-[60px]"},null,512),[[Hi,l.value]])]),$("div",yA,[b[16]||(b[16]=$("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"},"Writing Style Settings",-1)),$("div",_A,[b[14]||(b[14]=$("label",{class:"text-xs font-medium text-gray-900 dark:text-white block mb-1",for:"modal-writing-style"}," Default Writing Style ",-1)),mr($("select",{id:"modal-writing-style","onUpdate:modelValue":b[3]||(b[3]=E=>i.value=E),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 pr-8 text-xs bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white"},[(me(!0),be(ft,null,zn(r.writingStyles,E=>(me(),be("option",{key:E.id,value:E.id},Je(E.label),9,bA))),128))],512),[[_n,i.value]]),$("p",wA,Je(p()),1)]),$("div",vA,[b[15]||(b[15]=$("label",{class:"text-xs font-medium text-gray-900 dark:text-white block mb-1",for:"modal-english-region"}," English Region ",-1)),mr($("select",{id:"modal-english-region","onUpdate:modelValue":b[4]||(b[4]=E=>o.value=E),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 pr-8 text-xs bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white"},[(me(!0),be(ft,null,zn(r.englishRegions,E=>(me(),be("option",{key:E.id,value:E.id},Je(E.label),9,xA))),128))],512),[[_n,o.value]]),$("p",EA,Je(m()),1)])]),$("div",SA,[b[20]||(b[20]=$("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"},"Font Settings",-1)),$("div",OA,[b[17]||(b[17]=$("label",{class:"text-xs font-medium text-gray-900 dark:text-white block mb-1",for:"modal-font-family"}," Font Family ",-1)),mr($("select",{id:"modal-font-family","onUpdate:modelValue":b[5]||(b[5]=E=>u.value=E),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 pr-8 text-xs bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white"},[(me(!0),be(ft,null,zn(r.fontFamilies,E=>(me(),be("option",{key:E.id,value:E.id},Je(E.label),9,kA))),128))],512),[[_n,u.value]]),$("p",TA,Je(g()),1)]),$("div",AA,[b[18]||(b[18]=$("label",{class:"text-xs font-medium text-gray-900 dark:text-white block mb-1",for:"modal-font-size"}," Font Size ",-1)),mr($("select",{id:"modal-font-size","onUpdate:modelValue":b[6]||(b[6]=E=>c.value=E),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 pr-8 text-xs bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white"},[(me(!0),be(ft,null,zn(r.fontSizes,E=>(me(),be("option",{key:E.id,value:E.id},Je(E.label),9,PA))),128))],512),[[_n,c.value]]),$("p",IA,Je(_()),1)]),$("div",RA,[b[19]||(b[19]=$("label",{class:"text-xs font-medium text-gray-900 dark:text-white block mb-1",for:"modal-line-height"}," Line Height ",-1)),mr($("select",{id:"modal-line-height","onUpdate:modelValue":b[7]||(b[7]=E=>d.value=E),class:"w-full rounded-md border border-gray-300 px-2 py-1.5 pr-8 text-xs bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white"},[(me(!0),be(ft,null,zn(r.lineHeights,E=>(me(),be("option",{key:E.id,value:E.id},Je(E.label),9,CA))),128))],512),[[_n,d.value]]),$("p",$A,Je(v()),1)])])]),$("div",{class:"flex justify-end p-3 border-t border-gray-200 dark:border-gray-700 gap-2"},[$("button",{onClick:f,class:"px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors"}," Cancel "),$("button",{onClick:h,class:"px-3 py-1.5 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"}," Save ")])])])])):Dc("",!0)}},jA={class:"h-screen min-h-screen bg-white dark:bg-gray-800 flex flex-col text-gray-900 dark:text-white overflow-hidden"},LA={class:"flex-1 flex flex-col overflow-hidden"},MA={class:"py-1 px-2 text-right flex justify-between items-center"},FA={class:"text-xs text-gray-400 dark:text-gray-600"},DA={key:0,class:"fixed bottom-4 right-4 bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-100 p-3 sm:p-4 rounded max-w-[90%] sm:max-w-md z-50 text-sm",role:"alert"},UA={class:"flex justify-between items-start"},BA={__name:"App",setup(r){const e={INPUT:"writer-input-text",ONLY_GRAMMAR:"writer-only-grammar",WRITING_STYLE:"writer-style",ENGLISH_REGION:"writer-english-region",CUSTOM_INSTRUCTIONS:"writer-custom-instructions",API_KEY:"openai_api_key",FONT_FAMILY:"writer-font-family",FONT_SIZE:"writer-font-size",LINE_HEIGHT:"writer-line-height"},t=[{id:"preserve",label:"Preserve Original Style",description:"Maintain the original writing style while fixing errors"},{id:"business",label:"Business",description:"Professional and clear tone for business communication"},{id:"technical",label:"Technical",description:"Precise and detailed tone for technical documentation"},{id:"casual",label:"Casual",description:"Friendly and conversational tone"},{id:"marketing",label:"Marketing",description:"Engaging and persuasive tone for promotional content"},{id:"simple",label:"Simple",description:"Clear and easy-to-understand language for general audiences"}],n=[{id:"default",label:"Default",description:"Default English without specific regional preferences"},{id:"us",label:"US English",description:"American English spelling and expressions"},{id:"uk",label:"UK English",description:"British English spelling and expressions"},{id:"au",label:"Australian English",description:"Australian English spelling and expressions"},{id:"ca",label:"Canadian English",description:"Canadian English spelling and expressions"}],s=[{id:"serif",label:"Serif",description:"Traditional serif font for easier reading of long texts"},{id:"sans",label:"Sans-serif",description:"Clean sans-serif font for modern look"},{id:"mono",label:"Monospace",description:"Fixed-width font, good for code and technical content"}],a=[{id:"small",label:"Small",description:"Smaller text size for compact viewing"},{id:"medium",label:"Medium",description:"Standard comfortable reading size"},{id:"large",label:"Large",description:"Larger text size for improved readability"}],i=[{id:"dense",label:"Dense",description:"Compact line spacing"},{id:"normal",label:"Normal",description:"Standard line spacing for comfortable reading"},{id:"relaxed",label:"Relaxed",description:"More spacious line spacing for easier reading"}],o=_e(localStorage.getItem(e.INPUT)||""),l=_e(localStorage.getItem(e.ONLY_GRAMMAR)==="true"),u=_e(null),c=_e(localStorage.getItem(e.WRITING_STYLE)||"preserve"),d=_e(localStorage.getItem(e.ENGLISH_REGION)||"default"),f=_e(localStorage.getItem(e.CUSTOM_INSTRUCTIONS)||""),h=_e(localStorage.getItem(e.FONT_FAMILY)||"serif"),p=_e(localStorage.getItem(e.FONT_SIZE)||"medium"),m=_e(localStorage.getItem(e.LINE_HEIGHT)||"normal"),g=_e(null),_=_e(localStorage.getItem(e.API_KEY)||""),v=_e(!1),y=fa(()=>o.value.length),b=fa(()=>o.value.trim()?o.value.trim().split(/\s+/).filter(S=>S.length>0).length:0);Be(o,S=>{localStorage.setItem(e.INPUT,S)}),Be(l,S=>{localStorage.setItem(e.ONLY_GRAMMAR,S)}),Be(c,S=>{localStorage.setItem(e.WRITING_STYLE,S)}),Be(d,S=>{localStorage.setItem(e.ENGLISH_REGION,S)}),Be(f,S=>{localStorage.setItem(e.CUSTOM_INSTRUCTIONS,S)}),Be(_,S=>{localStorage.setItem(e.API_KEY,S)}),Be(h,S=>{localStorage.setItem(e.FONT_FAMILY,S)}),Be(p,S=>{localStorage.setItem(e.FONT_SIZE,S)}),Be(m,S=>{localStorage.setItem(e.LINE_HEIGHT,S)}),bo(()=>{_.value.trim()||(v.value=!0)});function E(){if(o.value="",g.value&&g.value.$el){const S=g.value.$el.querySelector("textarea");S&&S.focus()}}return(S,O)=>(me(),be("div",jA,[Ot(zw,{"writing-style":c.value,"writing-styles":t,"onUpdate:writingStyle":O[0]||(O[0]=A=>c.value=A),onToggleSettings:O[1]||(O[1]=A=>v.value=!v.value),onClearText:E},null,8,["writing-style"]),$("main",LA,[Ot(aA,{text:o.value,"onUpdate:text":O[2]||(O[2]=A=>o.value=A),"writing-style":c.value,"english-region":d.value,"custom-instructions":f.value,"font-family":h.value,"font-size":p.value,"line-height":m.value,ref_key:"textareaRef",ref:g,class:"flex-1"},null,8,["text","writing-style","english-region","custom-instructions","font-family","font-size","line-height"]),$("div",MA,[O[12]||(O[12]=$("a",{href:"https://github.com/mariomka/flow-pal",target:"_blank",rel:"noopener noreferrer",class:"text-xs text-gray-400 hover:text-gray-600 dark:text-gray-600 dark:hover:text-gray-400 opacity-80 hover:opacity-100 transition-opacity"}," GitHub ",-1)),$("div",FA,Je(b.value)+" words, "+Je(y.value)+" characters ",1)])]),u.value?(me(),be("div",DA,[$("div",UA,[$("div",null,[O[13]||(O[13]=$("p",{class:"font-bold"},"Error",-1)),$("p",null,Je(u.value),1)]),$("button",{onClick:O[3]||(O[3]=A=>u.value=null),class:"ml-4 text-red-700 hover:text-red-900 dark:text-red-200 dark:hover:text-red-100"},"  ")])])):Dc("",!0),Ot(NA,{show:v.value,"initial-api-key":_.value,"writing-style":c.value,"english-region":d.value,"custom-instructions":f.value,"writing-styles":t,"english-regions":n,"font-family":h.value,"font-size":p.value,"line-height":m.value,"font-families":s,"font-sizes":a,"line-heights":i,"onUpdate:apiKey":O[4]||(O[4]=A=>_.value=A),"onUpdate:writingStyle":O[5]||(O[5]=A=>c.value=A),"onUpdate:englishRegion":O[6]||(O[6]=A=>d.value=A),"onUpdate:customInstructions":O[7]||(O[7]=A=>f.value=A),"onUpdate:fontFamily":O[8]||(O[8]=A=>h.value=A),"onUpdate:fontSize":O[9]||(O[9]=A=>p.value=A),"onUpdate:lineHeight":O[10]||(O[10]=A=>m.value=A),onClose:O[11]||(O[11]=A=>v.value=!1)},null,8,["show","initial-api-key","writing-style","english-region","custom-instructions","font-family","font-size","line-height"])]))}};kw();xw(BA).mount("#app");
