var F_=Object.defineProperty;var U_=(r,e,t)=>e in r?F_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Fr=(r,e,t)=>U_(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function cc(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const Re={},Xn=[],gr=()=>{},B_=()=>!1,so=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),dc=r=>r.startsWith("onUpdate:"),ft=Object.assign,fc=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},H_=Object.prototype.hasOwnProperty,Se=(r,e)=>H_.call(r,e),ie=Array.isArray,Yn=r=>Ra(r)==="[object Map]",ms=r=>Ra(r)==="[object Set]",xd=r=>Ra(r)==="[object Date]",fe=r=>typeof r=="function",Fe=r=>typeof r=="string",yr=r=>typeof r=="symbol",Ne=r=>r!==null&&typeof r=="object",xp=r=>(Ne(r)||fe(r))&&fe(r.then)&&fe(r.catch),Op=Object.prototype.toString,Ra=r=>Op.call(r),q_=r=>Ra(r).slice(8,-1),Ap=r=>Ra(r)==="[object Object]",hc=r=>Fe(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,Zs=cc(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ao=r=>{const e=Object.create(null);return t=>e[t]||(e[t]=r(t))},Z_=/-(\w)/g,en=ao(r=>r.replace(Z_,(e,t)=>t?t.toUpperCase():"")),V_=/\B([A-Z])/g,$n=ao(r=>r.replace(V_,"-$1").toLowerCase()),Pp=ao(r=>r.charAt(0).toUpperCase()+r.slice(1)),Fo=ao(r=>r?`on${Pp(r)}`:""),Qr=(r,e)=>!Object.is(r,e),_i=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},Tp=(r,e,t,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:t})},Ii=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let Od;const io=()=>Od||(Od=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function pc(r){if(ie(r)){const e={};for(let t=0;t<r.length;t++){const n=r[t],s=Fe(n)?J_(n):pc(n);if(s)for(const a in s)e[a]=s[a]}return e}else if(Fe(r)||Ne(r))return r}const z_=/;(?![^(]*\))/g,W_=/:([^]+)/,G_=/\/\*[^]*?\*\//g;function J_(r){const e={};return r.replace(G_,"").split(z_).forEach(t=>{if(t){const n=t.split(W_);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function na(r){let e="";if(Fe(r))e=r;else if(ie(r))for(let t=0;t<r.length;t++){const n=na(r[t]);n&&(e+=n+" ")}else if(Ne(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const K_="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",X_=cc(K_);function Ip(r){return!!r||r===""}function Y_(r,e){if(r.length!==e.length)return!1;let t=!0;for(let n=0;t&&n<r.length;n++)t=ka(r[n],e[n]);return t}function ka(r,e){if(r===e)return!0;let t=xd(r),n=xd(e);if(t||n)return t&&n?r.getTime()===e.getTime():!1;if(t=yr(r),n=yr(e),t||n)return r===e;if(t=ie(r),n=ie(e),t||n)return t&&n?Y_(r,e):!1;if(t=Ne(r),n=Ne(e),t||n){if(!t||!n)return!1;const s=Object.keys(r).length,a=Object.keys(e).length;if(s!==a)return!1;for(const i in r){const o=r.hasOwnProperty(i),l=e.hasOwnProperty(i);if(o&&!l||!o&&l||!ka(r[i],e[i]))return!1}}return String(r)===String(e)}function mc(r,e){return r.findIndex(t=>ka(t,e))}const Rp=r=>!!(r&&r.__v_isRef===!0),gn=r=>Fe(r)?r:r==null?"":ie(r)||Ne(r)&&(r.toString===Op||!fe(r.toString))?Rp(r)?gn(r.value):JSON.stringify(r,kp,2):String(r),kp=(r,e)=>Rp(e)?kp(r,e.value):Yn(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],a)=>(t[Uo(n,a)+" =>"]=s,t),{})}:ms(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Uo(t))}:yr(e)?Uo(e):Ne(e)&&!ie(e)&&!Ap(e)?String(e):e,Uo=(r,e="")=>{var t;return yr(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Rt;class Q_{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Rt,!e&&Rt&&(this.index=(Rt.scopes||(Rt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Rt;try{return Rt=this,e()}finally{Rt=t}}}on(){Rt=this}off(){Rt=this.parent}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function ey(){return Rt}let Ce;const Bo=new WeakSet;class Cp{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Rt&&Rt.active&&Rt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Bo.has(this)&&(Bo.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Np(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ad(this),jp(this);const e=Ce,t=Kt;Ce=this,Kt=!0;try{return this.fn()}finally{Lp(this),Ce=e,Kt=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)yc(e);this.deps=this.depsTail=void 0,Ad(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Bo.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Su(this)&&this.run()}get dirty(){return Su(this)}}let $p=0,Vs,zs;function Np(r,e=!1){if(r.flags|=8,e){r.next=zs,zs=r;return}r.next=Vs,Vs=r}function gc(){$p++}function _c(){if(--$p>0)return;if(zs){let e=zs;for(zs=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;Vs;){let e=Vs;for(Vs=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=t}}if(r)throw r}function jp(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Lp(r){let e,t=r.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),yc(n),ty(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}r.deps=e,r.depsTail=t}function Su(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Mp(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function Mp(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===sa))return;r.globalVersion=sa;const e=r.dep;if(r.flags|=2,e.version>0&&!r.isSSR&&r.deps&&!Su(r)){r.flags&=-3;return}const t=Ce,n=Kt;Ce=r,Kt=!0;try{jp(r);const s=r.fn(r._value);(e.version===0||Qr(s,r._value))&&(r._value=s,e.version++)}catch(s){throw e.version++,s}finally{Ce=t,Kt=n,Lp(r),r.flags&=-3}}function yc(r,e=!1){const{dep:t,prevSub:n,nextSub:s}=r;if(n&&(n.nextSub=s,r.prevSub=void 0),s&&(s.prevSub=n,r.nextSub=void 0),t.subs===r&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let a=t.computed.deps;a;a=a.nextDep)yc(a,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function ty(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let Kt=!0;const Dp=[];function un(){Dp.push(Kt),Kt=!1}function cn(){const r=Dp.pop();Kt=r===void 0?!0:r}function Ad(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=Ce;Ce=void 0;try{e()}finally{Ce=t}}}let sa=0;class ry{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class bc{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Ce||!Kt||Ce===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Ce)t=this.activeLink=new ry(Ce,this),Ce.deps?(t.prevDep=Ce.depsTail,Ce.depsTail.nextDep=t,Ce.depsTail=t):Ce.deps=Ce.depsTail=t,Fp(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=Ce.depsTail,t.nextDep=void 0,Ce.depsTail.nextDep=t,Ce.depsTail=t,Ce.deps===t&&(Ce.deps=n)}return t}trigger(e){this.version++,sa++,this.notify(e)}notify(e){gc();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{_c()}}}function Fp(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Fp(n)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const xu=new WeakMap,vn=Symbol(""),Ou=Symbol(""),aa=Symbol("");function tt(r,e,t){if(Kt&&Ce){let n=xu.get(r);n||xu.set(r,n=new Map);let s=n.get(t);s||(n.set(t,s=new bc),s.map=n,s.key=t),s.track()}}function kr(r,e,t,n,s,a){const i=xu.get(r);if(!i){sa++;return}const o=l=>{l&&l.trigger()};if(gc(),e==="clear")i.forEach(o);else{const l=ie(r),u=l&&hc(t);if(l&&t==="length"){const c=Number(n);i.forEach((d,f)=>{(f==="length"||f===aa||!yr(f)&&f>=c)&&o(d)})}else switch((t!==void 0||i.has(void 0))&&o(i.get(t)),u&&o(i.get(aa)),e){case"add":l?u&&o(i.get("length")):(o(i.get(vn)),Yn(r)&&o(i.get(Ou)));break;case"delete":l||(o(i.get(vn)),Yn(r)&&o(i.get(Ou)));break;case"set":Yn(r)&&o(i.get(vn));break}}_c()}function Ln(r){const e=Ee(r);return e===r?e:(tt(e,"iterate",aa),Ft(r)?e:e.map(rt))}function oo(r){return tt(r=Ee(r),"iterate",aa),r}const ny={__proto__:null,[Symbol.iterator](){return Ho(this,Symbol.iterator,rt)},concat(...r){return Ln(this).concat(...r.map(e=>ie(e)?Ln(e):e))},entries(){return Ho(this,"entries",r=>(r[1]=rt(r[1]),r))},every(r,e){return Sr(this,"every",r,e,void 0,arguments)},filter(r,e){return Sr(this,"filter",r,e,t=>t.map(rt),arguments)},find(r,e){return Sr(this,"find",r,e,rt,arguments)},findIndex(r,e){return Sr(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return Sr(this,"findLast",r,e,rt,arguments)},findLastIndex(r,e){return Sr(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return Sr(this,"forEach",r,e,void 0,arguments)},includes(...r){return qo(this,"includes",r)},indexOf(...r){return qo(this,"indexOf",r)},join(r){return Ln(this).join(r)},lastIndexOf(...r){return qo(this,"lastIndexOf",r)},map(r,e){return Sr(this,"map",r,e,void 0,arguments)},pop(){return Ts(this,"pop")},push(...r){return Ts(this,"push",r)},reduce(r,...e){return Pd(this,"reduce",r,e)},reduceRight(r,...e){return Pd(this,"reduceRight",r,e)},shift(){return Ts(this,"shift")},some(r,e){return Sr(this,"some",r,e,void 0,arguments)},splice(...r){return Ts(this,"splice",r)},toReversed(){return Ln(this).toReversed()},toSorted(r){return Ln(this).toSorted(r)},toSpliced(...r){return Ln(this).toSpliced(...r)},unshift(...r){return Ts(this,"unshift",r)},values(){return Ho(this,"values",rt)}};function Ho(r,e,t){const n=oo(r),s=n[e]();return n!==r&&!Ft(r)&&(s._next=s.next,s.next=()=>{const a=s._next();return a.value&&(a.value=t(a.value)),a}),s}const sy=Array.prototype;function Sr(r,e,t,n,s,a){const i=oo(r),o=i!==r&&!Ft(r),l=i[e];if(l!==sy[e]){const d=l.apply(r,a);return o?rt(d):d}let u=t;i!==r&&(o?u=function(d,f){return t.call(this,rt(d),f,r)}:t.length>2&&(u=function(d,f){return t.call(this,d,f,r)}));const c=l.call(i,u,n);return o&&s?s(c):c}function Pd(r,e,t,n){const s=oo(r);let a=t;return s!==r&&(Ft(r)?t.length>3&&(a=function(i,o,l){return t.call(this,i,o,l,r)}):a=function(i,o,l){return t.call(this,i,rt(o),l,r)}),s[e](a,...n)}function qo(r,e,t){const n=Ee(r);tt(n,"iterate",aa);const s=n[e](...t);return(s===-1||s===!1)&&Sc(t[0])?(t[0]=Ee(t[0]),n[e](...t)):s}function Ts(r,e,t=[]){un(),gc();const n=Ee(r)[e].apply(r,t);return _c(),cn(),n}const ay=cc("__proto__,__v_isRef,__isVue"),Up=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(yr));function iy(r){yr(r)||(r=String(r));const e=Ee(this);return tt(e,"has",r),e.hasOwnProperty(r)}class Bp{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,a=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return a;if(t==="__v_raw")return n===(s?a?gy:Vp:a?Zp:qp).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const i=ie(e);if(!s){let l;if(i&&(l=ny[t]))return l;if(t==="hasOwnProperty")return iy}const o=Reflect.get(e,t,st(e)?e:n);return(yr(t)?Up.has(t):ay(t))||(s||tt(e,"get",t),a)?o:st(o)?i&&hc(t)?o:o.value:Ne(o)?s?zp(o):vc(o):o}}class Hp extends Bp{constructor(e=!1){super(!1,e)}set(e,t,n,s){let a=e[t];if(!this._isShallow){const l=An(a);if(!Ft(n)&&!An(n)&&(a=Ee(a),n=Ee(n)),!ie(e)&&st(a)&&!st(n))return l?!1:(a.value=n,!0)}const i=ie(e)&&hc(t)?Number(t)<e.length:Se(e,t),o=Reflect.set(e,t,n,st(e)?e:s);return e===Ee(s)&&(i?Qr(n,a)&&kr(e,"set",t,n):kr(e,"add",t,n)),o}deleteProperty(e,t){const n=Se(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&kr(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!yr(t)||!Up.has(t))&&tt(e,"has",t),n}ownKeys(e){return tt(e,"iterate",ie(e)?"length":vn),Reflect.ownKeys(e)}}class oy extends Bp{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const ly=new Hp,uy=new oy,cy=new Hp(!0);const Au=r=>r,za=r=>Reflect.getPrototypeOf(r);function dy(r,e,t){return function(...n){const s=this.__v_raw,a=Ee(s),i=Yn(a),o=r==="entries"||r===Symbol.iterator&&i,l=r==="keys"&&i,u=s[r](...n),c=t?Au:e?Pu:rt;return!e&&tt(a,"iterate",l?Ou:vn),{next(){const{value:d,done:f}=u.next();return f?{value:d,done:f}:{value:o?[c(d[0]),c(d[1])]:c(d),done:f}},[Symbol.iterator](){return this}}}}function Wa(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function fy(r,e){const t={get(s){const a=this.__v_raw,i=Ee(a),o=Ee(s);r||(Qr(s,o)&&tt(i,"get",s),tt(i,"get",o));const{has:l}=za(i),u=e?Au:r?Pu:rt;if(l.call(i,s))return u(a.get(s));if(l.call(i,o))return u(a.get(o));a!==i&&a.get(s)},get size(){const s=this.__v_raw;return!r&&tt(Ee(s),"iterate",vn),Reflect.get(s,"size",s)},has(s){const a=this.__v_raw,i=Ee(a),o=Ee(s);return r||(Qr(s,o)&&tt(i,"has",s),tt(i,"has",o)),s===o?a.has(s):a.has(s)||a.has(o)},forEach(s,a){const i=this,o=i.__v_raw,l=Ee(o),u=e?Au:r?Pu:rt;return!r&&tt(l,"iterate",vn),o.forEach((c,d)=>s.call(a,u(c),u(d),i))}};return ft(t,r?{add:Wa("add"),set:Wa("set"),delete:Wa("delete"),clear:Wa("clear")}:{add(s){!e&&!Ft(s)&&!An(s)&&(s=Ee(s));const a=Ee(this);return za(a).has.call(a,s)||(a.add(s),kr(a,"add",s,s)),this},set(s,a){!e&&!Ft(a)&&!An(a)&&(a=Ee(a));const i=Ee(this),{has:o,get:l}=za(i);let u=o.call(i,s);u||(s=Ee(s),u=o.call(i,s));const c=l.call(i,s);return i.set(s,a),u?Qr(a,c)&&kr(i,"set",s,a):kr(i,"add",s,a),this},delete(s){const a=Ee(this),{has:i,get:o}=za(a);let l=i.call(a,s);l||(s=Ee(s),l=i.call(a,s)),o&&o.call(a,s);const u=a.delete(s);return l&&kr(a,"delete",s,void 0),u},clear(){const s=Ee(this),a=s.size!==0,i=s.clear();return a&&kr(s,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=dy(s,r,e)}),t}function wc(r,e){const t=fy(r,e);return(n,s,a)=>s==="__v_isReactive"?!r:s==="__v_isReadonly"?r:s==="__v_raw"?n:Reflect.get(Se(t,s)&&s in n?t:n,s,a)}const hy={get:wc(!1,!1)},py={get:wc(!1,!0)},my={get:wc(!0,!1)};const qp=new WeakMap,Zp=new WeakMap,Vp=new WeakMap,gy=new WeakMap;function _y(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function yy(r){return r.__v_skip||!Object.isExtensible(r)?0:_y(q_(r))}function vc(r){return An(r)?r:Ec(r,!1,ly,hy,qp)}function by(r){return Ec(r,!1,cy,py,Zp)}function zp(r){return Ec(r,!0,uy,my,Vp)}function Ec(r,e,t,n,s){if(!Ne(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const a=s.get(r);if(a)return a;const i=yy(r);if(i===0)return r;const o=new Proxy(r,i===2?n:t);return s.set(r,o),o}function Qn(r){return An(r)?Qn(r.__v_raw):!!(r&&r.__v_isReactive)}function An(r){return!!(r&&r.__v_isReadonly)}function Ft(r){return!!(r&&r.__v_isShallow)}function Sc(r){return r?!!r.__v_raw:!1}function Ee(r){const e=r&&r.__v_raw;return e?Ee(e):r}function wy(r){return!Se(r,"__v_skip")&&Object.isExtensible(r)&&Tp(r,"__v_skip",!0),r}const rt=r=>Ne(r)?vc(r):r,Pu=r=>Ne(r)?zp(r):r;function st(r){return r?r.__v_isRef===!0:!1}function Ke(r){return vy(r,!1)}function vy(r,e){return st(r)?r:new Ey(r,e)}class Ey{constructor(e,t){this.dep=new bc,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ee(e),this._value=t?e:rt(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||Ft(e)||An(e);e=n?e:Ee(e),Qr(e,t)&&(this._rawValue=e,this._value=n?e:rt(e),this.dep.trigger())}}function Wp(r){return st(r)?r.value:r}const Sy={get:(r,e,t)=>e==="__v_raw"?r:Wp(Reflect.get(r,e,t)),set:(r,e,t,n)=>{const s=r[e];return st(s)&&!st(t)?(s.value=t,!0):Reflect.set(r,e,t,n)}};function Gp(r){return Qn(r)?r:new Proxy(r,Sy)}class xy{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new bc(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=sa-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Ce!==this)return Np(this,!0),!0}get value(){const e=this.dep.track();return Mp(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Oy(r,e,t=!1){let n,s;return fe(r)?n=r:(n=r.get,s=r.set),new xy(n,s,t)}const Ga={},Ri=new WeakMap;let _n;function Ay(r,e=!1,t=_n){if(t){let n=Ri.get(t);n||Ri.set(t,n=[]),n.push(r)}}function Py(r,e,t=Re){const{immediate:n,deep:s,once:a,scheduler:i,augmentJob:o,call:l}=t,u=w=>s?w:Ft(w)||s===!1||s===0?Cr(w,1):Cr(w);let c,d,f,h,p=!1,m=!1;if(st(r)?(d=()=>r.value,p=Ft(r)):Qn(r)?(d=()=>u(r),p=!0):ie(r)?(m=!0,p=r.some(w=>Qn(w)||Ft(w)),d=()=>r.map(w=>{if(st(w))return w.value;if(Qn(w))return u(w);if(fe(w))return l?l(w,2):w()})):fe(r)?e?d=l?()=>l(r,2):r:d=()=>{if(f){un();try{f()}finally{cn()}}const w=_n;_n=c;try{return l?l(r,3,[h]):r(h)}finally{_n=w}}:d=gr,e&&s){const w=d,S=s===!0?1/0:s;d=()=>Cr(w(),S)}const g=ey(),_=()=>{c.stop(),g&&g.active&&fc(g.effects,c)};if(a&&e){const w=e;e=(...S)=>{w(...S),_()}}let b=m?new Array(r.length).fill(Ga):Ga;const y=w=>{if(!(!(c.flags&1)||!c.dirty&&!w))if(e){const S=c.run();if(s||p||(m?S.some((x,T)=>Qr(x,b[T])):Qr(S,b))){f&&f();const x=_n;_n=c;try{const T=[S,b===Ga?void 0:m&&b[0]===Ga?[]:b,h];l?l(e,3,T):e(...T),b=S}finally{_n=x}}}else c.run()};return o&&o(y),c=new Cp(d),c.scheduler=i?()=>i(y,!1):y,h=w=>Ay(w,!1,c),f=c.onStop=()=>{const w=Ri.get(c);if(w){if(l)l(w,4);else for(const S of w)S();Ri.delete(c)}},e?n?y(!0):b=c.run():i?i(y.bind(null,!0),!0):c.run(),_.pause=c.pause.bind(c),_.resume=c.resume.bind(c),_.stop=_,_}function Cr(r,e=1/0,t){if(e<=0||!Ne(r)||r.__v_skip||(t=t||new Set,t.has(r)))return r;if(t.add(r),e--,st(r))Cr(r.value,e,t);else if(ie(r))for(let n=0;n<r.length;n++)Cr(r[n],e,t);else if(ms(r)||Yn(r))r.forEach(n=>{Cr(n,e,t)});else if(Ap(r)){for(const n in r)Cr(r[n],e,t);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&Cr(r[n],e,t)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ca(r,e,t,n){try{return n?r(...n):r()}catch(s){lo(s,e,t)}}function br(r,e,t,n){if(fe(r)){const s=Ca(r,e,t,n);return s&&xp(s)&&s.catch(a=>{lo(a,e,t)}),s}if(ie(r)){const s=[];for(let a=0;a<r.length;a++)s.push(br(r[a],e,t,n));return s}}function lo(r,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:a,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||Re;if(e){let o=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const c=o.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](r,l,u)===!1)return}o=o.parent}if(a){un(),Ca(a,null,10,[r,l,u]),cn();return}}Ty(r,t,s,n,i)}function Ty(r,e,t,n=!0,s=!1){if(s)throw r;console.error(r)}const ut=[];let cr=-1;const es=[];let Wr=null,Hn=0;const Jp=Promise.resolve();let ki=null;function xc(r){const e=ki||Jp;return r?e.then(this?r.bind(this):r):e}function Iy(r){let e=cr+1,t=ut.length;for(;e<t;){const n=e+t>>>1,s=ut[n],a=ia(s);a<r||a===r&&s.flags&2?e=n+1:t=n}return e}function Oc(r){if(!(r.flags&1)){const e=ia(r),t=ut[ut.length-1];!t||!(r.flags&2)&&e>=ia(t)?ut.push(r):ut.splice(Iy(e),0,r),r.flags|=1,Kp()}}function Kp(){ki||(ki=Jp.then(Yp))}function Ry(r){ie(r)?es.push(...r):Wr&&r.id===-1?Wr.splice(Hn+1,0,r):r.flags&1||(es.push(r),r.flags|=1),Kp()}function Td(r,e,t=cr+1){for(;t<ut.length;t++){const n=ut[t];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;ut.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function Xp(r){if(es.length){const e=[...new Set(es)].sort((t,n)=>ia(t)-ia(n));if(es.length=0,Wr){Wr.push(...e);return}for(Wr=e,Hn=0;Hn<Wr.length;Hn++){const t=Wr[Hn];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Wr=null,Hn=0}}const ia=r=>r.id==null?r.flags&2?-1:1/0:r.id;function Yp(r){try{for(cr=0;cr<ut.length;cr++){const e=ut[cr];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Ca(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;cr<ut.length;cr++){const e=ut[cr];e&&(e.flags&=-2)}cr=-1,ut.length=0,Xp(),ki=null,(ut.length||es.length)&&Yp()}}let Dt=null,Qp=null;function Ci(r){const e=Dt;return Dt=r,Qp=r&&r.type.__scopeId||null,e}function ky(r,e=Dt,t){if(!e||r._n)return r;const n=(...s)=>{n._d&&Dd(-1);const a=Ci(e);let i;try{i=r(...s)}finally{Ci(a),n._d&&Dd(1)}return i};return n._n=!0,n._c=!0,n._d=!0,n}function Ur(r,e){if(Dt===null)return r;const t=ho(Dt),n=r.dirs||(r.dirs=[]);for(let s=0;s<e.length;s++){let[a,i,o,l=Re]=e[s];a&&(fe(a)&&(a={mounted:a,updated:a}),a.deep&&Cr(i),n.push({dir:a,instance:t,value:i,oldValue:void 0,arg:o,modifiers:l}))}return r}function fn(r,e,t,n){const s=r.dirs,a=e&&e.dirs;for(let i=0;i<s.length;i++){const o=s[i];a&&(o.oldValue=a[i].value);let l=o.dir[n];l&&(un(),br(l,t,8,[r.el,o,r,e]),cn())}}const Cy=Symbol("_vte"),$y=r=>r.__isTeleport;function Ac(r,e){r.shapeFlag&6&&r.component?(r.transition=e,Ac(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function em(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function $i(r,e,t,n,s=!1){if(ie(r)){r.forEach((p,m)=>$i(p,e&&(ie(e)?e[m]:e),t,n,s));return}if(Ws(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&$i(r,e,t,n.component.subTree);return}const a=n.shapeFlag&4?ho(n.component):n.el,i=s?null:a,{i:o,r:l}=r,u=e&&e.r,c=o.refs===Re?o.refs={}:o.refs,d=o.setupState,f=Ee(d),h=d===Re?()=>!1:p=>Se(f,p);if(u!=null&&u!==l&&(Fe(u)?(c[u]=null,h(u)&&(d[u]=null)):st(u)&&(u.value=null)),fe(l))Ca(l,o,12,[i,c]);else{const p=Fe(l),m=st(l);if(p||m){const g=()=>{if(r.f){const _=p?h(l)?d[l]:c[l]:l.value;s?ie(_)&&fc(_,a):ie(_)?_.includes(a)||_.push(a):p?(c[l]=[a],h(l)&&(d[l]=c[l])):(l.value=[a],r.k&&(c[r.k]=l.value))}else p?(c[l]=i,h(l)&&(d[l]=i)):m&&(l.value=i,r.k&&(c[r.k]=i))};i?(g.id=-1,Pt(g,t)):g()}}}io().requestIdleCallback;io().cancelIdleCallback;const Ws=r=>!!r.type.__asyncLoader,tm=r=>r.type.__isKeepAlive;function Ny(r,e){rm(r,"a",e)}function jy(r,e){rm(r,"da",e)}function rm(r,e,t=dt){const n=r.__wdc||(r.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return r()});if(uo(e,n,t),t){let s=t.parent;for(;s&&s.parent;)tm(s.parent.vnode)&&Ly(n,e,t,s),s=s.parent}}function Ly(r,e,t,n){const s=uo(e,r,n,!0);sm(()=>{fc(n[e],s)},t)}function uo(r,e,t=dt,n=!1){if(t){const s=t[r]||(t[r]=[]),a=e.__weh||(e.__weh=(...i)=>{un();const o=$a(t),l=br(e,t,r,i);return o(),cn(),l});return n?s.unshift(a):s.push(a),a}}const Dr=r=>(e,t=dt)=>{(!la||r==="sp")&&uo(r,(...n)=>e(...n),t)},My=Dr("bm"),nm=Dr("m"),Dy=Dr("bu"),Fy=Dr("u"),Uy=Dr("bum"),sm=Dr("um"),By=Dr("sp"),Hy=Dr("rtg"),qy=Dr("rtc");function Zy(r,e=dt){uo("ec",r,e)}const Vy=Symbol.for("v-ndc");function Id(r,e,t,n){let s;const a=t,i=ie(r);if(i||Fe(r)){const o=i&&Qn(r);let l=!1;o&&(l=!Ft(r),r=oo(r)),s=new Array(r.length);for(let u=0,c=r.length;u<c;u++)s[u]=e(l?rt(r[u]):r[u],u,void 0,a)}else if(typeof r=="number"){s=new Array(r);for(let o=0;o<r;o++)s[o]=e(o+1,o,void 0,a)}else if(Ne(r))if(r[Symbol.iterator])s=Array.from(r,(o,l)=>e(o,l,void 0,a));else{const o=Object.keys(r);s=new Array(o.length);for(let l=0,u=o.length;l<u;l++){const c=o[l];s[l]=e(r[c],c,l,a)}}else s=[];return s}const Tu=r=>r?Am(r)?ho(r):Tu(r.parent):null,Gs=ft(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>Tu(r.parent),$root:r=>Tu(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>im(r),$forceUpdate:r=>r.f||(r.f=()=>{Oc(r.update)}),$nextTick:r=>r.n||(r.n=xc.bind(r.proxy)),$watch:r=>hb.bind(r)}),Zo=(r,e)=>r!==Re&&!r.__isScriptSetup&&Se(r,e),zy={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:a,accessCache:i,type:o,appContext:l}=r;let u;if(e[0]!=="$"){const h=i[e];if(h!==void 0)switch(h){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return a[e]}else{if(Zo(n,e))return i[e]=1,n[e];if(s!==Re&&Se(s,e))return i[e]=2,s[e];if((u=r.propsOptions[0])&&Se(u,e))return i[e]=3,a[e];if(t!==Re&&Se(t,e))return i[e]=4,t[e];Iu&&(i[e]=0)}}const c=Gs[e];let d,f;if(c)return e==="$attrs"&&tt(r.attrs,"get",""),c(r);if((d=o.__cssModules)&&(d=d[e]))return d;if(t!==Re&&Se(t,e))return i[e]=4,t[e];if(f=l.config.globalProperties,Se(f,e))return f[e]},set({_:r},e,t){const{data:n,setupState:s,ctx:a}=r;return Zo(s,e)?(s[e]=t,!0):n!==Re&&Se(n,e)?(n[e]=t,!0):Se(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(a[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:a}},i){let o;return!!t[i]||r!==Re&&Se(r,i)||Zo(e,i)||(o=a[0])&&Se(o,i)||Se(n,i)||Se(Gs,i)||Se(s.config.globalProperties,i)},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:Se(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function Rd(r){return ie(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let Iu=!0;function Wy(r){const e=im(r),t=r.proxy,n=r.ctx;Iu=!1,e.beforeCreate&&kd(e.beforeCreate,r,"bc");const{data:s,computed:a,methods:i,watch:o,provide:l,inject:u,created:c,beforeMount:d,mounted:f,beforeUpdate:h,updated:p,activated:m,deactivated:g,beforeDestroy:_,beforeUnmount:b,destroyed:y,unmounted:w,render:S,renderTracked:x,renderTriggered:T,errorCaptured:I,serverPrefetch:W,expose:Y,inheritAttrs:k,components:A,directives:M,filters:R}=e;if(u&&Gy(u,n,null),i)for(const N in i){const U=i[N];fe(U)&&(n[N]=U.bind(t))}if(s){const N=s.call(t,t);Ne(N)&&(r.data=vc(N))}if(Iu=!0,a)for(const N in a){const U=a[N],H=fe(U)?U.bind(t,t):fe(U.get)?U.get.bind(t,t):gr,ne=!fe(U)&&fe(U.set)?U.set.bind(t):gr,ce=$u({get:H,set:ne});Object.defineProperty(n,N,{enumerable:!0,configurable:!0,get:()=>ce.value,set:te=>ce.value=te})}if(o)for(const N in o)am(o[N],n,t,N);if(l){const N=fe(l)?l.call(t):l;Reflect.ownKeys(N).forEach(U=>{eb(U,N[U])})}c&&kd(c,r,"c");function B(N,U){ie(U)?U.forEach(H=>N(H.bind(t))):U&&N(U.bind(t))}if(B(My,d),B(nm,f),B(Dy,h),B(Fy,p),B(Ny,m),B(jy,g),B(Zy,I),B(qy,x),B(Hy,T),B(Uy,b),B(sm,w),B(By,W),ie(Y))if(Y.length){const N=r.exposed||(r.exposed={});Y.forEach(U=>{Object.defineProperty(N,U,{get:()=>t[U],set:H=>t[U]=H})})}else r.exposed||(r.exposed={});S&&r.render===gr&&(r.render=S),k!=null&&(r.inheritAttrs=k),A&&(r.components=A),M&&(r.directives=M),W&&em(r)}function Gy(r,e,t=gr){ie(r)&&(r=Ru(r));for(const n in r){const s=r[n];let a;Ne(s)?"default"in s?a=yi(s.from||n,s.default,!0):a=yi(s.from||n):a=yi(s),st(a)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>a.value,set:i=>a.value=i}):e[n]=a}}function kd(r,e,t){br(ie(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,t)}function am(r,e,t,n){let s=n.includes(".")?wm(t,n):()=>t[n];if(Fe(r)){const a=e[r];fe(a)&&It(s,a)}else if(fe(r))It(s,r.bind(t));else if(Ne(r))if(ie(r))r.forEach(a=>am(a,e,t,n));else{const a=fe(r.handler)?r.handler.bind(t):e[r.handler];fe(a)&&It(s,a,r)}}function im(r){const e=r.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:a,config:{optionMergeStrategies:i}}=r.appContext,o=a.get(e);let l;return o?l=o:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(u=>Ni(l,u,i,!0)),Ni(l,e,i)),Ne(e)&&a.set(e,l),l}function Ni(r,e,t,n=!1){const{mixins:s,extends:a}=e;a&&Ni(r,a,t,!0),s&&s.forEach(i=>Ni(r,i,t,!0));for(const i in e)if(!(n&&i==="expose")){const o=Jy[i]||t&&t[i];r[i]=o?o(r[i],e[i]):e[i]}return r}const Jy={data:Cd,props:$d,emits:$d,methods:Ns,computed:Ns,beforeCreate:lt,created:lt,beforeMount:lt,mounted:lt,beforeUpdate:lt,updated:lt,beforeDestroy:lt,beforeUnmount:lt,destroyed:lt,unmounted:lt,activated:lt,deactivated:lt,errorCaptured:lt,serverPrefetch:lt,components:Ns,directives:Ns,watch:Xy,provide:Cd,inject:Ky};function Cd(r,e){return e?r?function(){return ft(fe(r)?r.call(this,this):r,fe(e)?e.call(this,this):e)}:e:r}function Ky(r,e){return Ns(Ru(r),Ru(e))}function Ru(r){if(ie(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function lt(r,e){return r?[...new Set([].concat(r,e))]:e}function Ns(r,e){return r?ft(Object.create(null),r,e):e}function $d(r,e){return r?ie(r)&&ie(e)?[...new Set([...r,...e])]:ft(Object.create(null),Rd(r),Rd(e??{})):e}function Xy(r,e){if(!r)return e;if(!e)return r;const t=ft(Object.create(null),r);for(const n in e)t[n]=lt(r[n],e[n]);return t}function om(){return{app:null,config:{isNativeTag:B_,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Yy=0;function Qy(r,e){return function(n,s=null){fe(n)||(n=ft({},n)),s!=null&&!Ne(s)&&(s=null);const a=om(),i=new WeakSet,o=[];let l=!1;const u=a.app={_uid:Yy++,_component:n,_props:s,_container:null,_context:a,_instance:null,version:Nb,get config(){return a.config},set config(c){},use(c,...d){return i.has(c)||(c&&fe(c.install)?(i.add(c),c.install(u,...d)):fe(c)&&(i.add(c),c(u,...d))),u},mixin(c){return a.mixins.includes(c)||a.mixins.push(c),u},component(c,d){return d?(a.components[c]=d,u):a.components[c]},directive(c,d){return d?(a.directives[c]=d,u):a.directives[c]},mount(c,d,f){if(!l){const h=u._ceVNode||Nr(n,s);return h.appContext=a,f===!0?f="svg":f===!1&&(f=void 0),r(h,c,f),l=!0,u._container=c,c.__vue_app__=u,ho(h.component)}},onUnmount(c){o.push(c)},unmount(){l&&(br(o,u._instance,16),r(null,u._container),delete u._container.__vue_app__)},provide(c,d){return a.provides[c]=d,u},runWithContext(c){const d=ts;ts=u;try{return c()}finally{ts=d}}};return u}}let ts=null;function eb(r,e){if(dt){let t=dt.provides;const n=dt.parent&&dt.parent.provides;n===t&&(t=dt.provides=Object.create(n)),t[r]=e}}function yi(r,e,t=!1){const n=dt||Dt;if(n||ts){const s=ts?ts._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&r in s)return s[r];if(arguments.length>1)return t&&fe(e)?e.call(n&&n.proxy):e}}const lm={},um=()=>Object.create(lm),cm=r=>Object.getPrototypeOf(r)===lm;function tb(r,e,t,n=!1){const s={},a=um();r.propsDefaults=Object.create(null),dm(r,e,s,a);for(const i in r.propsOptions[0])i in s||(s[i]=void 0);t?r.props=n?s:by(s):r.type.props?r.props=s:r.props=a,r.attrs=a}function rb(r,e,t,n){const{props:s,attrs:a,vnode:{patchFlag:i}}=r,o=Ee(s),[l]=r.propsOptions;let u=!1;if((n||i>0)&&!(i&16)){if(i&8){const c=r.vnode.dynamicProps;for(let d=0;d<c.length;d++){let f=c[d];if(co(r.emitsOptions,f))continue;const h=e[f];if(l)if(Se(a,f))h!==a[f]&&(a[f]=h,u=!0);else{const p=en(f);s[p]=ku(l,o,p,h,r,!1)}else h!==a[f]&&(a[f]=h,u=!0)}}}else{dm(r,e,s,a)&&(u=!0);let c;for(const d in o)(!e||!Se(e,d)&&((c=$n(d))===d||!Se(e,c)))&&(l?t&&(t[d]!==void 0||t[c]!==void 0)&&(s[d]=ku(l,o,d,void 0,r,!0)):delete s[d]);if(a!==o)for(const d in a)(!e||!Se(e,d))&&(delete a[d],u=!0)}u&&kr(r.attrs,"set","")}function dm(r,e,t,n){const[s,a]=r.propsOptions;let i=!1,o;if(e)for(let l in e){if(Zs(l))continue;const u=e[l];let c;s&&Se(s,c=en(l))?!a||!a.includes(c)?t[c]=u:(o||(o={}))[c]=u:co(r.emitsOptions,l)||(!(l in n)||u!==n[l])&&(n[l]=u,i=!0)}if(a){const l=Ee(t),u=o||Re;for(let c=0;c<a.length;c++){const d=a[c];t[d]=ku(s,l,d,u[d],r,!Se(u,d))}}return i}function ku(r,e,t,n,s,a){const i=r[t];if(i!=null){const o=Se(i,"default");if(o&&n===void 0){const l=i.default;if(i.type!==Function&&!i.skipFactory&&fe(l)){const{propsDefaults:u}=s;if(t in u)n=u[t];else{const c=$a(s);n=u[t]=l.call(null,e),c()}}else n=l;s.ce&&s.ce._setProp(t,n)}i[0]&&(a&&!o?n=!1:i[1]&&(n===""||n===$n(t))&&(n=!0))}return n}const nb=new WeakMap;function fm(r,e,t=!1){const n=t?nb:e.propsCache,s=n.get(r);if(s)return s;const a=r.props,i={},o=[];let l=!1;if(!fe(r)){const c=d=>{l=!0;const[f,h]=fm(d,e,!0);ft(i,f),h&&o.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(c),r.extends&&c(r.extends),r.mixins&&r.mixins.forEach(c)}if(!a&&!l)return Ne(r)&&n.set(r,Xn),Xn;if(ie(a))for(let c=0;c<a.length;c++){const d=en(a[c]);Nd(d)&&(i[d]=Re)}else if(a)for(const c in a){const d=en(c);if(Nd(d)){const f=a[c],h=i[d]=ie(f)||fe(f)?{type:f}:ft({},f),p=h.type;let m=!1,g=!0;if(ie(p))for(let _=0;_<p.length;++_){const b=p[_],y=fe(b)&&b.name;if(y==="Boolean"){m=!0;break}else y==="String"&&(g=!1)}else m=fe(p)&&p.name==="Boolean";h[0]=m,h[1]=g,(m||Se(h,"default"))&&o.push(d)}}const u=[i,o];return Ne(r)&&n.set(r,u),u}function Nd(r){return r[0]!=="$"&&!Zs(r)}const hm=r=>r[0]==="_"||r==="$stable",Pc=r=>ie(r)?r.map(hr):[hr(r)],sb=(r,e,t)=>{if(e._n)return e;const n=ky((...s)=>Pc(e(...s)),t);return n._c=!1,n},pm=(r,e,t)=>{const n=r._ctx;for(const s in r){if(hm(s))continue;const a=r[s];if(fe(a))e[s]=sb(s,a,n);else if(a!=null){const i=Pc(a);e[s]=()=>i}}},mm=(r,e)=>{const t=Pc(e);r.slots.default=()=>t},gm=(r,e,t)=>{for(const n in e)(t||n!=="_")&&(r[n]=e[n])},ab=(r,e,t)=>{const n=r.slots=um();if(r.vnode.shapeFlag&32){const s=e._;s?(gm(n,e,t),t&&Tp(n,"_",s,!0)):pm(e,n)}else e&&mm(r,e)},ib=(r,e,t)=>{const{vnode:n,slots:s}=r;let a=!0,i=Re;if(n.shapeFlag&32){const o=e._;o?t&&o===1?a=!1:gm(s,e,t):(a=!e.$stable,pm(e,s)),i=e}else e&&(mm(r,e),i={default:1});if(a)for(const o in s)!hm(o)&&i[o]==null&&delete s[o]},Pt=wb;function ob(r){return lb(r)}function lb(r,e){const t=io();t.__VUE__=!0;const{insert:n,remove:s,patchProp:a,createElement:i,createText:o,createComment:l,setText:u,setElementText:c,parentNode:d,nextSibling:f,setScopeId:h=gr,insertStaticContent:p}=r,m=(v,E,P,D=null,$=null,L=null,z=void 0,Z=null,q=!!E.dynamicChildren)=>{if(v===E)return;v&&!Is(v,E)&&(D=Ut(v),te(v,$,L,!0),v=null),E.patchFlag===-2&&(q=!1,E.dynamicChildren=null);const{type:F,ref:se,shapeFlag:G}=E;switch(F){case fo:g(v,E,P,D);break;case Pn:_(v,E,P,D);break;case zo:v==null&&b(E,P,D,z);break;case Ct:A(v,E,P,D,$,L,z,Z,q);break;default:G&1?S(v,E,P,D,$,L,z,Z,q):G&6?M(v,E,P,D,$,L,z,Z,q):(G&64||G&128)&&F.process(v,E,P,D,$,L,z,Z,q,Er)}se!=null&&$&&$i(se,v&&v.ref,L,E||v,!E)},g=(v,E,P,D)=>{if(v==null)n(E.el=o(E.children),P,D);else{const $=E.el=v.el;E.children!==v.children&&u($,E.children)}},_=(v,E,P,D)=>{v==null?n(E.el=l(E.children||""),P,D):E.el=v.el},b=(v,E,P,D)=>{[v.el,v.anchor]=p(v.children,E,P,D,v.el,v.anchor)},y=({el:v,anchor:E},P,D)=>{let $;for(;v&&v!==E;)$=f(v),n(v,P,D),v=$;n(E,P,D)},w=({el:v,anchor:E})=>{let P;for(;v&&v!==E;)P=f(v),s(v),v=P;s(E)},S=(v,E,P,D,$,L,z,Z,q)=>{E.type==="svg"?z="svg":E.type==="math"&&(z="mathml"),v==null?x(E,P,D,$,L,z,Z,q):W(v,E,$,L,z,Z,q)},x=(v,E,P,D,$,L,z,Z)=>{let q,F;const{props:se,shapeFlag:G,transition:re,dirs:le}=v;if(q=v.el=i(v.type,L,se&&se.is,se),G&8?c(q,v.children):G&16&&I(v.children,q,null,D,$,Vo(v,L),z,Z),le&&fn(v,null,D,"created"),T(q,v,v.scopeId,z,D),se){for(const ke in se)ke!=="value"&&!Zs(ke)&&a(q,ke,null,se[ke],L,D);"value"in se&&a(q,"value",null,se.value,L),(F=se.onVnodeBeforeMount)&&lr(F,D,v)}le&&fn(v,null,D,"beforeMount");const ye=ub($,re);ye&&re.beforeEnter(q),n(q,E,P),((F=se&&se.onVnodeMounted)||ye||le)&&Pt(()=>{F&&lr(F,D,v),ye&&re.enter(q),le&&fn(v,null,D,"mounted")},$)},T=(v,E,P,D,$)=>{if(P&&h(v,P),D)for(let L=0;L<D.length;L++)h(v,D[L]);if($){let L=$.subTree;if(E===L||Em(L.type)&&(L.ssContent===E||L.ssFallback===E)){const z=$.vnode;T(v,z,z.scopeId,z.slotScopeIds,$.parent)}}},I=(v,E,P,D,$,L,z,Z,q=0)=>{for(let F=q;F<v.length;F++){const se=v[F]=Z?Gr(v[F]):hr(v[F]);m(null,se,E,P,D,$,L,z,Z)}},W=(v,E,P,D,$,L,z)=>{const Z=E.el=v.el;let{patchFlag:q,dynamicChildren:F,dirs:se}=E;q|=v.patchFlag&16;const G=v.props||Re,re=E.props||Re;let le;if(P&&hn(P,!1),(le=re.onVnodeBeforeUpdate)&&lr(le,P,E,v),se&&fn(E,v,P,"beforeUpdate"),P&&hn(P,!0),(G.innerHTML&&re.innerHTML==null||G.textContent&&re.textContent==null)&&c(Z,""),F?Y(v.dynamicChildren,F,Z,P,D,Vo(E,$),L):z||U(v,E,Z,null,P,D,Vo(E,$),L,!1),q>0){if(q&16)k(Z,G,re,P,$);else if(q&2&&G.class!==re.class&&a(Z,"class",null,re.class,$),q&4&&a(Z,"style",G.style,re.style,$),q&8){const ye=E.dynamicProps;for(let ke=0;ke<ye.length;ke++){const Ae=ye[ke],Et=G[Ae],_t=re[Ae];(_t!==Et||Ae==="value")&&a(Z,Ae,Et,_t,$,P)}}q&1&&v.children!==E.children&&c(Z,E.children)}else!z&&F==null&&k(Z,G,re,P,$);((le=re.onVnodeUpdated)||se)&&Pt(()=>{le&&lr(le,P,E,v),se&&fn(E,v,P,"updated")},D)},Y=(v,E,P,D,$,L,z)=>{for(let Z=0;Z<E.length;Z++){const q=v[Z],F=E[Z],se=q.el&&(q.type===Ct||!Is(q,F)||q.shapeFlag&70)?d(q.el):P;m(q,F,se,null,D,$,L,z,!0)}},k=(v,E,P,D,$)=>{if(E!==P){if(E!==Re)for(const L in E)!Zs(L)&&!(L in P)&&a(v,L,E[L],null,$,D);for(const L in P){if(Zs(L))continue;const z=P[L],Z=E[L];z!==Z&&L!=="value"&&a(v,L,Z,z,$,D)}"value"in P&&a(v,"value",E.value,P.value,$)}},A=(v,E,P,D,$,L,z,Z,q)=>{const F=E.el=v?v.el:o(""),se=E.anchor=v?v.anchor:o("");let{patchFlag:G,dynamicChildren:re,slotScopeIds:le}=E;le&&(Z=Z?Z.concat(le):le),v==null?(n(F,P,D),n(se,P,D),I(E.children||[],P,se,$,L,z,Z,q)):G>0&&G&64&&re&&v.dynamicChildren?(Y(v.dynamicChildren,re,P,$,L,z,Z),(E.key!=null||$&&E===$.subTree)&&_m(v,E,!0)):U(v,E,P,se,$,L,z,Z,q)},M=(v,E,P,D,$,L,z,Z,q)=>{E.slotScopeIds=Z,v==null?E.shapeFlag&512?$.ctx.activate(E,P,D,z,q):R(E,P,D,$,L,z,q):C(v,E,q)},R=(v,E,P,D,$,L,z)=>{const Z=v.component=Tb(v,D,$);if(tm(v)&&(Z.ctx.renderer=Er),Ib(Z,!1,z),Z.asyncDep){if($&&$.registerDep(Z,B,z),!v.el){const q=Z.subTree=Nr(Pn);_(null,q,E,P)}}else B(Z,v,E,P,$,L,z)},C=(v,E,P)=>{const D=E.component=v.component;if(yb(v,E,P))if(D.asyncDep&&!D.asyncResolved){N(D,E,P);return}else D.next=E,D.update();else E.el=v.el,D.vnode=E},B=(v,E,P,D,$,L,z)=>{const Z=()=>{if(v.isMounted){let{next:G,bu:re,u:le,parent:ye,vnode:ke}=v;{const ir=ym(v);if(ir){G&&(G.el=ke.el,N(v,G,z)),ir.asyncDep.then(()=>{v.isUnmounted||Z()});return}}let Ae=G,Et;hn(v,!1),G?(G.el=ke.el,N(v,G,z)):G=ke,re&&_i(re),(Et=G.props&&G.props.onVnodeBeforeUpdate)&&lr(Et,ye,G,ke),hn(v,!0);const _t=Ld(v),ar=v.subTree;v.subTree=_t,m(ar,_t,d(ar.el),Ut(ar),v,$,L),G.el=_t.el,Ae===null&&bb(v,_t.el),le&&Pt(le,$),(Et=G.props&&G.props.onVnodeUpdated)&&Pt(()=>lr(Et,ye,G,ke),$)}else{let G;const{el:re,props:le}=E,{bm:ye,m:ke,parent:Ae,root:Et,type:_t}=v,ar=Ws(E);hn(v,!1),ye&&_i(ye),!ar&&(G=le&&le.onVnodeBeforeMount)&&lr(G,Ae,E),hn(v,!0);{Et.ce&&Et.ce._injectChildStyle(_t);const ir=v.subTree=Ld(v);m(null,ir,P,D,v,$,L),E.el=ir.el}if(ke&&Pt(ke,$),!ar&&(G=le&&le.onVnodeMounted)){const ir=E;Pt(()=>lr(G,Ae,ir),$)}(E.shapeFlag&256||Ae&&Ws(Ae.vnode)&&Ae.vnode.shapeFlag&256)&&v.a&&Pt(v.a,$),v.isMounted=!0,E=P=D=null}};v.scope.on();const q=v.effect=new Cp(Z);v.scope.off();const F=v.update=q.run.bind(q),se=v.job=q.runIfDirty.bind(q);se.i=v,se.id=v.uid,q.scheduler=()=>Oc(se),hn(v,!0),F()},N=(v,E,P)=>{E.component=v;const D=v.vnode.props;v.vnode=E,v.next=null,rb(v,E.props,D,P),ib(v,E.children,P),un(),Td(v),cn()},U=(v,E,P,D,$,L,z,Z,q=!1)=>{const F=v&&v.children,se=v?v.shapeFlag:0,G=E.children,{patchFlag:re,shapeFlag:le}=E;if(re>0){if(re&128){ne(F,G,P,D,$,L,z,Z,q);return}else if(re&256){H(F,G,P,D,$,L,z,Z,q);return}}le&8?(se&16&&gt(F,$,L),G!==F&&c(P,G)):se&16?le&16?ne(F,G,P,D,$,L,z,Z,q):gt(F,$,L,!0):(se&8&&c(P,""),le&16&&I(G,P,D,$,L,z,Z,q))},H=(v,E,P,D,$,L,z,Z,q)=>{v=v||Xn,E=E||Xn;const F=v.length,se=E.length,G=Math.min(F,se);let re;for(re=0;re<G;re++){const le=E[re]=q?Gr(E[re]):hr(E[re]);m(v[re],le,P,null,$,L,z,Z,q)}F>se?gt(v,$,L,!0,!1,G):I(E,P,D,$,L,z,Z,q,G)},ne=(v,E,P,D,$,L,z,Z,q)=>{let F=0;const se=E.length;let G=v.length-1,re=se-1;for(;F<=G&&F<=re;){const le=v[F],ye=E[F]=q?Gr(E[F]):hr(E[F]);if(Is(le,ye))m(le,ye,P,null,$,L,z,Z,q);else break;F++}for(;F<=G&&F<=re;){const le=v[G],ye=E[re]=q?Gr(E[re]):hr(E[re]);if(Is(le,ye))m(le,ye,P,null,$,L,z,Z,q);else break;G--,re--}if(F>G){if(F<=re){const le=re+1,ye=le<se?E[le].el:D;for(;F<=re;)m(null,E[F]=q?Gr(E[F]):hr(E[F]),P,ye,$,L,z,Z,q),F++}}else if(F>re)for(;F<=G;)te(v[F],$,L,!0),F++;else{const le=F,ye=F,ke=new Map;for(F=ye;F<=re;F++){const St=E[F]=q?Gr(E[F]):hr(E[F]);St.key!=null&&ke.set(St.key,F)}let Ae,Et=0;const _t=re-ye+1;let ar=!1,ir=0;const Ps=new Array(_t);for(F=0;F<_t;F++)Ps[F]=0;for(F=le;F<=G;F++){const St=v[F];if(Et>=_t){te(St,$,L,!0);continue}let or;if(St.key!=null)or=ke.get(St.key);else for(Ae=ye;Ae<=re;Ae++)if(Ps[Ae-ye]===0&&Is(St,E[Ae])){or=Ae;break}or===void 0?te(St,$,L,!0):(Ps[or-ye]=F+1,or>=ir?ir=or:ar=!0,m(St,E[or],P,null,$,L,z,Z,q),Et++)}const Ed=ar?cb(Ps):Xn;for(Ae=Ed.length-1,F=_t-1;F>=0;F--){const St=ye+F,or=E[St],Sd=St+1<se?E[St+1].el:D;Ps[F]===0?m(null,or,P,Sd,$,L,z,Z,q):ar&&(Ae<0||F!==Ed[Ae]?ce(or,P,Sd,2):Ae--)}}},ce=(v,E,P,D,$=null)=>{const{el:L,type:z,transition:Z,children:q,shapeFlag:F}=v;if(F&6){ce(v.component.subTree,E,P,D);return}if(F&128){v.suspense.move(E,P,D);return}if(F&64){z.move(v,E,P,Er);return}if(z===Ct){n(L,E,P);for(let G=0;G<q.length;G++)ce(q[G],E,P,D);n(v.anchor,E,P);return}if(z===zo){y(v,E,P);return}if(D!==2&&F&1&&Z)if(D===0)Z.beforeEnter(L),n(L,E,P),Pt(()=>Z.enter(L),$);else{const{leave:G,delayLeave:re,afterLeave:le}=Z,ye=()=>n(L,E,P),ke=()=>{G(L,()=>{ye(),le&&le()})};re?re(L,ye,ke):ke()}else n(L,E,P)},te=(v,E,P,D=!1,$=!1)=>{const{type:L,props:z,ref:Z,children:q,dynamicChildren:F,shapeFlag:se,patchFlag:G,dirs:re,cacheIndex:le}=v;if(G===-2&&($=!1),Z!=null&&$i(Z,null,P,v,!0),le!=null&&(E.renderCache[le]=void 0),se&256){E.ctx.deactivate(v);return}const ye=se&1&&re,ke=!Ws(v);let Ae;if(ke&&(Ae=z&&z.onVnodeBeforeUnmount)&&lr(Ae,E,v),se&6)$e(v.component,P,D);else{if(se&128){v.suspense.unmount(P,D);return}ye&&fn(v,null,E,"beforeUnmount"),se&64?v.type.remove(v,E,P,Er,D):F&&!F.hasOnce&&(L!==Ct||G>0&&G&64)?gt(F,E,P,!1,!0):(L===Ct&&G&384||!$&&se&16)&&gt(q,E,P),D&&ve(v)}(ke&&(Ae=z&&z.onVnodeUnmounted)||ye)&&Pt(()=>{Ae&&lr(Ae,E,v),ye&&fn(v,null,E,"unmounted")},P)},ve=v=>{const{type:E,el:P,anchor:D,transition:$}=v;if(E===Ct){Me(P,D);return}if(E===zo){w(v);return}const L=()=>{s(P),$&&!$.persisted&&$.afterLeave&&$.afterLeave()};if(v.shapeFlag&1&&$&&!$.persisted){const{leave:z,delayLeave:Z}=$,q=()=>z(P,L);Z?Z(v.el,L,q):q()}else L()},Me=(v,E)=>{let P;for(;v!==E;)P=f(v),s(v),v=P;s(E)},$e=(v,E,P)=>{const{bum:D,scope:$,job:L,subTree:z,um:Z,m:q,a:F}=v;jd(q),jd(F),D&&_i(D),$.stop(),L&&(L.flags|=8,te(z,v,E,P)),Z&&Pt(Z,E),Pt(()=>{v.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&v.asyncDep&&!v.asyncResolved&&v.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},gt=(v,E,P,D=!1,$=!1,L=0)=>{for(let z=L;z<v.length;z++)te(v[z],E,P,D,$)},Ut=v=>{if(v.shapeFlag&6)return Ut(v.component.subTree);if(v.shapeFlag&128)return v.suspense.next();const E=f(v.anchor||v.el),P=E&&E[Cy];return P?f(P):E};let Nn=!1;const jn=(v,E,P)=>{v==null?E._vnode&&te(E._vnode,null,null,!0):m(E._vnode||null,v,E,null,null,null,P),E._vnode=v,Nn||(Nn=!0,Td(),Xp(),Nn=!1)},Er={p:m,um:te,m:ce,r:ve,mt:R,mc:I,pc:U,pbc:Y,n:Ut,o:r};return{render:jn,hydrate:void 0,createApp:Qy(jn)}}function Vo({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function hn({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function ub(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function _m(r,e,t=!1){const n=r.children,s=e.children;if(ie(n)&&ie(s))for(let a=0;a<n.length;a++){const i=n[a];let o=s[a];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[a]=Gr(s[a]),o.el=i.el),!t&&o.patchFlag!==-2&&_m(i,o)),o.type===fo&&(o.el=i.el)}}function cb(r){const e=r.slice(),t=[0];let n,s,a,i,o;const l=r.length;for(n=0;n<l;n++){const u=r[n];if(u!==0){if(s=t[t.length-1],r[s]<u){e[n]=s,t.push(n);continue}for(a=0,i=t.length-1;a<i;)o=a+i>>1,r[t[o]]<u?a=o+1:i=o;u<r[t[a]]&&(a>0&&(e[n]=t[a-1]),t[a]=n)}}for(a=t.length,i=t[a-1];a-- >0;)t[a]=i,i=e[i];return t}function ym(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:ym(e)}function jd(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const db=Symbol.for("v-scx"),fb=()=>yi(db);function It(r,e,t){return bm(r,e,t)}function bm(r,e,t=Re){const{immediate:n,deep:s,flush:a,once:i}=t,o=ft({},t),l=e&&n||!e&&a!=="post";let u;if(la){if(a==="sync"){const h=fb();u=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=gr,h.resume=gr,h.pause=gr,h}}const c=dt;o.call=(h,p,m)=>br(h,c,p,m);let d=!1;a==="post"?o.scheduler=h=>{Pt(h,c&&c.suspense)}:a!=="sync"&&(d=!0,o.scheduler=(h,p)=>{p?h():Oc(h)}),o.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,c&&(h.id=c.uid,h.i=c))};const f=Py(r,e,o);return la&&(u?u.push(f):l&&f()),f}function hb(r,e,t){const n=this.proxy,s=Fe(r)?r.includes(".")?wm(n,r):()=>n[r]:r.bind(n,n);let a;fe(e)?a=e:(a=e.handler,t=e);const i=$a(this),o=bm(s,a.bind(n),t);return i(),o}function wm(r,e){const t=e.split(".");return()=>{let n=r;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const pb=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${en(e)}Modifiers`]||r[`${$n(e)}Modifiers`];function mb(r,e,...t){if(r.isUnmounted)return;const n=r.vnode.props||Re;let s=t;const a=e.startsWith("update:"),i=a&&pb(n,e.slice(7));i&&(i.trim&&(s=t.map(c=>Fe(c)?c.trim():c)),i.number&&(s=t.map(Ii)));let o,l=n[o=Fo(e)]||n[o=Fo(en(e))];!l&&a&&(l=n[o=Fo($n(e))]),l&&br(l,r,6,s);const u=n[o+"Once"];if(u){if(!r.emitted)r.emitted={};else if(r.emitted[o])return;r.emitted[o]=!0,br(u,r,6,s)}}function vm(r,e,t=!1){const n=e.emitsCache,s=n.get(r);if(s!==void 0)return s;const a=r.emits;let i={},o=!1;if(!fe(r)){const l=u=>{const c=vm(u,e,!0);c&&(o=!0,ft(i,c))};!t&&e.mixins.length&&e.mixins.forEach(l),r.extends&&l(r.extends),r.mixins&&r.mixins.forEach(l)}return!a&&!o?(Ne(r)&&n.set(r,null),null):(ie(a)?a.forEach(l=>i[l]=null):ft(i,a),Ne(r)&&n.set(r,i),i)}function co(r,e){return!r||!so(e)?!1:(e=e.slice(2).replace(/Once$/,""),Se(r,e[0].toLowerCase()+e.slice(1))||Se(r,$n(e))||Se(r,e))}function Ld(r){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[a],slots:i,attrs:o,emit:l,render:u,renderCache:c,props:d,data:f,setupState:h,ctx:p,inheritAttrs:m}=r,g=Ci(r);let _,b;try{if(t.shapeFlag&4){const w=s||n,S=w;_=hr(u.call(S,w,c,d,h,f,p)),b=o}else{const w=e;_=hr(w.length>1?w(d,{attrs:o,slots:i,emit:l}):w(d,null)),b=e.props?o:gb(o)}}catch(w){Js.length=0,lo(w,r,1),_=Nr(Pn)}let y=_;if(b&&m!==!1){const w=Object.keys(b),{shapeFlag:S}=y;w.length&&S&7&&(a&&w.some(dc)&&(b=_b(b,a)),y=os(y,b,!1,!0))}return t.dirs&&(y=os(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(t.dirs):t.dirs),t.transition&&Ac(y,t.transition),_=y,Ci(g),_}const gb=r=>{let e;for(const t in r)(t==="class"||t==="style"||so(t))&&((e||(e={}))[t]=r[t]);return e},_b=(r,e)=>{const t={};for(const n in r)(!dc(n)||!(n.slice(9)in e))&&(t[n]=r[n]);return t};function yb(r,e,t){const{props:n,children:s,component:a}=r,{props:i,children:o,patchFlag:l}=e,u=a.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?Md(n,i,u):!!i;if(l&8){const c=e.dynamicProps;for(let d=0;d<c.length;d++){const f=c[d];if(i[f]!==n[f]&&!co(u,f))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:n===i?!1:n?i?Md(n,i,u):!0:!!i;return!1}function Md(r,e,t){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let s=0;s<n.length;s++){const a=n[s];if(e[a]!==r[a]&&!co(t,a))return!0}return!1}function bb({vnode:r,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=t,e=e.parent;else break}}const Em=r=>r.__isSuspense;function wb(r,e){e&&e.pendingBranch?ie(r)?e.effects.push(...r):e.effects.push(r):Ry(r)}const Ct=Symbol.for("v-fgt"),fo=Symbol.for("v-txt"),Pn=Symbol.for("v-cmt"),zo=Symbol.for("v-stc"),Js=[];let $t=null;function Be(r=!1){Js.push($t=r?null:[])}function vb(){Js.pop(),$t=Js[Js.length-1]||null}let oa=1;function Dd(r,e=!1){oa+=r,r<0&&$t&&e&&($t.hasOnce=!0)}function Sm(r){return r.dynamicChildren=oa>0?$t||Xn:null,vb(),oa>0&&$t&&$t.push(r),r}function Ze(r,e,t,n,s,a){return Sm(K(r,e,t,n,s,a,!0))}function Eb(r,e,t,n,s){return Sm(Nr(r,e,t,n,s,!0))}function xm(r){return r?r.__v_isVNode===!0:!1}function Is(r,e){return r.type===e.type&&r.key===e.key}const Om=({key:r})=>r??null,bi=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?Fe(r)||st(r)||fe(r)?{i:Dt,r,k:e,f:!!t}:r:null);function K(r,e=null,t=null,n=0,s=null,a=r===Ct?0:1,i=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&Om(e),ref:e&&bi(e),scopeId:Qp,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Dt};return o?(Tc(l,t),a&128&&r.normalize(l)):t&&(l.shapeFlag|=Fe(t)?8:16),oa>0&&!i&&$t&&(l.patchFlag>0||a&6)&&l.patchFlag!==32&&$t.push(l),l}const Nr=Sb;function Sb(r,e=null,t=null,n=0,s=null,a=!1){if((!r||r===Vy)&&(r=Pn),xm(r)){const o=os(r,e,!0);return t&&Tc(o,t),oa>0&&!a&&$t&&(o.shapeFlag&6?$t[$t.indexOf(r)]=o:$t.push(o)),o.patchFlag=-2,o}if($b(r)&&(r=r.__vccOpts),e){e=xb(e);let{class:o,style:l}=e;o&&!Fe(o)&&(e.class=na(o)),Ne(l)&&(Sc(l)&&!ie(l)&&(l=ft({},l)),e.style=pc(l))}const i=Fe(r)?1:Em(r)?128:$y(r)?64:Ne(r)?4:fe(r)?2:0;return K(r,e,t,n,s,i,a,!0)}function xb(r){return r?Sc(r)||cm(r)?ft({},r):r:null}function os(r,e,t=!1,n=!1){const{props:s,ref:a,patchFlag:i,children:o,transition:l}=r,u=e?Ob(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:r.type,props:u,key:u&&Om(u),ref:e&&e.ref?t&&a?ie(a)?a.concat(bi(e)):[a,bi(e)]:bi(e):a,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:o,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==Ct?i===-1?16:i|16:i,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:l,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&os(r.ssContent),ssFallback:r.ssFallback&&os(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return l&&n&&Ac(c,l.clone(c)),c}function zr(r=" ",e=0){return Nr(fo,null,r,e)}function xr(r="",e=!1){return e?(Be(),Eb(Pn,null,r)):Nr(Pn,null,r)}function hr(r){return r==null||typeof r=="boolean"?Nr(Pn):ie(r)?Nr(Ct,null,r.slice()):xm(r)?Gr(r):Nr(fo,null,String(r))}function Gr(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:os(r)}function Tc(r,e){let t=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(ie(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),Tc(r,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!cm(e)?e._ctx=Dt:s===3&&Dt&&(Dt.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else fe(e)?(e={default:e,_ctx:Dt},t=32):(e=String(e),n&64?(t=16,e=[zr(e)]):t=8);r.children=e,r.shapeFlag|=t}function Ob(...r){const e={};for(let t=0;t<r.length;t++){const n=r[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=na([e.class,n.class]));else if(s==="style")e.style=pc([e.style,n.style]);else if(so(s)){const a=e[s],i=n[s];i&&a!==i&&!(ie(a)&&a.includes(i))&&(e[s]=a?[].concat(a,i):i)}else s!==""&&(e[s]=n[s])}return e}function lr(r,e,t,n=null){br(r,e,7,[t,n])}const Ab=om();let Pb=0;function Tb(r,e,t){const n=r.type,s=(e?e.appContext:r.appContext)||Ab,a={uid:Pb++,vnode:r,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Q_(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:fm(n,s),emitsOptions:vm(n,s),emit:null,emitted:null,propsDefaults:Re,inheritAttrs:n.inheritAttrs,ctx:Re,data:Re,props:Re,attrs:Re,slots:Re,refs:Re,setupState:Re,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=mb.bind(null,a),r.ce&&r.ce(a),a}let dt=null,ji,Cu;{const r=io(),e=(t,n)=>{let s;return(s=r[t])||(s=r[t]=[]),s.push(n),a=>{s.length>1?s.forEach(i=>i(a)):s[0](a)}};ji=e("__VUE_INSTANCE_SETTERS__",t=>dt=t),Cu=e("__VUE_SSR_SETTERS__",t=>la=t)}const $a=r=>{const e=dt;return ji(r),r.scope.on(),()=>{r.scope.off(),ji(e)}},Fd=()=>{dt&&dt.scope.off(),ji(null)};function Am(r){return r.vnode.shapeFlag&4}let la=!1;function Ib(r,e=!1,t=!1){e&&Cu(e);const{props:n,children:s}=r.vnode,a=Am(r);tb(r,n,a,e),ab(r,s,t);const i=a?Rb(r,e):void 0;return e&&Cu(!1),i}function Rb(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,zy);const{setup:n}=t;if(n){un();const s=r.setupContext=n.length>1?Cb(r):null,a=$a(r),i=Ca(n,r,0,[r.props,s]),o=xp(i);if(cn(),a(),(o||r.sp)&&!Ws(r)&&em(r),o){if(i.then(Fd,Fd),e)return i.then(l=>{Ud(r,l)}).catch(l=>{lo(l,r,0)});r.asyncDep=i}else Ud(r,i)}else Pm(r)}function Ud(r,e,t){fe(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Ne(e)&&(r.setupState=Gp(e)),Pm(r)}function Pm(r,e,t){const n=r.type;r.render||(r.render=n.render||gr);{const s=$a(r);un();try{Wy(r)}finally{cn(),s()}}}const kb={get(r,e){return tt(r,"get",""),r[e]}};function Cb(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,kb),slots:r.slots,emit:r.emit,expose:e}}function ho(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(Gp(wy(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in Gs)return Gs[t](r)},has(e,t){return t in e||t in Gs}})):r.proxy}function $b(r){return fe(r)&&"__vccOpts"in r}const $u=(r,e)=>Oy(r,e,la),Nb="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Nu;const Bd=typeof window<"u"&&window.trustedTypes;if(Bd)try{Nu=Bd.createPolicy("vue",{createHTML:r=>r})}catch{}const Tm=Nu?r=>Nu.createHTML(r):r=>r,jb="http://www.w3.org/2000/svg",Lb="http://www.w3.org/1998/Math/MathML",Ir=typeof document<"u"?document:null,Hd=Ir&&Ir.createElement("template"),Mb={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,n)=>{const s=e==="svg"?Ir.createElementNS(jb,r):e==="mathml"?Ir.createElementNS(Lb,r):t?Ir.createElement(r,{is:t}):Ir.createElement(r);return r==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:r=>Ir.createTextNode(r),createComment:r=>Ir.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>Ir.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,n,s,a){const i=t?t.previousSibling:e.lastChild;if(s&&(s===a||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===a||!(s=s.nextSibling)););else{Hd.innerHTML=Tm(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const o=Hd.content;if(n==="svg"||n==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}e.insertBefore(o,t)}return[i?i.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Db=Symbol("_vtc");function Fb(r,e,t){const n=r[Db];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const qd=Symbol("_vod"),Ub=Symbol("_vsh"),Bb=Symbol(""),Hb=/(^|;)\s*display\s*:/;function qb(r,e,t){const n=r.style,s=Fe(t);let a=!1;if(t&&!s){if(e)if(Fe(e))for(const i of e.split(";")){const o=i.slice(0,i.indexOf(":")).trim();t[o]==null&&wi(n,o,"")}else for(const i in e)t[i]==null&&wi(n,i,"");for(const i in t)i==="display"&&(a=!0),wi(n,i,t[i])}else if(s){if(e!==t){const i=n[Bb];i&&(t+=";"+i),n.cssText=t,a=Hb.test(t)}}else e&&r.removeAttribute("style");qd in r&&(r[qd]=a?n.display:"",r[Ub]&&(n.display="none"))}const Zd=/\s*!important$/;function wi(r,e,t){if(ie(t))t.forEach(n=>wi(r,e,n));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const n=Zb(r,e);Zd.test(t)?r.setProperty($n(n),t.replace(Zd,""),"important"):r[n]=t}}const Vd=["Webkit","Moz","ms"],Wo={};function Zb(r,e){const t=Wo[e];if(t)return t;let n=en(e);if(n!=="filter"&&n in r)return Wo[e]=n;n=Pp(n);for(let s=0;s<Vd.length;s++){const a=Vd[s]+n;if(a in r)return Wo[e]=a}return e}const zd="http://www.w3.org/1999/xlink";function Wd(r,e,t,n,s,a=X_(e)){n&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(zd,e.slice(6,e.length)):r.setAttributeNS(zd,e,t):t==null||a&&!Ip(t)?r.removeAttribute(e):r.setAttribute(e,a?"":yr(t)?String(t):t)}function Gd(r,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?Tm(t):t);return}const a=r.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){const o=a==="OPTION"?r.getAttribute("value")||"":r.value,l=t==null?r.type==="checkbox"?"on":"":String(t);(o!==l||!("_value"in r))&&(r.value=l),t==null&&r.removeAttribute(e),r._value=t;return}let i=!1;if(t===""||t==null){const o=typeof r[e];o==="boolean"?t=Ip(t):t==null&&o==="string"?(t="",i=!0):o==="number"&&(t=0,i=!0)}try{r[e]=t}catch{}i&&r.removeAttribute(s||e)}function Xr(r,e,t,n){r.addEventListener(e,t,n)}function Vb(r,e,t,n){r.removeEventListener(e,t,n)}const Jd=Symbol("_vei");function zb(r,e,t,n,s=null){const a=r[Jd]||(r[Jd]={}),i=a[e];if(n&&i)i.value=n;else{const[o,l]=Wb(e);if(n){const u=a[e]=Kb(n,s);Xr(r,o,u,l)}else i&&(Vb(r,o,i,l),a[e]=void 0)}}const Kd=/(?:Once|Passive|Capture)$/;function Wb(r){let e;if(Kd.test(r)){e={};let n;for(;n=r.match(Kd);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):$n(r.slice(2)),e]}let Go=0;const Gb=Promise.resolve(),Jb=()=>Go||(Gb.then(()=>Go=0),Go=Date.now());function Kb(r,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;br(Xb(n,t.value),e,5,[n])};return t.value=r,t.attached=Jb(),t}function Xb(r,e){if(ie(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const Xd=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,Yb=(r,e,t,n,s,a)=>{const i=s==="svg";e==="class"?Fb(r,n,i):e==="style"?qb(r,t,n):so(e)?dc(e)||zb(r,e,t,n,a):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Qb(r,e,n,i))?(Gd(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Wd(r,e,n,i,a,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!Fe(n))?Gd(r,en(e),n,a,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),Wd(r,e,n,i))};function Qb(r,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&Xd(e)&&fe(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=r.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Xd(e)&&Fe(t)?!1:e in r}const ls=r=>{const e=r.props["onUpdate:modelValue"]||!1;return ie(e)?t=>_i(e,t):e};function ew(r){r.target.composing=!0}function Yd(r){const e=r.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const jr=Symbol("_assign"),Jo={created(r,{modifiers:{lazy:e,trim:t,number:n}},s){r[jr]=ls(s);const a=n||s.props&&s.props.type==="number";Xr(r,e?"change":"input",i=>{if(i.target.composing)return;let o=r.value;t&&(o=o.trim()),a&&(o=Ii(o)),r[jr](o)}),t&&Xr(r,"change",()=>{r.value=r.value.trim()}),e||(Xr(r,"compositionstart",ew),Xr(r,"compositionend",Yd),Xr(r,"change",Yd))},mounted(r,{value:e}){r.value=e??""},beforeUpdate(r,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:a}},i){if(r[jr]=ls(i),r.composing)return;const o=(a||r.type==="number")&&!/^0\d/.test(r.value)?Ii(r.value):r.value,l=e??"";o!==l&&(document.activeElement===r&&r.type!=="range"&&(n&&e===t||s&&r.value.trim()===l)||(r.value=l))}},Ja={deep:!0,created(r,e,t){r[jr]=ls(t),Xr(r,"change",()=>{const n=r._modelValue,s=ua(r),a=r.checked,i=r[jr];if(ie(n)){const o=mc(n,s),l=o!==-1;if(a&&!l)i(n.concat(s));else if(!a&&l){const u=[...n];u.splice(o,1),i(u)}}else if(ms(n)){const o=new Set(n);a?o.add(s):o.delete(s),i(o)}else i(Im(r,a))})},mounted:Qd,beforeUpdate(r,e,t){r[jr]=ls(t),Qd(r,e,t)}};function Qd(r,{value:e,oldValue:t},n){r._modelValue=e;let s;if(ie(e))s=mc(e,n.props.value)>-1;else if(ms(e))s=e.has(n.props.value);else{if(e===t)return;s=ka(e,Im(r,!0))}r.checked!==s&&(r.checked=s)}const tw={deep:!0,created(r,{value:e,modifiers:{number:t}},n){const s=ms(e);Xr(r,"change",()=>{const a=Array.prototype.filter.call(r.options,i=>i.selected).map(i=>t?Ii(ua(i)):ua(i));r[jr](r.multiple?s?new Set(a):a:a[0]),r._assigning=!0,xc(()=>{r._assigning=!1})}),r[jr]=ls(n)},mounted(r,{value:e}){ef(r,e)},beforeUpdate(r,e,t){r[jr]=ls(t)},updated(r,{value:e}){r._assigning||ef(r,e)}};function ef(r,e){const t=r.multiple,n=ie(e);if(!(t&&!n&&!ms(e))){for(let s=0,a=r.options.length;s<a;s++){const i=r.options[s],o=ua(i);if(t)if(n){const l=typeof o;l==="string"||l==="number"?i.selected=e.some(u=>String(u)===String(o)):i.selected=mc(e,o)>-1}else i.selected=e.has(o);else if(ka(ua(i),e)){r.selectedIndex!==s&&(r.selectedIndex=s);return}}!t&&r.selectedIndex!==-1&&(r.selectedIndex=-1)}}function ua(r){return"_value"in r?r._value:r.value}function Im(r,e){const t=e?"_trueValue":"_falseValue";return t in r?r[t]:e}const rw=ft({patchProp:Yb},Mb);let tf;function nw(){return tf||(tf=ob(rw))}const sw=(...r)=>{const e=nw().createApp(...r),{mount:t}=e;return e.mount=n=>{const s=iw(n);if(!s)return;const a=e._component;!fe(a)&&!a.render&&!a.template&&(a.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=t(s,!1,aw(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},e};function aw(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function iw(r){return Fe(r)?document.querySelector(r):r}const ju="RFC3986",Lu={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},ow="RFC1738",lw=Array.isArray,ur=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),Ko=1024,uw=(r,e,t,n,s)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=Ko){const l=a.length>=Ko?a.slice(o,o+Ko):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===ow&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=ur[d];continue}if(d<2048){u[u.length]=ur[192|d>>6]+ur[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=ur[224|d>>12]+ur[128|d>>6&63]+ur[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=ur[240|d>>18]+ur[128|d>>12&63]+ur[128|d>>6&63]+ur[128|d&63]}i+=u.join("")}return i};function cw(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function rf(r,e){if(lw(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const dw=Object.prototype.hasOwnProperty,Rm={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},dr=Array.isArray,fw=Array.prototype.push,km=function(r,e){fw.apply(r,dr(e)?e:[e])},hw=Date.prototype.toISOString,He={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:uw,encodeValuesOnly:!1,format:ju,formatter:Lu[ju],indices:!1,serializeDate(r){return hw.call(r)},skipNulls:!1,strictNullHandling:!1};function pw(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Xo={};function Cm(r,e,t,n,s,a,i,o,l,u,c,d,f,h,p,m,g,_){let b=r,y=_,w=0,S=!1;for(;(y=y.get(Xo))!==void 0&&!S;){const Y=y.get(r);if(w+=1,typeof Y<"u"){if(Y===w)throw new RangeError("Cyclic object value");S=!0}typeof y.get(Xo)>"u"&&(w=0)}if(typeof u=="function"?b=u(e,b):b instanceof Date?b=f==null?void 0:f(b):t==="comma"&&dr(b)&&(b=rf(b,function(Y){return Y instanceof Date?f==null?void 0:f(Y):Y})),b===null){if(a)return l&&!m?l(e,He.encoder,g,"key",h):e;b=""}if(pw(b)||cw(b)){if(l){const Y=m?e:l(e,He.encoder,g,"key",h);return[(p==null?void 0:p(Y))+"="+(p==null?void 0:p(l(b,He.encoder,g,"value",h)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(b)))]}const x=[];if(typeof b>"u")return x;let T;if(t==="comma"&&dr(b))m&&l&&(b=rf(b,l)),T=[{value:b.length>0?b.join(",")||null:void 0}];else if(dr(u))T=u;else{const Y=Object.keys(b);T=c?Y.sort(c):Y}const I=o?String(e).replace(/\./g,"%2E"):String(e),W=n&&dr(b)&&b.length===1?I+"[]":I;if(s&&dr(b)&&b.length===0)return W+"[]";for(let Y=0;Y<T.length;++Y){const k=T[Y],A=typeof k=="object"&&typeof k.value<"u"?k.value:b[k];if(i&&A===null)continue;const M=d&&o?k.replace(/\./g,"%2E"):k,R=dr(b)?typeof t=="function"?t(W,M):W:W+(d?"."+M:"["+M+"]");_.set(r,w);const C=new WeakMap;C.set(Xo,_),km(x,Cm(A,R,t,n,s,a,i,o,t==="comma"&&m&&dr(b)?null:l,u,c,d,f,h,p,m,g,C))}return x}function mw(r=He){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||He.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=ju;if(typeof r.format<"u"){if(!dw.call(Lu,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Lu[t];let s=He.filter;(typeof r.filter=="function"||dr(r.filter))&&(s=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in Rm?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=He.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:He.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:He.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:He.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:He.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?He.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:He.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:He.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:He.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:He.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:He.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:He.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:He.strictNullHandling}}function gw(r,e={}){let t=r;const n=mw(e);let s,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):dr(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Rm[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];n.skipNulls&&t[h]===null||km(i,Cm(t[h],h,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}const c=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const qn="4.90.0";let nf=!1,Ks,$m,Nm,Mu,jm,Lm,Mm,Dm,Fm;function _w(r,e={auto:!1}){if(nf)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Ks)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Ks}'\``);nf=e.auto,Ks=r.kind,$m=r.fetch,Nm=r.FormData,Mu=r.File,jm=r.ReadableStream,Lm=r.getMultipartRequestOptions,Mm=r.getDefaultAgent,Dm=r.fileFromPath,Fm=r.isFsReadStream}class yw{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function bw({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new yw(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Um=()=>{Ks||_w(bw(),{auto:!0})};Um();class ae extends Error{}class Qe extends ae{constructor(e,t,n,s){super(`${Qe.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new po({message:n,cause:Fu(t)});const a=t==null?void 0:t.error;return e===400?new Bm(e,a,n,s):e===401?new Hm(e,a,n,s):e===403?new qm(e,a,n,s):e===404?new Zm(e,a,n,s):e===409?new Vm(e,a,n,s):e===422?new zm(e,a,n,s):e===429?new Wm(e,a,n,s):e>=500?new Gm(e,a,n,s):new Qe(e,a,n,s)}}class Nt extends Qe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class po extends Qe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class mo extends po{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Bm extends Qe{}class Hm extends Qe{}class qm extends Qe{}class Zm extends Qe{}class Vm extends Qe{}class zm extends Qe{}class Wm extends Qe{}class Gm extends Qe{}class Jm extends ae{constructor(){super("Could not parse response content as the length limit was reached")}}class Km extends ae{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Ka=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},pn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ot;class go{constructor(){Ot.set(this,void 0),this.buffer=new Uint8Array,Ka(this,Ot,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let a;for(;(a=ww(this.buffer,pn(this,Ot,"f")))!=null;){if(a.carriage&&pn(this,Ot,"f")==null){Ka(this,Ot,a.index,"f");continue}if(pn(this,Ot,"f")!=null&&(a.index!==pn(this,Ot,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,pn(this,Ot,"f")-1))),this.buffer=this.buffer.slice(pn(this,Ot,"f")),Ka(this,Ot,null,"f");continue}const i=pn(this,Ot,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),Ka(this,Ot,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ae(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ae(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ae("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}Ot=new WeakMap;go.NEWLINE_CHARS=new Set([`
`,"\r"]);go.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ww(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function vw(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function Xm(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class pr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Ew(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new Qe(void 0,o.error,void 0,sg(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new Qe(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new pr(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new go,o=Xm(e);for await(const l of o)for(const u of i.decode(l))yield u;for(const l of i.flush())yield l}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new pr(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new pr(()=>s(e),this.controller),new pr(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new jm({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Ew(r,e){if(!r.body)throw e.abort(),new ae("Attempted to iterate over a response with no body");const t=new xw,n=new go,s=Xm(r.body);for await(const a of Sw(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Sw(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=vw(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class xw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Ow(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Ow(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const Ym=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Qm=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&_o(r),_o=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Aw=r=>Qm(r)||Ym(r)||Fm(r);async function eg(r,e,t){var s;if(r=await r,Qm(r))return r;if(Ym(r)){const a=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=_o(a)?[await a.arrayBuffer()]:[a];return new Mu(i,e,t)}const n=await Pw(r);if(e||(e=Iw(r)??"unknown_file"),!(t!=null&&t.type)){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new Mu(n,e,t)}async function Pw(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(_o(r))e.push(await r.arrayBuffer());else if(Rw(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Tw(r)}`);return e}function Tw(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Iw(r){var e;return Yo(r.name)||Yo(r.filename)||((e=Yo(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Yo=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Rw=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",sf=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",us=async r=>{const e=await kw(r.body);return Lm(e,r)},kw=async r=>{const e=new Nm;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Du(e,t,n))),e},Du=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Aw(t)){const n=await eg(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Du(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Du(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var rs={},Cw=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},$w=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Xa;Um();async function tg(r){var i;const{response:e}=r;if(r.options.stream)return ns("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):pr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return ns("response",e.status,e.url,e.headers,o),rg(o,e)}const a=await e.text();return ns("response",e.status,e.url,e.headers,a),a}function rg(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class yo extends Promise{constructor(e,t=tg){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new yo(this.responsePromise,async t=>rg(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Nw{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Qo("maxRetries",t),this.timeout=Qo("timeout",n),this.httpAgent=s,this.fetch=a??$m}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Fw(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${qw()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const a=s&&_o(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:sf(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(s,a);"timeout"in e&&Qo("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const c=e.httpAgent??this.httpAgent??Mm(u),d=e.timeout+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:e,headers:i,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:f,...c&&{agent:c},signal:e.signal??null},url:u,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return uf(a,i),uf(a,t),sf(e.body)&&Ks!=="node"&&delete a["content-type"],Qa(i,"x-stainless-retry-count")===void 0&&Qa(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),Qa(i,"x-stainless-timeout")===void 0&&Qa(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Qe.generate(e,t,n,s)}request(e,t=null){return new yo(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:n}),ns("request",i,n,a.headers),(d=n.signal)!=null&&d.aborted)throw new Nt;const l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(Fu);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new Nt;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new mo:new po({cause:u})}const c=sg(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const b=`retrying, ${t} attempts remaining`;return ns(`response (error; ${b})`,u.status,i,c),this.retryRequest(n,t,c)}const h=await u.text().catch(b=>Fu(b).message),p=Uw(h),m=p?void 0:h;throw ns(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new jw(this,n,e)}buildURL(e,t){const n=Hw(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ag(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new ae(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Na(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${qn}`}}class ng{constructor(e,t,n,s){Xa.set(this,void 0),Cw(this,Xa,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ae("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await $w(this,Xa,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Xa=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class jw extends yo{constructor(e,t,n){super(t,async s=>new n(e,s.response,await tg(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const sg=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Lw={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Je=r=>typeof r=="object"&&r!==null&&!ag(r)&&Object.keys(r).every(e=>ig(Lw,e)),Mw=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qn,"X-Stainless-OS":of(Deno.build.os),"X-Stainless-Arch":af(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qn,"X-Stainless-OS":of(process.platform),"X-Stainless-Arch":af(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Dw();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":qn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Dw(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const af=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",of=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let lf;const Fw=()=>lf??(lf=Mw()),Uw=r=>{try{return JSON.parse(r)}catch{return}},Bw=/^[a-z][a-z0-9+.-]*:/i,Hw=r=>Bw.test(r),Na=r=>new Promise(e=>setTimeout(e,r)),Qo=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ae(`${r} must be an integer`);if(e<0)throw new ae(`${r} must be a positive integer`);return e},Fu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Ya=r=>{var e,t,n,s;if(typeof process<"u")return((e=rs==null?void 0:rs[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function ag(r){if(!r)return!0;for(const e in r)return!1;return!0}function ig(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function uf(r,e){for(const t in e){if(!ig(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const cf=new Set(["authorization","api-key"]);function ns(r,...e){if(typeof process<"u"&&(rs==null?void 0:rs.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const a={...n,headers:{...n.headers}};for(const i in n.headers)cf.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(const a in n)cf.has(a.toLowerCase())&&(s??(s={...n}),s[a]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const qw=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Zw=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Vw=r=>typeof(r==null?void 0:r.get)=="function",Qa=(r,e)=>{var n;const t=e.toLowerCase();if(Vw(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),s]){const i=r.get(a);if(i)return i}}for(const[s,a]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function el(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class Ic extends ng{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class vt extends ng{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class _e{constructor(e){this._client=e}}let og=class extends _e{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,zw,{query:t,...n})}},bo=class extends _e{constructor(){super(...arguments),this.messages=new og(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/chat/completions",wo,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class wo extends vt{}class zw extends vt{}bo.ChatCompletionsPage=wo;bo.Messages=og;let vo=class extends _e{constructor(){super(...arguments),this.completions=new bo(this._client)}};vo.Completions=bo;vo.ChatCompletionsPage=wo;class lg extends _e{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class ug extends _e{create(e,t){return this._client.post("/audio/transcriptions",us({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class cg extends _e{create(e,t){return this._client.post("/audio/translations",us({body:e,...t,__metadata:{model:e.model}}))}}class ja extends _e{constructor(){super(...arguments),this.transcriptions=new ug(this._client),this.translations=new cg(this._client),this.speech=new lg(this._client)}}ja.Transcriptions=ug;ja.Translations=cg;ja.Speech=lg;class Rc extends _e{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/batches",kc,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class kc extends vt{}Rc.BatchesPage=kc;class Cc extends _e{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/assistants",$c,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class $c extends vt{}Cc.AssistantsPage=$c;function df(r){return typeof r.parse=="function"}const ss=r=>(r==null?void 0:r.role)==="assistant",dg=r=>(r==null?void 0:r.role)==="function",fg=r=>(r==null?void 0:r.role)==="tool";var zt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},je=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Uu,vi,Ei,js,Ls,Si,Ms,Pr,Ds,Li,Mi,Zn,hg;class Nc{constructor(){Uu.add(this),this.controller=new AbortController,vi.set(this,void 0),Ei.set(this,()=>{}),js.set(this,()=>{}),Ls.set(this,void 0),Si.set(this,()=>{}),Ms.set(this,()=>{}),Pr.set(this,{}),Ds.set(this,!1),Li.set(this,!1),Mi.set(this,!1),Zn.set(this,!1),zt(this,vi,new Promise((e,t)=>{zt(this,Ei,e,"f"),zt(this,js,t,"f")}),"f"),zt(this,Ls,new Promise((e,t)=>{zt(this,Si,e,"f"),zt(this,Ms,t,"f")}),"f"),je(this,vi,"f").catch(()=>{}),je(this,Ls,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},je(this,Uu,"m",hg).bind(this))},0)}_connected(){this.ended||(je(this,Ei,"f").call(this),this._emit("connect"))}get ended(){return je(this,Ds,"f")}get errored(){return je(this,Li,"f")}get aborted(){return je(this,Mi,"f")}abort(){this.controller.abort()}on(e,t){return(je(this,Pr,"f")[e]||(je(this,Pr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=je(this,Pr,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(je(this,Pr,"f")[e]||(je(this,Pr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{zt(this,Zn,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){zt(this,Zn,!0,"f"),await je(this,Ls,"f")}_emit(e,...t){if(je(this,Ds,"f"))return;e==="end"&&(zt(this,Ds,!0,"f"),je(this,Si,"f").call(this));const n=je(this,Pr,"f")[e];if(n&&(je(this,Pr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!je(this,Zn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),je(this,js,"f").call(this,s),je(this,Ms,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!je(this,Zn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),je(this,js,"f").call(this,s),je(this,Ms,"f").call(this,s),this._emit("end")}}_emitFinal(){}}vi=new WeakMap,Ei=new WeakMap,js=new WeakMap,Ls=new WeakMap,Si=new WeakMap,Ms=new WeakMap,Pr=new WeakMap,Ds=new WeakMap,Li=new WeakMap,Mi=new WeakMap,Zn=new WeakMap,Uu=new WeakSet,hg=function(e){if(zt(this,Li,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Nt),e instanceof Nt)return zt(this,Mi,!0,"f"),this._emit("abort",e);if(e instanceof ae)return this._emit("error",e);if(e instanceof Error){const t=new ae(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ae(String(e)))};function Ww(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function jc(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function Gw(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function La(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function Jw(r,e){return!e||!pg(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Lc(r,e)}function Lc(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new Jm;if(n.finish_reason==="content_filter")throw new Km;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>Xw(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Kw(e,n.message.content):null}}});return{...r,choices:t}}function Kw(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Xw(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:La(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Yw(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return La(t)||(t==null?void 0:t.function.strict)||!1}function pg(r){var e;return jc(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>La(t)||t.type==="function"&&t.function.strict===!0))??!1}function Qw(r){for(const e of r??[]){if(e.type!=="function")throw new ae(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ae(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var bt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},et,Bu,Di,Hu,qu,Zu,mg,Vu;const ff=10;class gg extends Nc{constructor(){super(...arguments),et.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(dg(e)||fg(e))&&e.content)this._emit("functionCallResult",e.content);else if(ss(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ss(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ae("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),bt(this,et,"m",Bu).call(this)}async finalMessage(){return await this.done(),bt(this,et,"m",Di).call(this)}async finalFunctionCall(){return await this.done(),bt(this,et,"m",Hu).call(this)}async finalFunctionCallResult(){return await this.done(),bt(this,et,"m",qu).call(this)}async totalUsage(){return await this.done(),bt(this,et,"m",Zu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=bt(this,et,"m",Di).call(this);t&&this._emit("finalMessage",t);const n=bt(this,et,"m",Bu).call(this);n&&this._emit("finalContent",n);const s=bt(this,et,"m",Hu).call(this);s&&this._emit("finalFunctionCall",s);const a=bt(this,et,"m",qu).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",bt(this,et,"m",Zu).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),bt(this,et,"m",mg).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Lc(a,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;const s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=ff}=n||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!m)throw new ae("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:_}=m.function_call,b=c[g];if(b){if(l&&l!==g){const x=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:x});continue}}else{const x=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(T=>JSON.stringify(T.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:x});continue}let y;try{y=df(b)?await b.parse(_):_}catch(x){this._addMessage({role:s,name:g,content:x instanceof Error?x.message:String(x)});continue}const w=await b.function(y,this),S=bt(this,et,"m",Vu).call(this,w);if(this._addMessage({role:s,name:g,content:S}),l)return}}async _runTools(e,t,n){var h,p,m;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((h=a==null?void 0:a.function)==null?void 0:h.name),{maxChatCompletions:u=ff}=n||{},c=t.tools.map(g=>{if(La(g)){if(!g.$callback)throw new ae("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of c)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const f="tools"in t?c.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<u;++g){const b=(p=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!b)throw new ae("missing message in ChatCompletion response");if(!((m=b.tool_calls)!=null&&m.length))return;for(const y of b.tool_calls){if(y.type!=="function")continue;const w=y.id,{name:S,arguments:x}=y.function,T=d[S];if(T){if(l&&l!==S){const k=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:k});continue}}else{const k=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(d).map(A=>JSON.stringify(A)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:k});continue}let I;try{I=df(T)?await T.parse(x):x}catch(k){const A=k instanceof Error?k.message:String(k);this._addMessage({role:s,tool_call_id:w,content:A});continue}const W=await T.function(I,this),Y=bt(this,et,"m",Vu).call(this,W);if(this._addMessage({role:s,tool_call_id:w,content:Y}),l)return}}}}et=new WeakSet,Bu=function(){return bt(this,et,"m",Di).call(this).content??null},Di=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ss(t)){const{function_call:n,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new ae("stream ended without producing a ChatCompletionMessage with role=assistant")},Hu=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(ss(s)&&(s!=null&&s.function_call))return s.function_call;if(ss(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},qu=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(dg(t)&&t.content!=null||fg(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Zu=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},mg=function(e){if(e.n!=null&&e.n>1)throw new ae("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Vu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ca extends gg{static runFunctions(e,t,n){const s=new ca,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new ca,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),ss(e)&&e.content&&this._emit("content",e.content)}}const _g=1,yg=2,bg=4,wg=8,vg=16,Eg=32,Sg=64,xg=128,Og=256,Ag=xg|Og,Pg=vg|Eg|Ag|Sg,Tg=_g|yg|Pg,Ig=bg|wg,ev=Tg|Ig,ze={STR:_g,NUM:yg,ARR:bg,OBJ:wg,NULL:vg,BOOL:Eg,NAN:Sg,INFINITY:xg,MINUS_INFINITY:Og,INF:Ag,SPECIAL:Pg,ATOM:Tg,COLLECTION:Ig,ALL:ev};class tv extends Error{}class rv extends Error{}function nv(r,e=ze.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return sv(r.trim(),e)}const sv=(r,e)=>{const t=r.length;let n=0;const s=f=>{throw new tv(`${f} at position ${n}`)},a=f=>{throw new rv(`${f} at position ${n}`)},i=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?u():r.substring(n,n+4)==="null"||ze.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||ze.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||ze.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||ze.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||ze.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||ze.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):c()),o=()=>{const f=n;let h=!1;for(n++;n<t&&(r[n]!=='"'||h&&r[n-1]==="\\");)h=r[n]==="\\"?!h:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(h)))}catch(p){a(String(p))}else if(ze.STR&e)try{return JSON.parse(r.substring(f,n-Number(h))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const f={};try{for(;r[n]!=="}";){if(d(),n>=t&&ze.OBJ&e)return f;const h=o();d(),n++;try{const p=i();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(ze.OBJ&e)return f;throw p}d(),r[n]===","&&n++}}catch{if(ze.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},u=()=>{n++;const f=[];try{for(;r[n]!=="]";)f.push(i()),d(),r[n]===","&&n++}catch{if(ze.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},c=()=>{if(n===0){r==="-"&&ze.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(h){if(ze.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(h))}}const f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(ze.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&ze.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(p){a(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},hf=r=>nv(r,ze.ALL^ze.NUM);var Mn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ie=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ue,Or,Dn,Br,tl,ei,rl,nl,sl,ti,al,pf;class da extends gg{constructor(e){super(),Ue.add(this),Or.set(this,void 0),Dn.set(this,void 0),Br.set(this,void 0),Mn(this,Or,e,"f"),Mn(this,Dn,[],"f")}get currentChatCompletionSnapshot(){return Ie(this,Br,"f")}static fromReadableStream(e){const t=new da(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new da(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ie(this,Ue,"m",tl).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Ie(this,Ue,"m",rl).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Nt;return this._addChatCompletion(Ie(this,Ue,"m",ti).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ie(this,Ue,"m",tl).call(this),this._connected();const s=pr.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(Ie(this,Ue,"m",ti).call(this)),Ie(this,Ue,"m",rl).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new Nt;return this._addChatCompletion(Ie(this,Ue,"m",ti).call(this))}[(Or=new WeakMap,Dn=new WeakMap,Br=new WeakMap,Ue=new WeakSet,tl=function(){this.ended||Mn(this,Br,void 0,"f")},ei=function(t){let n=Ie(this,Dn,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ie(this,Dn,"f")[t.index]=n,n)},rl=function(t){var s,a,i,o,l,u,c,d,f,h,p,m,g,_,b;if(this.ended)return;const n=Ie(this,Ue,"m",pf).call(this,t);this._emit("chunk",t,n);for(const y of t.choices){const w=n.choices[y.index];y.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((a=w.message)!=null&&a.content)&&(this._emit("content",y.delta.content,w.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),y.delta.refusal!=null&&((i=w.message)==null?void 0:i.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:w.message.refusal}),((l=y.logprobs)==null?void 0:l.content)!=null&&((u=w.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=y.logprobs)==null?void 0:c.content,snapshot:((d=w.logprobs)==null?void 0:d.content)??[]}),((f=y.logprobs)==null?void 0:f.refusal)!=null&&((h=w.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=y.logprobs)==null?void 0:p.refusal,snapshot:((m=w.logprobs)==null?void 0:m.refusal)??[]});const S=Ie(this,Ue,"m",ei).call(this,w);w.finish_reason&&(Ie(this,Ue,"m",sl).call(this,w),S.current_tool_call_index!=null&&Ie(this,Ue,"m",nl).call(this,w,S.current_tool_call_index));for(const x of y.delta.tool_calls??[])S.current_tool_call_index!==x.index&&(Ie(this,Ue,"m",sl).call(this,w),S.current_tool_call_index!=null&&Ie(this,Ue,"m",nl).call(this,w,S.current_tool_call_index)),S.current_tool_call_index=x.index;for(const x of y.delta.tool_calls??[]){const T=(g=w.message.tool_calls)==null?void 0:g[x.index];T!=null&&T.type&&((T==null?void 0:T.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=T.function)==null?void 0:_.name,index:x.index,arguments:T.function.arguments,parsed_arguments:T.function.parsed_arguments,arguments_delta:((b=x.function)==null?void 0:b.arguments)??""}):(T==null||T.type,void 0))}}},nl=function(t,n){var i,o,l;if(Ie(this,Ue,"m",ei).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=Ie(this,Or,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>c.type==="function"&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:La(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},sl=function(t){var s,a;const n=Ie(this,Ue,"m",ei).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=Ie(this,Ue,"m",al).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ti=function(){if(this.ended)throw new ae("stream has ended, this shouldn't happen");const t=Ie(this,Br,"f");if(!t)throw new ae("request ended without sending any chunks");return Mn(this,Br,void 0,"f"),Mn(this,Dn,[],"f"),av(t,Ie(this,Or,"f"))},al=function(){var n;const t=(n=Ie(this,Or,"f"))==null?void 0:n.response_format;return jc(t)?t:null},pf=function(t){var n,s,a,i;let o=Ie(this,Br,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=Mn(this,Br,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...p}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:x,refusal:T,...I}=h;Object.assign(m.logprobs,I),x&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...x)),T&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...T))}if(d&&(m.finish_reason=d,Ie(this,Or,"f")&&pg(Ie(this,Or,"f")))){if(d==="length")throw new Jm;if(d==="content_filter")throw new Km}if(Object.assign(m,p),!c)continue;const{content:g,refusal:_,function_call:b,role:y,tool_calls:w,...S}=c;if(Object.assign(m.message,S),_&&(m.message.refusal=(m.message.refusal||"")+_),y&&(m.message.role=y),b&&(m.message.function_call?(b.name&&(m.message.function_call.name=b.name),b.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=b.arguments)):m.message.function_call=b),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Ie(this,Ue,"m",al).call(this)&&(m.message.parsed=hf(m.message.content))),w){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:x,id:T,type:I,function:W,...Y}of w){const k=(i=m.message.tool_calls)[x]??(i[x]={});Object.assign(k,Y),T&&(k.id=T),I&&(k.type=I),W&&(k.function??(k.function={name:W.name??"",arguments:""})),W!=null&&W.name&&(k.function.name=W.name),W!=null&&W.arguments&&(k.function.arguments+=W.arguments,Yw(Ie(this,Or,"f"),k)&&(k.function.parsed_arguments=hf(k.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new pr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function av(r,e){const{id:t,choices:n,created:s,model:a,system_fingerprint:i,...o}=r,l={...o,id:t,choices:n.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new ae(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,..._}=u,b=u.role;if(!b)throw new ae(`missing role for choice ${d}`);if(m){const{arguments:y,name:w}=m;if(y==null)throw new ae(`missing function_call.arguments for choice ${d}`);if(!w)throw new ae(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:y,name:w},role:b,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return g?{...h,index:d,finish_reason:c,logprobs:f,message:{..._,role:b,content:p,refusal:u.refusal??null,tool_calls:g.map((y,w)=>{const{function:S,type:x,id:T,...I}=y,{arguments:W,name:Y,...k}=S||{};if(T==null)throw new ae(`missing choices[${d}].tool_calls[${w}].id
${ri(r)}`);if(x==null)throw new ae(`missing choices[${d}].tool_calls[${w}].type
${ri(r)}`);if(Y==null)throw new ae(`missing choices[${d}].tool_calls[${w}].function.name
${ri(r)}`);if(W==null)throw new ae(`missing choices[${d}].tool_calls[${w}].function.arguments
${ri(r)}`);return{...I,id:T,type:x,function:{...k,name:Y,arguments:W}}})}}:{...h,message:{..._,content:p,role:b,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Jw(l,e)}function ri(r){return JSON.stringify(r)}class as extends da{static fromReadableStream(e){const t=new as(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new as(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new as(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let Rg=class extends _e{parse(e,t){return Qw(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Lc(n,e))}runFunctions(e,t){return e.stream?as.runFunctions(this._client,e,t):ca.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?as.runTools(this._client,e,t):ca.runTools(this._client,e,t)}stream(e,t){return da.createChatCompletion(this._client,e,t)}};class zu extends _e{constructor(){super(...arguments),this.completions=new Rg(this._client)}}(function(r){r.Completions=Rg})(zu||(zu={}));class kg extends _e{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Cg extends _e{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Eo extends _e{constructor(){super(...arguments),this.sessions=new kg(this._client),this.transcriptionSessions=new Cg(this._client)}}Eo.Sessions=kg;Eo.TranscriptionSessions=Cg;var Q=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},xt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ye,Wu,fr,xi,Wt,bn,zn,yn,Fi,Tt,Oi,Ai,Xs,Fs,Us,mf,gf,_f,yf,bf,wf,vf;class Gt extends Nc{constructor(){super(...arguments),Ye.add(this),Wu.set(this,[]),fr.set(this,{}),xi.set(this,{}),Wt.set(this,void 0),bn.set(this,void 0),zn.set(this,void 0),yn.set(this,void 0),Fi.set(this,void 0),Tt.set(this,void 0),Oi.set(this,void 0),Ai.set(this,void 0),Xs.set(this,void 0)}[(Wu=new WeakMap,fr=new WeakMap,xi=new WeakMap,Wt=new WeakMap,bn=new WeakMap,zn=new WeakMap,yn=new WeakMap,Fi=new WeakMap,Tt=new WeakMap,Oi=new WeakMap,Ai=new WeakMap,Xs=new WeakMap,Ye=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Gt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=pr.fromReadableStream(e,this.controller);for await(const i of s)Q(this,Ye,"m",Fs).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Nt;return this._addRun(Q(this,Ye,"m",Us).call(this))}toReadableStream(){return new pr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new Gt;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const c of l)Q(this,Ye,"m",Fs).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new Nt;return this._addRun(Q(this,Ye,"m",Us).call(this))}static createThreadAssistantStream(e,t,n){const s=new Gt;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new Gt;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return Q(this,Oi,"f")}currentRun(){return Q(this,Ai,"f")}currentMessageSnapshot(){return Q(this,Wt,"f")}currentRunStepSnapshot(){return Q(this,Xs,"f")}async finalRunSteps(){return await this.done(),Object.values(Q(this,fr,"f"))}async finalMessages(){return await this.done(),Object.values(Q(this,xi,"f"))}async finalRun(){if(await this.done(),!Q(this,bn,"f"))throw Error("Final run was not received.");return Q(this,bn,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)Q(this,Ye,"m",Fs).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new Nt;return this._addRun(Q(this,Ye,"m",Us).call(this))}async _createAssistantStream(e,t,n,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)Q(this,Ye,"m",Fs).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Nt;return this._addRun(Q(this,Ye,"m",Us).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(el(a)&&el(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!el(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}}Fs=function(e){if(!this.ended)switch(xt(this,Oi,e,"f"),Q(this,Ye,"m",_f).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Q(this,Ye,"m",vf).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Q(this,Ye,"m",gf).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Q(this,Ye,"m",mf).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Us=function(){if(this.ended)throw new ae("stream has ended, this shouldn't happen");if(!Q(this,bn,"f"))throw Error("Final run has not been received");return Q(this,bn,"f")},mf=function(e){const[t,n]=Q(this,Ye,"m",bf).call(this,e,Q(this,Wt,"f"));xt(this,Wt,t,"f"),Q(this,xi,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Q(this,zn,"f")){if(Q(this,yn,"f"))switch(Q(this,yn,"f").type){case"text":this._emit("textDone",Q(this,yn,"f").text,Q(this,Wt,"f"));break;case"image_file":this._emit("imageFileDone",Q(this,yn,"f").image_file,Q(this,Wt,"f"));break}xt(this,zn,s.index,"f")}xt(this,yn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Q(this,zn,"f")!==void 0){const s=e.data.content[Q(this,zn,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Q(this,Wt,"f"));break;case"text":this._emit("textDone",s.text,Q(this,Wt,"f"));break}}Q(this,Wt,"f")&&this._emit("messageDone",e.data),xt(this,Wt,void 0,"f")}},gf=function(e){const t=Q(this,Ye,"m",yf).call(this,e);switch(xt(this,Xs,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==Q(this,Fi,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(Q(this,Tt,"f")&&this._emit("toolCallDone",Q(this,Tt,"f")),xt(this,Fi,a.index,"f"),xt(this,Tt,t.step_details.tool_calls[a.index],"f"),Q(this,Tt,"f")&&this._emit("toolCallCreated",Q(this,Tt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":xt(this,Xs,void 0,"f"),e.data.step_details.type=="tool_calls"&&Q(this,Tt,"f")&&(this._emit("toolCallDone",Q(this,Tt,"f")),xt(this,Tt,void 0,"f")),this._emit("runStepDone",e.data,t);break}},_f=function(e){Q(this,Wu,"f").push(e),this._emit("event",e)},yf=function(e){switch(e.event){case"thread.run.step.created":return Q(this,fr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Q(this,fr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Gt.accumulateDelta(t,n.delta);Q(this,fr,"f")[e.data.id]=s}return Q(this,fr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Q(this,fr,"f")[e.data.id]=e.data;break}if(Q(this,fr,"f")[e.data.id])return Q(this,fr,"f")[e.data.id];throw new Error("No snapshot available")},bf=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=Q(this,Ye,"m",wf).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},wf=function(e,t){return Gt.accumulateDelta(t,e)},vf=function(e){switch(xt(this,Ai,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":xt(this,bn,e.data,"f"),Q(this,Tt,"f")&&(this._emit("toolCallDone",Q(this,Tt,"f")),xt(this,Tt,void 0,"f"));break}};class Mc extends _e{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Dc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Dc extends vt{}Mc.MessagesPage=Dc;class Fc extends _e{retrieve(e,t,n,s={},a){return Je(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},s){return Je(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Uc,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Uc extends vt{}Fc.RunStepsPage=Uc;class Ma extends _e{constructor(){super(...arguments),this.steps=new Fc(this._client)}create(e,t,n){const{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Bc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Gt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Na(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Gt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return Gt.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Bc extends vt{}Ma.RunsPage=Bc;Ma.Steps=Fc;Ma.RunStepsPage=Uc;class gs extends _e{constructor(){super(...arguments),this.runs=new Ma(this._client),this.messages=new Mc(this._client)}create(e={},t){return Je(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Gt.createThreadAssistantStream(e,this._client.beta.threads,t)}}gs.Runs=Ma;gs.RunsPage=Bc;gs.Messages=Mc;gs.MessagesPage=Dc;class _s extends _e{constructor(){super(...arguments),this.realtime=new Eo(this._client),this.chat=new zu(this._client),this.assistants=new Cc(this._client),this.threads=new gs(this._client)}}_s.Realtime=Eo;_s.Assistants=Cc;_s.AssistantsPage=$c;_s.Threads=gs;class $g extends _e{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Ng extends _e{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}let Hc=class extends _e{create(e,t){return this._client.post("/files",us({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/files",qc,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Na(t),i=await this.retrieve(e),Date.now()-a>n)throw new mo({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class qc extends vt{}Hc.FileObjectsPage=qc;class Zc extends _e{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Vc,{query:t,...n})}}class Vc extends vt{}Zc.FineTuningJobCheckpointsPage=Vc;class ys extends _e{constructor(){super(...arguments),this.checkpoints=new Zc(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",zc,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Je(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Wc,{query:t,...n})}}class zc extends vt{}class Wc extends vt{}ys.FineTuningJobsPage=zc;ys.FineTuningJobEventsPage=Wc;ys.Checkpoints=Zc;ys.FineTuningJobCheckpointsPage=Vc;class Da extends _e{constructor(){super(...arguments),this.jobs=new ys(this._client)}}Da.Jobs=ys;Da.FineTuningJobsPage=zc;Da.FineTuningJobEventsPage=Wc;class jg extends _e{createVariation(e,t){return this._client.post("/images/variations",us({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",us({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Gc extends _e{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Jc,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Jc extends Ic{}Gc.ModelsPage=Jc;class Lg extends _e{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function iv(r,e){return!e||!lv(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Mg(r,e)}function Mg(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:dv(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:ov(e,i.text)}:i);return{...s,content:a}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||Dg(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function ov(r,e){var t,n,s,a;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((a=r.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function lv(r){var e;return!!jc((e=r.text)==null?void 0:e.format)}function uv(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function cv(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function dv(r,e){const t=cv(r.tools??[],e.name);return{...e,...e,parsed_arguments:uv(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Dg(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class Fg extends _e{list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,hv,{query:t,...n})}}var Fn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Hr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Un,ni,qr,si,Ef,Sf,xf,Of;class Kc extends Nc{constructor(e){super(),Un.add(this),ni.set(this,void 0),qr.set(this,void 0),si.set(this,void 0),Fn(this,ni,e,"f")}static createResponse(e,t,n){const s=new Kc(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Hr(this,Un,"m",Ef).call(this);const a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Hr(this,Un,"m",Sf).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Nt;return Hr(this,Un,"m",xf).call(this)}[(ni=new WeakMap,qr=new WeakMap,si=new WeakMap,Un=new WeakSet,Ef=function(){this.ended||Fn(this,qr,void 0,"f")},Sf=function(t){if(this.ended)return;const n=Hr(this,Un,"m",Of).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ae(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new ae(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new ae(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ae(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},xf=function(){if(this.ended)throw new ae("stream has ended, this shouldn't happen");const t=Hr(this,qr,"f");if(!t)throw new ae("request ended without sending any events");Fn(this,qr,void 0,"f");const n=fv(t,Hr(this,ni,"f"));return Fn(this,si,n,"f"),n},Of=function(t){let n=Hr(this,qr,"f");if(!n){if(t.type!=="response.created")throw new ae(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Fn(this,qr,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new ae(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new ae(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new ae(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new ae(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new ae(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Fn(this,qr,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Hr(this,si,"f");if(!e)throw new ae("stream ended without producing a ChatCompletion");return e}}function fv(r,e){return iv(r,e)}class Xc extends _e{constructor(){super(...arguments),this.inputItems=new Fg(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Dg(n),n))}retrieve(e,t={},n){return Je(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Mg(n,e))}stream(e,t){return Kc.createResponse(this._client,e,t)}}class hv extends vt{}Xc.InputItems=Fg;class Ug extends _e{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,us({body:t,...n}))}}class Yc extends _e{constructor(){super(...arguments),this.parts=new Ug(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}Yc.Parts=Ug;const pv=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class So extends _e{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Je(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,xo,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Na(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Qc,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class xo extends vt{}class Qc extends Ic{}So.VectorStoreFilesPage=xo;So.FileContentResponsesPage=Qc;class Bg extends _e{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Je(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,xo,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Na(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),u=[...n];async function c(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},s);u.push(p.id)}}const d=Array(i).fill(l).map(c);return await pv(d),await this.createAndPoll(e,{file_ids:u})}}class dn extends _e{constructor(){super(...arguments),this.files=new So(this._client),this.fileBatches=new Bg(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Je(e)?this.list({},e):this._client.getAPIList("/vector_stores",ed,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,td,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class ed extends vt{}class td extends Ic{}dn.VectorStoresPage=ed;dn.VectorStoreSearchResponsesPage=td;dn.Files=So;dn.VectorStoreFilesPage=xo;dn.FileContentResponsesPage=Qc;dn.FileBatches=Bg;var Hg;let me=class extends Nw{constructor({baseURL:e=Ya("OPENAI_BASE_URL"),apiKey:t=Ya("OPENAI_API_KEY"),organization:n=Ya("OPENAI_ORG_ID")??null,project:s=Ya("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new ae("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Zw())throw new ae(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new $g(this),this.chat=new vo(this),this.embeddings=new Ng(this),this.files=new Hc(this),this.images=new jg(this),this.audio=new ja(this),this.moderations=new Lg(this),this.models=new Gc(this),this.fineTuning=new Da(this),this.vectorStores=new dn(this),this.beta=new _s(this),this.batches=new Rc(this),this.uploads=new Yc(this),this.responses=new Xc(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return gw(e,{arrayFormat:"brackets"})}};Hg=me;me.OpenAI=Hg;me.DEFAULT_TIMEOUT=6e5;me.OpenAIError=ae;me.APIError=Qe;me.APIConnectionError=po;me.APIConnectionTimeoutError=mo;me.APIUserAbortError=Nt;me.NotFoundError=Zm;me.ConflictError=Vm;me.RateLimitError=Wm;me.BadRequestError=Bm;me.AuthenticationError=Hm;me.InternalServerError=Gm;me.PermissionDeniedError=qm;me.UnprocessableEntityError=zm;me.toFile=eg;me.fileFromPath=Dm;me.Completions=$g;me.Chat=vo;me.ChatCompletionsPage=wo;me.Embeddings=Ng;me.Files=Hc;me.FileObjectsPage=qc;me.Images=jg;me.Audio=ja;me.Moderations=Lg;me.Models=Gc;me.ModelsPage=Jc;me.FineTuning=Da;me.VectorStores=dn;me.VectorStoresPage=ed;me.VectorStoreSearchResponsesPage=td;me.Beta=_s;me.Batches=Rc;me.BatchesPage=kc;me.Uploads=Yc;me.Responses=Xc;function Af(r,e=rd){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function rd(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let a of r){if(n)a==='"'&&!s?n=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')n=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}n&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}function bs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var il,Pf;function mv(){return Pf||(Pf=1,il=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),il}var gv=mv();const _v=bs(gv);var ai={exports:{}},Tf;function yv(){if(Tf)return ai.exports;Tf=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(f,h,p)=>{let m=!1,g=!1,_=!1;for(let b=0;b<f.length;b++){const y=f[b];m&&r.test(y)?(f=f.slice(0,b)+"-"+f.slice(b),m=!1,_=g,g=!0,b++):g&&_&&e.test(y)?(f=f.slice(0,b-1)+"-"+f.slice(b-1),_=g,g=!1,m=!0):(m=h(y)===y&&p(y)!==y,_=g,g=p(y)===y&&h(y)!==y)}return f},u=(f,h)=>(t.lastIndex=0,f.replace(t,p=>h(p))),c=(f,h)=>(i.lastIndex=0,o.lastIndex=0,f.replace(i,(p,m)=>h(m)).replace(o,p=>h(p))),d=(f,h)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(h={pascalCase:!1,preserveConsecutiveUppercase:!1,...h},Array.isArray(f)?f=f.map(_=>_.trim()).filter(_=>_.length).join("-"):f=f.trim(),f.length===0)return"";const p=h.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(h.locale),m=h.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(h.locale);return f.length===1?h.pascalCase?m(f):p(f):(f!==p(f)&&(f=l(f,p,m)),f=f.replace(a,""),h.preserveConsecutiveUppercase?f=u(f,p):f=p(f),h.pascalCase&&(f=m(f.charAt(0))+f.slice(1)),c(f,m))};return ai.exports=d,ai.exports.default=d,ai.exports}yv();function bv(r,e){return(e==null?void 0:e[r])||_v(r)}function wv(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function If(r){return Array.isArray(r)?[...r]:{...r}}function vv(r,e){const t=If(r);for(const[n,s]of Object.entries(e)){const[a,...i]=n.split(".").reverse();let o=t;for(const l of i.reverse()){if(o[l]===void 0)break;o[l]=If(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function qg(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class Tn{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qg(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Tn||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=n;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?i[u]={}:Array.isArray(a[u])&&(i[u]=[])),a=a[u],i=i[u]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wv(Object.keys(t).length?vv(n,t):n,bv,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function ws(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Oo(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function Ev(r,e){return r==="error"||e==="error"?"error":"success"}function Sv(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,s+1));const a={};for(const i of Object.keys(n))a[i]=t(n[i],s+1);return a}return JSON.stringify(t(r,0),null,2)}class vs extends Tn{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Sv(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function ht(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=ht(t[n],s);else if(Array.isArray(t[n]))t[n]=Oo(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Oo(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(a=>a.index===n.index);s!==-1?t[s]=ht(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function xv(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Oo(r,e);if(typeof r=="object"&&typeof e=="object")return ht(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Es extends vs{}function Ov(r){return typeof r.role=="string"}function Ao(r){return typeof(r==null?void 0:r._getType)=="function"}function Av(r){return Ao(r)&&typeof r.concat=="function"}class Pv extends vs{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class nd extends Es{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new nd({content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),artifact:xv(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Ev(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Tv(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const a=JSON.parse(n.function.arguments),i={name:s||"",args:a||{},id:n.id};e.push(i)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class fa extends vs{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const a=(s=n.additional_kwargs)==null?void 0:s.tool_calls,i=n.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,l]=Tv(a);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Fa(r){return r._getType()==="ai"}function Rf(r){return r._getType()==="ai"}class tn extends Es{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=rd(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,a,i,o,l,u,c,d,f,h,p,m,g,_,b,y,w,S,x,T,I,W,Y,k,A,M,R,C,B,N,U,H,ne,ce,te,ve,Me,$e,gt;const t={content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Ut=Oo(this.tool_call_chunks,e.tool_call_chunks);Ut!==void 0&&Ut.length>0&&(t.tool_call_chunks=Ut)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Ut={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((i=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((c=(u=e.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:c.audio)??0)},...(((f=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:f.cache_read)!==void 0||((p=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((b=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:b.cache_read)??0)},...(((w=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:w.cache_creation)!==void 0||((x=(S=e.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:x.cache_creation)!==void 0)&&{cache_creation:(((I=(T=this.usage_metadata)==null?void 0:T.input_token_details)==null?void 0:I.cache_creation)??0)+(((Y=(W=e.usage_metadata)==null?void 0:W.input_token_details)==null?void 0:Y.cache_creation)??0)}},Nn={...(((A=(k=this.usage_metadata)==null?void 0:k.output_token_details)==null?void 0:A.audio)!==void 0||((R=(M=e.usage_metadata)==null?void 0:M.output_token_details)==null?void 0:R.audio)!==void 0)&&{audio:(((B=(C=this.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:B.audio)??0)+(((U=(N=e.usage_metadata)==null?void 0:N.output_token_details)==null?void 0:U.audio)??0)},...(((ne=(H=this.usage_metadata)==null?void 0:H.output_token_details)==null?void 0:ne.reasoning)!==void 0||((te=(ce=e.usage_metadata)==null?void 0:ce.output_token_details)==null?void 0:te.reasoning)!==void 0)&&{reasoning:(((Me=(ve=this.usage_metadata)==null?void 0:ve.output_token_details)==null?void 0:Me.reasoning)??0)+(((gt=($e=e.usage_metadata)==null?void 0:$e.output_token_details)==null?void 0:gt.reasoning)??0)}},jn=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Er=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},vd={input_tokens:jn.input_tokens+Er.input_tokens,output_tokens:jn.output_tokens+Er.output_tokens,total_tokens:jn.total_tokens+Er.total_tokens,...Object.keys(Ut).length>0&&{input_token_details:Ut},...Object.keys(Nn).length>0&&{output_token_details:Nn}};t.usage_metadata=vd}return new tn(t)}}class Ua extends vs{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ua}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Po extends Es{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Po({content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class To extends Es{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new To({content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Io extends vs{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Ro extends Es{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Ro({content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class kf extends vs{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class ha extends Es{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new ha({content:ws(this.content,e.content),additional_kwargs:ht(this.additional_kwargs,e.additional_kwargs),response_metadata:ht(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Zg(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Vg(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class Iv extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Rv(r){return Vg(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function kv(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function ol(r){let e,t;if(kv(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new Io(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new fa(t);const a=n.map(Rv);return new fa({...s,tool_calls:a})}else{if(e==="system")return new kf(t);if(e==="developer")return new kf({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Pv({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Zg(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Bs(r){if(typeof r=="string")return new Io(r);if(Ao(r))return r;if(Array.isArray(r)){const[e,t]=r;return ol({type:e,content:t})}else if(Ov(r)){const{role:e,...t}=r;return ol({...t,type:e})}else return ol(r)}function zg(r,e="Human",t="AI"){const n=[];for(const s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${a}: ${i}${o}`)}return n.join(`
`)}function Cv(r){var t;const e=r._getType();if(e==="human")return new Ro({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new tn({...n})}else{if(e==="system")return new ha({...r});if(e==="function")return new To({...r});if(Ua.isInstance(r))return new Po({...r});throw new Error("Unknown message type.")}}var be;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(be||(be={}));var Gu;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Gu||(Gu={}));const J=be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rr=r=>{switch(typeof r){case"undefined":return J.undefined;case"string":return J.string;case"number":return isNaN(r)?J.nan:J.number;case"boolean":return J.boolean;case"function":return J.function;case"bigint":return J.bigint;case"symbol":return J.symbol;case"object":return Array.isArray(r)?J.array:r===null?J.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?J.promise:typeof Map<"u"&&r instanceof Map?J.map:typeof Set<"u"&&r instanceof Set?J.set:typeof Date<"u"&&r instanceof Date?J.date:J.object;default:return J.unknown}},j=be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),$v=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class jt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,l=0;for(;l<i.path.length;){const u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),n}static assert(e){if(!(e instanceof jt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}jt.create=r=>new jt(r);const cs=(r,e)=>{let t;switch(r.code){case j.invalid_type:r.received===J.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case j.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,be.jsonStringifyReplacer)}`;break;case j.unrecognized_keys:t=`Unrecognized key(s) in object: ${be.joinValues(r.keys,", ")}`;break;case j.invalid_union:t="Invalid input";break;case j.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${be.joinValues(r.options)}`;break;case j.invalid_enum_value:t=`Invalid enum value. Expected ${be.joinValues(r.options)}, received '${r.received}'`;break;case j.invalid_arguments:t="Invalid function arguments";break;case j.invalid_return_type:t="Invalid function return type";break;case j.invalid_date:t="Invalid date";break;case j.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:be.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case j.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case j.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case j.custom:t="Invalid input";break;case j.invalid_intersection_types:t="Intersection results could not be merged";break;case j.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case j.not_finite:t="Number must be finite";break;default:t=e.defaultError,be.assertNever(r)}return{message:t}};let Wg=cs;function Nv(r){Wg=r}function Ui(){return Wg}const Bi=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=n.filter(u=>!!u).slice().reverse();for(const u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},jv=[];function V(r,e){const t=Ui(),n=Bi({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===cs?void 0:cs].filter(s=>!!s)});r.common.issues.push(n)}class at{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return oe;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return at.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return oe;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const oe=Object.freeze({status:"aborted"}),Wn=r=>({status:"dirty",value:r}),pt=r=>({status:"valid",value:r}),Ju=r=>r.status==="aborted",Ku=r=>r.status==="dirty",In=r=>r.status==="valid",pa=r=>typeof Promise<"u"&&r instanceof Promise;function Hi(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function Gg(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var X;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(X||(X={}));var Hs,qs;class wr{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Cf=(r,e)=>{if(In(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new jt(r.common.issues);return this._error=t,this._error}}};function ue(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var l,u;const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??n)!==null&&l!==void 0?l:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:s}}class pe{get description(){return this._def.description}_getType(e){return Rr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new at,ctx:{common:e.parent.common,data:e.data,parsedType:Rr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(pa(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)},a=this._parseSync({data:e,path:s.path,parent:s});return Cf(s,a)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return In(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((n=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>In(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rr(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(pa(s)?s:Promise.resolve(s));return Cf(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:j.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new tr({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Yt.create(this,this._def)}nullable(){return an.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Xt.create(this)}promise(){return fs.create(this,this._def)}or(e){return ya.create([this,e],this._def)}and(e){return ba.create(this,e,this._def)}transform(e){return new tr({...ue(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new xa({...ue(this._def),innerType:this,defaultValue:t,typeName:O.ZodDefault})}brand(){return new sd({typeName:O.ZodBranded,type:this,...ue(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Oa({...ue(this._def),innerType:this,catchValue:t,typeName:O.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ba.create(this,e)}readonly(){return Aa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Lv=/^c[^\s-]{8,}$/i,Mv=/^[0-9a-z]+$/,Dv=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Fv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Uv=/^[a-z0-9_-]{21}$/i,Bv=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Hv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,qv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Zv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let ll;const Vv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,zv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Wv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Gv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Jv=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Kv=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Jg="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Xv=new RegExp(`^${Jg}$`);function Kg(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Yv(r){return new RegExp(`^${Kg(r)}$`)}function Xg(r){let e=`${Jg}T${Kg(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Qv(r,e){return!!((e==="v4"||!e)&&Vv.test(r)||(e==="v6"||!e)&&Wv.test(r))}function e0(r,e){if(!Bv.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function t0(r,e){return!!((e==="v4"||!e)&&zv.test(r)||(e==="v6"||!e)&&Gv.test(r))}class Jt extends pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==J.string){const a=this._getOrReturnCtx(e);return V(a,{code:j.invalid_type,expected:J.string,received:a.parsedType}),oe}const n=new at;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),V(s,{code:j.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),V(s,{code:j.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?V(s,{code:j.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&V(s,{code:j.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")qv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"email",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")ll||(ll=new RegExp(Zv,"u")),ll.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"emoji",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")Fv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"uuid",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")Uv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"nanoid",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")Lv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"cuid",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Mv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"cuid2",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")Dv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"ulid",code:j.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),V(s,{validation:"url",code:j.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"regex",code:j.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Xg(a).test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?Xv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?Yv(a).test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{code:j.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?Hv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"duration",code:j.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?Qv(e.data,a.version)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"ip",code:j.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?e0(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"jwt",code:j.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?t0(e.data,a.version)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"cidr",code:j.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?Jv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"base64",code:j.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?Kv.test(e.data)||(s=this._getOrReturnCtx(e,s),V(s,{validation:"base64url",code:j.invalid_string,message:a.message}),n.dirty()):be.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:j.invalid_string,...X.errToObj(n)})}_addCheck(e){return new Jt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...X.errToObj(e)})}url(e){return this._addCheck({kind:"url",...X.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...X.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...X.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...X.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...X.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...X.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...X.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...X.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...X.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...X.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...X.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...X.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...X.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...X.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...X.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...X.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...X.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...X.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...X.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...X.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...X.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...X.errToObj(t)})}nonempty(e){return this.min(1,X.errToObj(e))}trim(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Jt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Jt.create=r=>{var e;return new Jt({checks:[],typeName:O.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...ue(r)})};function r0(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class rn extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==J.number){const a=this._getOrReturnCtx(e);return V(a,{code:j.invalid_type,expected:J.number,received:a.parsedType}),oe}let n;const s=new at;for(const a of this._def.checks)a.kind==="int"?be.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),V(n,{code:j.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?r0(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),V(n,{code:j.not_finite,message:a.message}),s.dirty()):be.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,n,s){return new rn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:X.toString(s)}]})}_addCheck(e){return new rn({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:X.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:X.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:X.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:X.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&be.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}rn.create=r=>new rn({checks:[],typeName:O.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...ue(r)});class nn extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==J.bigint)return this._getInvalidInput(e);let n;const s=new at;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),V(n,{code:j.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):be.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return V(t,{code:j.invalid_type,expected:J.bigint,received:t.parsedType}),oe}gte(e,t){return this.setLimit("min",e,!0,X.toString(t))}gt(e,t){return this.setLimit("min",e,!1,X.toString(t))}lte(e,t){return this.setLimit("max",e,!0,X.toString(t))}lt(e,t){return this.setLimit("max",e,!1,X.toString(t))}setLimit(e,t,n,s){return new nn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:X.toString(s)}]})}_addCheck(e){return new nn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:X.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:X.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:X.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:X.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:X.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}nn.create=r=>{var e;return new nn({checks:[],typeName:O.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...ue(r)})};class ma extends pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==J.boolean){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.boolean,received:n.parsedType}),oe}return pt(e.data)}}ma.create=r=>new ma({typeName:O.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...ue(r)});class Rn extends pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==J.date){const a=this._getOrReturnCtx(e);return V(a,{code:j.invalid_type,expected:J.date,received:a.parsedType}),oe}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return V(a,{code:j.invalid_date}),oe}const n=new at;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),V(s,{code:j.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),V(s,{code:j.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):be.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Rn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:X.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:X.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Rn.create=r=>new Rn({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:O.ZodDate,...ue(r)});class qi extends pe{_parse(e){if(this._getType(e)!==J.symbol){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.symbol,received:n.parsedType}),oe}return pt(e.data)}}qi.create=r=>new qi({typeName:O.ZodSymbol,...ue(r)});class ga extends pe{_parse(e){if(this._getType(e)!==J.undefined){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.undefined,received:n.parsedType}),oe}return pt(e.data)}}ga.create=r=>new ga({typeName:O.ZodUndefined,...ue(r)});class _a extends pe{_parse(e){if(this._getType(e)!==J.null){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.null,received:n.parsedType}),oe}return pt(e.data)}}_a.create=r=>new _a({typeName:O.ZodNull,...ue(r)});class ds extends pe{constructor(){super(...arguments),this._any=!0}_parse(e){return pt(e.data)}}ds.create=r=>new ds({typeName:O.ZodAny,...ue(r)});class En extends pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return pt(e.data)}}En.create=r=>new En({typeName:O.ZodUnknown,...ue(r)});class Mr extends pe{_parse(e){const t=this._getOrReturnCtx(e);return V(t,{code:j.invalid_type,expected:J.never,received:t.parsedType}),oe}}Mr.create=r=>new Mr({typeName:O.ZodNever,...ue(r)});class Zi extends pe{_parse(e){if(this._getType(e)!==J.undefined){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.void,received:n.parsedType}),oe}return pt(e.data)}}Zi.create=r=>new Zi({typeName:O.ZodVoid,...ue(r)});class Xt extends pe{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==J.array)return V(t,{code:j.invalid_type,expected:J.array,received:t.parsedType}),oe;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(V(t,{code:i?j.too_big:j.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(V(t,{code:j.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(V(t,{code:j.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new wr(t,i,t.path,o)))).then(i=>at.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new wr(t,i,t.path,o)));return at.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new Xt({...this._def,minLength:{value:e,message:X.toString(t)}})}max(e,t){return new Xt({...this._def,maxLength:{value:e,message:X.toString(t)}})}length(e,t){return new Xt({...this._def,exactLength:{value:e,message:X.toString(t)}})}nonempty(e){return this.min(1,e)}}Xt.create=(r,e)=>new Xt({type:r,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...ue(e)});function Vn(r){if(r instanceof Le){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=Yt.create(Vn(n))}return new Le({...r._def,shape:()=>e})}else return r instanceof Xt?new Xt({...r._def,type:Vn(r.element)}):r instanceof Yt?Yt.create(Vn(r.unwrap())):r instanceof an?an.create(Vn(r.unwrap())):r instanceof vr?vr.create(r.items.map(e=>Vn(e))):r}class Le extends pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=be.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==J.object){const u=this._getOrReturnCtx(e);return V(u,{code:j.invalid_type,expected:J.object,received:u.parsedType}),oe}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Mr&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const l=[];for(const u of i){const c=a[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new wr(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Mr){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(V(s,{code:j.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new wr(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>at.mergeObjectSync(n,u)):at.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return X.errToObj,new Le({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,i,o;const l=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=X.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Le({...this._def,unknownKeys:"strip"})}passthrough(){return new Le({...this._def,unknownKeys:"passthrough"})}extend(e){return new Le({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Le({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Le({...this._def,catchall:e})}pick(e){const t={};return be.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new Le({...this._def,shape:()=>t})}omit(e){const t={};return be.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new Le({...this._def,shape:()=>t})}deepPartial(){return Vn(this)}partial(e){const t={};return be.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new Le({...this._def,shape:()=>t})}required(e){const t={};return be.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Yt;)a=a._def.innerType;t[n]=a}}),new Le({...this._def,shape:()=>t})}keyof(){return Yg(be.objectKeys(this.shape))}}Le.create=(r,e)=>new Le({shape:()=>r,unknownKeys:"strip",catchall:Mr.create(),typeName:O.ZodObject,...ue(e)});Le.strictCreate=(r,e)=>new Le({shape:()=>r,unknownKeys:"strict",catchall:Mr.create(),typeName:O.ZodObject,...ue(e)});Le.lazycreate=(r,e)=>new Le({shape:r,unknownKeys:"strip",catchall:Mr.create(),typeName:O.ZodObject,...ue(e)});class ya extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new jt(o.ctx.common.issues));return V(t,{code:j.invalid_union,unionErrors:i}),oe}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of n){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new jt(l));return V(t,{code:j.invalid_union,unionErrors:o}),oe}}get options(){return this._def.options}}ya.create=(r,e)=>new ya({options:r,typeName:O.ZodUnion,...ue(e)});const Tr=r=>r instanceof va?Tr(r.schema):r instanceof tr?Tr(r.innerType()):r instanceof Ea?[r.value]:r instanceof sn?r.options:r instanceof Sa?be.objectValues(r.enum):r instanceof xa?Tr(r._def.innerType):r instanceof ga?[void 0]:r instanceof _a?[null]:r instanceof Yt?[void 0,...Tr(r.unwrap())]:r instanceof an?[null,...Tr(r.unwrap())]:r instanceof sd||r instanceof Aa?Tr(r.unwrap()):r instanceof Oa?Tr(r._def.innerType):[];class ko extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.object)return V(t,{code:j.invalid_type,expected:J.object,received:t.parsedType}),oe;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(V(t,{code:j.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),oe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const i=Tr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new ko({typeName:O.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...ue(n)})}}function Xu(r,e){const t=Rr(r),n=Rr(e);if(r===e)return{valid:!0,data:r};if(t===J.object&&n===J.object){const s=be.objectKeys(e),a=be.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const l=Xu(r[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===J.array&&n===J.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],l=Xu(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===J.date&&n===J.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class ba extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(Ju(a)||Ju(i))return oe;const o=Xu(a.value,i.value);return o.valid?((Ku(a)||Ku(i))&&t.dirty(),{status:t.value,value:o.data}):(V(n,{code:j.invalid_intersection_types}),oe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}ba.create=(r,e,t)=>new ba({left:r,right:e,typeName:O.ZodIntersection,...ue(t)});class vr extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.array)return V(n,{code:j.invalid_type,expected:J.array,received:n.parsedType}),oe;if(n.data.length<this._def.items.length)return V(n,{code:j.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),oe;!this._def.rest&&n.data.length>this._def.items.length&&(V(n,{code:j.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new wr(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>at.mergeArray(t,i)):at.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new vr({...this._def,rest:e})}}vr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new vr({items:r,typeName:O.ZodTuple,rest:null,...ue(e)})};class wa extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.object)return V(n,{code:j.invalid_type,expected:J.object,received:n.parsedType}),oe;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in n.data)s.push({key:a._parse(new wr(n,o,n.path,o)),value:i._parse(new wr(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?at.mergeObjectAsync(t,s):at.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof pe?new wa({keyType:e,valueType:t,typeName:O.ZodRecord,...ue(n)}):new wa({keyType:Jt.create(),valueType:e,typeName:O.ZodRecord,...ue(t)})}}class Vi extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.map)return V(n,{code:j.invalid_type,expected:J.map,received:n.parsedType}),oe;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,l],u)=>({key:s._parse(new wr(n,o,n.path,[u,"key"])),value:a._parse(new wr(n,l,n.path,[u,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return oe;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of i){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return oe;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}Vi.create=(r,e,t)=>new Vi({valueType:e,keyType:r,typeName:O.ZodMap,...ue(t)});class kn extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==J.set)return V(n,{code:j.invalid_type,expected:J.set,received:n.parsedType}),oe;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(V(n,{code:j.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(V(n,{code:j.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(l){const u=new Set;for(const c of l){if(c.status==="aborted")return oe;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...n.data.values()].map((l,u)=>a._parse(new wr(n,l,n.path,u)));return n.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new kn({...this._def,minSize:{value:e,message:X.toString(t)}})}max(e,t){return new kn({...this._def,maxSize:{value:e,message:X.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}kn.create=(r,e)=>new kn({valueType:r,minSize:null,maxSize:null,typeName:O.ZodSet,...ue(e)});class is extends pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.function)return V(t,{code:j.invalid_type,expected:J.function,received:t.parsedType}),oe;function n(o,l){return Bi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ui(),cs].filter(u=>!!u),issueData:{code:j.invalid_arguments,argumentsError:l}})}function s(o,l){return Bi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ui(),cs].filter(u=>!!u),issueData:{code:j.invalid_return_type,returnTypeError:l}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof fs){const o=this;return pt(async function(...l){const u=new jt([]),c=await o._def.args.parseAsync(l,a).catch(h=>{throw u.addIssue(n(l,h)),u}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw u.addIssue(s(d,h)),u})})}else{const o=this;return pt(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new jt([n(l,u.error)]);const c=Reflect.apply(i,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new jt([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new is({...this._def,args:vr.create(e).rest(En.create())})}returns(e){return new is({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new is({args:e||vr.create([]).rest(En.create()),returns:t||En.create(),typeName:O.ZodFunction,...ue(n)})}}class va extends pe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}va.create=(r,e)=>new va({getter:r,typeName:O.ZodLazy,...ue(e)});class Ea extends pe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return V(t,{received:t.data,code:j.invalid_literal,expected:this._def.value}),oe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ea.create=(r,e)=>new Ea({value:r,typeName:O.ZodLiteral,...ue(e)});function Yg(r,e){return new sn({values:r,typeName:O.ZodEnum,...ue(e)})}class sn extends pe{constructor(){super(...arguments),Hs.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return V(t,{expected:be.joinValues(n),received:t.parsedType,code:j.invalid_type}),oe}if(Hi(this,Hs)||Gg(this,Hs,new Set(this._def.values)),!Hi(this,Hs).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return V(t,{received:t.data,code:j.invalid_enum_value,options:n}),oe}return pt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return sn.create(e,{...this._def,...t})}exclude(e,t=this._def){return sn.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Hs=new WeakMap;sn.create=Yg;class Sa extends pe{constructor(){super(...arguments),qs.set(this,void 0)}_parse(e){const t=be.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==J.string&&n.parsedType!==J.number){const s=be.objectValues(t);return V(n,{expected:be.joinValues(s),received:n.parsedType,code:j.invalid_type}),oe}if(Hi(this,qs)||Gg(this,qs,new Set(be.getValidEnumValues(this._def.values))),!Hi(this,qs).has(e.data)){const s=be.objectValues(t);return V(n,{received:n.data,code:j.invalid_enum_value,options:s}),oe}return pt(e.data)}get enum(){return this._def.values}}qs=new WeakMap;Sa.create=(r,e)=>new Sa({values:r,typeName:O.ZodNativeEnum,...ue(e)});class fs extends pe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.promise&&t.common.async===!1)return V(t,{code:j.invalid_type,expected:J.promise,received:t.parsedType}),oe;const n=t.parsedType===J.promise?t.data:Promise.resolve(t.data);return pt(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}fs.create=(r,e)=>new fs({type:r,typeName:O.ZodPromise,...ue(e)});class tr extends pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{V(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return oe;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?oe:l.status==="dirty"||t.value==="dirty"?Wn(l.value):l});{if(t.value==="aborted")return oe;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?oe:o.status==="dirty"||t.value==="dirty"?Wn(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?oe:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?oe:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!In(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>In(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);be.assertNever(s)}}tr.create=(r,e,t)=>new tr({schema:r,typeName:O.ZodEffects,effect:e,...ue(t)});tr.createWithPreprocess=(r,e,t)=>new tr({schema:e,effect:{type:"preprocess",transform:r},typeName:O.ZodEffects,...ue(t)});class Yt extends pe{_parse(e){return this._getType(e)===J.undefined?pt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Yt.create=(r,e)=>new Yt({innerType:r,typeName:O.ZodOptional,...ue(e)});class an extends pe{_parse(e){return this._getType(e)===J.null?pt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}an.create=(r,e)=>new an({innerType:r,typeName:O.ZodNullable,...ue(e)});class xa extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===J.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}xa.create=(r,e)=>new xa({innerType:r,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ue(e)});class Oa extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return pa(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new jt(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new jt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Oa.create=(r,e)=>new Oa({innerType:r,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ue(e)});class zi extends pe{_parse(e){if(this._getType(e)!==J.nan){const n=this._getOrReturnCtx(e);return V(n,{code:j.invalid_type,expected:J.nan,received:n.parsedType}),oe}return{status:"valid",value:e.data}}}zi.create=r=>new zi({typeName:O.ZodNaN,...ue(r)});const n0=Symbol("zod_brand");class sd extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ba extends pe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?oe:a.status==="dirty"?(t.dirty(),Wn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?oe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Ba({in:e,out:t,typeName:O.ZodPipeline})}}class Aa extends pe{_parse(e){const t=this._def.innerType._parse(e),n=s=>(In(s)&&(s.value=Object.freeze(s.value)),s);return pa(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Aa.create=(r,e)=>new Aa({innerType:r,typeName:O.ZodReadonly,...ue(e)});function $f(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Qg(r,e={},t){return r?ds.create().superRefine((n,s)=>{var a,i;const o=r(n);if(o instanceof Promise)return o.then(l=>{var u,c;if(!l){const d=$f(e,n),f=(c=(u=d.fatal)!==null&&u!==void 0?u:t)!==null&&c!==void 0?c:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const l=$f(e,n),u=(i=(a=l.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0;s.addIssue({code:"custom",...l,fatal:u})}}):ds.create()}const s0={object:Le.lazycreate};var O;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(O||(O={}));const a0=(r,e={message:`Input not instance of ${r.name}`})=>Qg(t=>t instanceof r,e),e_=Jt.create,t_=rn.create,i0=zi.create,o0=nn.create,r_=ma.create,l0=Rn.create,u0=qi.create,c0=ga.create,d0=_a.create,f0=ds.create,h0=En.create,p0=Mr.create,m0=Zi.create,g0=Xt.create,_0=Le.create,y0=Le.strictCreate,b0=ya.create,w0=ko.create,v0=ba.create,E0=vr.create,S0=wa.create,x0=Vi.create,O0=kn.create,A0=is.create,P0=va.create,T0=Ea.create,I0=sn.create,R0=Sa.create,k0=fs.create,Nf=tr.create,C0=Yt.create,$0=an.create,N0=tr.createWithPreprocess,j0=Ba.create,L0=()=>e_().optional(),M0=()=>t_().optional(),D0=()=>r_().optional(),F0={string:r=>Jt.create({...r,coerce:!0}),number:r=>rn.create({...r,coerce:!0}),boolean:r=>ma.create({...r,coerce:!0}),bigint:r=>nn.create({...r,coerce:!0}),date:r=>Rn.create({...r,coerce:!0})},U0=oe;var Sn=Object.freeze({__proto__:null,defaultErrorMap:cs,setErrorMap:Nv,getErrorMap:Ui,makeIssue:Bi,EMPTY_PATH:jv,addIssueToContext:V,ParseStatus:at,INVALID:oe,DIRTY:Wn,OK:pt,isAborted:Ju,isDirty:Ku,isValid:In,isAsync:pa,get util(){return be},get objectUtil(){return Gu},ZodParsedType:J,getParsedType:Rr,ZodType:pe,datetimeRegex:Xg,ZodString:Jt,ZodNumber:rn,ZodBigInt:nn,ZodBoolean:ma,ZodDate:Rn,ZodSymbol:qi,ZodUndefined:ga,ZodNull:_a,ZodAny:ds,ZodUnknown:En,ZodNever:Mr,ZodVoid:Zi,ZodArray:Xt,ZodObject:Le,ZodUnion:ya,ZodDiscriminatedUnion:ko,ZodIntersection:ba,ZodTuple:vr,ZodRecord:wa,ZodMap:Vi,ZodSet:kn,ZodFunction:is,ZodLazy:va,ZodLiteral:Ea,ZodEnum:sn,ZodNativeEnum:Sa,ZodPromise:fs,ZodEffects:tr,ZodTransformer:tr,ZodOptional:Yt,ZodNullable:an,ZodDefault:xa,ZodCatch:Oa,ZodNaN:zi,BRAND:n0,ZodBranded:sd,ZodPipeline:Ba,ZodReadonly:Aa,custom:Qg,Schema:pe,ZodSchema:pe,late:s0,get ZodFirstPartyTypeKind(){return O},coerce:F0,any:f0,array:g0,bigint:o0,boolean:r_,date:l0,discriminatedUnion:w0,effect:Nf,enum:I0,function:A0,instanceof:a0,intersection:v0,lazy:P0,literal:T0,map:x0,nan:i0,nativeEnum:R0,never:p0,null:d0,nullable:$0,number:t_,object:_0,oboolean:D0,onumber:M0,optional:C0,ostring:L0,pipeline:j0,preprocess:N0,promise:k0,record:S0,set:O0,strictObject:y0,string:e_,symbol:u0,transformer:Nf,tuple:E0,undefined:c0,union:b0,unknown:h0,void:m0,NEVER:U0,ZodIssueCode:j,quotelessJson:$v,ZodError:jt}),Rs={exports:{}},ul={},cl,jf;function B0(){if(jf)return cl;jf=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return cl=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var a=this._errors[s],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=n&&(t=a,n=o)}return t},cl}var Lf;function H0(){return Lf||(Lf=1,function(r){var e=B0();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<n.retries;i++)a.push(this.createTimeout(i,n));return t&&t.forever&&!a.length&&a.push(this.createTimeout(i,n)),a.sort(function(o,l){return o-l}),a},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,a=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return a=Math.min(a,n.maxTimeout),a},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],l=t[o];t[o]=(function(c){var d=r.operation(n),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(t,f)})}).bind(t,l),t[o].options=n}}}(ul)),ul}var dl,Mf;function q0(){return Mf||(Mf=1,dl=H0()),dl}var Df;function Z0(){if(Df)return Rs.exports;Df=1;const r=q0(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(i,o,l)=>{const u=l.retries-(o-1);return i.attemptNumber=o,i.retriesLeft=u,i},s=i=>e.includes(i),a=(i,o)=>new Promise((l,u)=>{o={onFailedAttempt:()=>{},retries:10,...o};const c=r.operation(o);c.attempt(async d=>{try{l(await i(d))}catch(f){if(!(f instanceof Error)){u(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)c.stop(),u(f.originalError);else if(f instanceof TypeError&&!s(f.message))c.stop(),u(f);else{n(f,d,o);try{await o.onFailedAttempt(f)}catch(h){u(h);return}c.retry(f)||u(c.mainError())}}})});return Rs.exports=a,Rs.exports.default=a,Rs.exports.AbortError=t,Rs.exports}var V0=Z0();const Wi=bs(V0),z0=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ys(r){return typeof r=="string"&&z0.test(r)}var Xe=[];for(var fl=0;fl<256;++fl)Xe.push((fl+256).toString(16).slice(1));function W0(r,e=0){return(Xe[r[e+0]]+Xe[r[e+1]]+Xe[r[e+2]]+Xe[r[e+3]]+"-"+Xe[r[e+4]]+Xe[r[e+5]]+"-"+Xe[r[e+6]]+Xe[r[e+7]]+"-"+Xe[r[e+8]]+Xe[r[e+9]]+"-"+Xe[r[e+10]]+Xe[r[e+11]]+Xe[r[e+12]]+Xe[r[e+13]]+Xe[r[e+14]]+Xe[r[e+15]]).toLowerCase()}var ii,G0=new Uint8Array(16);function J0(){if(!ii&&(ii=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ii))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ii(G0)}var K0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ff={randomUUID:K0};function ct(r,e,t){if(Ff.randomUUID&&!r)return Ff.randomUUID();r=r||{};var n=r.random||(r.rng||J0)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,W0(n)}var oi={},hl={exports:{}},Uf;function X0(){return Uf||(Uf=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,p){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,b,y;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,f),!0;case 5:return g.fn.call(g.context,c,d,f,h),!0;case 6:return g.fn.call(g.context,c,d,f,h,p),!0}for(y=1,b=new Array(_-1);y<_;y++)b[y-1]=arguments[y];g.fn.apply(g.context,b)}else{var w=g.length,S;for(y=0;y<w;y++)switch(g[y].once&&this.removeListener(u,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,c);break;case 3:g[y].fn.call(g[y].context,c,d);break;case 4:g[y].fn.call(g[y].context,c,d,f);break;default:if(!b)for(S=1,b=new Array(_-1);S<_;S++)b[S-1]=arguments[S];g[y].fn.apply(g[y].context,b)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==c||f&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[h]=g.length===1?g[0]:g:i(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(hl)),hl.exports}var ks={exports:{}},pl,Bf;function Y0(){return Bf||(Bf=1,pl=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),pl}var Hf;function Q0(){if(Hf)return ks.exports;Hf=1;const r=Y0();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(n);return}const l=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const u=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,c=a instanceof Error?a:new e(u);typeof n.cancel=="function"&&n.cancel(),o(c)},s);r(n.then(i,o),()=>{clearTimeout(l)})});return ks.exports=t,ks.exports.default=t,ks.exports.TimeoutError=e,ks.exports}var li={},ui={},qf;function eE(){if(qf)return ui;qf=1,Object.defineProperty(ui,"__esModule",{value:!0});function r(e,t,n){let s=0,a=e.length;for(;a>0;){const i=a/2|0;let o=s+i;n(e[o],t)<=0?(s=++o,a-=i+1):a=i}return s}return ui.default=r,ui}var Zf;function tE(){if(Zf)return li;Zf=1,Object.defineProperty(li,"__esModule",{value:!0});const r=eE();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=r.default(this._queue,a,(o,l)=>l.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return li.default=e,li}var Vf;function rE(){if(Vf)return oi;Vf=1,Object.defineProperty(oi,"__esModule",{value:!0});const r=X0(),e=Q0(),t=tE(),n=()=>{},s=new e.TimeoutError;class a extends r{constructor(o){var l,u,c,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(u=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(c=o.interval)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((u,c)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&c(s)});u(await f)}catch(f){c(f)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async u=>this.add(u,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return oi.default=a,oi}var nE=rE();const Lr=bs(nE),sE=(...r)=>fetch(...r),aE=Symbol.for("ls:fetch_implementation"),ee=()=>globalThis[aE]??sE,iE=[400,401,403,404,405,406,407,408],oE=[409];let zf=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Lr?this.queue=new Lr.default({concurrency:this.maxConcurrency}):this.queue=new Lr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>Wi(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(iE.includes(+i))throw s;if(oE.includes(+i))return;n&&await n(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>ee()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function Wf(r){return typeof(r==null?void 0:r._getType)=="function"}function Gf(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function de(r,e){if(!Ys(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const Jf={};function n_(r){Jf[r]||(console.warn(r),Jf[r]=!0)}var ci={exports:{}},ml,Kf;function Co(){if(Kf)return ml;Kf=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return ml={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ml}var gl,Xf;function $o(){if(Xf)return gl;Xf=1;var r={};return gl=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},gl}var Yf;function Ha(){return Yf||(Yf=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Co(),a=$o();e=r.exports={};const i=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[f,n]],p=g=>{for(const[_,b]of h)g=g.split(`${_}*`).join(`${_}{0,${b}}`).split(`${_}+`).join(`${_}{1,${b}}`);return g},m=(g,_,b)=>{const y=p(_),w=d++;a(g,w,_),c[g]=w,l[w]=_,u[w]=y,i[w]=new RegExp(_,b?"g":void 0),o[w]=new RegExp(y,b?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ci,ci.exports)),ci.exports}var _l,Qf;function ad(){if(Qf)return _l;Qf=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return _l=n=>n?typeof n!="object"?r:n:e,_l}var yl,eh;function s_(){if(eh)return yl;eh=1;const r=/^[0-9]+$/,e=(n,s)=>{const a=r.test(n),i=r.test(s);return a&&i&&(n=+n,s=+s),n===s?0:a&&!i?-1:i&&!a?1:n<s?-1:1};return yl={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},yl}var bl,th;function mt(){if(th)return bl;th=1;const r=$o(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Co(),{safeRe:n,safeSrc:s,t:a}=Ha(),i=ad(),{compareIdentifiers:o}=s_();class l{constructor(c,d){if(d=i(d),c instanceof l){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const f=c.trim().match(d.loose?n[a.LOOSE]:n[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<t)return p}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(r("SemVer.compare",this.version,this.options,c),!(c instanceof l)){if(typeof c=="string"&&c===this.version)return 0;c=new l(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof l||(c=new l(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof l||(c=new l(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const f=this.prerelease[d],h=c.prerelease[d];if(r("prerelease compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}compareBuild(c){c instanceof l||(c=new l(c,this.options));let d=0;do{const f=this.build[d],h=c.build[d];if(r("build compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}inc(c,d,f){if(c.startsWith("pre")){if(!d&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const h=new RegExp(`^${this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]}$`),p=`-${d}`.match(h);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,f),this.inc("pre",d,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,f),this.inc("pre",d,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(d){let p=[d,h];f===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return bl=l,bl}var wl,rh;function Ss(){if(rh)return wl;rh=1;const r=mt();return wl=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(a){if(!s)return null;throw a}},wl}var vl,nh;function lE(){if(nh)return vl;nh=1;const r=Ss();return vl=(t,n)=>{const s=r(t,n);return s?s.version:null},vl}var El,sh;function uE(){if(sh)return El;sh=1;const r=Ss();return El=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},El}var Sl,ah;function cE(){if(ah)return Sl;ah=1;const r=mt();return Sl=(t,n,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,a,i).version}catch{return null}},Sl}var xl,ih;function dE(){if(ih)return xl;ih=1;const r=Ss();return xl=(t,n)=>{const s=r(t,null,!0),a=r(n,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,l=o?s:a,u=o?a:s,c=!!l.prerelease.length;if(!!u.prerelease.length&&!c){if(!u.patch&&!u.minor)return"major";if(u.compareMain(l)===0)return u.minor&&!u.patch?"minor":"patch"}const f=c?"pre":"";return s.major!==a.major?f+"major":s.minor!==a.minor?f+"minor":s.patch!==a.patch?f+"patch":"prerelease"},xl}var Ol,oh;function fE(){if(oh)return Ol;oh=1;const r=mt();return Ol=(t,n)=>new r(t,n).major,Ol}var Al,lh;function hE(){if(lh)return Al;lh=1;const r=mt();return Al=(t,n)=>new r(t,n).minor,Al}var Pl,uh;function pE(){if(uh)return Pl;uh=1;const r=mt();return Pl=(t,n)=>new r(t,n).patch,Pl}var Tl,ch;function mE(){if(ch)return Tl;ch=1;const r=Ss();return Tl=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Tl}var Il,dh;function nr(){if(dh)return Il;dh=1;const r=mt();return Il=(t,n,s)=>new r(t,s).compare(new r(n,s)),Il}var Rl,fh;function gE(){if(fh)return Rl;fh=1;const r=nr();return Rl=(t,n,s)=>r(n,t,s),Rl}var kl,hh;function _E(){if(hh)return kl;hh=1;const r=nr();return kl=(t,n)=>r(t,n,!0),kl}var Cl,ph;function id(){if(ph)return Cl;ph=1;const r=mt();return Cl=(t,n,s)=>{const a=new r(t,s),i=new r(n,s);return a.compare(i)||a.compareBuild(i)},Cl}var $l,mh;function yE(){if(mh)return $l;mh=1;const r=id();return $l=(t,n)=>t.sort((s,a)=>r(s,a,n)),$l}var Nl,gh;function bE(){if(gh)return Nl;gh=1;const r=id();return Nl=(t,n)=>t.sort((s,a)=>r(a,s,n)),Nl}var jl,_h;function No(){if(_h)return jl;_h=1;const r=nr();return jl=(t,n,s)=>r(t,n,s)>0,jl}var Ll,yh;function od(){if(yh)return Ll;yh=1;const r=nr();return Ll=(t,n,s)=>r(t,n,s)<0,Ll}var Ml,bh;function a_(){if(bh)return Ml;bh=1;const r=nr();return Ml=(t,n,s)=>r(t,n,s)===0,Ml}var Dl,wh;function i_(){if(wh)return Dl;wh=1;const r=nr();return Dl=(t,n,s)=>r(t,n,s)!==0,Dl}var Fl,vh;function ld(){if(vh)return Fl;vh=1;const r=nr();return Fl=(t,n,s)=>r(t,n,s)>=0,Fl}var Ul,Eh;function ud(){if(Eh)return Ul;Eh=1;const r=nr();return Ul=(t,n,s)=>r(t,n,s)<=0,Ul}var Bl,Sh;function o_(){if(Sh)return Bl;Sh=1;const r=a_(),e=i_(),t=No(),n=ld(),s=od(),a=ud();return Bl=(o,l,u,c)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return r(o,u,c);case"!=":return e(o,u,c);case">":return t(o,u,c);case">=":return n(o,u,c);case"<":return s(o,u,c);case"<=":return a(o,u,c);default:throw new TypeError(`Invalid operator: ${l}`)}},Bl}var Hl,xh;function wE(){if(xh)return Hl;xh=1;const r=mt(),e=Ss(),{safeRe:t,t:n}=Ha();return Hl=(a,i)=>{if(a instanceof r)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const h=i.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const l=o[2],u=o[3]||"0",c=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",f=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${u}.${c}${d}${f}`,i)},Hl}var ql,Oh;function vE(){if(Oh)return ql;Oh=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,n)}return this}}return ql=r,ql}var Zl,Ah;function sr(){if(Ah)return Zl;Ah=1;const r=/\s+/g;class e{constructor(C,B){if(B=s(B),C instanceof e)return C.loose===!!B.loose&&C.includePrerelease===!!B.includePrerelease?C:new e(C.raw,B);if(C instanceof a)return this.raw=C.value,this.set=[[C]],this.formatted=void 0,this;if(this.options=B,this.loose=!!B.loose,this.includePrerelease=!!B.includePrerelease,this.raw=C.trim().replace(r," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(U=>!m(U[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const U of this.set)if(U.length===1&&g(U[0])){this.set=[U];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let C=0;C<this.set.length;C++){C>0&&(this.formatted+="||");const B=this.set[C];for(let N=0;N<B.length;N++)N>0&&(this.formatted+=" "),this.formatted+=B[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(C){const N=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+C,U=n.get(N);if(U)return U;const H=this.options.loose,ne=H?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];C=C.replace(ne,A(this.options.includePrerelease)),i("hyphen replace",C),C=C.replace(l[u.COMPARATORTRIM],c),i("comparator trim",C),C=C.replace(l[u.TILDETRIM],d),i("tilde trim",C),C=C.replace(l[u.CARETTRIM],f),i("caret trim",C);let ce=C.split(" ").map($e=>b($e,this.options)).join(" ").split(/\s+/).map($e=>k($e,this.options));H&&(ce=ce.filter($e=>(i("loose invalid filter",$e,this.options),!!$e.match(l[u.COMPARATORLOOSE])))),i("range list",ce);const te=new Map,ve=ce.map($e=>new a($e,this.options));for(const $e of ve){if(m($e))return[$e];te.set($e.value,$e)}te.size>1&&te.has("")&&te.delete("");const Me=[...te.values()];return n.set(N,Me),Me}intersects(C,B){if(!(C instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>_(N,B)&&C.set.some(U=>_(U,B)&&N.every(H=>U.every(ne=>H.intersects(ne,B)))))}test(C){if(!C)return!1;if(typeof C=="string")try{C=new o(C,this.options)}catch{return!1}for(let B=0;B<this.set.length;B++)if(M(this.set[B],C,this.options))return!0;return!1}}Zl=e;const t=vE(),n=new t,s=ad(),a=jo(),i=$o(),o=mt(),{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=Ha(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=Co(),m=R=>R.value==="<0.0.0-0",g=R=>R.value==="",_=(R,C)=>{let B=!0;const N=R.slice();let U=N.pop();for(;B&&N.length;)B=N.every(H=>U.intersects(H,C)),U=N.pop();return B},b=(R,C)=>(i("comp",R,C),R=x(R,C),i("caret",R),R=w(R,C),i("tildes",R),R=I(R,C),i("xrange",R),R=Y(R,C),i("stars",R),R),y=R=>!R||R.toLowerCase()==="x"||R==="*",w=(R,C)=>R.trim().split(/\s+/).map(B=>S(B,C)).join(" "),S=(R,C)=>{const B=C.loose?l[u.TILDELOOSE]:l[u.TILDE];return R.replace(B,(N,U,H,ne,ce)=>{i("tilde",R,N,U,H,ne,ce);let te;return y(U)?te="":y(H)?te=`>=${U}.0.0 <${+U+1}.0.0-0`:y(ne)?te=`>=${U}.${H}.0 <${U}.${+H+1}.0-0`:ce?(i("replaceTilde pr",ce),te=`>=${U}.${H}.${ne}-${ce} <${U}.${+H+1}.0-0`):te=`>=${U}.${H}.${ne} <${U}.${+H+1}.0-0`,i("tilde return",te),te})},x=(R,C)=>R.trim().split(/\s+/).map(B=>T(B,C)).join(" "),T=(R,C)=>{i("caret",R,C);const B=C.loose?l[u.CARETLOOSE]:l[u.CARET],N=C.includePrerelease?"-0":"";return R.replace(B,(U,H,ne,ce,te)=>{i("caret",R,U,H,ne,ce,te);let ve;return y(H)?ve="":y(ne)?ve=`>=${H}.0.0${N} <${+H+1}.0.0-0`:y(ce)?H==="0"?ve=`>=${H}.${ne}.0${N} <${H}.${+ne+1}.0-0`:ve=`>=${H}.${ne}.0${N} <${+H+1}.0.0-0`:te?(i("replaceCaret pr",te),H==="0"?ne==="0"?ve=`>=${H}.${ne}.${ce}-${te} <${H}.${ne}.${+ce+1}-0`:ve=`>=${H}.${ne}.${ce}-${te} <${H}.${+ne+1}.0-0`:ve=`>=${H}.${ne}.${ce}-${te} <${+H+1}.0.0-0`):(i("no pr"),H==="0"?ne==="0"?ve=`>=${H}.${ne}.${ce}${N} <${H}.${ne}.${+ce+1}-0`:ve=`>=${H}.${ne}.${ce}${N} <${H}.${+ne+1}.0-0`:ve=`>=${H}.${ne}.${ce} <${+H+1}.0.0-0`),i("caret return",ve),ve})},I=(R,C)=>(i("replaceXRanges",R,C),R.split(/\s+/).map(B=>W(B,C)).join(" ")),W=(R,C)=>{R=R.trim();const B=C.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return R.replace(B,(N,U,H,ne,ce,te)=>{i("xRange",R,N,U,H,ne,ce,te);const ve=y(H),Me=ve||y(ne),$e=Me||y(ce),gt=$e;return U==="="&&gt&&(U=""),te=C.includePrerelease?"-0":"",ve?U===">"||U==="<"?N="<0.0.0-0":N="*":U&&gt?(Me&&(ne=0),ce=0,U===">"?(U=">=",Me?(H=+H+1,ne=0,ce=0):(ne=+ne+1,ce=0)):U==="<="&&(U="<",Me?H=+H+1:ne=+ne+1),U==="<"&&(te="-0"),N=`${U+H}.${ne}.${ce}${te}`):Me?N=`>=${H}.0.0${te} <${+H+1}.0.0-0`:$e&&(N=`>=${H}.${ne}.0${te} <${H}.${+ne+1}.0-0`),i("xRange return",N),N})},Y=(R,C)=>(i("replaceStars",R,C),R.trim().replace(l[u.STAR],"")),k=(R,C)=>(i("replaceGTE0",R,C),R.trim().replace(l[C.includePrerelease?u.GTE0PRE:u.GTE0],"")),A=R=>(C,B,N,U,H,ne,ce,te,ve,Me,$e,gt)=>(y(N)?B="":y(U)?B=`>=${N}.0.0${R?"-0":""}`:y(H)?B=`>=${N}.${U}.0${R?"-0":""}`:ne?B=`>=${B}`:B=`>=${B}${R?"-0":""}`,y(ve)?te="":y(Me)?te=`<${+ve+1}.0.0-0`:y($e)?te=`<${ve}.${+Me+1}.0-0`:gt?te=`<=${ve}.${Me}.${$e}-${gt}`:R?te=`<${ve}.${Me}.${+$e+1}-0`:te=`<=${te}`,`${B} ${te}`.trim()),M=(R,C,B)=>{for(let N=0;N<R.length;N++)if(!R[N].test(C))return!1;if(C.prerelease.length&&!B.includePrerelease){for(let N=0;N<R.length;N++)if(i(R[N].semver),R[N].semver!==a.ANY&&R[N].semver.prerelease.length>0){const U=R[N].semver;if(U.major===C.major&&U.minor===C.minor&&U.patch===C.patch)return!0}return!1}return!0};return Zl}var Vl,Ph;function jo(){if(Ph)return Vl;Ph=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Vl=e;const t=ad(),{safeRe:n,t:s}=Ha(),a=o_(),i=$o(),o=mt(),l=sr();return Vl}var zl,Th;function Lo(){if(Th)return zl;Th=1;const r=sr();return zl=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},zl}var Wl,Ih;function EE(){if(Ih)return Wl;Ih=1;const r=sr();return Wl=(t,n)=>new r(t,n).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),Wl}var Gl,Rh;function SE(){if(Rh)return Gl;Rh=1;const r=mt(),e=sr();return Gl=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===-1)&&(i=u,o=new r(i,a))}),i},Gl}var Jl,kh;function xE(){if(kh)return Jl;kh=1;const r=mt(),e=sr();return Jl=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===1)&&(i=u,o=new r(i,a))}),i},Jl}var Kl,Ch;function OE(){if(Ch)return Kl;Ch=1;const r=mt(),e=sr(),t=No();return Kl=(s,a)=>{s=new e(s,a);let i=new r("0.0.0");if(s.test(i)||(i=new r("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let u=null;l.forEach(c=>{const d=new r(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!u||t(d,u))&&(u=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),u&&(!i||t(i,u))&&(i=u)}return i&&s.test(i)?i:null},Kl}var Xl,$h;function AE(){if($h)return Xl;$h=1;const r=sr();return Xl=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},Xl}var Yl,Nh;function cd(){if(Nh)return Yl;Nh=1;const r=mt(),e=jo(),{ANY:t}=e,n=sr(),s=Lo(),a=No(),i=od(),o=ud(),l=ld();return Yl=(c,d,f,h)=>{c=new r(c,h),d=new n(d,h);let p,m,g,_,b;switch(f){case">":p=a,m=o,g=i,_=">",b=">=";break;case"<":p=i,m=l,g=a,_="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(c,d,h))return!1;for(let y=0;y<d.set.length;++y){const w=d.set[y];let S=null,x=null;if(w.forEach(T=>{T.semver===t&&(T=new e(">=0.0.0")),S=S||T,x=x||T,p(T.semver,S.semver,h)?S=T:g(T.semver,x.semver,h)&&(x=T)}),S.operator===_||S.operator===b||(!x.operator||x.operator===_)&&m(c,x.semver))return!1;if(x.operator===b&&g(c,x.semver))return!1}return!0},Yl}var Ql,jh;function PE(){if(jh)return Ql;jh=1;const r=cd();return Ql=(t,n,s)=>r(t,n,">",s),Ql}var eu,Lh;function TE(){if(Lh)return eu;Lh=1;const r=cd();return eu=(t,n,s)=>r(t,n,"<",s),eu}var tu,Mh;function IE(){if(Mh)return tu;Mh=1;const r=sr();return tu=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),tu}var ru,Dh;function RE(){if(Dh)return ru;Dh=1;const r=Lo(),e=nr();return ru=(t,n,s)=>{const a=[];let i=null,o=null;const l=t.sort((f,h)=>e(f,h,s));for(const f of l)r(f,n,s)?(o=f,i||(i=f)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const u=[];for(const[f,h]of a)f===h?u.push(f):!h&&f===l[0]?u.push("*"):h?f===l[0]?u.push(`<=${h}`):u.push(`${f} - ${h}`):u.push(`>=${f}`);const c=u.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return c.length<d.length?c:n},ru}var nu,Fh;function kE(){if(Fh)return nu;Fh=1;const r=sr(),e=jo(),{ANY:t}=e,n=Lo(),s=nr(),a=(d,f,h={})=>{if(d===f)return!0;d=new r(d,h),f=new r(f,h);let p=!1;e:for(const m of d.set){for(const g of f.set){const _=l(m,g,h);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,f,h)=>{if(d===f)return!0;if(d.length===1&&d[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;h.includePrerelease?d=i:d=o}if(f.length===1&&f[0].semver===t){if(h.includePrerelease)return!0;f=o}const p=new Set;let m,g;for(const I of d)I.operator===">"||I.operator===">="?m=u(m,I,h):I.operator==="<"||I.operator==="<="?g=c(g,I,h):p.add(I.semver);if(p.size>1)return null;let _;if(m&&g){if(_=s(m.semver,g.semver,h),_>0)return null;if(_===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const I of p){if(m&&!n(I,String(m),h)||g&&!n(I,String(g),h))return null;for(const W of f)if(!n(I,String(W),h))return!1;return!0}let b,y,w,S,x=g&&!h.includePrerelease&&g.semver.prerelease.length?g.semver:!1,T=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;x&&x.prerelease.length===1&&g.operator==="<"&&x.prerelease[0]===0&&(x=!1);for(const I of f){if(S=S||I.operator===">"||I.operator===">=",w=w||I.operator==="<"||I.operator==="<=",m){if(T&&I.semver.prerelease&&I.semver.prerelease.length&&I.semver.major===T.major&&I.semver.minor===T.minor&&I.semver.patch===T.patch&&(T=!1),I.operator===">"||I.operator===">="){if(b=u(m,I,h),b===I&&b!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(I),h))return!1}if(g){if(x&&I.semver.prerelease&&I.semver.prerelease.length&&I.semver.major===x.major&&I.semver.minor===x.minor&&I.semver.patch===x.patch&&(x=!1),I.operator==="<"||I.operator==="<="){if(y=c(g,I,h),y===I&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(I),h))return!1}if(!I.operator&&(g||m)&&_!==0)return!1}return!(m&&w&&!g&&_!==0||g&&S&&!m&&_!==0||T||x)},u=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p>0?d:p<0||f.operator===">"&&d.operator===">="?f:d},c=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p<0?d:p>0||f.operator==="<"&&d.operator==="<="?f:d};return nu=a,nu}var su,Uh;function CE(){if(Uh)return su;Uh=1;const r=Ha(),e=Co(),t=mt(),n=s_(),s=Ss(),a=lE(),i=uE(),o=cE(),l=dE(),u=fE(),c=hE(),d=pE(),f=mE(),h=nr(),p=gE(),m=_E(),g=id(),_=yE(),b=bE(),y=No(),w=od(),S=a_(),x=i_(),T=ld(),I=ud(),W=o_(),Y=wE(),k=jo(),A=sr(),M=Lo(),R=EE(),C=SE(),B=xE(),N=OE(),U=AE(),H=cd(),ne=PE(),ce=TE(),te=IE(),ve=RE(),Me=kE();return su={parse:s,valid:a,clean:i,inc:o,diff:l,major:u,minor:c,patch:d,prerelease:f,compare:h,rcompare:p,compareLoose:m,compareBuild:g,sort:_,rsort:b,gt:y,lt:w,eq:S,neq:x,gte:T,lte:I,cmp:W,coerce:Y,Comparator:k,Range:A,satisfies:M,toComparators:R,maxSatisfying:C,minSatisfying:B,minVersion:N,validRange:U,outside:H,gtr:ne,ltr:ce,intersects:te,simplifyRange:ve,subset:Me,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},su}CE();function Zr(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${r}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class $E extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function ge(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new $E(s):new Error(s)}var Bh="[...]",NE={result:"[Circular]"},Gi=[],Gn=[];const jE=new TextEncoder;function LE(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function di(r){return jE.encode(r)}function At(r,e,t,n){var s;try{const a=JSON.stringify(r,e,t);return di(a)}catch(a){if(!((s=a.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),di("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=LE()),Yu(r,"",0,[],void 0,0,n);let i;try{Gn.length===0?i=JSON.stringify(r,e,t):i=JSON.stringify(r,ME(e),t)}catch{return di("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Gi.length!==0;){const o=Gi.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return di(i)}}function au(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Gi.push([n,t,e,s])):Gn.push([e,t,r]):(n[t]=r,Gi.push([n,t,e]))}function Yu(r,e,t,n,s,a,i){a+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){au(NE,r,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){au(Bh,r,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){au(Bh,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Yu(r[o],o,o,n,r,a,i);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var u=l[o];Yu(r[u],u,o,n,r,a,i)}}n.pop()}}function ME(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Gn.length>0)for(var n=0;n<Gn.length;n++){var s=Gn[n];if(s[1]===e&&s[0]===t){t=s[2],Gn.splice(n,1);break}}return r.call(this,e,t)}}function Hh(r){const e=c_(),t=KE(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const DE=r=>{const e=(r==null?void 0:r.toString())??Yr("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},FE=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function UE(r){const e=[];for await(const t of r)e.push(t);return e}function iu(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const BE=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function qh(r){return typeof r=="number"?Number(r.toFixed(4)):r}class HE{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(a=>{t=a}),s=At(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),n+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),n+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const qE=20971520,ZE=2500;class Pa{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new HE}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:xn("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Pa.getDefaultClientConfig();if(this.tracingSampleRate=DE(e.tracingSamplingRate),this.apiUrl=iu(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=iu(e.apiKey??t.apiKey),this.webUrl=iu(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new zf(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new zf({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:BE}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Yr("API_KEY"),t=Yr("ENDPOINT")??"https://api.smith.langchain.com",n=Yr("HIDE_INPUTS")==="true",s=Yr("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:FE(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${l_}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(ee(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(ee(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(ee(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?n.push(s):this.filteredPostUuids.add(a):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??qE}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const a=this._processBatch(n,s).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(n=a==null?void 0:a.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Hh(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await ee()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(ZE),...this.fetchOptions});return await ge(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=Hh(s),i=await this.caller.call(ee(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:At(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((u,c)=>(c.id&&(u[c.id]=c),u),{}),l=[];for(const u of s)u.id!==void 0&&o[u.id]?o[u.id]={...o[u.id],...u}:l.push(u);n=Object.values(o),s=l}const a={post:n,patch:s};if(!a.post.length&&!a.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const l=o,u=a[l].reverse();let c=u.pop();for(;c!==void 0;)i[l].push(c),c=u.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(At(i))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(ee(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const c=s.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",s],["patch",a]])for(const f of d){const{inputs:h,outputs:p,events:m,attachments:g,..._}=f,b={inputs:h,outputs:p,events:m},y=At(_);u.push({name:`${c}.${_.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[w,S]of Object.entries(b)){if(S===void 0)continue;const x=At(S);u.push({name:`${c}.${_.id}.${w}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})})}if(_.id!==void 0){const w=n[_.id];if(w){delete n[_.id];for(const[S,x]of Object.entries(w)){let T,I;if(Array.isArray(x)?[T,I]=x:(T=x.mimeType,I=x.data),S.includes(".")){console.warn(`Skipping attachment '${S}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${_.id}.${S}`,payload:new Blob([I],{type:`${T}; length=${I.byteLength}`})})}}}l.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const i=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(ee(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){de(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(ee(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:At(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){de(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:Yr("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await UE(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=n[e.id]||[];for(const a in n)a!==e.id&&(s[a].child_runs=n[a]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:g,limit:_,select:b}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const T=Array.isArray(n)?n:[n],I=await Promise.all(T.map(W=>this.readProject({projectName:W}).then(Y=>Y.id)));y.push(...I)}const w=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],S={session:y.length?y:null,run_type:c,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:_,trace:a,select:b||w,is_root:u};let x=0;for await(const T of this._getCursorPaginatedList("/runs/query",S))if(_){if(x>=_)break;if(T.length+x>_){yield*T.slice(0,_-x);break}x+=T.length,yield*T}else yield*T}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:g}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(x=>this.readProject({projectName:x}).then(T=>T.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:_,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:g}).filter(([x,T])=>T!==void 0));return await(await this.caller.call(ee(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||ct()};de(e);const a=await(await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){de(e);const t=await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(t,"unshare run",!0)}async readRunSharedLink(e){de(e);const n=await(await this.caller.call(ee(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)n.append("id",i);return de(e),await(await this.caller.call(ee(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),de(e);const s=await(await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};de(e);const a=await(await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){de(e);const t=await this.caller.call(ee(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(t,"unshare dataset",!0)}async readSharedDataset(e){return de(e),await(await this.caller.call(ee(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const a=await this.caller.call(ee(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};n&&(u.metadata=n);const c={name:e,extra:u,description:t};i!==null&&(c.reference_dataset_id=i);const d=await this.caller.call(ee(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;s&&(l={...l||{},metadata:s});const u={name:t,extra:l,description:n,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(ee(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)de(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(ee(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)de(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,de(n);const s=await this.caller.call(ee(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),n.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);const c=await this.caller.call(ee(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(ee(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)de(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const u of n)l.append("id",u);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;de(a);const i=await this.caller.call(ee(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;de(i);const o=await this.caller.call(ee(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)de(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(ee(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(a,`delete ${n}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),de(s);const a={tag:n},i=await this.caller.call(ee(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(i,"index dataset"),await i.json()}async similarExamples(e,t,n,{filter:s}={}){const a={limit:n,inputs:e};s!==void 0&&(a.filter=s),de(t);const i=await this.caller.call(ee(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,n){var c;if(Zh(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const a=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;Zh(e)?o=e:o={inputs:e,outputs:t,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??ct())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const b=e;let y=b[0].dataset_id;const w=b[0].dataset_name;if(y===void 0&&w===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&w!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:w})).id);const S=await this._uploadExamplesMultipart(y,b);return await Promise.all(S.example_ids.map(T=>this.readExample(T)))}const{inputs:t,outputs:n,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:u,exampleIds:c,datasetId:d,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let h=d;const p=f;if(h===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(await this.readDataset({datasetName:p})).id);const m=t.map((b,y)=>({dataset_id:h,inputs:b,outputs:n==null?void 0:n[y],metadata:s==null?void 0:s[y],split:a==null?void 0:a[y],id:c==null?void 0:c[y],attachments:u==null?void 0:u[y],source_run_id:i==null?void 0:i[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:l==null?void 0:l[y]})),g=await this._uploadExamplesMultipart(h,m);return await Promise.all(g.example_ids.map(b=>this.readExample(b)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(i=>Wf(i)?Gf(i):i),a=Wf(t)?Gf(t):t;return this.createExample({input:s},{output:a},n)}async readExample(e){de(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...a}=n,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:u,filter:c,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:f}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&h.append("as_of",p);const m=i??!0;if(h.append("inline_s3_urls",m.toString()),n!==void 0)for(const _ of n)h.append("id",_);if(a!==void 0)for(const _ of a)h.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);h.append("metadata",_)}l!==void 0&&h.append("limit",l.toString()),u!==void 0&&h.append("offset",u.toString()),c!==void 0&&h.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>h.append("select",_));let g=0;for await(const _ of this._getPaginated("/examples",h)){for(const b of _){const{attachment_urls:y,...w}=b,S=w;y&&(S.attachments=Object.entries(y).reduce((x,[T,I])=>(x[T.slice(11)]={presigned_url:I.presigned_url,mime_type:I.mime_type||void 0},x),{})),yield S,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){de(e);const t=`/examples/${e}`,n=await this.caller.call(ee(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,de(n);let s;t?s={id:n,...t}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,de(a),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(ee(),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,de(s);const a=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,de(i);const o={split_name:n,examples:s.map(u=>(de(u),u)),remove:a},l=await this.caller.call(ee(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){n_("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a),[l,u]=await this._logEvaluationFeedback(o,i,n);return u[0]}async createFeedback(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var b;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((b=p.metadata.__run)==null?void 0:b.run_id)!==void 0&&de(p.metadata.__run.run_id);const m={id:c??ct(),run_id:e,key:t,score:qh(n),value:s,correction:a,comment:i,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},g=`${this.apiUrl}/feedback`,_=await this.caller.call(ee(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(_,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:a}){const i={};t!=null&&(i.score=qh(t)),n!=null&&(i.value=n),s!=null&&(i.correction=s),a!=null&&(i.comment=a),de(e);const o=await this.caller.call(ee(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(o,"update feedback",!0)}async readFeedback(e){de(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){de(e);const t=`/feedback/${e}`,n=await this.caller.call(ee(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const a of t)s.append("key",a);if(n)for(const a of n)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const a={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?a.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(a.expires_in=n):a.expires_in={hours:3},await(await this.caller.call(ee(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:a,created_at:(c=s??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(ee(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){de(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((l,u)=>{de(l,`queueIds[${u}]`),i.append("ids",l)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,a={name:t,description:n,id:s||ct()},i=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,a=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(a,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>de(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${de(e,"queueId")}/run`,s=await this.caller.call(ee(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/runs/${de(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(ee(),`${this.apiUrl}/annotation-queues/${de(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(ee(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,a]=Zr(e),i=await this.caller.call(ee(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[t,n,s]=Zr(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=Zr(e),a=await this.caller.call(ee(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await ge(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=Zr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(ee(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=Zr(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(ee(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(u,"create commit");const c=await u.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const l of t){const u=l.id,c={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=At(c),f=new Blob([d],{type:"application/json"});if(n.append(u,f),l.inputs){const h=At(l.inputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.inputs`,p)}if(l.outputs){const h=At(l.outputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.outputs`,p)}if(l.attachments)for(const[h,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const _=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${u}.attachment.${h}`,_)}if(l.attachments_operations){const h=At(l.attachments_operations),p=new Blob([h],{type:"application/json"});n.append(`${u}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(ee(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const i of t){const o=(i.id??ct()).toString(),l={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=At(l),c=new Blob([u],{type:"application/json"});if(n.append(o,c),i.inputs){const d=At(i.inputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,f)}if(i.outputs){const d=At(i.outputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,f)}if(i.attachments)for(const[d,f]of Object.entries(i.attachments)){let h,p;Array.isArray(f)?[h,p]=f:(h=f.mimeType,p=f.data);const m=new Blob([p],{type:`${h}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}return await(await this.caller.call(ee(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=Zr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(ee(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ge(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=Zr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(ee(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,a]=Zr(e),i=await this.caller.call(ee(),`${this.apiUrl}/commits/${n}/${s}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ge(i,"pull prompt commit");const o=await i.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,n),o=new Pa({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(i),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return de(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function Zh(r){return"dataset_id"in r||"dataset_name"in r}const l_="0.3.15";var Qs={};let Ar;const VE=()=>typeof window<"u"&&typeof window.document<"u",zE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",WE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),u_=()=>typeof Deno<"u",GE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!u_(),JE=()=>Ar||(VE()?Ar="browser":GE()?Ar="node":zE()?Ar="webworker":WE()?Ar="jsdom":u_()?Ar="deno":Ar="other",Ar);let ou;function c_(){if(ou===void 0){const r=JE(),e=YE();ou={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:l_,...e}}return ou}function KE(){const r=XE()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function XE(){try{return typeof process<"u"&&Qs?Object.entries(Qs).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function xn(r){try{return typeof process<"u"?Qs==null?void 0:Qs[r]:void 0}catch{return}}function Yr(r){return xn(`LANGSMITH_${r}`)||xn(`LANGCHAIN_${r}`)}let lu;function YE(){if(lu!==void 0)return lu;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=xn(t);n!==void 0&&(e[t]=n)}return lu=e,e}const QE=r=>!!["TRACING_V2","TRACING"].find(t=>Yr(t)==="true"),uu=Symbol.for("lc:context_variables");function eS(r){return r.replace(/[-:.]/g,"")}function tS(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return eS(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Ji{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let n={},s=[];for(const a of t){const[i,o]=a.split("="),l=decodeURIComponent(o);i==="langsmith-metadata"?n=JSON.parse(l):i==="langsmith-tags"&&(s=l.split(","))}return new Ji(n,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class kt{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),d_(e)){Object.assign(this,{...e});return}const t=kt.getDefaultConfig(),{metadata:n,...s}=e,a=s.client??kt.getSharedClient(),i={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=tS(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:ct(),run_type:"chain",project_name:Yr("PROJECT")??xn("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:xn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:xn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return kt.sharedClient||(kt.sharedClient=new Pa),kt.sharedClient}createChild(e){var l,u,c,d,f,h;const t=this.child_execution_order+1,n=new kt({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});uu in this&&(n[uu]=this[uu]);const s=Symbol.for("lc:child_config"),a=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(nS(a)){const p={...a},m=rS(p.callbacks)?(c=(u=p.callbacks).copy)==null?void 0:c.call(u):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(h=(f=(d=m.handlers)==null?void 0:d.find(f_))==null?void 0:f.updateFromRunTree)==null||h.call(f,n),p.callbacks=m),n.extra[s]=p}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[u,c]of Object.entries(t))s.runtime[u]||(s.runtime[u]=c);let a,i;return n?(i=(l=e.parent_run)==null?void 0:l.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=c_(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){n_("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var u,c,d,f;const n=e==null?void 0:e.callbacks;let s,a,i,o=QE();if(n){const h=((u=n==null?void 0:n.getParentRunId)==null?void 0:u.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),a=p==null?void 0:p.projectName,i=p==null?void 0:p.client,o=o||!!p}return s?new kt({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=s==null?void 0:s.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new kt({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(c=>{const[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=i[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=i.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:a};if(n.baggage&&typeof n.baggage=="string"){const c=Ji.fromHeader(n.baggage);l.metadata=c.metadata,l.tags=c.tags}return new kt(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Ji((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[s,a]of Object.entries(t))e.set(s,a);return t}}Object.defineProperty(kt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function d_(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function f_(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Vh(r){return Array.isArray(r)&&r.some(e=>f_(e))}function rS(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function nS(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(Vh((e=r.callbacks)==null?void 0:e.handlers)||Vh(r.callbacks))}let sS=class{getStore(){}run(e,t){return t()}};const cu=Symbol.for("ls:tracing_async_local_storage"),aS=new sS;let iS=class{getInstance(){return globalThis[cu]??aS}initializeGlobalInstance(e){globalThis[cu]===void 0&&(globalThis[cu]=e)}};const oS=new iS,lS=()=>{const r=oS.getInstance().getStore();if(!d_(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function dd(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const uS=Object.prototype.hasOwnProperty;function Qu(r,e){return uS.call(r,e)}function ec(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Qu(r,t)&&e.push(t);return e}function mr(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function tc(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Bn(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function cS(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function rc(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(rc(r[t]))return!0}else if(typeof r=="object"){const t=ec(r),n=t.length;for(var e=0;e<n;e++)if(rc(r[t[e]]))return!0}}return!1}function zh(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class dS extends Error{constructor(e,t,n,s,a){super(zh(e,{name:t,index:n,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=zh(e,{name:t,index:n,operation:s,tree:a})}}const De=dS,Jn={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=nc(t,this.path);n&&(n=mr(n));const s=ea(t,{op:"remove",path:this.from}).removed;return ea(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=nc(t,this.from);return ea(t,{op:"add",path:this.path,value:mr(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Xi(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var fS={add:function(r,e,t){return tc(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Jn.move,copy:Jn.copy,test:Jn.test,_get:Jn._get};function nc(r,e){if(e=="")return r;var t={op:"_get",path:e};return ea(r,t),t.value}function ea(r,e,t=!1,n=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):sc(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=nc(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=Xi(r,e.value),i.test===!1)throw new De("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new De("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,r);return i}}else{n||(r=mr(r));const o=(e.path||"").split("/");let l=r,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=sc;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=cS(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,r,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!tc(f))throw new De("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,r);tc(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new De("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,r);const p=fS[e.op].call(e,l,f,r);if(p.test===!1)throw new De("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}}else if(u>=c){const p=Jn[e.op].call(e,l,f,r);if(p.test===!1)throw new De("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new De("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,r)}}}function Ki(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new De("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=mr(r));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=ea(r,e[i],t,!0,s,i),r=a[i].newDocument;return a.newDocument=r,a}function sc(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new De("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Jn[r.op]){if(typeof r.path!="string")throw new De("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new De('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new De("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new De("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&rc(r.value))throw new De("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new De("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new De("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=hS([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new De("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new De("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function hS(r,e,t){try{if(!Array.isArray(r))throw new De("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ki(mr(e),mr(r),t||!0);else{t=t||sc;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof De)return s;throw s}}function Xi(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,a,i;if(t&&n){if(a=r.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!Xi(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!Xi(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function h_(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=ec(e),i=ec(r),o=!1,l=i.length-1;l>=0;l--){var u=i[l],c=r[u];if(Qu(e,u)&&!(e[u]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?h_(c,d,t,n+"/"+Bn(u),s):c!==d&&(s&&t.push({op:"test",path:n+"/"+Bn(u),value:mr(c)}),t.push({op:"replace",path:n+"/"+Bn(u),value:mr(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Bn(u),value:mr(c)}),t.push({op:"remove",path:n+"/"+Bn(u)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&a.length==i.length))for(var l=0;l<a.length;l++){var u=a[l];!Qu(r,u)&&e[u]!==void 0&&t.push({op:"add",path:n+"/"+Bn(u),value:mr(e[u])})}}}function pS(r,e,t=!1){var n=[];return h_(r,e,n,"",t),n}var du={};const mS=()=>typeof window<"u"&&typeof window.document<"u",gS=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_S=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),fd=()=>typeof Deno<"u",yS=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!fd(),bS=()=>{let r;return mS()?r="browser":yS()?r="node":gS()?r="webworker":_S()?r="jsdom":fd()?r="deno":r="other",r};let fu;async function wS(){return fu===void 0&&(fu={library:"langchain-js",runtime:bS()}),fu}function _r(r){try{return typeof process<"u"?du==null?void 0:du[r]:fd()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class vS{}function ES(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class qa extends vS{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,qg(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:_r("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Tn.prototype.toJSON.call(this)}toJSONNotImplemented(){return Tn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends qa{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ct()}),Object.assign(this,e)}}return new t}}const SS=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function hu(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function xS(r){return r.replace(/[-:.]/g,"")}function OS(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return xS(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function Cs(r){return typeof r._addRunToRunMap=="function"}class Za extends qa{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=OS(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=hu(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=hu(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=hu(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onToolStart)==null?void 0:c.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,a,i){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}var Pi={exports:{}};Pi.exports;var Wh;function AS(){return Wh||(Wh=1,function(r){const t=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,n=(a=0)=>(i,o,l)=>`\x1B[${38+a};2;${i};${o};${l}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,l]of Object.entries(i)){for(const[u,c]of Object.entries(l))i[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=i[u],a.set(c[0],c[1]);Object.defineProperty(i,o,{value:l,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=n(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}(Pi)),Pi.exports}var PS=AS();const p_=bs(PS);function it(r,e){return`${r.open}${e}${r.close}`}function Mt(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function Gh(r){return typeof r=="string"?r.trim():r==null?r:Mt(r,r.toString())}function Vr(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:yt}=p_;class Jh extends Za{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?it(p_.bold,o):o}).join(" > ");return it(yt.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Mt(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.cyan,"[chain/end]")} [${t}] [${Vr(e)}] Exiting Chain run with output: ${Mt(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.red,"[chain/error]")} [${t}] [${Vr(e)}] Chain run errored with error: ${Mt(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${it(yt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Mt(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.cyan,"[llm/end]")} [${t}] [${Vr(e)}] Exiting LLM run with output: ${Mt(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.red,"[llm/error]")} [${t}] [${Vr(e)}] LLM run errored with error: ${Mt(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Gh(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${it(yt.cyan,"[tool/end]")} [${t}] [${Vr(e)}] Exiting Tool run with output: "${Gh((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.red,"[tool/error]")} [${t}] [${Vr(e)}] Tool run errored with error: ${Mt(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Mt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.cyan,"[retriever/end]")} [${t}] [${Vr(e)}] Exiting Retriever run with output: ${Mt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${it(yt.red,"[retriever/error]")} [${t}] [${Vr(e)}] Retriever run errored with error: ${Mt(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${it(yt.blue,"[agent/action]")} [${n}] Agent selected action: ${Mt(t.actions[t.actions.length-1],"[action]")}`)}}let pu;const TS=()=>{if(pu===void 0){const r=_r("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};pu=new Pa(r)}return pu};class ta extends Za{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??_r("LANGCHAIN_PROJECT")??_r("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??TS();const a=ta.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await wS()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const a=s.shift();!a||n.has(a.id)||(n.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,a]of this.runMap){const i=new kt({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,n.push([s,a.dotted_order])}n.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(const[s]of n){const a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){const o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return lS()}catch{return}}}const m_=Symbol.for("ls:tracing_async_local_storage"),Ti=Symbol.for("lc:context_variables"),IS=r=>{globalThis[m_]=r},Ta=()=>globalThis[m_];let ra;function RS(){const r="default"in Lr?Lr.default:Lr;return new r({autoStart:!0,concurrency:1})}function kS(){return typeof ra>"u"&&(ra=RS()),ra}async function qe(r,e){if(e===!0){const t=Ta();t!==void 0?await t.run(void 0,async()=>r()):await r()}else ra=kS(),ra.add(async()=>{const t=Ta();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const CS=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>_r(t)==="true");function g_(r){var n;const e=Ta();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Ti])==null?void 0:n[r]}const $S=Symbol("lc:configure_hooks"),NS=()=>g_($S)||[];class jS{setHandler(e){return this.setHandlers([e])}}class Mo{constructor(e,t,n,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class LS extends Mo{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Kh extends Mo{async handleLLMNewToken(e,t,n,s,a,i){await Promise.all(this.handlers.map(o=>qe(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleLLMEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class MS extends Mo{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class DS extends Mo{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>qe(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class wt extends jS{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ct();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Cs(f)&&f._createRunForLLMStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),qe(async()=>{var h;try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new Kh(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ct();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Cs(f)&&f._createRunForChatModelStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),qe(async()=>{var h,p;try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=zg(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new Kh(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=ct(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Cs(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),qe(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new MS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=ct(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Cs(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),qe(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new DS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=ct(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Cs(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),qe(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new LS(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>qe(async()=>{var o;if(!i.ignoreCustomEvent)try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,n,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new wt(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);n.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);n.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)n.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends qa{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ct()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,a,i,o){return this._configureSync(e,t,n,s,a,i,o)}static _configureSync(e,t,n,s,a,i,o){var f,h;let l;(e||t)&&(Array.isArray(e)||!e?(l=new wt,l.setHandlers((e==null?void 0:e.map(Yi))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(Yi):t==null?void 0:t.handlers,!1));const u=_r("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=((f=ta.getTraceableRunTree())==null?void 0:f.tracingEnabled)||CS(),d=c||(_r("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new wt),u&&!l.handlers.some(p=>p.name===Jh.prototype.name)){const p=new Jh;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new ta;l.addHandler(p,!0),l._parentRunId=((h=ta.getTraceableRunTree())==null?void 0:h.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:_}of NS()){const b=_&&_r(_)==="true"&&g;let y;const w=p!==void 0?g_(p):void 0;w&&SS(w)?y=w:b&&(y=new g({})),y!==void 0&&(l||(l=new wt),l.handlers.some(S=>S.name===y.name)||l.addHandler(y,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}function Yi(r){return"name"in r?r:qa.fromMethods(r)}class FS{getStore(){}run(e,t){return t()}enterWith(e){}}const US=new FS,Xh=Symbol.for("lc:child_config");class BS{getInstance(){return Ta()??US}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[Xh]}runWithConfig(e,t,n){var c;const s=wt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),i=a.getStore(),o=s==null?void 0:s.getParentRunId(),l=(c=s==null?void 0:s.handlers)==null?void 0:c.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let u;return l&&o?u=l.convertToRunTree(o):n||(u=new kt({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[Xh]:e}),i!==void 0&&i[Ti]!==void 0&&(u===void 0&&(u={}),u[Ti]=i[Ti]),a.run(u,t)}initializeGlobalInstance(e){Ta()===void 0&&IS(e)}}const on=new BS,mu=25;async function Qt(r){return wt._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Yh(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(Yi(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(Yi(o),!0);e.callbacks=i}else e.callbacks=new wt(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const HS=new Set(["string","number","boolean"]);function xe(r){var n;const e=on.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;t=Object.entries(i).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),t)}if(r&&(t=Object.entries(r).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))HS.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function nt(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:a,runId:i}={}){const o=xe(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function hs(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function ln(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Lt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Lt({start(n){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){n.close();return}return n.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Lt({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function __(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const a=await r.next();for(const i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function er(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=er(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class xs{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{on.runWithConfig(hs(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(a=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?on.runWithConfig(hs(this.config),this.signal?async()=>ln(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function qS(r,e,t,n,...s){const a=new xs({generator:e,startSetup:t,signal:n}),i=await a.setup;return{output:r(a,i,...s),setup:i}}class Jr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=Ki({},t);return new Ia({ops:t,state:n[n.length-1].newDocument})}}class Ia extends Jr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=Ki(this.state,e.ops);return new Ia({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=Ki({},e.ops);return new Ia({ops:e.ops,state:t[t.length-1].newDocument})}}const ZS=r=>r.name==="log_stream_tracer";async function Qh(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function ep(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function VS(r){return r!==void 0&&r.message!==void 0}class tp extends Za{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Lt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Jr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Jr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Qh(e,this._schemaFormat)),await this.writer.write(new Jr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Qh(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await ep(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Jr({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Jr({ops:[{op:"replace",path:"/final_output",value:await ep(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?VS(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new tn({id:`run-${e.id}`,content:t}):i=t;const o=new Jr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}const rp="__run";class ps{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ps({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Cn extends ps{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Cn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function fi({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const zS=r=>r.name==="event_stream_tracer";class WS extends Za{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Lt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new ps({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(l=>{o=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:a(s.runType,n.value)}},s),yield n.value;for await(const u of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:a(s.runType,u)}},s),yield u}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var i,o;const t=fi(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?a=new tn({content:t,id:`run-${e.id}`}):a=n.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?a=new ps({text:t}):a=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(t.runType==="chat_model"){for(const u of s??[]){if(a!==void 0)break;a=(o=u[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")a={generations:s==null?void 0:s.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var i,o;const t=fi(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,a;const t=fi(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,i;const t=fi(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const GS=[400,401,402,403,404,405,406,407,409],JS=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&GS.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class hd{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??JS;const t="default"in Lr?Lr.default:Lr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Wi(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class y_ extends Za{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function pd(r){return r?r.lc_runnable:!1}class KS{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),n}}const XS=Symbol("Let zodToJsonSchema decide on which parser to use"),YS={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},QS=r=>({...YS,...r}),ex=r=>{const e=QS(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function b_(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Pe(r,e,t,n,s){r[e]=t,b_(r,e,n,s)}function tx(){return{}}function rx(r,e){var n,s,a;const t={type:"array"};return(n=r.type)!=null&&n._def&&((a=(s=r.type)==null?void 0:s._def)==null?void 0:a.typeName)!==O.ZodAny&&(t.items=Oe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Pe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Pe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Pe(t,"minItems",r.exactLength.value,r.exactLength.message,e),Pe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function nx(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Pe(t,"minimum",n.value,n.message,e):Pe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Pe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Pe(t,"maximum",n.value,n.message,e):Pe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Pe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Pe(t,"multipleOf",n.value,n.message,e);break}return t}function sx(){return{type:"boolean"}}function w_(r,e){return Oe(r.type._def,e)}const ax=(r,e)=>Oe(r.innerType._def,e);function v_(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>v_(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ix(r,e)}}const ix=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Pe(t,"minimum",n.value,n.message,e);break;case"max":Pe(t,"maximum",n.value,n.message,e);break}return t};function ox(r,e){return{...Oe(r.innerType._def,e),default:r.defaultValue()}}function lx(r,e){return e.effectStrategy==="input"?Oe(r.schema._def,e):{}}function ux(r){return{type:"string",enum:Array.from(r.values)}}const cx=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function dx(r,e){const t=[Oe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Oe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(cx(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function fx(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let gu;const Bt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gu===void 0&&(gu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function E_(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":Pe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":Pe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ht(t,"email",n.message,e);break;case"format:idn-email":Ht(t,"idn-email",n.message,e);break;case"pattern:zod":ot(t,Bt.email,n.message,e);break}break;case"url":Ht(t,"uri",n.message,e);break;case"uuid":Ht(t,"uuid",n.message,e);break;case"regex":ot(t,n.regex,n.message,e);break;case"cuid":ot(t,Bt.cuid,n.message,e);break;case"cuid2":ot(t,Bt.cuid2,n.message,e);break;case"startsWith":ot(t,RegExp(`^${_u(n.value,e)}`),n.message,e);break;case"endsWith":ot(t,RegExp(`${_u(n.value,e)}$`),n.message,e);break;case"datetime":Ht(t,"date-time",n.message,e);break;case"date":Ht(t,"date",n.message,e);break;case"time":Ht(t,"time",n.message,e);break;case"duration":Ht(t,"duration",n.message,e);break;case"length":Pe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),Pe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{ot(t,RegExp(_u(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Ht(t,"ipv4",n.message,e),n.version!=="v4"&&Ht(t,"ipv6",n.message,e);break}case"base64url":ot(t,Bt.base64url,n.message,e);break;case"jwt":ot(t,Bt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&ot(t,Bt.ipv4Cidr,n.message,e),n.version!=="v4"&&ot(t,Bt.ipv6Cidr,n.message,e);break}case"emoji":ot(t,Bt.emoji(),n.message,e);break;case"ulid":{ot(t,Bt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ht(t,"binary",n.message,e);break}case"contentEncoding:base64":{Pe(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{ot(t,Bt.base64,n.message,e);break}}break}case"nanoid":ot(t,Bt.nanoid,n.message,e)}return t}function _u(r,e){return e.patternStrategy==="escape"?px(r):r}const hx=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function px(r){let e="";for(let t=0;t<r.length;t++)hx.has(r[t])||(e+="\\"),e+=r[t];return e}function Ht(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Pe(r,"format",e,t,n)}function ot(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:np(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Pe(r,"pattern",np(e,n),t,n)}function np(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",a=!1,i=!1,o=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(t.i){if(i){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&((l=n[u+2])!=null&&l.match(/[a-z]/))?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function S_(r,e){var n,s,a,i,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===O.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>({...u,[c]:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===O.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=E_(r.keyType._def,e);return{...t,propertyNames:c}}else{if(((i=r.keyType)==null?void 0:i._def.typeName)===O.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===O.ZodBranded&&r.keyType._def.type._def.typeName===O.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=w_(r.keyType._def,e);return{...t,propertyNames:c}}}return t}function mx(r,e){if(e.mapStrategy==="record")return S_(r,e);const t=Oe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function gx(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function _x(){return{not:{}}}function yx(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Qi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bx(r,e){if(e.target==="openApi3")return sp(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Qi&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=Qi[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return sp(r,e)}const sp=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Oe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function wx(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Qi[r.innerType._def.typeName],nullable:!0}:{type:[Qi[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function vx(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",b_(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Pe(t,"minimum",n.value,n.message,e):Pe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Pe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Pe(t,"maximum",n.value,n.message,e):Pe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Pe(t,"maximum",n.value,n.message,e));break;case"multipleOf":Pe(t,"multipleOf",n.value,n.message,e);break}return t}function Ex(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],a=r.shape();for(const o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let u=xx(l);u&&t&&(l instanceof Yt&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=Oe(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(n.properties[o]=c,u||s.push(o))}s.length&&(n.required=s);const i=Sx(r,e);return i!==void 0&&(n.additionalProperties=i),n}function Sx(r,e){if(r.catchall._def.typeName!=="ZodNever")return Oe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function xx(r){try{return r.isOptional()}catch{return!0}}const Ox=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Oe(r.innerType._def,e);const t=Oe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Ax=(r,e)=>{if(e.pipeStrategy==="input")return Oe(r.in._def,e);if(e.pipeStrategy==="output")return Oe(r.out._def,e);const t=Oe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Oe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function Px(r,e){return Oe(r.type._def,e)}function Tx(r,e){const n={type:"array",uniqueItems:!0,items:Oe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Pe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Pe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function Ix(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Oe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Oe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Oe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function Rx(){return{not:{}}}function kx(){return{}}const Cx=(r,e)=>Oe(r.innerType._def,e),$x=(r,e,t)=>{switch(e){case O.ZodString:return E_(r,t);case O.ZodNumber:return vx(r,t);case O.ZodObject:return Ex(r,t);case O.ZodBigInt:return nx(r,t);case O.ZodBoolean:return sx();case O.ZodDate:return v_(r,t);case O.ZodUndefined:return Rx();case O.ZodNull:return yx(t);case O.ZodArray:return rx(r,t);case O.ZodUnion:case O.ZodDiscriminatedUnion:return bx(r,t);case O.ZodIntersection:return dx(r,t);case O.ZodTuple:return Ix(r,t);case O.ZodRecord:return S_(r,t);case O.ZodLiteral:return fx(r,t);case O.ZodEnum:return ux(r);case O.ZodNativeEnum:return gx(r);case O.ZodNullable:return wx(r,t);case O.ZodOptional:return Ox(r,t);case O.ZodMap:return mx(r,t);case O.ZodSet:return Tx(r,t);case O.ZodLazy:return()=>r.getter()._def;case O.ZodPromise:return Px(r,t);case O.ZodNaN:case O.ZodNever:return _x();case O.ZodEffects:return lx(r,t);case O.ZodAny:return tx();case O.ZodUnknown:return kx();case O.ZodDefault:return ox(r,t);case O.ZodBranded:return w_(r,t);case O.ZodReadonly:return Cx(r,t);case O.ZodCatch:return ax(r,t);case O.ZodPipeline:return Ax(r,t);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(n=>{})()}};function Oe(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==XS)return l}if(n&&!t){const l=Nx(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=$x(r,r.typeName,e),i=typeof a=="function"?Oe(a(),e):a;if(i&&Lx(r,e,i),e.postProcess){const l=e.postProcess(i,r,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}const Nx=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:jx(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},jx=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},Lx=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),Va=(r,e)=>{const t=ex(e),n=void 0,s=e==null?void 0:e.name,a=Oe(r._def,t,!1)??{},i=s===void 0?n?{...a,[t.definitionPath]:n}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:a}};return t.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function yu(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const Mx=["*","_","`"];function Dx(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function Fx(r,e,t){const{firstNode:n,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const h="default",p={[h]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const _=g.name.split(":").pop()??"";let y=Mx.some(S=>_.startsWith(S)&&_.endsWith(S))?`<p>${_}</p>`:_;Object.keys(g.metadata??{}).length&&(y+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([S,x])=>`${S} = ${x}`).join(`
`)}</em></small>`);const w=(p[m]??p[h]).replace("{0}",yu(m)).replace("{1}",y);u+=`	${w}
`}}const c={};for(const h of e){const p=h.source.split(":"),m=h.target.split(":"),g=p.filter((_,b)=>_===m[b]).join(":");c[g]||(c[g]=[]),c[g].push(h)}const d=new Set;function f(h,p){const m=h.length===1&&h[0].source===h[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),u+=`	subgraph ${g}
`}for(const g of h){const{source:_,target:b,data:y,conditional:w}=g;let S="";if(y!==void 0){let x=y;const T=x.split(" ");T.length>l&&(x=Array.from({length:Math.ceil(T.length/l)},(I,W)=>T.slice(W*l,(W+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),S=w?` -. &nbsp;${x}&nbsp; .-> `:` -- &nbsp;${x}&nbsp; --> `}else S=w?" -.-> ":" --> ";u+=`	${yu(_)}${S}${yu(b)};
`}for(const g in c)g.startsWith(`${p}:`)&&g!==p&&f(c[g],g);p&&!m&&(u+=`	end
`)}f(c[""]??[],"");for(const h in c)!h.includes(":")&&h!==""&&f(c[h],h);return i&&(u+=Dx(a??{})),u}async function Ux(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function Bx(r,e){if(r!==void 0&&!Ys(r))return r;if(pd(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function Hx(r){return pd(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Va(r.data.schema),title:r.data.name}}}class Do{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Ys(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...Hx(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??ct(),a={id:s,data:e,name:Bx(t,e),metadata:n};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(a),a}firstNode(){return ap(this)}lastNode(){return ip(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(u=>u.id).every(Ys)&&(n="");const a=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[a(u)]={...c,id:a(u)}});const i=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&ap(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&ip(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const a=e[s];return Ys(s)&&t.get(a)===1?a:s};return new Do({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[n(s),{...a,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),l=i.lastNode();return Fx(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return Ux(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function ap(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function ip(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function qx(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Lt.fromReadableStream(t)}function op(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const Zx=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function ac(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*lp(r,e){for(;;){const{value:t,done:n}=on.runWithConfig(hs(r),e.next.bind(e),!0);if(n)break;yield t}}async function*ic(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await on.runWithConfig(hs(r),t.next.bind(e),!0);if(s)break;yield n}}function We(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class Ge extends Tn{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new On({bound:this,kwargs:e,config:{}})}map(){return new eo({bound:this})}withRetry(e){return new Vx({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new On({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new Wx({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(xe);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>xe(a===0?e:n))}return Array.from({length:t},()=>xe(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new hd({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>i.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=xe(t),s=new xs({generator:this._streamIterator(e,n),config:n});return await s.setup,Lt.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=xe(e):t=xe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=xe(n),a=await Qt(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),We(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,i);o=await ln(l,n==null?void 0:n.signal)}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(We(o,"output"))),o}async _batchWithConfig(e,t,n,s){var u;const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(Qt)),o=await Promise.all(i.map(async(c,d)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),We(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,f}));let l;try{const c=e.call(this,t,a,o,s);l=await ln(c,(u=a==null?void 0:a[0])==null?void 0:u.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(We(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,a=!0,i,o=!0;const l=xe(n),u=await Qt(l);async function*c(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=er(s,f)}catch{s=void 0,a=!1}yield f}}let d;try{const f=await qS(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=f.setup;const h=d==null?void 0:d.handlers.find(zS);let p=f.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(ZS);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(i===void 0)i=g;else try{i=er(i,g)}catch{i=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:We(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:We(s,"input")}))}getGraph(e){const t=new Do,n=t.addNode({name:`${this.getName()}Input`,schema:Sn.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Sn.any()});return t.addEdge(n,s),t.addEdge(s,a),t}pipe(e){return new $r({first:this,last:wn(e)})}pick(e){return this.pipe(new Gx(e))}assign(e){return this.pipe(new x_(new Os({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=er(n,s);yield*this._streamIterator(n,xe(t))}async*streamLog(e,t,n){const s=new tp({...n,autoClose:!1,_schemaFormat:"original"}),a=xe(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const a=this.stream(e,n);async function i(){try{const l=await a;for await(const u of l){const c=new Jr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=i();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?qx(s):Lt.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new WS({...n,autoClose:!1}),a=xe(t),i=a.runId??ct();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),a.callbacks=m}const l=new AbortController,u=this;async function c(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await u.stream(e,{...a,signal:m}),_=s.tapOutputIterable(i,g);for await(const b of _)if(l.signal.aborted)break}finally{await s.finish()}}const d=c();let f=!1,h;try{for await(const m of s){if(!f){m.data.input=e,f=!0,h=m.run_id,yield m;continue}m.run_id===h&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,a=!1;const i=xe(t),o=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new tp({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new KS({...n}),f=this._streamLog(e,c,i);for await(const p of f){if(s?s=s.concat(p):s=Ia.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const b={...s.state},y={run_id:b.id,event:`on_${b.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,b.type)&&(yield y)}const m=p.ops.filter(b=>b.path.startsWith("/logs/")).map(b=>b.path.split("/")[2]),g=[...new Set(m)];for(const b of g){let y,w={};const S=s.state.logs[b];if(S.end_time===void 0?S.streamed_output.length>0?y="stream":y="start":y="end",y==="start")S.inputs!==void 0&&(w.input=S.inputs);else if(y==="end")S.inputs!==void 0&&(w.input=S.inputs),w.output=S.final_output;else if(y==="stream"){const x=S.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${S.name}"`);w={chunk:S.streamed_output[0]},S.streamed_output=[]}yield{event:`on_${S.type}_${y}`,name:S.name,run_id:S.id,tags:S.tags,metadata:S.metadata,data:w}}const{state:_}=s;if(_.streamed_output.length>0){const b=_.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${_.name}"`);const y={chunk:_.streamed_output[0]};_.streamed_output=[];const w={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:l,name:u,data:y};d.includeEvent(w,_.type)&&(yield w)}}const h=s==null?void 0:s.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return pd(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new On({bound:this,config:{},configFactories:[s=>({callbacks:[new y_({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return Jx(this,e)}}class On extends Ge{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Yh(this.config,...e);return Yh(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(xe(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(xe(a),this.kwargs))):await this._mergeConfig(xe(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(xe(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(xe(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(xe(t),this.kwargs))}streamEvents(e,t,n){const s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(xe(t),s.kwargs),version:t.version},n)};return Lt.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&Ge.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new On({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new y_({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class eo extends Ge{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new eo({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,nt(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new eo({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class Vx extends On{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return nt(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return Wi(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const a={};try{await Wi(async i=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(i,t==null?void 0:t[f],n==null?void 0:n[f])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class $r extends Ge{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=xe(t),s=await Qt(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),We(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let i=e,o;try{const u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){const f=u[c].invoke(i,nt(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));i=await ln(f,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(i,nt(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(We(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(Qt)),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),We(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const d=this.steps[u].batch(o,i.map((f,h)=>{const p=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return nt(s[h],{callbacks:p})}),n);o=await ln(d,(l=s[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(i.map(u=>u==null?void 0:u.handleChainEnd(We(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await Qt(t),{runId:s,...a}=t??{},i=await(n==null?void 0:n.handleChainStart(this.toJSON(),We(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let f=o[0].transform(c(),nt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<o.length;h+=1)f=await o[h].transform(f,nt(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of f)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield h,l)if(u===void 0)u=h;else try{u=er(u,h)}catch{u=void 0,l=!1}}catch(f){throw await(i==null?void 0:i.handleChainError(f)),f}await(i==null?void 0:i.handleChainEnd(We(u,"output")))}getGraph(e){const t=new Do;let n=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=i.lastNode()}),t}pipe(e){return $r.isRunnableSequence(e)?new $r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new $r({first:this.first,middle:[...this.middle,this.last],last:wn(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Ge.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new $r({...s,first:wn(e),middle:t.slice(0,-1).map(wn),last:wn(t[t.length-1])})}}class Os extends Ge{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=wn(n)}static from(e){return new Os({steps:e})}async invoke(e,t){const n=xe(t),s=await Qt(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const i={};try{const o=Object.entries(this.steps).map(async([l,u])=>{i[l]=await u.invoke(e,nt(n,{callbacks:a==null?void 0:a.getChild(`map:key:${l}`)}))});await ln(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,t,n){const s={...this.steps},a=__(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],u)=>{const c=l.transform(a[u],nt(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:l,result:u,gen:c}=await ln(o,n==null?void 0:n.signal);i.delete(l),u.done||(yield{[l]:u.value},i.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=xe(t),a=new xs({generator:this.transform(n(),s),config:s});return await a.setup,Lt.fromAsyncGenerator(a)}}class md extends Ge{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!dd(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await Qt(n),a=this.func(nt(n,{callbacks:s}),e);return ln(a,n==null?void 0:n.signal)}async*_streamIterator(e,t){var a,i;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(ac(s)){for await(const o of s)(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),yield o;return}if(Zx(s)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new md({func:e})}}function zx(r){if(dd(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class As extends Ge{static lc_name(){return"RunnableLambda"}constructor(e){if(dd(e.func))return md.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),zx(e.func),this.func=e.func}static from(e){return new As({func:e})}async _invoke(e,t,n){return new Promise((s,a)=>{const i=nt(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??mu)-1});on.runWithConfig(hs(i),async()=>{var o,l;try{let u=await this.func(e,{...i});if(u&&Ge.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...i,recursionLimit:(i.recursionLimit??mu)-1})}else if(ac(u)){let c;for await(const d of ic(i,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),c===void 0)c=d;else try{c=er(c,d)}catch{c=d}u=c}else if(op(u)){let c;for(const d of lp(i,u))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),c===void 0)c=d;else try{c=er(c,d)}catch{c=d}u=c}s(u)}catch(u){a(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const u of e)if(s===void 0)s=u;else try{s=er(s,u)}catch{s=u}const a=nt(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??mu)-1}),i=await new Promise((u,c)=>{on.runWithConfig(hs(a),async()=>{try{const d=await this.func(s,{...a,config:a});u(d)}catch(d){c(d)}})});if(i&&Ge.isRunnable(i)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await i.stream(s,a);for await(const c of u)yield c}else if(ac(i))for await(const u of ic(a,i))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield u;else if(op(i))for(const u of lp(a,i))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield u;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=xe(t),a=new xs({generator:this.transform(n(),s),config:s});return await a.setup,Lt.fromAsyncGenerator(a)}}class Wx extends Ge{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=xe(t),s=await Qt(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),We(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),l=nt(i,{callbacks:o==null?void 0:o.getChild()});return await on.runWithConfig(l,async()=>{var d;let c;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const h=await f.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(We(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,t){var d;const n=xe(t),s=await Qt(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),We(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let l,u;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const h=nt(i,{callbacks:o==null?void 0:o.getChild()});try{const p=await f.stream(e,h);u=ic(h,p);break}catch(p){l===void 0&&(l=p)}}if(u===void 0){const f=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let c;try{for await(const f of u){yield f;try{c=c===void 0?c:er(c,f)}catch{c=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(We(c,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(u=>Qt(u))),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),We(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o;for(const u of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const c=await u.batch(e,i.map((d,f)=>nt(s[f],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,f)=>d==null?void 0:d.handleChainEnd(We(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function wn(r){if(typeof r=="function")return new As({func:r});if(Ge.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=wn(n);return new Os({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class x_ extends Ge{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Os&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[a,i]=__(e),o=this.mapper.transform(i,nt(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=xe(t),a=new xs({generator:this.transform(n(),s),config:s});return await a.setup,Lt.fromAsyncGenerator(a)}}class Gx extends Ge{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=xe(t),a=new xs({generator:this.transform(n(),s),config:s});return await a.setup,Lt.fromAsyncGenerator(a)}}class up extends On{constructor(e){const t=$r.from([As.from(async n=>{let s;if(Vg(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new Iv("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function Jx(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===Sn.ZodString?new up({name:t,description:n,schema:Sn.object({input:Sn.string()}).transform(a=>a.input),bound:r}):new up({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var Kx=typeof window=="object"?window:{},he="0123456789abcdef".split(""),Xx=[-2147483648,8388608,32768,128],qt=[24,16,8,0],Ve=[];function rr(r){r?(Ve[0]=Ve[16]=Ve[1]=Ve[2]=Ve[3]=Ve[4]=Ve[5]=Ve[6]=Ve[7]=Ve[8]=Ve[9]=Ve[10]=Ve[11]=Ve[12]=Ve[13]=Ve[14]=Ve[15]=0,this.blocks=Ve):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}rr.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===Kx.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,a=r.length||0,i=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;n<a&&s<64;++n)i[s>>2]|=r[n]<<qt[s++&3];else for(s=this.start;n<a&&s<64;++n)t=r.charCodeAt(n),t<128?i[s>>2]|=t<<qt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<qt[s++&3],i[s>>2]|=(128|t&63)<<qt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<qt[s++&3],i[s>>2]|=(128|t>>6&63)<<qt[s++&3],i[s>>2]|=(128|t&63)<<qt[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),i[s>>2]|=(240|t>>18)<<qt[s++&3],i[s>>2]|=(128|t>>12&63)<<qt[s++&3],i[s>>2]|=(128|t>>6&63)<<qt[s++&3],i[s>>2]|=(128|t&63)<<qt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};rr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=Xx[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};rr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&n,o=r<<5|r>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=r&e|~r&t,o=s<<5|s>>>27,n=o+a+n+1518500249+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|~s&e,o=n<<5|n>>>27,t=o+a+t+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|~n&r,o=t<<5|t>>>27,e=o+a+e+1518500249+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|~t&s,o=e<<5|e>>>27,r=o+a+r+1518500249+l[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n+1859775393+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e+1859775393+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r+1859775393+l[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+a+n-1894007588+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+a+t-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+a+e-1894007588+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+a+r-1894007588+l[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n-899497514+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e-899497514+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r-899497514+l[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};rr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return he[r>>28&15]+he[r>>24&15]+he[r>>20&15]+he[r>>16&15]+he[r>>12&15]+he[r>>8&15]+he[r>>4&15]+he[r&15]+he[e>>28&15]+he[e>>24&15]+he[e>>20&15]+he[e>>16&15]+he[e>>12&15]+he[e>>8&15]+he[e>>4&15]+he[e&15]+he[t>>28&15]+he[t>>24&15]+he[t>>20&15]+he[t>>16&15]+he[t>>12&15]+he[t>>8&15]+he[t>>4&15]+he[t&15]+he[n>>28&15]+he[n>>24&15]+he[n>>20&15]+he[n>>16&15]+he[n>>12&15]+he[n>>8&15]+he[n>>4&15]+he[n&15]+he[s>>28&15]+he[s>>24&15]+he[s>>20&15]+he[s>>16&15]+he[s>>12&15]+he[s>>8&15]+he[s>>4&15]+he[s&15]};rr.prototype.toString=rr.prototype.hex;rr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};rr.prototype.array=rr.prototype.digest;rr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const Yx=r=>new rr(!0).update(r).hex(),cp=(...r)=>Yx(r.join("_"));class Qx{}const eO=new Map;class gd extends Qx{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(cp(e,t))??null)}async update(e,t,n){this.cache.set(cp(e,t),n)}static global(){return new gd(eO)}}class O_ extends Tn{}class tO extends O_{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Io(this.value)]}}class rO extends O_{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return zg(this.messages)}toChatMessages(){return this.messages}}var $s={},dp;function nO(){if(dp)return $s;dp=1,$s.byteLength=o,$s.toByteArray=u,$s.fromByteArray=f;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=n.length;s<a;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function i(h){var p=h.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=h.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(h){var p=i(h),m=p[0],g=p[1];return(m+g)*3/4-g}function l(h,p,m){return(p+m)*3/4-m}function u(h){var p,m=i(h),g=m[0],_=m[1],b=new t(l(h,g,_)),y=0,w=_>0?g-4:g,S;for(S=0;S<w;S+=4)p=e[h.charCodeAt(S)]<<18|e[h.charCodeAt(S+1)]<<12|e[h.charCodeAt(S+2)]<<6|e[h.charCodeAt(S+3)],b[y++]=p>>16&255,b[y++]=p>>8&255,b[y++]=p&255;return _===2&&(p=e[h.charCodeAt(S)]<<2|e[h.charCodeAt(S+1)]>>4,b[y++]=p&255),_===1&&(p=e[h.charCodeAt(S)]<<10|e[h.charCodeAt(S+1)]<<4|e[h.charCodeAt(S+2)]>>2,b[y++]=p>>8&255,b[y++]=p&255),b}function c(h){return r[h>>18&63]+r[h>>12&63]+r[h>>6&63]+r[h&63]}function d(h,p,m){for(var g,_=[],b=p;b<m;b+=3)g=(h[b]<<16&16711680)+(h[b+1]<<8&65280)+(h[b+2]&255),_.push(c(g));return _.join("")}function f(h){for(var p,m=h.length,g=m%3,_=[],b=16383,y=0,w=m-g;y<w;y+=b)_.push(d(h,y,y+b>w?w:y+b));return g===1?(p=h[m-1],_.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(h[m-2]<<8)+h[m-1],_.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),_.join("")}return $s}var sO=nO();const aO=bs(sO);var iO=Object.defineProperty,oO=(r,e,t)=>e in r?iO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lO=(r,e,t)=>(oO(r,e+"",t),t);function uO(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const a=r.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function cO(r,e){return r.length===1?[e.get(r.join(","))]:uO(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function dO(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var oc=class{constructor(r,e){Fr(this,"specialTokens");Fr(this,"inverseSpecialTokens");Fr(this,"patStr");Fr(this,"textEncoder",new TextEncoder);Fr(this,"textDecoder",new TextDecoder("utf-8"));Fr(this,"rankMap",new Map);Fr(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((u,c)=>n[u]=l+c),n},{});for(const[n,s]of Object.entries(t)){const a=aO.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=oc.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){const u=oc.specialTokenRegex([...o]),c=r.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(r),!(u==null||i.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??r.length;for(const h of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(h[0]),m=this.rankMap.get(p.join(","));if(m!=null){a.push(m);continue}a.push(...cO(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),l=u.index+u[0].length}return a}decode(r){const e=[];let t=0;for(let a=0;a<r.length;++a){const i=r[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},A_=oc;lO(A_,"specialTokenRegex",r=>new RegExp(r.map(e=>dO(e)).join("|"),"g"));function fO(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const hi={},hO=new hd({});async function pO(r){return r in hi||(hi[r]=hO.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new A_(e)).catch(e=>{throw delete hi[r],e})),await hi[r]}async function mO(r){return pO(fO(r))}const gO=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function P_(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const _O=()=>!1;class yO extends Ge{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??_O(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class bO extends yO{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...a}=n;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=gd.global():this.cache=void 0,this.caller=new hd(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await mO("modelName"in this?gO(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new tO(e):Array.isArray(e)?new rO(e.map(Bs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class to extends Ge{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=xe(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=xe(t);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,a)if(s===void 0)s=i;else try{s=er(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new x_(new Os({steps:e}))}}function T_(r){return typeof(r==null?void 0:r.parse)=="function"}class Kr extends bO{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=Kr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===Kr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const a=Kr._convertInputToPromptValue(e).toChatMessages(),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...i.metadata,...this.getLsParams(o)},u=await wt.configure(i.callbacks,this.callbacks,i.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[a],i.runId,void 0,c,void 0,void 0,i.runName));let f,h;try{for await(const p of this._streamResponseChunks(a,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,f?f=f.concat(p):f=p,Rf(p.message)&&p.message.usage_metadata!==void 0&&(h={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[f]],llmOutput:h})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,f;const a=e.map(h=>h.map(Bs));let i;if(s!==void 0&&s.length===a.length)i=s;else{const h={...n.metadata,...this.getLsParams(t)},p=await wt.configure(n.callbacks,this.callbacks,n.tags,this.tags,h,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};i=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),a,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(i!=null&&i[0].handlers.find(ES))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==Kr.prototype._streamResponseChunks)try{const h=await this._streamResponseChunks(a[0],t,i==null?void 0:i[0]);let p,m;for await(const g of h){if(g.message.id==null){const _=(d=i==null?void 0:i.at(0))==null?void 0:d.runId;_!=null&&g.message._updateId(`run-${_}`)}p===void 0?p=g:p=er(p,g),Rf(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(i==null?void 0:i[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(h){throw await(i==null?void 0:i[0].handleLLMError(h)),h}else{const h=await Promise.allSettled(a.map((p,m)=>this._generate(p,{...t,promptIndex:m},i==null?void 0:i[m])));await Promise.all(h.map(async(p,m)=>{var g,_,b;if(p.status==="fulfilled"){const y=p.value;for(const w of y.generations){if(w.message.id==null){const S=(g=i==null?void 0:i.at(0))==null?void 0:g.runId;S!=null&&w.message._updateId(`run-${S}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[m]=y.generations,l[m]=y.llmOutput,(_=i==null?void 0:i[m])==null?void 0:_.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((b=i==null?void 0:i[m])==null?void 0:b.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const c={generations:o,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(c,rp,{value:i?{runIds:i==null?void 0:i.map(h=>h.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:a}){const i=e.map(g=>g.map(Bs)),o={...a.metadata,...this.getLsParams(s)},l=await wt.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},c=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),i,a.runId,void 0,u,void 0,void 0,a.runName)),d=[],h=(await Promise.allSettled(i.map(async(g,_)=>{const b=Kr._convertInputToPromptValue(g).toString(),y=await t.lookup(b,n);return y==null&&d.push(_),y}))).map((g,_)=>({result:g,runManager:c==null?void 0:c[_]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(h.map(async({result:g,runManager:_},b)=>{if(g.status==="fulfilled"){const y=g.value;return p[b]=y.map(w=>("message"in w&&Ao(w.message)&&Fa(w.message)&&(w.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),w.generationInfo={...w.generationInfo,tokenUsage:{}},w)),y.length&&await(_==null?void 0:_.handleLLMNewToken(y[0].text)),_==null?void 0:_.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,rp,{value:c?{runIds:c==null?void 0:c.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const a=e.map(p=>p.map(Bs)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(a,o,i);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:f}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:i});let h={};if(d.length>0){const p=await this._generateUncached(d.map(m=>a[m]),o,i,f!==void 0?d.map(m=>f==null?void 0:f[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const _=d[g];c[_]=m;const b=Kr._convertInputToPromptValue(a[_]).toString();return l.update(b,u,m)})),h=p.llmOutput??{}}return{generations:c,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(a=>a.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Bs)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new Io(e),a=await this.call([s],t,n);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,a=n.description??"A function available to call.",i=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;T_(n)?u=[{type:"function",function:{name:l,description:a,parameters:Va(n)}}]:("name"in n&&(l=n.name),u=[{type:"function",function:{name:l,description:a,parameters:n}}]);const c=this.bindTools(u),d=As.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(_=>_.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});const f=to.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),h=to.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[h]});return $r.from([{raw:c},p]).withConfig({runName:"StructuredOutputRunnable"})}}class wO extends Ge{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class I_ extends wO{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class _d extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Zg(this,"OUTPUT_PARSING_FAILURE")}}function lc(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!lc(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!lc(r[i],e[i]))return!1;return!0}return r===e}class vO extends I_{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class R_ extends vO{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(Av(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Cn({message:s,text:s.content})}else if(Ao(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Cn({message:Cv(s),text:s.content})}else a=new ps({text:s});n===void 0?n=a:n=n.concat(a);const i=await this.parsePartialResult([n]);i!=null&&!lc(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}}class fp extends I_{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=Sn.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,Sn.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Va(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new _d(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class hp extends R_{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?pS(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Af(e[0].text)}async parse(e){return Af(e,JSON.parse)}getFormatInstructions(){return""}}function yd(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=rd(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new _d([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function EO(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function k_(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class SO extends R_{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var i;const n=e[0].message;let s;if(Fa(n)&&((i=n.tool_calls)!=null&&i.length)?s=n.tool_calls.map(o=>{const{id:l,...u}=o;return this.returnId?{id:l,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>yd(l,{returnId:this.returnId,partial:t}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};a.push(l)}return a}}class pp extends SO{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new _d(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}}const xO=Symbol("Let zodToJsonSchema decide on which parser to use"),mp={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},OO=r=>typeof r=="string"?{...mp,basePath:["#"],definitions:{},name:r}:{...mp,basePath:["#"],definitions:{},...r},uc=r=>"_def"in r?r._def:r;function AO(r){if(!r)return!0;for(const e in r)return!1;return!0}const PO=r=>{const e=OO(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[uc(s),{def:uc(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function C_(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Te(r,e,t,n,s){r[e]=t,C_(r,e,n,s)}function TO(){return{}}function IO(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==O.ZodAny&&(t.items=we(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Te(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Te(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Te(t,"minItems",r.exactLength.value,r.exactLength.message,e),Te(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function RO(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Te(t,"minimum",n.value,n.message,e):Te(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Te(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Te(t,"maximum",n.value,n.message,e):Te(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Te(t,"maximum",n.value,n.message,e));break;case"multipleOf":Te(t,"multipleOf",n.value,n.message,e);break}return t}function kO(){return{type:"boolean"}}function CO(r,e){return we(r.type._def,e)}const $O=(r,e)=>we(r.innerType._def,e);function $_(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>$_(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return NO(r,e)}}const NO=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Te(t,"minimum",n.value,n.message,e);break;case"max":Te(t,"maximum",n.value,n.message,e);break}return t};function jO(r,e){return{...we(r.innerType._def,e),default:r.defaultValue()}}function LO(r,e,t){return e.effectStrategy==="input"?we(r.schema._def,e,t):{}}function MO(r){return{type:"string",enum:[...r.values]}}const DO=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function FO(r,e){const t=[we(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),we(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(DO(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function UO(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let bu;const mn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(bu===void 0&&(bu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),bu),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function N_(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?BO(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Zt(t,"email",s.message,e);break;case"format:idn-email":Zt(t,"idn-email",s.message,e);break;case"pattern:zod":Vt(t,mn.email,s.message,e);break}break;case"url":Zt(t,"uri",s.message,e);break;case"uuid":Zt(t,"uuid",s.message,e);break;case"regex":Vt(t,s.regex,s.message,e);break;case"cuid":Vt(t,mn.cuid,s.message,e);break;case"cuid2":Vt(t,mn.cuid2,s.message,e);break;case"startsWith":Vt(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":Vt(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Zt(t,"date-time",s.message,e);break;case"date":Zt(t,"date",s.message,e);break;case"time":Zt(t,"time",s.message,e);break;case"duration":Zt(t,"duration",s.message,e);break;case"length":Te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Vt(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Zt(t,"ipv4",s.message,e),s.version!=="v4"&&Zt(t,"ipv6",s.message,e);break}case"emoji":Vt(t,mn.emoji,s.message,e);break;case"ulid":{Vt(t,mn.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Zt(t,"binary",s.message,e);break}case"contentEncoding:base64":{Te(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Vt(t,mn.base64,s.message,e);break}}break}case"nanoid":Vt(t,mn.nanoid,s.message,e)}return t}const BO=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Zt=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Te(r,"format",e,t,n)},Vt=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:gp(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Te(r,"pattern",gp(e,n),t,n)},gp=(r,e)=>{var u;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let a="",i=!1,o=!1,l=!1;for(let c=0;c<s.length;c++){if(i){a+=s[c],i=!1;continue}if(n.i){if(o){if(s[c].match(/[a-z]/)){l?(a+=s[c],a+=`${s[c-2]}-${s[c]}`.toUpperCase(),l=!1):s[c+1]==="-"&&((u=s[c+2])!=null&&u.match(/[a-z]/))?(a+=s[c],l=!0):a+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){a+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(n.m){if(s[c]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&s[c]==="."){a+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}a+=s[c],s[c]==="\\"?i=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{const c=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function j_(r,e){var n,s,a,i;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===O.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:we(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:we(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===O.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const o=Object.entries(N_(r.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...t,propertyNames:o}}else if(((i=r.keyType)==null?void 0:i._def.typeName)===O.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function HO(r,e){if(e.mapStrategy==="record")return j_(r,e);const t=we(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=we(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function qO(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function ZO(){return{not:{}}}function VO(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const ro={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function zO(r,e){if(e.target==="openApi3")return _p(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ro&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=ro[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return _p(r,e)}const _p=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>we(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function WO(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:ro[r.innerType._def.typeName],nullable:!0}:{type:[ro[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=we(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=we(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function GO(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",C_(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Te(t,"minimum",n.value,n.message,e):Te(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Te(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Te(t,"maximum",n.value,n.message,e):Te(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Te(t,"maximum",n.value,n.message,e));break;case"multipleOf":Te(t,"multipleOf",n.value,n.message,e);break}return t}function JO(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":we(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":we(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function KO(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,a])=>{if(a===void 0||a._def===void 0)return n;const i=we(a._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return i===void 0?n:{properties:{...n.properties,[s]:i},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:JO(r,e)};return t.required.length||delete t.required,t}const XO=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return we(r.innerType._def,e);const t=we(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},YO=(r,e)=>{if(e.pipeStrategy==="input")return we(r.in._def,e);if(e.pipeStrategy==="output")return we(r.out._def,e);const t=we(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=we(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function QO(r,e){return we(r.type._def,e)}function eA(r,e){const n={type:"array",uniqueItems:!0,items:we(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Te(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Te(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function tA(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>we(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:we(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>we(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function rA(){return{not:{}}}function nA(){return{}}const sA=(r,e)=>we(r.innerType._def,e);function we(r,e,t=!1){var i;const n=e.seen.get(r);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,r,e,n,t);if(o!==xO)return o}if(n&&!t){const o=aA(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=oA(r,r.typeName,e,t);return a&&lA(r,e,a),s.jsonSchema=a,a}const aA=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:iA(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},iA=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},oA=(r,e,t,n)=>{switch(e){case O.ZodString:return N_(r,t);case O.ZodNumber:return GO(r,t);case O.ZodObject:return KO(r,t);case O.ZodBigInt:return RO(r,t);case O.ZodBoolean:return kO();case O.ZodDate:return $_(r,t);case O.ZodUndefined:return rA();case O.ZodNull:return VO(t);case O.ZodArray:return IO(r,t);case O.ZodUnion:case O.ZodDiscriminatedUnion:return zO(r,t);case O.ZodIntersection:return FO(r,t);case O.ZodTuple:return tA(r,t);case O.ZodRecord:return j_(r,t);case O.ZodLiteral:return UO(r,t);case O.ZodEnum:return MO(r);case O.ZodNativeEnum:return qO(r);case O.ZodNullable:return WO(r,t);case O.ZodOptional:return XO(r,t);case O.ZodMap:return HO(r,t);case O.ZodSet:return eA(r,t);case O.ZodLazy:return we(r.getter()._def,t);case O.ZodPromise:return QO(r,t);case O.ZodNaN:case O.ZodNever:return ZO();case O.ZodEffects:return LO(r,t,n);case O.ZodAny:return TO();case O.ZodUnknown:return nA();case O.ZodDefault:return jO(r,t);case O.ZodBranded:return CO(r,t);case O.ZodReadonly:return sA(r,t);case O.ZodCatch:return $O(r,t);case O.ZodPipeline:return YO(r,t);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(s=>{})()}},lA=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),uA=(r,e)=>{const t=PO(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=we(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(AO(t.definitions))return;const l={},u=new Set;for(let c=0;c<500;c++){const d=Object.entries(t.definitions).filter(([f])=>!u.has(f));if(d.length===0)break;for(const[f,h]of d)l[f]=we(uc(h),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},u.add(f)}return l})(),o=n===void 0?i?{...s,[t.definitionPath]:i}:s:t.nameStrategy==="duplicate-ref"?{...s,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function L_(r,e){return uA(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function cA(r,e,t){return Ww({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:L_(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function dA(r){return Gw({type:"function",function:{name:r.name,parameters:L_(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function fA(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=r;if((n||i)&&s&&e)return`${s}/${e}`;if((n||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function hA(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:Va(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function pA(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function mA(r){return r!==void 0&&Ge.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function gA(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&T_(r.schema)}function _A(r){return gA(r)||mA(r)||pA(r)}function pi(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function wu(r){let e;return r.constructor.name===mo.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Nt.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=pi(r,"INVALID_TOOL_RESULTS"):r.status===401?e=pi(r,"MODEL_AUTHENTICATION"):r.status===429?e=pi(r,"MODEL_RATE_LIMIT"):r.status===404?e=pi(r,"MODEL_NOT_FOUND"):e=r,e}function yp(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function yA(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function bA(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(M_(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function M_(r,e){var n;const t=[];for(const[s,a]of Object.entries(r.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${no(a,e)},`):t.push(`${s}?: ${no(a,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function no(r,e){if(yA(r))return r.anyOf.map(t=>no(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",M_(r,e+2),"}"].join(`
`);case"array":return r.items?`${no(r.items,e)}[]`:"any[]";default:return""}}function wA(r,e){let t;if(_A(r)){const n=dA({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:hA(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function vA(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function bd(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ua.isInstance(r))throw new Error("Invalid generic chat message");return vA(r)}default:throw new Error(`Unknown message type: ${e}`)}}function bp(r,e){return r.flatMap(t=>{var a;let n=bd(t);n==="system"&&wd(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),Fa(t)&&((a=t.tool_calls)!=null&&a.length)?(s.tool_calls=t.tool_calls.map(EO),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}const Kn="__openai_function_call_ids__";function wp(r,e){return r.flatMap(t=>{var s,a,i;let n=bd(t);if(n==="system"&&wd(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const o=t;return((s=o.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof o.content=="string")return{type:"computer_screenshot",image_url:o.content};if(Array.isArray(o.content)){const u=o.content.find(d=>d.type==="computer_screenshot");if(u)return u;const c=o.content.find(d=>d.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:o.tool_call_id}:{type:"function_call_output",call_id:o.tool_call_id,id:o.id,output:typeof o.content!="string"?JSON.stringify(o.content):o.content}}if(n==="assistant"){const o=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&o.push(t.additional_kwargs.reasoning);let{content:l}=t;t.additional_kwargs.refusal!=null&&(typeof l=="string"&&(l=[{type:"output_text",text:l,annotations:[]}]),l=[...l,{type:"refusal",refusal:t.additional_kwargs.refusal}]),o.push({type:"message",role:"assistant",content:typeof l=="string"?l:l.flatMap(d=>d.type==="text"?{type:"output_text",text:d.text,annotations:d.annotations??[]}:d.type==="output_text"||d.type==="refusal"?d:[])});const u=t.additional_kwargs[Kn];Fa(t)&&((a=t.tool_calls)!=null&&a.length)?o.push(...t.tool_calls.map(d=>({type:"function_call",name:d.name,arguments:JSON.stringify(d.args),call_id:d.id,id:u==null?void 0:u[d.id]}))):t.additional_kwargs.tool_calls!=null&&o.push(...t.additional_kwargs.tool_calls.map(d=>({type:"function_call",name:d.function.name,call_id:d.id,id:u==null?void 0:u[d.id],arguments:d.function.arguments})));const c=(i=t.response_metadata.output)!=null&&i.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(c!=null){const d=c,f=d==null?void 0:d.filter(p=>p.type==="reasoning"),h=d==null?void 0:d.filter(p=>p.type==="computer_call");f.length>0&&h.length>0&&o.push(...f),h.length>0&&o.push(...h)}return o}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(o=>{if(o.type==="text")return{type:"input_text",text:o.text};if(o.type==="image_url"){const l=typeof o.image_url=="string"?o.image_url:o.image_url.url,u=typeof o.image_url=="string"?"auto":o.image_url.detail;return{type:"input_image",image_url:l,detail:u}}return o.type==="input_text"||o.type==="input_image"||o.type==="input_file"?o:[]})}:[]})}function D_(r){if(r.error){const i=new Error(r.error.message);throw i.name=r.error.code,i}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},a={};for(const i of r.output)if(i.type==="message")e.push(...i.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(a.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(a.refusal=o.refusal,[]):o));else if(i.type==="function_call"){const o={function:{name:i.name,arguments:i.arguments},id:i.call_id};try{t.push(yd(o,{returnId:!0}))}catch(l){let u;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(u=l.message),n.push(k_(o,u))}a[Kn]??(a[Kn]={}),a[Kn][i.call_id]=i.id}else i.type==="reasoning"?a.reasoning=i:(a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(i));return new fa({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:a,response_metadata:s})}function EA(r){var l,u;const e=[];let t={},n;const s=[],a={},i={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),i[Kn]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))i.tool_outputs=[r.item];else if(r.type==="response.created")a.id=r.response.id,a.model_name=r.response.model,a.model=r.response.model;else if(r.type==="response.completed"){const c=D_(r.response);n=r.response.usage,((u=(l=r.response.text)==null?void 0:l.format)==null?void 0:u.type)==="json_schema"&&(i.parsed??(i.parsed=JSON.parse(c.text)));for(const[d,f]of Object.entries(r.response))d!=="id"&&(a[d]=f)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")i.refusal=r.refusal;else return null;return new Cn({text:e.map(c=>c.text).join(""),message:new tn({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:i,response_metadata:a}),generationInfo:t})}function vu(r){return"type"in r&&r.type!=="function"}function SA(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function vp(r,e){return P_(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:wA(r,e)}function wd(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class xA extends Kr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??_r("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??_r("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>vu(s)?s:vp(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&mi(e.json_schema.schema)?cA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const u={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>vu(d)?d:P_(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:SA(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=yp(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},c=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return c!==void 0&&(u.reasoning={effort:c}),u}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(u=>vp(u,{strict:n})):void 0,tool_choice:yp(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction);const i=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(a.reasoning_effort=i),wd(a.model)?a.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:a.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,a}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const l of n??[])try{s.push(yd(l,{returnId:!0}))}catch(u){a.push(k_(l,u.message))}const i={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(i.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new fa({content:e.content||"",tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:t.id})}default:return new Ua(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,u;const s=e.role??n,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Ro({content:a,response_metadata:o});if(s==="assistant"){const c=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)c.push({name:(l=d.function)==null?void 0:l.name,args:(u=d.function)==null?void 0:u.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new tn({content:a,tool_call_chunks:c,additional_kwargs:i,id:t.id,response_metadata:o})}else return s==="system"?new ha({content:a,response_metadata:o}):s==="developer"?new ha({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new To({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new nd({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new Po({content:a,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var u,c,d,f,h,p,m,g,_,b;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:wp(e,this.model),stream:!0},t);for await(const w of y){const S=EA(w);S!=null&&(yield S)}return}const s=bp(e,this.model),a={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,t);let l;for await(const y of o){const w=(u=y==null?void 0:y.choices)==null?void 0:u[0];if(y.usage&&(l=y.usage),!w)continue;const{delta:S}=w;if(!S)continue;const x=this._convertOpenAIDeltaToBaseMessageChunk(S,y,i);i=S.role??i;const T={prompt:t.promptIndex??0,completion:w.index??0};if(typeof x.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const I={...T};w.finish_reason!=null&&(I.finish_reason=w.finish_reason,I.system_fingerprint=y.system_fingerprint,I.model_name=y.model),this.logprobs&&(I.logprobs=w.logprobs);const W=new Cn({message:x,text:x.content,generationInfo:I});yield W,await(n==null?void 0:n.handleLLMNewToken(W.text??"",T,void 0,void 0,void 0,{chunk:W}))}if(l){const y={...((c=l.prompt_tokens_details)==null?void 0:c.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((f=l.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(h=l.prompt_tokens_details)==null?void 0:h.cached_tokens}},w={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(_=l.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new Cn({message:new tn({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(w).length>0&&{output_token_details:w}}}),text:""})}if((b=t.signal)!=null&&b.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let u;for await(const c of l)c.message.response_metadata={...c.generationInfo,...c.message.response_metadata},u=(u==null?void 0:u.concat(c))??c;return{generations:u?[u]:[],llmOutput:{estimatedTokenUsage:(o=u==null?void 0:u.message)==null?void 0:o.usage_metadata}}}const a=wp(e,this.model),i=await this.responseApiWithRetry({input:a,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:i.output_text,message:D_(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(vu),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},a=this.invocationParams(t),i=bp(e,this.model);if(a.stream){const u=this._streamResponseChunks(e,t,n),c={};for await(const g of u){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const _=((o=g.generationInfo)==null?void 0:o.completion)??0;c[_]===void 0?c[_]=g:c[_]=c[_].concat(g)}const d=Object.entries(c).sort(([g],[_])=>parseInt(g,10)-parseInt(_,10)).map(([g,_])=>_),{functions:f,function_call:h}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,f,h),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let u;t.response_format&&t.response_format.type==="json_schema"?u=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):u=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:c,prompt_tokens:d,total_tokens:f,prompt_tokens_details:h,completion_tokens_details:p}=(u==null?void 0:u.usage)??{};c&&(s.output_tokens=(s.output_tokens??0)+c),d&&(s.input_tokens=(s.input_tokens??0)+d),f&&(s.total_tokens=(s.total_tokens??0)+f),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.cached_tokens)!==null)&&(s.input_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.cached_tokens)!==null&&{cache_read:h==null?void 0:h.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(u==null?void 0:u.choices)??[]){const b={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},u)};b.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},Fa(b.message)&&(b.message.usage_metadata=s),b.message=new fa(Object.fromEntries(Object.entries(b.message).filter(([y])=>!y.startsWith("lc_")))),m.push(b)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const a=bA(t);s+=await this.getNumTokens(a),s+=9}return t&&e.find(a=>a._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const a=await Promise.all(e.map(async i=>{var f,h,p,m,g,_;const o=await this.getNumTokens(i.content),l=await this.getNumTokens(bd(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0;let c=o+n+l+u;const d=i;if(d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(c+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(b){console.error("Error parsing function arguments",b,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw wu(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,a;const n=this._getClientOptions(t);try{return((a=(s=e.text)==null?void 0:s.format)==null?void 0:a.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(i){throw wu(i)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw wu(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=fA(n),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new me(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,a,i;OA(e)?(n=e.schema,s=e.name,a=e.method,i=e.includeRaw):(n=e,s=t==null?void 0:t.name,a=t==null?void 0:t.method,i=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),mi(n)?l=fp.fromZodSchema(n):l=new hp;else if(a==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),mi(n)){const f=fp.fromZodSchema(n);l=As.from(h=>"parsed"in h.additional_kwargs?h.additional_kwargs.parsed:f)}else l=new hp;else{let f=s??"extract";if(mi(n)){const h=Va(n);o=this.bind({tools:[{type:"function",function:{name:f,description:h.description,parameters:h}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new pp({returnSingle:!0,keyName:f,zodSchema:n})}else{let h;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(h=n,f=n.name):(f=n.title??f,h={name:f,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:h}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new pp({returnSingle:!0,keyName:f})}}if(!i)return o.pipe(l);const u=to.assign({parsed:(f,h)=>l.invoke(f.raw,h)}),c=to.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return $r.from([{raw:o},d])}}function mi(r){return typeof(r==null?void 0:r.parse)=="function"}function OA(r){return r!==void 0&&typeof r.schema=="object"}const gi={openai:{modelName:"gpt-4",temperature:.3,get apiKey(){return localStorage.getItem("openai_api_key")||""}}};class AA{constructor(){if(!gi.openai.apiKey)throw new Error("OpenAI API key is not configured. Please enter your API key in the settings.");this.model=new xA({modelName:gi.openai.modelName,temperature:gi.openai.temperature,openAIApiKey:gi.openai.apiKey})}async process(e,t){try{const n=await this.model.invoke([{role:"system",content:t},{role:"user",content:e}]);if(!n.content)throw new Error("No response received from the language model");return n.content}catch(n){throw console.error("LLM Processing Error:",n),n.message.includes("API key")?new Error("Invalid API key. Please check your configuration."):n.message.includes("429")?new Error("Rate limit exceeded. Please try again in a moment."):n.message.includes("500")?new Error("OpenAI service is currently experiencing issues. Please try again later."):new Error(n.message||"Failed to process text. Please try again.")}}}async function PA(r,e={onlyGrammar:!1,handleSpanish:!0,customInstructions:"",writingStyle:"preserve"}){const t=new AA,n={preserve:`
      - Maintain the original writing style, voice, and tone
      - Only fix errors while preserving the author's unique expression
      - Keep the same level of formality and complexity
    `,business:`
      - Use clear, concise, and professional language
      - Maintain a confident and direct tone
      - Focus on clarity and actionable information
      - Use business-appropriate terminology
      - Keep sentences brief and well-structured
      - Emphasize professionalism and efficiency
    `,technical:`
      - Use precise and specific terminology
      - Maintain a clear and methodical structure
      - Focus on accuracy and detail
      - Use technical terms appropriately
      - Ensure explanations are thorough and exact
      - Present information in a logical sequence
    `,casual:`
      - Use friendly and conversational language
      - Include natural expressions and colloquialisms
      - Keep sentences relatively simple and easy to read
      - Maintain an engaging and personal tone
      - Use contractions and informal phrases when appropriate
      - Write as if speaking to a friend
    `,marketing:`
      - Use engaging and benefit-focused language
      - Create emotional connections with readers
      - Include persuasive calls to action
      - Highlight unique value propositions
      - Use power words and emotional triggers
      - Maintain brand voice consistency
    `,simple:`
      - Use clear, straightforward language
      - Keep sentences short and direct
      - Avoid jargon and complex terminology
      - Explain concepts in simple terms
      - Use active voice consistently
      - Focus on readability for general audiences
    `};let s=`You are an expert English language editor with native-level mastery.
    Your task is to ${e.onlyGrammar?"fix grammar and spelling errors only":"improve the provided text"} while:

    ${e.onlyGrammar?`
    1. Fixing grammar and spelling errors
    2. Making minimal changes to preserve the original writing style
    3. Not changing word choice or phrasing unless necessary for grammar
    `:`
    Writing Style Instructions:
    ${n[e.writingStyle]}
    
    General Improvements:
    1. Enhancing clarity and flow while maintaining the intended meaning
    2. Using appropriate expressions based on the selected style
    3. Improving sentence structure for better readability
    4. Maintaining an appropriate tone for the selected style
    5. Fixing any grammar or spelling errors
    `}

    ${e.handleSpanish?`
    Additional Spanish handling:
    - Identify any Spanish words or phrases in the text
    - Translate them to natural, contextually appropriate English
    - Ensure the translations flow naturally with the rest of the text
    `:""}

    ${e.customInstructions?`
    Additional custom instructions:
    ${e.customInstructions}
    `:""}

    IMPORTANT FORMATTING RULES:
    - Preserve all line breaks exactly as they appear in the original text
    - Maintain paragraph structure and spacing
    - Keep any special formatting like bullet points, numbering, or indentation
    - Respect the original text's list formats and structural elements
    - If text has multiple paragraphs, maintain the same paragraph breaks
    
    The goal is to ${e.onlyGrammar?"fix grammar while preserving the original writing as much as possible":`improve the text according to the ${e.writingStyle==="preserve"?"original":e.writingStyle} style guidelines`} while keeping the exact same formatting.
    Return only the ${e.onlyGrammar?"corrected":"improved"} text without any explanations or comments.`;return await t.process(r,s)}const TA={name:"Improve Writing",processor:PA,description:"Enhances text to sound more natural and native-like while maintaining meaning"};var IA="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z",Eu={exports:{}},Ep;function RA(){return Ep||(Ep=1,function(r){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,s=0;e.Diff=function(a,i){return[a,i]},e.prototype.diff_main=function(a,i,o,l){typeof l>"u"&&(this.Diff_Timeout<=0?l=Number.MAX_VALUE:l=new Date().getTime()+this.Diff_Timeout*1e3);var u=l;if(a==null||i==null)throw new Error("Null input. (diff_main)");if(a==i)return a?[new e.Diff(s,a)]:[];typeof o>"u"&&(o=!0);var c=o,d=this.diff_commonPrefix(a,i),f=a.substring(0,d);a=a.substring(d),i=i.substring(d),d=this.diff_commonSuffix(a,i);var h=a.substring(a.length-d);a=a.substring(0,a.length-d),i=i.substring(0,i.length-d);var p=this.diff_compute_(a,i,c,u);return f&&p.unshift(new e.Diff(s,f)),h&&p.push(new e.Diff(s,h)),this.diff_cleanupMerge(p),p},e.prototype.diff_compute_=function(a,i,o,l){var u;if(!a)return[new e.Diff(n,i)];if(!i)return[new e.Diff(t,a)];var c=a.length>i.length?a:i,d=a.length>i.length?i:a,f=c.indexOf(d);if(f!=-1)return u=[new e.Diff(n,c.substring(0,f)),new e.Diff(s,d),new e.Diff(n,c.substring(f+d.length))],a.length>i.length&&(u[0][0]=u[2][0]=t),u;if(d.length==1)return[new e.Diff(t,a),new e.Diff(n,i)];var h=this.diff_halfMatch_(a,i);if(h){var p=h[0],m=h[1],g=h[2],_=h[3],b=h[4],y=this.diff_main(p,g,o,l),w=this.diff_main(m,_,o,l);return y.concat([new e.Diff(s,b)],w)}return o&&a.length>100&&i.length>100?this.diff_lineMode_(a,i,l):this.diff_bisect_(a,i,l)},e.prototype.diff_lineMode_=function(a,i,o){var l=this.diff_linesToChars_(a,i);a=l.chars1,i=l.chars2;var u=l.lineArray,c=this.diff_main(a,i,!1,o);this.diff_charsToLines_(c,u),this.diff_cleanupSemantic(c),c.push(new e.Diff(s,""));for(var d=0,f=0,h=0,p="",m="";d<c.length;){switch(c[d][0]){case n:h++,m+=c[d][1];break;case t:f++,p+=c[d][1];break;case s:if(f>=1&&h>=1){c.splice(d-f-h,f+h),d=d-f-h;for(var g=this.diff_main(p,m,!1,o),_=g.length-1;_>=0;_--)c.splice(d,0,g[_]);d=d+g.length}h=0,f=0,p="",m="";break}d++}return c.pop(),c},e.prototype.diff_bisect_=function(a,i,o){for(var l=a.length,u=i.length,c=Math.ceil((l+u)/2),d=c,f=2*c,h=new Array(f),p=new Array(f),m=0;m<f;m++)h[m]=-1,p[m]=-1;h[d+1]=0,p[d+1]=0;for(var g=l-u,_=g%2!=0,b=0,y=0,w=0,S=0,x=0;x<c&&!(new Date().getTime()>o);x++){for(var T=-x+b;T<=x-y;T+=2){var I=d+T,W;T==-x||T!=x&&h[I-1]<h[I+1]?W=h[I+1]:W=h[I-1]+1;for(var Y=W-T;W<l&&Y<u&&a.charAt(W)==i.charAt(Y);)W++,Y++;if(h[I]=W,W>l)y+=2;else if(Y>u)b+=2;else if(_){var k=d+g-T;if(k>=0&&k<f&&p[k]!=-1){var A=l-p[k];if(W>=A)return this.diff_bisectSplit_(a,i,W,Y,o)}}}for(var M=-x+w;M<=x-S;M+=2){var k=d+M,A;M==-x||M!=x&&p[k-1]<p[k+1]?A=p[k+1]:A=p[k-1]+1;for(var R=A-M;A<l&&R<u&&a.charAt(l-A-1)==i.charAt(u-R-1);)A++,R++;if(p[k]=A,A>l)S+=2;else if(R>u)w+=2;else if(!_){var I=d+g-M;if(I>=0&&I<f&&h[I]!=-1){var W=h[I],Y=d+W-I;if(A=l-A,W>=A)return this.diff_bisectSplit_(a,i,W,Y,o)}}}}return[new e.Diff(t,a),new e.Diff(n,i)]},e.prototype.diff_bisectSplit_=function(a,i,o,l,u){var c=a.substring(0,o),d=i.substring(0,l),f=a.substring(o),h=i.substring(l),p=this.diff_main(c,d,!1,u),m=this.diff_main(f,h,!1,u);return p.concat(m)},e.prototype.diff_linesToChars_=function(a,i){var o=[],l={};o[0]="";function u(h){for(var p="",m=0,g=-1,_=o.length;g<h.length-1;){g=h.indexOf(`
`,m),g==-1&&(g=h.length-1);var b=h.substring(m,g+1);(l.hasOwnProperty?l.hasOwnProperty(b):l[b]!==void 0)?p+=String.fromCharCode(l[b]):(_==c&&(b=h.substring(m),g=h.length),p+=String.fromCharCode(_),l[b]=_,o[_++]=b),m=g+1}return p}var c=4e4,d=u(a);c=65535;var f=u(i);return{chars1:d,chars2:f,lineArray:o}},e.prototype.diff_charsToLines_=function(a,i){for(var o=0;o<a.length;o++){for(var l=a[o][1],u=[],c=0;c<l.length;c++)u[c]=i[l.charCodeAt(c)];a[o][1]=u.join("")}},e.prototype.diff_commonPrefix=function(a,i){if(!a||!i||a.charAt(0)!=i.charAt(0))return 0;for(var o=0,l=Math.min(a.length,i.length),u=l,c=0;o<u;)a.substring(c,u)==i.substring(c,u)?(o=u,c=o):l=u,u=Math.floor((l-o)/2+o);return u},e.prototype.diff_commonSuffix=function(a,i){if(!a||!i||a.charAt(a.length-1)!=i.charAt(i.length-1))return 0;for(var o=0,l=Math.min(a.length,i.length),u=l,c=0;o<u;)a.substring(a.length-u,a.length-c)==i.substring(i.length-u,i.length-c)?(o=u,c=o):l=u,u=Math.floor((l-o)/2+o);return u},e.prototype.diff_commonOverlap_=function(a,i){var o=a.length,l=i.length;if(o==0||l==0)return 0;o>l?a=a.substring(o-l):o<l&&(i=i.substring(0,o));var u=Math.min(o,l);if(a==i)return u;for(var c=0,d=1;;){var f=a.substring(u-d),h=i.indexOf(f);if(h==-1)return c;d+=h,(h==0||a.substring(u-d)==i.substring(0,d))&&(c=d,d++)}},e.prototype.diff_halfMatch_=function(a,i){if(this.Diff_Timeout<=0)return null;var o=a.length>i.length?a:i,l=a.length>i.length?i:a;if(o.length<4||l.length*2<o.length)return null;var u=this;function c(y,w,S){for(var x=y.substring(S,S+Math.floor(y.length/4)),T=-1,I="",W,Y,k,A;(T=w.indexOf(x,T+1))!=-1;){var M=u.diff_commonPrefix(y.substring(S),w.substring(T)),R=u.diff_commonSuffix(y.substring(0,S),w.substring(0,T));I.length<R+M&&(I=w.substring(T-R,T)+w.substring(T,T+M),W=y.substring(0,S-R),Y=y.substring(S+M),k=w.substring(0,T-R),A=w.substring(T+M))}return I.length*2>=y.length?[W,Y,k,A,I]:null}var d=c(o,l,Math.ceil(o.length/4)),f=c(o,l,Math.ceil(o.length/2)),h;if(!d&&!f)return null;f?d?h=d[4].length>f[4].length?d:f:h=f:h=d;var p,m,g,_;a.length>i.length?(p=h[0],m=h[1],g=h[2],_=h[3]):(g=h[0],_=h[1],p=h[2],m=h[3]);var b=h[4];return[p,m,g,_,b]},e.prototype.diff_cleanupSemantic=function(a){for(var i=!1,o=[],l=0,u=null,c=0,d=0,f=0,h=0,p=0;c<a.length;)a[c][0]==s?(o[l++]=c,d=h,f=p,h=0,p=0,u=a[c][1]):(a[c][0]==n?h+=a[c][1].length:p+=a[c][1].length,u&&u.length<=Math.max(d,f)&&u.length<=Math.max(h,p)&&(a.splice(o[l-1],0,new e.Diff(t,u)),a[o[l-1]+1][0]=n,l--,l--,c=l>0?o[l-1]:-1,d=0,f=0,h=0,p=0,u=null,i=!0)),c++;for(i&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a),c=1;c<a.length;){if(a[c-1][0]==t&&a[c][0]==n){var m=a[c-1][1],g=a[c][1],_=this.diff_commonOverlap_(m,g),b=this.diff_commonOverlap_(g,m);_>=b?(_>=m.length/2||_>=g.length/2)&&(a.splice(c,0,new e.Diff(s,g.substring(0,_))),a[c-1][1]=m.substring(0,m.length-_),a[c+1][1]=g.substring(_),c++):(b>=m.length/2||b>=g.length/2)&&(a.splice(c,0,new e.Diff(s,m.substring(0,b))),a[c-1][0]=n,a[c-1][1]=g.substring(0,g.length-b),a[c+1][0]=t,a[c+1][1]=m.substring(b),c++),c++}c++}},e.prototype.diff_cleanupSemanticLossless=function(a){function i(b,y){if(!b||!y)return 6;var w=b.charAt(b.length-1),S=y.charAt(0),x=w.match(e.nonAlphaNumericRegex_),T=S.match(e.nonAlphaNumericRegex_),I=x&&w.match(e.whitespaceRegex_),W=T&&S.match(e.whitespaceRegex_),Y=I&&w.match(e.linebreakRegex_),k=W&&S.match(e.linebreakRegex_),A=Y&&b.match(e.blanklineEndRegex_),M=k&&y.match(e.blanklineStartRegex_);return A||M?5:Y||k?4:x&&!I&&W?3:I||W?2:x||T?1:0}for(var o=1;o<a.length-1;){if(a[o-1][0]==s&&a[o+1][0]==s){var l=a[o-1][1],u=a[o][1],c=a[o+1][1],d=this.diff_commonSuffix(l,u);if(d){var f=u.substring(u.length-d);l=l.substring(0,l.length-d),u=f+u.substring(0,u.length-d),c=f+c}for(var h=l,p=u,m=c,g=i(l,u)+i(u,c);u.charAt(0)===c.charAt(0);){l+=u.charAt(0),u=u.substring(1)+c.charAt(0),c=c.substring(1);var _=i(l,u)+i(u,c);_>=g&&(g=_,h=l,p=u,m=c)}a[o-1][1]!=h&&(h?a[o-1][1]=h:(a.splice(o-1,1),o--),a[o][1]=p,m?a[o+1][1]=m:(a.splice(o+1,1),o--))}o++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(a){for(var i=!1,o=[],l=0,u=null,c=0,d=!1,f=!1,h=!1,p=!1;c<a.length;)a[c][0]==s?(a[c][1].length<this.Diff_EditCost&&(h||p)?(o[l++]=c,d=h,f=p,u=a[c][1]):(l=0,u=null),h=p=!1):(a[c][0]==t?p=!0:h=!0,u&&(d&&f&&h&&p||u.length<this.Diff_EditCost/2&&d+f+h+p==3)&&(a.splice(o[l-1],0,new e.Diff(t,u)),a[o[l-1]+1][0]=n,l--,u=null,d&&f?(h=p=!0,l=0):(l--,c=l>0?o[l-1]:-1,h=p=!1),i=!0)),c++;i&&this.diff_cleanupMerge(a)},e.prototype.diff_cleanupMerge=function(a){a.push(new e.Diff(s,""));for(var i=0,o=0,l=0,u="",c="",d;i<a.length;)switch(a[i][0]){case n:l++,c+=a[i][1],i++;break;case t:o++,u+=a[i][1],i++;break;case s:o+l>1?(o!==0&&l!==0&&(d=this.diff_commonPrefix(c,u),d!==0&&(i-o-l>0&&a[i-o-l-1][0]==s?a[i-o-l-1][1]+=c.substring(0,d):(a.splice(0,0,new e.Diff(s,c.substring(0,d))),i++),c=c.substring(d),u=u.substring(d)),d=this.diff_commonSuffix(c,u),d!==0&&(a[i][1]=c.substring(c.length-d)+a[i][1],c=c.substring(0,c.length-d),u=u.substring(0,u.length-d))),i-=o+l,a.splice(i,o+l),u.length&&(a.splice(i,0,new e.Diff(t,u)),i++),c.length&&(a.splice(i,0,new e.Diff(n,c)),i++),i++):i!==0&&a[i-1][0]==s?(a[i-1][1]+=a[i][1],a.splice(i,1)):i++,l=0,o=0,u="",c="";break}a[a.length-1][1]===""&&a.pop();var f=!1;for(i=1;i<a.length-1;)a[i-1][0]==s&&a[i+1][0]==s&&(a[i][1].substring(a[i][1].length-a[i-1][1].length)==a[i-1][1]?(a[i][1]=a[i-1][1]+a[i][1].substring(0,a[i][1].length-a[i-1][1].length),a[i+1][1]=a[i-1][1]+a[i+1][1],a.splice(i-1,1),f=!0):a[i][1].substring(0,a[i+1][1].length)==a[i+1][1]&&(a[i-1][1]+=a[i+1][1],a[i][1]=a[i][1].substring(a[i+1][1].length)+a[i+1][1],a.splice(i+1,1),f=!0)),i++;f&&this.diff_cleanupMerge(a)},e.prototype.diff_xIndex=function(a,i){var o=0,l=0,u=0,c=0,d;for(d=0;d<a.length&&(a[d][0]!==n&&(o+=a[d][1].length),a[d][0]!==t&&(l+=a[d][1].length),!(o>i));d++)u=o,c=l;return a.length!=d&&a[d][0]===t?c:c+(i-u)},e.prototype.diff_prettyHtml=function(a){for(var i=[],o=/&/g,l=/</g,u=/>/g,c=/\n/g,d=0;d<a.length;d++){var f=a[d][0],h=a[d][1],p=h.replace(o,"&amp;").replace(l,"&lt;").replace(u,"&gt;").replace(c,"&para;<br>");switch(f){case n:i[d]='<ins style="background:#e6ffe6;">'+p+"</ins>";break;case t:i[d]='<del style="background:#ffe6e6;">'+p+"</del>";break;case s:i[d]="<span>"+p+"</span>";break}}return i.join("")},e.prototype.diff_text1=function(a){for(var i=[],o=0;o<a.length;o++)a[o][0]!==n&&(i[o]=a[o][1]);return i.join("")},e.prototype.diff_text2=function(a){for(var i=[],o=0;o<a.length;o++)a[o][0]!==t&&(i[o]=a[o][1]);return i.join("")},e.prototype.diff_levenshtein=function(a){for(var i=0,o=0,l=0,u=0;u<a.length;u++){var c=a[u][0],d=a[u][1];switch(c){case n:o+=d.length;break;case t:l+=d.length;break;case s:i+=Math.max(o,l),o=0,l=0;break}}return i+=Math.max(o,l),i},e.prototype.diff_toDelta=function(a){for(var i=[],o=0;o<a.length;o++)switch(a[o][0]){case n:i[o]="+"+encodeURI(a[o][1]);break;case t:i[o]="-"+a[o][1].length;break;case s:i[o]="="+a[o][1].length;break}return i.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(a,i){for(var o=[],l=0,u=0,c=i.split(/\t/g),d=0;d<c.length;d++){var f=c[d].substring(1);switch(c[d].charAt(0)){case"+":try{o[l++]=new e.Diff(n,decodeURI(f))}catch{throw new Error("Illegal escape in diff_fromDelta: "+f)}break;case"-":case"=":var h=parseInt(f,10);if(isNaN(h)||h<0)throw new Error("Invalid number in diff_fromDelta: "+f);var p=a.substring(u,u+=h);c[d].charAt(0)=="="?o[l++]=new e.Diff(s,p):o[l++]=new e.Diff(t,p);break;default:if(c[d])throw new Error("Invalid diff operation in diff_fromDelta: "+c[d])}}if(u!=a.length)throw new Error("Delta length ("+u+") does not equal source text length ("+a.length+").");return o},e.prototype.match_main=function(a,i,o){if(a==null||i==null||o==null)throw new Error("Null input. (match_main)");return o=Math.max(0,Math.min(o,a.length)),a==i?0:a.length?a.substring(o,o+i.length)==i?o:this.match_bitap_(a,i,o):-1},e.prototype.match_bitap_=function(a,i,o){if(i.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var l=this.match_alphabet_(i),u=this;function c(W,Y){var k=W/i.length,A=Math.abs(o-Y);return u.Match_Distance?k+A/u.Match_Distance:A?1:k}var d=this.Match_Threshold,f=a.indexOf(i,o);f!=-1&&(d=Math.min(c(0,f),d),f=a.lastIndexOf(i,o+i.length),f!=-1&&(d=Math.min(c(0,f),d)));var h=1<<i.length-1;f=-1;for(var p,m,g=i.length+a.length,_,b=0;b<i.length;b++){for(p=0,m=g;p<m;)c(b,o+m)<=d?p=m:g=m,m=Math.floor((g-p)/2+p);g=m;var y=Math.max(1,o-m+1),w=Math.min(o+m,a.length)+i.length,S=Array(w+2);S[w+1]=(1<<b)-1;for(var x=w;x>=y;x--){var T=l[a.charAt(x-1)];if(b===0?S[x]=(S[x+1]<<1|1)&T:S[x]=(S[x+1]<<1|1)&T|((_[x+1]|_[x])<<1|1)|_[x+1],S[x]&h){var I=c(b,x-1);if(I<=d)if(d=I,f=x-1,f>o)y=Math.max(1,2*o-f);else break}}if(c(b+1,o)>d)break;_=S}return f},e.prototype.match_alphabet_=function(a){for(var i={},o=0;o<a.length;o++)i[a.charAt(o)]=0;for(var o=0;o<a.length;o++)i[a.charAt(o)]|=1<<a.length-o-1;return i},e.prototype.patch_addContext_=function(a,i){if(i.length!=0){if(a.start2===null)throw Error("patch not initialized");for(var o=i.substring(a.start2,a.start2+a.length1),l=0;i.indexOf(o)!=i.lastIndexOf(o)&&o.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)l+=this.Patch_Margin,o=i.substring(a.start2-l,a.start2+a.length1+l);l+=this.Patch_Margin;var u=i.substring(a.start2-l,a.start2);u&&a.diffs.unshift(new e.Diff(s,u));var c=i.substring(a.start2+a.length1,a.start2+a.length1+l);c&&a.diffs.push(new e.Diff(s,c)),a.start1-=u.length,a.start2-=u.length,a.length1+=u.length+c.length,a.length2+=u.length+c.length}},e.prototype.patch_make=function(a,i,o){var l,u;if(typeof a=="string"&&typeof i=="string"&&typeof o>"u")l=a,u=this.diff_main(l,i,!0),u.length>2&&(this.diff_cleanupSemantic(u),this.diff_cleanupEfficiency(u));else if(a&&typeof a=="object"&&typeof i>"u"&&typeof o>"u")u=a,l=this.diff_text1(u);else if(typeof a=="string"&&i&&typeof i=="object"&&typeof o>"u")l=a,u=i;else if(typeof a=="string"&&typeof i=="string"&&o&&typeof o=="object")l=a,u=o;else throw new Error("Unknown call format to patch_make.");if(u.length===0)return[];for(var c=[],d=new e.patch_obj,f=0,h=0,p=0,m=l,g=l,_=0;_<u.length;_++){var b=u[_][0],y=u[_][1];switch(!f&&b!==s&&(d.start1=h,d.start2=p),b){case n:d.diffs[f++]=u[_],d.length2+=y.length,g=g.substring(0,p)+y+g.substring(p);break;case t:d.length1+=y.length,d.diffs[f++]=u[_],g=g.substring(0,p)+g.substring(p+y.length);break;case s:y.length<=2*this.Patch_Margin&&f&&u.length!=_+1?(d.diffs[f++]=u[_],d.length1+=y.length,d.length2+=y.length):y.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(d,m),c.push(d),d=new e.patch_obj,f=0,m=g,h=p);break}b!==n&&(h+=y.length),b!==t&&(p+=y.length)}return f&&(this.patch_addContext_(d,m),c.push(d)),c},e.prototype.patch_deepCopy=function(a){for(var i=[],o=0;o<a.length;o++){var l=a[o],u=new e.patch_obj;u.diffs=[];for(var c=0;c<l.diffs.length;c++)u.diffs[c]=new e.Diff(l.diffs[c][0],l.diffs[c][1]);u.start1=l.start1,u.start2=l.start2,u.length1=l.length1,u.length2=l.length2,i[o]=u}return i},e.prototype.patch_apply=function(a,i){if(a.length==0)return[i,[]];a=this.patch_deepCopy(a);var o=this.patch_addPadding(a);i=o+i+o,this.patch_splitMax(a);for(var l=0,u=[],c=0;c<a.length;c++){var d=a[c].start2+l,f=this.diff_text1(a[c].diffs),h,p=-1;if(f.length>this.Match_MaxBits?(h=this.match_main(i,f.substring(0,this.Match_MaxBits),d),h!=-1&&(p=this.match_main(i,f.substring(f.length-this.Match_MaxBits),d+f.length-this.Match_MaxBits),(p==-1||h>=p)&&(h=-1))):h=this.match_main(i,f,d),h==-1)u[c]=!1,l-=a[c].length2-a[c].length1;else{u[c]=!0,l=h-d;var m;if(p==-1?m=i.substring(h,h+f.length):m=i.substring(h,p+this.Match_MaxBits),f==m)i=i.substring(0,h)+this.diff_text2(a[c].diffs)+i.substring(h+f.length);else{var g=this.diff_main(f,m,!1);if(f.length>this.Match_MaxBits&&this.diff_levenshtein(g)/f.length>this.Patch_DeleteThreshold)u[c]=!1;else{this.diff_cleanupSemanticLossless(g);for(var _=0,b,y=0;y<a[c].diffs.length;y++){var w=a[c].diffs[y];w[0]!==s&&(b=this.diff_xIndex(g,_)),w[0]===n?i=i.substring(0,h+b)+w[1]+i.substring(h+b):w[0]===t&&(i=i.substring(0,h+b)+i.substring(h+this.diff_xIndex(g,_+w[1].length))),w[0]!==t&&(_+=w[1].length)}}}}}return i=i.substring(o.length,i.length-o.length),[i,u]},e.prototype.patch_addPadding=function(a){for(var i=this.Patch_Margin,o="",l=1;l<=i;l++)o+=String.fromCharCode(l);for(var l=0;l<a.length;l++)a[l].start1+=i,a[l].start2+=i;var u=a[0],c=u.diffs;if(c.length==0||c[0][0]!=s)c.unshift(new e.Diff(s,o)),u.start1-=i,u.start2-=i,u.length1+=i,u.length2+=i;else if(i>c[0][1].length){var d=i-c[0][1].length;c[0][1]=o.substring(c[0][1].length)+c[0][1],u.start1-=d,u.start2-=d,u.length1+=d,u.length2+=d}if(u=a[a.length-1],c=u.diffs,c.length==0||c[c.length-1][0]!=s)c.push(new e.Diff(s,o)),u.length1+=i,u.length2+=i;else if(i>c[c.length-1][1].length){var d=i-c[c.length-1][1].length;c[c.length-1][1]+=o.substring(0,d),u.length1+=d,u.length2+=d}return o},e.prototype.patch_splitMax=function(a){for(var i=this.Match_MaxBits,o=0;o<a.length;o++)if(!(a[o].length1<=i)){var l=a[o];a.splice(o--,1);for(var u=l.start1,c=l.start2,d="";l.diffs.length!==0;){var f=new e.patch_obj,h=!0;for(f.start1=u-d.length,f.start2=c-d.length,d!==""&&(f.length1=f.length2=d.length,f.diffs.push(new e.Diff(s,d)));l.diffs.length!==0&&f.length1<i-this.Patch_Margin;){var p=l.diffs[0][0],m=l.diffs[0][1];p===n?(f.length2+=m.length,c+=m.length,f.diffs.push(l.diffs.shift()),h=!1):p===t&&f.diffs.length==1&&f.diffs[0][0]==s&&m.length>2*i?(f.length1+=m.length,u+=m.length,h=!1,f.diffs.push(new e.Diff(p,m)),l.diffs.shift()):(m=m.substring(0,i-f.length1-this.Patch_Margin),f.length1+=m.length,u+=m.length,p===s?(f.length2+=m.length,c+=m.length):h=!1,f.diffs.push(new e.Diff(p,m)),m==l.diffs[0][1]?l.diffs.shift():l.diffs[0][1]=l.diffs[0][1].substring(m.length))}d=this.diff_text2(f.diffs),d=d.substring(d.length-this.Patch_Margin);var g=this.diff_text1(l.diffs).substring(0,this.Patch_Margin);g!==""&&(f.length1+=g.length,f.length2+=g.length,f.diffs.length!==0&&f.diffs[f.diffs.length-1][0]===s?f.diffs[f.diffs.length-1][1]+=g:f.diffs.push(new e.Diff(s,g))),h||a.splice(++o,0,f)}}},e.prototype.patch_toText=function(a){for(var i=[],o=0;o<a.length;o++)i[o]=a[o];return i.join("")},e.prototype.patch_fromText=function(a){var i=[];if(!a)return i;for(var o=a.split(`
`),l=0,u=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;l<o.length;){var c=o[l].match(u);if(!c)throw new Error("Invalid patch string: "+o[l]);var d=new e.patch_obj;for(i.push(d),d.start1=parseInt(c[1],10),c[2]===""?(d.start1--,d.length1=1):c[2]=="0"?d.length1=0:(d.start1--,d.length1=parseInt(c[2],10)),d.start2=parseInt(c[3],10),c[4]===""?(d.start2--,d.length2=1):c[4]=="0"?d.length2=0:(d.start2--,d.length2=parseInt(c[4],10)),l++;l<o.length;){var f=o[l].charAt(0);try{var h=decodeURI(o[l].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+h)}if(f=="-")d.diffs.push(new e.Diff(t,h));else if(f=="+")d.diffs.push(new e.Diff(n,h));else if(f==" ")d.diffs.push(new e.Diff(s,h));else{if(f=="@")break;if(f!=="")throw new Error('Invalid patch mode "'+f+'" in: '+h)}l++}}return i},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var a,i;this.length1===0?a=this.start1+",0":this.length1==1?a=this.start1+1:a=this.start1+1+","+this.length1,this.length2===0?i=this.start2+",0":this.length2==1?i=this.start2+1:i=this.start2+1+","+this.length2;for(var o=["@@ -"+a+" +"+i+` @@
`],l,u=0;u<this.diffs.length;u++){switch(this.diffs[u][0]){case n:l="+";break;case t:l="-";break;case s:l=" ";break}o[u+1]=l+encodeURI(this.diffs[u][1])+`
`}return o.join("").replace(/%20/g," ")},r.exports=e,r.exports.diff_match_patch=e,r.exports.DIFF_DELETE=t,r.exports.DIFF_INSERT=n,r.exports.DIFF_EQUAL=s}(Eu)),Eu.exports}var kA=RA();const Sp=bs(kA),CA={class:"min-h-screen bg-gray-50 flex flex-col"},$A={class:"bg-white shadow-sm px-4 sm:px-8 py-4 border-b border-gray-200 flex-none"},NA={class:"flex justify-between items-center"},jA={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},LA={class:"bg-white p-4 sm:p-6 rounded-lg shadow-lg w-full max-w-md"},MA={class:"flex justify-between items-center mb-4"},DA={class:"mb-4"},FA={class:"flex justify-end"},UA={class:"flex flex-wrap gap-2 sm:gap-4 items-center mb-4"},BA={class:"flex flex-wrap items-center gap-2 sm:gap-4 w-full md:w-auto mb-2 md:mb-0"},HA={class:"flex items-center gap-2 text-gray-600 text-sm"},qA={class:"flex items-center gap-2 text-gray-600 text-sm"},ZA={class:"flex items-center gap-2"},VA=["value","title"],zA={class:"flex flex-wrap gap-2"},WA=["disabled"],GA={key:0},JA={key:1},KA={class:"flex items-center gap-2 mb-2"},XA={key:1,class:"transition-all duration-200"},YA={class:"flex-1"},QA={class:"flex-1 p-4 sm:p-8 flex flex-col min-h-0"},eP={class:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-8 flex-1 min-h-0"},tP={class:"bg-white rounded-lg shadow-sm p-4 sm:p-6 flex flex-col flex-1"},rP={class:"flex justify-between items-center mb-4"},nP={class:"bg-white rounded-lg shadow-sm p-4 sm:p-6 flex flex-col min-h-0"},sP={class:"flex flex-wrap justify-between items-center mb-4 flex-none"},aP={class:"flex flex-wrap items-center gap-2 mb-2 sm:mb-0"},iP={class:"flex items-center gap-2 text-sm text-gray-600"},oP={class:"flex items-center gap-2 text-sm text-gray-600"},lP={class:"flex items-center gap-2"},uP={class:"w-3 h-3 sm:w-4 sm:h-4",viewBox:"0 0 24 24"},cP=["d"],dP={class:"flex-1 w-full p-3 sm:p-4 border border-gray-200 rounded-md overflow-y-auto whitespace-pre-wrap font-serif text-base sm:text-lg leading-relaxed min-h-0"},fP=["onClick","title"],hP={key:0,class:"fixed bottom-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-3 sm:p-4 rounded shadow-lg max-w-[90%] sm:max-w-md z-50 text-sm",role:"alert"},pP={class:"flex justify-between items-start"},mP={key:1,class:"fixed bottom-4 left-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-3 sm:p-4 rounded shadow-lg z-50 text-sm"},gP={key:2,class:"fixed bottom-4 left-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 sm:p-4 rounded shadow-lg transition-opacity duration-300 z-50 text-sm"},_P={__name:"App",setup(r){const e={INPUT:"writer-input-text",PROCESSED:"writer-processed-text",ONLY_GRAMMAR:"writer-only-grammar",HANDLE_SPANISH:"writer-handle-spanish",SHOW_DIFF:"writer-show-diff",CUSTOM_INSTRUCTIONS:"writer-custom-instructions",SHOW_INSTRUCTIONS:"writer-show-instructions",WRITING_STYLE:"writer-style",SHOW_ONLY_ADDITIONS:"writer-show-only-additions",API_KEY:"openai_api_key"},t=[{id:"preserve",label:"Preserve Original Style",description:"Maintain the original writing style while fixing errors"},{id:"business",label:"Business",description:"Professional and clear tone for business communication"},{id:"technical",label:"Technical",description:"Precise and detailed tone for technical documentation"},{id:"casual",label:"Casual",description:"Friendly and conversational tone"},{id:"marketing",label:"Marketing",description:"Engaging and persuasive tone for promotional content"},{id:"simple",label:"Simple",description:"Clear and easy-to-understand language for general audiences"}],n=Ke(localStorage.getItem(e.INPUT)||""),s=Ke(localStorage.getItem(e.PROCESSED)||""),a=Ke(localStorage.getItem(e.ONLY_GRAMMAR)==="true"),i=Ke(localStorage.getItem(e.HANDLE_SPANISH)!=="false"),o=Ke(localStorage.getItem(e.CUSTOM_INSTRUCTIONS)||""),l=Ke(localStorage.getItem(e.SHOW_INSTRUCTIONS)==="true"),u=Ke(!1),c=Ke(null),d=Ke(localStorage.getItem(e.SHOW_DIFF)==="true"),f=Ke(localStorage.getItem(e.WRITING_STYLE)||"preserve"),h=Ke(!1),p=Ke(!1),m=Ke(!1),g=Ke(null),_=Ke(localStorage.getItem(e.SHOW_ONLY_ADDITIONS)==="true"),b=Ke(localStorage.getItem(e.API_KEY)||""),y=Ke(!1),w=$u(()=>{if(!n.value||!s.value)return[];const k=new Sp,A=k.diff_main(n.value,s.value);return k.diff_cleanupSemantic(A),A});$u(()=>{if(!w.value||w.value.length===0)return[];const k=new Sp,A=[];for(let M=0;M<w.value.length;M++){const R=w.value[M];if(R[0]!==0){if(R[0]===1){let C="",B="";if(M>0&&w.value[M-1][0]===0){const H=w.value[M-1][1];C=H.substring(Math.max(0,H.length-40))}if(M<w.value.length-1&&w.value[M+1][0]===0){const H=w.value[M+1][1];B=H.substring(0,Math.min(40,H.length))}const N=[];C&&N.push([0,C]),N.push([1,R[1]]),B&&N.push([0,B]);const U=k.patch_make(N);A.push({index:M,patch:U,type:"addition",text:R[1],hasContext:!!(C||B)})}else if(R[0]===-1){let C="",B="";if(M>0&&w.value[M-1][0]===0){const H=w.value[M-1][1];C=H.substring(Math.max(0,H.length-40))}if(M<w.value.length-1&&w.value[M+1][0]===0){const H=w.value[M+1][1];B=H.substring(0,Math.min(40,H.length))}const N=[];C&&N.push([0,C]),N.push([-1,R[1]]),B&&N.push([0,B]);const U=k.patch_make(N);A.push({index:M,patch:U,type:"deletion",text:R[1],hasContext:!!(C||B)})}}}return A}),It(d,k=>{localStorage.setItem(e.SHOW_DIFF,k)}),It(l,k=>{localStorage.setItem(e.SHOW_INSTRUCTIONS,k)}),It(n,k=>{localStorage.setItem(e.INPUT,k)}),It(s,k=>{localStorage.setItem(e.PROCESSED,k)}),It(a,k=>{localStorage.setItem(e.ONLY_GRAMMAR,k)}),It(i,k=>{localStorage.setItem(e.HANDLE_SPANISH,k)}),It(o,k=>{localStorage.setItem(e.CUSTOM_INSTRUCTIONS,k)}),It(f,k=>{localStorage.setItem(e.WRITING_STYLE,k)}),It(_,k=>{localStorage.setItem(e.SHOW_ONLY_ADDITIONS,k)}),It(b,k=>{localStorage.setItem(e.API_KEY,k)});const S=async()=>{if(!n.value.trim()){c.value="Please enter some text to process.";return}u.value=!0,c.value=null;try{const k=await TA.processor(n.value,{onlyGrammar:a.value,handleSpanish:i.value,customInstructions:o.value,writingStyle:f.value});if(!k)throw new Error("No result received from the processor.");s.value=k}catch(k){console.error("Processing error:",k),c.value=k.message}finally{u.value=!1}},x=()=>{s.value&&(n.value=s.value)},T=()=>{confirm("Are you sure you want to clear all text? This cannot be undone.")&&(n.value="",s.value="",c.value=null)},I=async(k,A)=>{try{await navigator.clipboard.writeText(k),A==="input"?(h.value=!0,setTimeout(()=>h.value=!1,2e3)):(p.value=!0,setTimeout(()=>p.value=!1,2e3))}catch(M){console.error("Failed to copy text:",M),c.value="Failed to copy text to clipboard"}},W=k=>{const A=k.target;A.style.height="auto",A.style.height=A.scrollHeight+"px"},Y=(k,A)=>{if(k[0]===1)try{if(A>0&&w.value[A-1]&&w.value[A-1][0]===-1){let R=0;for(let U=0;U<A-1;U++){const H=w.value[U];H&&H[0]===0&&(R+=H[1].length)}const C=w.value[A-1][1],B=n.value.substring(0,R),N=n.value.substring(R+C.length);n.value=B+k[1]+N}else{let R=0;for(let N=0;N<A;N++){const U=w.value[N];U&&U[0]===0&&(R+=U[1].length)}const C=n.value.substring(0,R),B=n.value.substring(R);n.value=C+k[1]+B}m.value=!0,setTimeout(()=>{m.value=!1},2e3),xc(()=>{g.value&&W({target:g.value})})}catch(M){console.error("Error handling change click:",M),c.value="Failed to apply change. Please try again."}};return nm(()=>{g.value&&W({target:g.value})}),(k,A)=>(Be(),Ze("div",CA,[K("header",$A,[K("div",NA,[A[17]||(A[17]=K("h1",{class:"text-xl sm:text-2xl font-bold mb-4 text-gray-800"},"FlowPal",-1)),K("button",{onClick:A[0]||(A[0]=M=>y.value=!y.value),class:"text-gray-600 hover:text-gray-800",title:"Settings"},A[16]||(A[16]=[K("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)]))]),y.value?(Be(),Ze("div",jA,[K("div",LA,[K("div",MA,[A[19]||(A[19]=K("h2",{class:"text-lg sm:text-xl font-semibold"},"Settings",-1)),K("button",{onClick:A[1]||(A[1]=M=>y.value=!1),class:"text-gray-500 hover:text-gray-700"},A[18]||(A[18]=[K("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),K("div",DA,[A[20]||(A[20]=K("label",{for:"api-key",class:"block text-sm font-medium text-gray-700 mb-1"}," OpenAI API Key ",-1)),Ur(K("input",{id:"api-key",type:"password","onUpdate:modelValue":A[2]||(A[2]=M=>b.value=M),placeholder:"sk-...",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm"},null,512),[[Jo,b.value]]),A[21]||(A[21]=K("p",{class:"mt-1 text-xs sm:text-sm text-gray-500"}," Your API key is stored locally in your browser and never sent to our servers. ",-1))]),K("div",FA,[K("button",{onClick:A[3]||(A[3]=M=>y.value=!1),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Save ")])])])):xr("",!0),K("div",UA,[K("div",BA,[K("label",HA,[Ur(K("input",{type:"checkbox","onUpdate:modelValue":A[4]||(A[4]=M=>a.value=M),class:"rounded text-blue-600 focus:ring-blue-500"},null,512),[[Ja,a.value]]),A[22]||(A[22]=zr(" Only Fix Grammar "))]),K("label",qA,[Ur(K("input",{type:"checkbox","onUpdate:modelValue":A[5]||(A[5]=M=>i.value=M),class:"rounded text-blue-600 focus:ring-blue-500"},null,512),[[Ja,i.value]]),A[23]||(A[23]=zr(" Handle Spanish Text "))]),K("div",ZA,[A[24]||(A[24]=K("label",{for:"writing-style",class:"text-gray-600 text-sm"},"Style:",-1)),Ur(K("select",{id:"writing-style","onUpdate:modelValue":A[6]||(A[6]=M=>f.value=M),class:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-xs sm:text-sm w-full min-w-[120px]"},[(Be(),Ze(Ct,null,Id(t,M=>K("option",{key:M.id,value:M.id,title:M.description},gn(M.label),9,VA)),64))],512),[[tw,f.value]])])]),K("div",zA,[K("button",{onClick:S,disabled:u.value,class:"px-3 py-2 sm:px-4 sm:py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(Be(),Ze("span",GA,"Processing...")):(Be(),Ze("span",JA,"Improve Writing"))],8,WA),K("button",{onClick:T,class:"px-3 py-2 sm:px-4 sm:py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 shadow-sm"}," Clear All ")])]),K("div",KA,[K("button",{onClick:A[7]||(A[7]=M=>l.value=!l.value),class:"text-xs sm:text-sm text-gray-600 hover:text-gray-800 flex items-center gap-1"},[(Be(),Ze("svg",{class:na(["w-4 h-4 transform transition-transform",l.value?"rotate-0":"-rotate-90"]),viewBox:"0 0 24 24"},A[25]||(A[25]=[K("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",fill:"currentColor"},null,-1)]),2)),A[26]||(A[26]=zr(" Custom Instructions "))])]),l.value?(Be(),Ze("div",XA,[K("div",YA,[Ur(K("textarea",{"onUpdate:modelValue":A[8]||(A[8]=M=>o.value=M),placeholder:"Add your custom instructions for the AI here...",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-xs sm:text-sm",rows:"2"},null,512),[[Jo,o.value]])])])):xr("",!0)]),K("main",QA,[K("div",eP,[K("div",tP,[K("div",rP,[A[27]||(A[27]=K("h2",{class:"text-xl font-semibold text-gray-800"},"Your Text",-1)),n.value?(Be(),Ze("button",{key:0,onClick:A[9]||(A[9]=M=>I(n.value,"input")),class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 shadow-sm flex items-center gap-1 sm:gap-2"},gn(h.value?"Copied!":"Copy"),1)):xr("",!0)]),Ur(K("textarea",{ref_key:"textareaRef",ref:g,"onUpdate:modelValue":A[10]||(A[10]=M=>n.value=M),placeholder:"Start writing here...",class:"w-full p-3 sm:p-4 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-serif text-base sm:text-lg leading-relaxed overflow-hidden resize-none min-h-[150px] flex-grow",onInput:A[11]||(A[11]=M=>W(M))},null,544),[[Jo,n.value]])]),K("div",nP,[K("div",sP,[K("div",aP,[A[30]||(A[30]=K("h2",{class:"text-xl font-semibold text-gray-800"},"Processed Text",-1)),K("label",iP,[Ur(K("input",{type:"checkbox","onUpdate:modelValue":A[12]||(A[12]=M=>d.value=M),class:"rounded text-blue-600 focus:ring-blue-500"},null,512),[[Ja,d.value]]),A[28]||(A[28]=zr(" Show Changes "))]),K("label",oP,[Ur(K("input",{type:"checkbox","onUpdate:modelValue":A[13]||(A[13]=M=>_.value=M),class:"rounded text-blue-600 focus:ring-blue-500"},null,512),[[Ja,_.value]]),A[29]||(A[29]=zr(" Show Only Additions "))])]),K("div",lP,[s.value?(Be(),Ze("button",{key:0,onClick:A[14]||(A[14]=M=>I(s.value,"processed")),class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 shadow-sm"},gn(p.value?"Copied!":"Copy"),1)):xr("",!0),s.value?(Be(),Ze("button",{key:1,onClick:x,class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 shadow-sm flex items-center gap-1 sm:gap-2"},[(Be(),Ze("svg",uP,[K("path",{d:Wp(IA),fill:"currentColor"},null,8,cP)])),A[31]||(A[31]=zr(" Apply "))])):xr("",!0)])]),K("div",dP,[d.value&&s.value?(Be(!0),Ze(Ct,{key:0},Id(w.value,(M,R)=>(Be(),Ze(Ct,{key:R},[M[0]===0||_.value&&M[0]===1||!_.value&&M[0]!==0?(Be(),Ze("span",{key:0,class:na({"bg-red-100 line-through":M[0]===-1&&!_.value,"bg-green-100 hover:bg-green-200 cursor-pointer transition-colors duration-150 border-b border-dashed border-green-400 hover:border-green-500":M[0]===1}),onClick:C=>M[0]===1?Y(M,R):null,title:M[0]===1?"Click to apply this change":""},gn(M[1]),11,fP)):xr("",!0)],64))),128)):(Be(),Ze(Ct,{key:1},[zr(gn(s.value),1)],64))])])])]),c.value?(Be(),Ze("div",hP,[K("div",pP,[K("div",null,[A[32]||(A[32]=K("p",{class:"font-bold"},"Error",-1)),K("p",null,gn(c.value),1)]),K("button",{onClick:A[15]||(A[15]=M=>c.value=null),class:"ml-4 text-red-700 hover:text-red-900"}," × ")])])):xr("",!0),u.value?(Be(),Ze("div",mP," Processing your text... ")):xr("",!0),m.value?(Be(),Ze("div",gP," Change applied! ")):xr("",!0)]))}};sw(_P).mount("#app");
