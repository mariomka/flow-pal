var J_=Object.defineProperty;var K_=(r,e,t)=>e in r?J_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Hr=(r,e,t)=>K_(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function mc(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const $e={},es=[],wr=()=>{},X_=()=>!1,lo=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),gc=r=>r.startsWith("onUpdate:"),mt=Object.assign,_c=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},Y_=Object.prototype.hasOwnProperty,Ae=(r,e)=>Y_.call(r,e),ae=Array.isArray,ts=r=>Ca(r)==="[object Map]",ys=r=>Ca(r)==="[object Set]",Rd=r=>Ca(r)==="[object Date]",de=r=>typeof r=="function",Ze=r=>typeof r=="string",xr=r=>typeof r=="symbol",Me=r=>r!==null&&typeof r=="object",Cp=r=>(Me(r)||de(r))&&de(r.then)&&de(r.catch),$p=Object.prototype.toString,Ca=r=>$p.call(r),Q_=r=>Ca(r).slice(8,-1),Np=r=>Ca(r)==="[object Object]",yc=r=>Ze(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,Gs=mc(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),uo=r=>{const e=Object.create(null);return t=>e[t]||(e[t]=r(t))},ey=/-(\w)/g,sn=uo(r=>r.replace(ey,(e,t)=>t?t.toUpperCase():"")),ty=/\B([A-Z])/g,Ln=uo(r=>r.replace(ty,"-$1").toLowerCase()),jp=uo(r=>r.charAt(0).toUpperCase()+r.slice(1)),Vo=uo(r=>r?`on${jp(r)}`:""),tn=(r,e)=>!Object.is(r,e),yi=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},Lp=(r,e,t,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:t})},Ci=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let Cd;const co=()=>Cd||(Cd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function bc(r){if(ae(r)){const e={};for(let t=0;t<r.length;t++){const n=r[t],s=Ze(n)?ay(n):bc(n);if(s)for(const a in s)e[a]=s[a]}return e}else if(Ze(r)||Me(r))return r}const ry=/;(?![^(]*\))/g,ny=/:([^]+)/,sy=/\/\*[^]*?\*\//g;function ay(r){const e={};return r.replace(sy,"").split(ry).forEach(t=>{if(t){const n=t.split(ny);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Mr(r){let e="";if(Ze(r))e=r;else if(ae(r))for(let t=0;t<r.length;t++){const n=Mr(r[t]);n&&(e+=n+" ")}else if(Me(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const iy="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",oy=mc(iy);function Mp(r){return!!r||r===""}function ly(r,e){if(r.length!==e.length)return!1;let t=!0;for(let n=0;t&&n<r.length;n++)t=$a(r[n],e[n]);return t}function $a(r,e){if(r===e)return!0;let t=Rd(r),n=Rd(e);if(t||n)return t&&n?r.getTime()===e.getTime():!1;if(t=xr(r),n=xr(e),t||n)return r===e;if(t=ae(r),n=ae(e),t||n)return t&&n?ly(r,e):!1;if(t=Me(r),n=Me(e),t||n){if(!t||!n)return!1;const s=Object.keys(r).length,a=Object.keys(e).length;if(s!==a)return!1;for(const i in r){const o=r.hasOwnProperty(i),l=e.hasOwnProperty(i);if(o&&!l||!o&&l||!$a(r[i],e[i]))return!1}}return String(r)===String(e)}function wc(r,e){return r.findIndex(t=>$a(t,e))}const Dp=r=>!!(r&&r.__v_isRef===!0),rn=r=>Ze(r)?r:r==null?"":ae(r)||Me(r)&&(r.toString===$p||!de(r.toString))?Dp(r)?rn(r.value):JSON.stringify(r,Fp,2):String(r),Fp=(r,e)=>Dp(e)?Fp(r,e.value):ts(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],a)=>(t[zo(n,a)+" =>"]=s,t),{})}:ys(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>zo(t))}:xr(e)?zo(e):Me(e)&&!ae(e)&&!Np(e)?String(e):e,zo=(r,e="")=>{var t;return xr(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let $t;class uy{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=$t,!e&&$t&&(this.index=($t.scopes||($t.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=$t;try{return $t=this,e()}finally{$t=t}}}on(){$t=this}off(){$t=this.parent}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function cy(){return $t}let je;const Go=new WeakSet;class Up{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,$t&&$t.active&&$t.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Go.has(this)&&(Go.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Hp(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,$d(this),qp(this);const e=je,t=er;je=this,er=!0;try{return this.fn()}finally{Zp(this),je=e,er=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Ec(e);this.deps=this.depsTail=void 0,$d(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Go.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Tu(this)&&this.run()}get dirty(){return Tu(this)}}let Bp=0,Ws,Js;function Hp(r,e=!1){if(r.flags|=8,e){r.next=Js,Js=r;return}r.next=Ws,Ws=r}function vc(){Bp++}function xc(){if(--Bp>0)return;if(Js){let e=Js;for(Js=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;Ws;){let e=Ws;for(Ws=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=t}}if(r)throw r}function qp(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Zp(r){let e,t=r.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),Ec(n),dy(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}r.deps=e,r.depsTail=t}function Tu(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Vp(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function Vp(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===ia))return;r.globalVersion=ia;const e=r.dep;if(r.flags|=2,e.version>0&&!r.isSSR&&r.deps&&!Tu(r)){r.flags&=-3;return}const t=je,n=er;je=r,er=!0;try{qp(r);const s=r.fn(r._value);(e.version===0||tn(s,r._value))&&(r._value=s,e.version++)}catch(s){throw e.version++,s}finally{je=t,er=n,Zp(r),r.flags&=-3}}function Ec(r,e=!1){const{dep:t,prevSub:n,nextSub:s}=r;if(n&&(n.nextSub=s,r.prevSub=void 0),s&&(s.prevSub=n,r.nextSub=void 0),t.subs===r&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let a=t.computed.deps;a;a=a.nextDep)Ec(a,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function dy(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let er=!0;const zp=[];function hn(){zp.push(er),er=!1}function pn(){const r=zp.pop();er=r===void 0?!0:r}function $d(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=je;je=void 0;try{e()}finally{je=t}}}let ia=0;class fy{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Sc{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!je||!er||je===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==je)t=this.activeLink=new fy(je,this),je.deps?(t.prevDep=je.depsTail,je.depsTail.nextDep=t,je.depsTail=t):je.deps=je.depsTail=t,Gp(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=je.depsTail,t.nextDep=void 0,je.depsTail.nextDep=t,je.depsTail=t,je.deps===t&&(je.deps=n)}return t}trigger(e){this.version++,ia++,this.notify(e)}notify(e){vc();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{xc()}}}function Gp(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Gp(n)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const Pu=new WeakMap,Sn=Symbol(""),Iu=Symbol(""),oa=Symbol("");function nt(r,e,t){if(er&&je){let n=Pu.get(r);n||Pu.set(r,n=new Map);let s=n.get(t);s||(n.set(t,s=new Sc),s.map=n,s.key=t),s.track()}}function Nr(r,e,t,n,s,a){const i=Pu.get(r);if(!i){ia++;return}const o=l=>{l&&l.trigger()};if(vc(),e==="clear")i.forEach(o);else{const l=ae(r),u=l&&yc(t);if(l&&t==="length"){const c=Number(n);i.forEach((d,f)=>{(f==="length"||f===oa||!xr(f)&&f>=c)&&o(d)})}else switch((t!==void 0||i.has(void 0))&&o(i.get(t)),u&&o(i.get(oa)),e){case"add":l?u&&o(i.get("length")):(o(i.get(Sn)),ts(r)&&o(i.get(Iu)));break;case"delete":l||(o(i.get(Sn)),ts(r)&&o(i.get(Iu)));break;case"set":ts(r)&&o(i.get(Sn));break}}xc()}function Fn(r){const e=Oe(r);return e===r?e:(nt(e,"iterate",oa),qt(r)?e:e.map(st))}function fo(r){return nt(r=Oe(r),"iterate",oa),r}const hy={__proto__:null,[Symbol.iterator](){return Wo(this,Symbol.iterator,st)},concat(...r){return Fn(this).concat(...r.map(e=>ae(e)?Fn(e):e))},entries(){return Wo(this,"entries",r=>(r[1]=st(r[1]),r))},every(r,e){return Tr(this,"every",r,e,void 0,arguments)},filter(r,e){return Tr(this,"filter",r,e,t=>t.map(st),arguments)},find(r,e){return Tr(this,"find",r,e,st,arguments)},findIndex(r,e){return Tr(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return Tr(this,"findLast",r,e,st,arguments)},findLastIndex(r,e){return Tr(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return Tr(this,"forEach",r,e,void 0,arguments)},includes(...r){return Jo(this,"includes",r)},indexOf(...r){return Jo(this,"indexOf",r)},join(r){return Fn(this).join(r)},lastIndexOf(...r){return Jo(this,"lastIndexOf",r)},map(r,e){return Tr(this,"map",r,e,void 0,arguments)},pop(){return Rs(this,"pop")},push(...r){return Rs(this,"push",r)},reduce(r,...e){return Nd(this,"reduce",r,e)},reduceRight(r,...e){return Nd(this,"reduceRight",r,e)},shift(){return Rs(this,"shift")},some(r,e){return Tr(this,"some",r,e,void 0,arguments)},splice(...r){return Rs(this,"splice",r)},toReversed(){return Fn(this).toReversed()},toSorted(r){return Fn(this).toSorted(r)},toSpliced(...r){return Fn(this).toSpliced(...r)},unshift(...r){return Rs(this,"unshift",r)},values(){return Wo(this,"values",st)}};function Wo(r,e,t){const n=fo(r),s=n[e]();return n!==r&&!qt(r)&&(s._next=s.next,s.next=()=>{const a=s._next();return a.value&&(a.value=t(a.value)),a}),s}const py=Array.prototype;function Tr(r,e,t,n,s,a){const i=fo(r),o=i!==r&&!qt(r),l=i[e];if(l!==py[e]){const d=l.apply(r,a);return o?st(d):d}let u=t;i!==r&&(o?u=function(d,f){return t.call(this,st(d),f,r)}:t.length>2&&(u=function(d,f){return t.call(this,d,f,r)}));const c=l.call(i,u,n);return o&&s?s(c):c}function Nd(r,e,t,n){const s=fo(r);let a=t;return s!==r&&(qt(r)?t.length>3&&(a=function(i,o,l){return t.call(this,i,o,l,r)}):a=function(i,o,l){return t.call(this,i,st(o),l,r)}),s[e](a,...n)}function Jo(r,e,t){const n=Oe(r);nt(n,"iterate",oa);const s=n[e](...t);return(s===-1||s===!1)&&Pc(t[0])?(t[0]=Oe(t[0]),n[e](...t)):s}function Rs(r,e,t=[]){hn(),vc();const n=Oe(r)[e].apply(r,t);return xc(),pn(),n}const my=mc("__proto__,__v_isRef,__isVue"),Wp=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(xr));function gy(r){xr(r)||(r=String(r));const e=Oe(this);return nt(e,"has",r),e.hasOwnProperty(r)}class Jp{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,a=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return a;if(t==="__v_raw")return n===(s?a?Ay:Qp:a?Yp:Xp).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const i=ae(e);if(!s){let l;if(i&&(l=hy[t]))return l;if(t==="hasOwnProperty")return gy}const o=Reflect.get(e,t,it(e)?e:n);return(xr(t)?Wp.has(t):my(t))||(s||nt(e,"get",t),a)?o:it(o)?i&&yc(t)?o:o.value:Me(o)?s?em(o):Ac(o):o}}class Kp extends Jp{constructor(e=!1){super(!1,e)}set(e,t,n,s){let a=e[t];if(!this._isShallow){const l=In(a);if(!qt(n)&&!In(n)&&(a=Oe(a),n=Oe(n)),!ae(e)&&it(a)&&!it(n))return l?!1:(a.value=n,!0)}const i=ae(e)&&yc(t)?Number(t)<e.length:Ae(e,t),o=Reflect.set(e,t,n,it(e)?e:s);return e===Oe(s)&&(i?tn(n,a)&&Nr(e,"set",t,n):Nr(e,"add",t,n)),o}deleteProperty(e,t){const n=Ae(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&Nr(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!xr(t)||!Wp.has(t))&&nt(e,"has",t),n}ownKeys(e){return nt(e,"iterate",ae(e)?"length":Sn),Reflect.ownKeys(e)}}class _y extends Jp{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const yy=new Kp,by=new _y,wy=new Kp(!0);const ku=r=>r,Wa=r=>Reflect.getPrototypeOf(r);function vy(r,e,t){return function(...n){const s=this.__v_raw,a=Oe(s),i=ts(a),o=r==="entries"||r===Symbol.iterator&&i,l=r==="keys"&&i,u=s[r](...n),c=t?ku:e?Ru:st;return!e&&nt(a,"iterate",l?Iu:Sn),{next(){const{value:d,done:f}=u.next();return f?{value:d,done:f}:{value:o?[c(d[0]),c(d[1])]:c(d),done:f}},[Symbol.iterator](){return this}}}}function Ja(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function xy(r,e){const t={get(s){const a=this.__v_raw,i=Oe(a),o=Oe(s);r||(tn(s,o)&&nt(i,"get",s),nt(i,"get",o));const{has:l}=Wa(i),u=e?ku:r?Ru:st;if(l.call(i,s))return u(a.get(s));if(l.call(i,o))return u(a.get(o));a!==i&&a.get(s)},get size(){const s=this.__v_raw;return!r&&nt(Oe(s),"iterate",Sn),Reflect.get(s,"size",s)},has(s){const a=this.__v_raw,i=Oe(a),o=Oe(s);return r||(tn(s,o)&&nt(i,"has",s),nt(i,"has",o)),s===o?a.has(s):a.has(s)||a.has(o)},forEach(s,a){const i=this,o=i.__v_raw,l=Oe(o),u=e?ku:r?Ru:st;return!r&&nt(l,"iterate",Sn),o.forEach((c,d)=>s.call(a,u(c),u(d),i))}};return mt(t,r?{add:Ja("add"),set:Ja("set"),delete:Ja("delete"),clear:Ja("clear")}:{add(s){!e&&!qt(s)&&!In(s)&&(s=Oe(s));const a=Oe(this);return Wa(a).has.call(a,s)||(a.add(s),Nr(a,"add",s,s)),this},set(s,a){!e&&!qt(a)&&!In(a)&&(a=Oe(a));const i=Oe(this),{has:o,get:l}=Wa(i);let u=o.call(i,s);u||(s=Oe(s),u=o.call(i,s));const c=l.call(i,s);return i.set(s,a),u?tn(a,c)&&Nr(i,"set",s,a):Nr(i,"add",s,a),this},delete(s){const a=Oe(this),{has:i,get:o}=Wa(a);let l=i.call(a,s);l||(s=Oe(s),l=i.call(a,s)),o&&o.call(a,s);const u=a.delete(s);return l&&Nr(a,"delete",s,void 0),u},clear(){const s=Oe(this),a=s.size!==0,i=s.clear();return a&&Nr(s,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=vy(s,r,e)}),t}function Oc(r,e){const t=xy(r,e);return(n,s,a)=>s==="__v_isReactive"?!r:s==="__v_isReadonly"?r:s==="__v_raw"?n:Reflect.get(Ae(t,s)&&s in n?t:n,s,a)}const Ey={get:Oc(!1,!1)},Sy={get:Oc(!1,!0)},Oy={get:Oc(!0,!1)};const Xp=new WeakMap,Yp=new WeakMap,Qp=new WeakMap,Ay=new WeakMap;function Ty(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Py(r){return r.__v_skip||!Object.isExtensible(r)?0:Ty(Q_(r))}function Ac(r){return In(r)?r:Tc(r,!1,yy,Ey,Xp)}function Iy(r){return Tc(r,!1,wy,Sy,Yp)}function em(r){return Tc(r,!0,by,Oy,Qp)}function Tc(r,e,t,n,s){if(!Me(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const a=s.get(r);if(a)return a;const i=Py(r);if(i===0)return r;const o=new Proxy(r,i===2?n:t);return s.set(r,o),o}function rs(r){return In(r)?rs(r.__v_raw):!!(r&&r.__v_isReactive)}function In(r){return!!(r&&r.__v_isReadonly)}function qt(r){return!!(r&&r.__v_isShallow)}function Pc(r){return r?!!r.__v_raw:!1}function Oe(r){const e=r&&r.__v_raw;return e?Oe(e):r}function ky(r){return!Ae(r,"__v_skip")&&Object.isExtensible(r)&&Lp(r,"__v_skip",!0),r}const st=r=>Me(r)?Ac(r):r,Ru=r=>Me(r)?em(r):r;function it(r){return r?r.__v_isRef===!0:!1}function Se(r){return Ry(r,!1)}function Ry(r,e){return it(r)?r:new Cy(r,e)}class Cy{constructor(e,t){this.dep=new Sc,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Oe(e),this._value=t?e:st(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||qt(e)||In(e);e=n?e:Oe(e),tn(e,t)&&(this._rawValue=e,this._value=n?e:st(e),this.dep.trigger())}}function Wr(r){return it(r)?r.value:r}const $y={get:(r,e,t)=>e==="__v_raw"?r:Wr(Reflect.get(r,e,t)),set:(r,e,t,n)=>{const s=r[e];return it(s)&&!it(t)?(s.value=t,!0):Reflect.set(r,e,t,n)}};function tm(r){return rs(r)?r:new Proxy(r,$y)}class Ny{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Sc(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ia-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&je!==this)return Hp(this,!0),!0}get value(){const e=this.dep.track();return Vp(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function jy(r,e,t=!1){let n,s;return de(r)?n=r:(n=r.get,s=r.set),new Ny(n,s,t)}const Ka={},$i=new WeakMap;let wn;function Ly(r,e=!1,t=wn){if(t){let n=$i.get(t);n||$i.set(t,n=[]),n.push(r)}}function My(r,e,t=$e){const{immediate:n,deep:s,once:a,scheduler:i,augmentJob:o,call:l}=t,u=v=>s?v:qt(v)||s===!1||s===0?jr(v,1):jr(v);let c,d,f,h,p=!1,m=!1;if(it(r)?(d=()=>r.value,p=qt(r)):rs(r)?(d=()=>u(r),p=!0):ae(r)?(m=!0,p=r.some(v=>rs(v)||qt(v)),d=()=>r.map(v=>{if(it(v))return v.value;if(rs(v))return u(v);if(de(v))return l?l(v,2):v()})):de(r)?e?d=l?()=>l(r,2):r:d=()=>{if(f){hn();try{f()}finally{pn()}}const v=wn;wn=c;try{return l?l(r,3,[h]):r(h)}finally{wn=v}}:d=wr,e&&s){const v=d,E=s===!0?1/0:s;d=()=>jr(v(),E)}const g=cy(),_=()=>{c.stop(),g&&g.active&&_c(g.effects,c)};if(a&&e){const v=e;e=(...E)=>{v(...E),_()}}let b=m?new Array(r.length).fill(Ka):Ka;const y=v=>{if(!(!(c.flags&1)||!c.dirty&&!v))if(e){const E=c.run();if(s||p||(m?E.some((A,S)=>tn(A,b[S])):tn(E,b))){f&&f();const A=wn;wn=c;try{const S=[E,b===Ka?void 0:m&&b[0]===Ka?[]:b,h];l?l(e,3,S):e(...S),b=E}finally{wn=A}}}else c.run()};return o&&o(y),c=new Up(d),c.scheduler=i?()=>i(y,!1):y,h=v=>Ly(v,!1,c),f=c.onStop=()=>{const v=$i.get(c);if(v){if(l)l(v,4);else for(const E of v)E();$i.delete(c)}},e?n?y(!0):b=c.run():i?i(y.bind(null,!0),!0):c.run(),_.pause=c.pause.bind(c),_.resume=c.resume.bind(c),_.stop=_,_}function jr(r,e=1/0,t){if(e<=0||!Me(r)||r.__v_skip||(t=t||new Set,t.has(r)))return r;if(t.add(r),e--,it(r))jr(r.value,e,t);else if(ae(r))for(let n=0;n<r.length;n++)jr(r[n],e,t);else if(ys(r)||ts(r))r.forEach(n=>{jr(n,e,t)});else if(Np(r)){for(const n in r)jr(r[n],e,t);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&jr(r[n],e,t)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Na(r,e,t,n){try{return n?r(...n):r()}catch(s){ho(s,e,t)}}function Er(r,e,t,n){if(de(r)){const s=Na(r,e,t,n);return s&&Cp(s)&&s.catch(a=>{ho(a,e,t)}),s}if(ae(r)){const s=[];for(let a=0;a<r.length;a++)s.push(Er(r[a],e,t,n));return s}}function ho(r,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:a,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||$e;if(e){let o=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const c=o.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](r,l,u)===!1)return}o=o.parent}if(a){hn(),Na(a,null,10,[r,l,u]),pn();return}}Dy(r,t,s,n,i)}function Dy(r,e,t,n=!0,s=!1){if(s)throw r;console.error(r)}const ft=[];let pr=-1;const ns=[];let Jr=null,Vn=0;const rm=Promise.resolve();let Ni=null;function po(r){const e=Ni||rm;return r?e.then(this?r.bind(this):r):e}function Fy(r){let e=pr+1,t=ft.length;for(;e<t;){const n=e+t>>>1,s=ft[n],a=la(s);a<r||a===r&&s.flags&2?e=n+1:t=n}return e}function Ic(r){if(!(r.flags&1)){const e=la(r),t=ft[ft.length-1];!t||!(r.flags&2)&&e>=la(t)?ft.push(r):ft.splice(Fy(e),0,r),r.flags|=1,nm()}}function nm(){Ni||(Ni=rm.then(am))}function Uy(r){ae(r)?ns.push(...r):Jr&&r.id===-1?Jr.splice(Vn+1,0,r):r.flags&1||(ns.push(r),r.flags|=1),nm()}function jd(r,e,t=pr+1){for(;t<ft.length;t++){const n=ft[t];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;ft.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function sm(r){if(ns.length){const e=[...new Set(ns)].sort((t,n)=>la(t)-la(n));if(ns.length=0,Jr){Jr.push(...e);return}for(Jr=e,Vn=0;Vn<Jr.length;Vn++){const t=Jr[Vn];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Jr=null,Vn=0}}const la=r=>r.id==null?r.flags&2?-1:1/0:r.id;function am(r){try{for(pr=0;pr<ft.length;pr++){const e=ft[pr];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Na(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;pr<ft.length;pr++){const e=ft[pr];e&&(e.flags&=-2)}pr=-1,ft.length=0,sm(),Ni=null,(ft.length||ns.length)&&am()}}let Bt=null,im=null;function ji(r){const e=Bt;return Bt=r,im=r&&r.type.__scopeId||null,e}function By(r,e=Bt,t){if(!e||r._n)return r;const n=(...s)=>{n._d&&Zd(-1);const a=ji(e);let i;try{i=r(...s)}finally{ji(a),n._d&&Zd(1)}return i};return n._n=!0,n._c=!0,n._d=!0,n}function nn(r,e){if(Bt===null)return r;const t=bo(Bt),n=r.dirs||(r.dirs=[]);for(let s=0;s<e.length;s++){let[a,i,o,l=$e]=e[s];a&&(de(a)&&(a={mounted:a,updated:a}),a.deep&&jr(i),n.push({dir:a,instance:t,value:i,oldValue:void 0,arg:o,modifiers:l}))}return r}function gn(r,e,t,n){const s=r.dirs,a=e&&e.dirs;for(let i=0;i<s.length;i++){const o=s[i];a&&(o.oldValue=a[i].value);let l=o.dir[n];l&&(hn(),Er(l,t,8,[r.el,o,r,e]),pn())}}const Hy=Symbol("_vte"),qy=r=>r.__isTeleport;function kc(r,e){r.shapeFlag&6&&r.component?(r.transition=e,kc(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function om(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function Li(r,e,t,n,s=!1){if(ae(r)){r.forEach((p,m)=>Li(p,e&&(ae(e)?e[m]:e),t,n,s));return}if(Ks(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Li(r,e,t,n.component.subTree);return}const a=n.shapeFlag&4?bo(n.component):n.el,i=s?null:a,{i:o,r:l}=r,u=e&&e.r,c=o.refs===$e?o.refs={}:o.refs,d=o.setupState,f=Oe(d),h=d===$e?()=>!1:p=>Ae(f,p);if(u!=null&&u!==l&&(Ze(u)?(c[u]=null,h(u)&&(d[u]=null)):it(u)&&(u.value=null)),de(l))Na(l,o,12,[i,c]);else{const p=Ze(l),m=it(l);if(p||m){const g=()=>{if(r.f){const _=p?h(l)?d[l]:c[l]:l.value;s?ae(_)&&_c(_,a):ae(_)?_.includes(a)||_.push(a):p?(c[l]=[a],h(l)&&(d[l]=c[l])):(l.value=[a],r.k&&(c[r.k]=l.value))}else p?(c[l]=i,h(l)&&(d[l]=i)):m&&(l.value=i,r.k&&(c[r.k]=i))};i?(g.id=-1,Rt(g,t)):g()}}}co().requestIdleCallback;co().cancelIdleCallback;const Ks=r=>!!r.type.__asyncLoader,lm=r=>r.type.__isKeepAlive;function Zy(r,e){um(r,"a",e)}function Vy(r,e){um(r,"da",e)}function um(r,e,t=pt){const n=r.__wdc||(r.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return r()});if(mo(e,n,t),t){let s=t.parent;for(;s&&s.parent;)lm(s.parent.vnode)&&zy(n,e,t,s),s=s.parent}}function zy(r,e,t,n){const s=mo(e,r,n,!0);dm(()=>{_c(n[e],s)},t)}function mo(r,e,t=pt,n=!1){if(t){const s=t[r]||(t[r]=[]),a=e.__weh||(e.__weh=(...i)=>{hn();const o=ja(t),l=Er(e,t,r,i);return o(),pn(),l});return n?s.unshift(a):s.push(a),a}}const Br=r=>(e,t=pt)=>{(!ca||r==="sp")&&mo(r,(...n)=>e(...n),t)},Gy=Br("bm"),go=Br("m"),Wy=Br("bu"),Jy=Br("u"),cm=Br("bum"),dm=Br("um"),Ky=Br("sp"),Xy=Br("rtg"),Yy=Br("rtc");function Qy(r,e=pt){mo("ec",r,e)}const eb=Symbol.for("v-ndc");function fm(r,e,t,n){let s;const a=t,i=ae(r);if(i||Ze(r)){const o=i&&rs(r);let l=!1;o&&(l=!qt(r),r=fo(r)),s=new Array(r.length);for(let u=0,c=r.length;u<c;u++)s[u]=e(l?st(r[u]):r[u],u,void 0,a)}else if(typeof r=="number"){s=new Array(r);for(let o=0;o<r;o++)s[o]=e(o+1,o,void 0,a)}else if(Me(r))if(r[Symbol.iterator])s=Array.from(r,(o,l)=>e(o,l,void 0,a));else{const o=Object.keys(r);s=new Array(o.length);for(let l=0,u=o.length;l<u;l++){const c=o[l];s[l]=e(r[c],c,l,a)}}else s=[];return s}const Cu=r=>r?Nm(r)?bo(r):Cu(r.parent):null,Xs=mt(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>Cu(r.parent),$root:r=>Cu(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>pm(r),$forceUpdate:r=>r.f||(r.f=()=>{Ic(r.update)}),$nextTick:r=>r.n||(r.n=po.bind(r.proxy)),$watch:r=>xb.bind(r)}),Ko=(r,e)=>r!==$e&&!r.__isScriptSetup&&Ae(r,e),tb={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:a,accessCache:i,type:o,appContext:l}=r;let u;if(e[0]!=="$"){const h=i[e];if(h!==void 0)switch(h){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return a[e]}else{if(Ko(n,e))return i[e]=1,n[e];if(s!==$e&&Ae(s,e))return i[e]=2,s[e];if((u=r.propsOptions[0])&&Ae(u,e))return i[e]=3,a[e];if(t!==$e&&Ae(t,e))return i[e]=4,t[e];$u&&(i[e]=0)}}const c=Xs[e];let d,f;if(c)return e==="$attrs"&&nt(r.attrs,"get",""),c(r);if((d=o.__cssModules)&&(d=d[e]))return d;if(t!==$e&&Ae(t,e))return i[e]=4,t[e];if(f=l.config.globalProperties,Ae(f,e))return f[e]},set({_:r},e,t){const{data:n,setupState:s,ctx:a}=r;return Ko(s,e)?(s[e]=t,!0):n!==$e&&Ae(n,e)?(n[e]=t,!0):Ae(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(a[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:a}},i){let o;return!!t[i]||r!==$e&&Ae(r,i)||Ko(e,i)||(o=a[0])&&Ae(o,i)||Ae(n,i)||Ae(Xs,i)||Ae(s.config.globalProperties,i)},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:Ae(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function Ld(r){return ae(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let $u=!0;function rb(r){const e=pm(r),t=r.proxy,n=r.ctx;$u=!1,e.beforeCreate&&Md(e.beforeCreate,r,"bc");const{data:s,computed:a,methods:i,watch:o,provide:l,inject:u,created:c,beforeMount:d,mounted:f,beforeUpdate:h,updated:p,activated:m,deactivated:g,beforeDestroy:_,beforeUnmount:b,destroyed:y,unmounted:v,render:E,renderTracked:A,renderTriggered:S,errorCaptured:O,serverPrefetch:k,expose:K,inheritAttrs:Z,components:re,directives:ye,filters:L}=e;if(u&&nb(u,n,null),i)for(const M in i){const F=i[M];de(F)&&(n[M]=F.bind(t))}if(s){const M=s.call(t,t);Me(M)&&(r.data=Ac(M))}if($u=!0,a)for(const M in a){const F=a[M],W=de(F)?F.bind(t,t):de(F.get)?F.get.bind(t,t):wr,te=!de(F)&&de(F.set)?F.set.bind(t):wr,ue=$c({get:W,set:te});Object.defineProperty(n,M,{enumerable:!0,configurable:!0,get:()=>ue.value,set:Q=>ue.value=Q})}if(o)for(const M in o)hm(o[M],n,t,M);if(l){const M=de(l)?l.call(t):l;Reflect.ownKeys(M).forEach(F=>{ub(F,M[F])})}c&&Md(c,r,"c");function H(M,F){ae(F)?F.forEach(W=>M(W.bind(t))):F&&M(F.bind(t))}if(H(Gy,d),H(go,f),H(Wy,h),H(Jy,p),H(Zy,m),H(Vy,g),H(Qy,O),H(Yy,A),H(Xy,S),H(cm,b),H(dm,v),H(Ky,k),ae(K))if(K.length){const M=r.exposed||(r.exposed={});K.forEach(F=>{Object.defineProperty(M,F,{get:()=>t[F],set:W=>t[F]=W})})}else r.exposed||(r.exposed={});E&&r.render===wr&&(r.render=E),Z!=null&&(r.inheritAttrs=Z),re&&(r.components=re),ye&&(r.directives=ye),k&&om(r)}function nb(r,e,t=wr){ae(r)&&(r=Nu(r));for(const n in r){const s=r[n];let a;Me(s)?"default"in s?a=bi(s.from||n,s.default,!0):a=bi(s.from||n):a=bi(s),it(a)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>a.value,set:i=>a.value=i}):e[n]=a}}function Md(r,e,t){Er(ae(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,t)}function hm(r,e,t,n){let s=n.includes(".")?Pm(t,n):()=>t[n];if(Ze(r)){const a=e[r];de(a)&&Ue(s,a)}else if(de(r))Ue(s,r.bind(t));else if(Me(r))if(ae(r))r.forEach(a=>hm(a,e,t,n));else{const a=de(r.handler)?r.handler.bind(t):e[r.handler];de(a)&&Ue(s,a,r)}}function pm(r){const e=r.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:a,config:{optionMergeStrategies:i}}=r.appContext,o=a.get(e);let l;return o?l=o:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(u=>Mi(l,u,i,!0)),Mi(l,e,i)),Me(e)&&a.set(e,l),l}function Mi(r,e,t,n=!1){const{mixins:s,extends:a}=e;a&&Mi(r,a,t,!0),s&&s.forEach(i=>Mi(r,i,t,!0));for(const i in e)if(!(n&&i==="expose")){const o=sb[i]||t&&t[i];r[i]=o?o(r[i],e[i]):e[i]}return r}const sb={data:Dd,props:Fd,emits:Fd,methods:Ms,computed:Ms,beforeCreate:ct,created:ct,beforeMount:ct,mounted:ct,beforeUpdate:ct,updated:ct,beforeDestroy:ct,beforeUnmount:ct,destroyed:ct,unmounted:ct,activated:ct,deactivated:ct,errorCaptured:ct,serverPrefetch:ct,components:Ms,directives:Ms,watch:ib,provide:Dd,inject:ab};function Dd(r,e){return e?r?function(){return mt(de(r)?r.call(this,this):r,de(e)?e.call(this,this):e)}:e:r}function ab(r,e){return Ms(Nu(r),Nu(e))}function Nu(r){if(ae(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function ct(r,e){return r?[...new Set([].concat(r,e))]:e}function Ms(r,e){return r?mt(Object.create(null),r,e):e}function Fd(r,e){return r?ae(r)&&ae(e)?[...new Set([...r,...e])]:mt(Object.create(null),Ld(r),Ld(e??{})):e}function ib(r,e){if(!r)return e;if(!e)return r;const t=mt(Object.create(null),r);for(const n in e)t[n]=ct(r[n],e[n]);return t}function mm(){return{app:null,config:{isNativeTag:X_,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ob=0;function lb(r,e){return function(n,s=null){de(n)||(n=mt({},n)),s!=null&&!Me(s)&&(s=null);const a=mm(),i=new WeakSet,o=[];let l=!1;const u=a.app={_uid:ob++,_component:n,_props:s,_container:null,_context:a,_instance:null,version:qb,get config(){return a.config},set config(c){},use(c,...d){return i.has(c)||(c&&de(c.install)?(i.add(c),c.install(u,...d)):de(c)&&(i.add(c),c(u,...d))),u},mixin(c){return a.mixins.includes(c)||a.mixins.push(c),u},component(c,d){return d?(a.components[c]=d,u):a.components[c]},directive(c,d){return d?(a.directives[c]=d,u):a.directives[c]},mount(c,d,f){if(!l){const h=u._ceVNode||qe(n,s);return h.appContext=a,f===!0?f="svg":f===!1&&(f=void 0),r(h,c,f),l=!0,u._container=c,c.__vue_app__=u,bo(h.component)}},onUnmount(c){o.push(c)},unmount(){l&&(Er(o,u._instance,16),r(null,u._container),delete u._container.__vue_app__)},provide(c,d){return a.provides[c]=d,u},runWithContext(c){const d=ss;ss=u;try{return c()}finally{ss=d}}};return u}}let ss=null;function ub(r,e){if(pt){let t=pt.provides;const n=pt.parent&&pt.parent.provides;n===t&&(t=pt.provides=Object.create(n)),t[r]=e}}function bi(r,e,t=!1){const n=pt||Bt;if(n||ss){const s=ss?ss._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&r in s)return s[r];if(arguments.length>1)return t&&de(e)?e.call(n&&n.proxy):e}}const gm={},_m=()=>Object.create(gm),ym=r=>Object.getPrototypeOf(r)===gm;function cb(r,e,t,n=!1){const s={},a=_m();r.propsDefaults=Object.create(null),bm(r,e,s,a);for(const i in r.propsOptions[0])i in s||(s[i]=void 0);t?r.props=n?s:Iy(s):r.type.props?r.props=s:r.props=a,r.attrs=a}function db(r,e,t,n){const{props:s,attrs:a,vnode:{patchFlag:i}}=r,o=Oe(s),[l]=r.propsOptions;let u=!1;if((n||i>0)&&!(i&16)){if(i&8){const c=r.vnode.dynamicProps;for(let d=0;d<c.length;d++){let f=c[d];if(_o(r.emitsOptions,f))continue;const h=e[f];if(l)if(Ae(a,f))h!==a[f]&&(a[f]=h,u=!0);else{const p=sn(f);s[p]=ju(l,o,p,h,r,!1)}else h!==a[f]&&(a[f]=h,u=!0)}}}else{bm(r,e,s,a)&&(u=!0);let c;for(const d in o)(!e||!Ae(e,d)&&((c=Ln(d))===d||!Ae(e,c)))&&(l?t&&(t[d]!==void 0||t[c]!==void 0)&&(s[d]=ju(l,o,d,void 0,r,!0)):delete s[d]);if(a!==o)for(const d in a)(!e||!Ae(e,d))&&(delete a[d],u=!0)}u&&Nr(r.attrs,"set","")}function bm(r,e,t,n){const[s,a]=r.propsOptions;let i=!1,o;if(e)for(let l in e){if(Gs(l))continue;const u=e[l];let c;s&&Ae(s,c=sn(l))?!a||!a.includes(c)?t[c]=u:(o||(o={}))[c]=u:_o(r.emitsOptions,l)||(!(l in n)||u!==n[l])&&(n[l]=u,i=!0)}if(a){const l=Oe(t),u=o||$e;for(let c=0;c<a.length;c++){const d=a[c];t[d]=ju(s,l,d,u[d],r,!Ae(u,d))}}return i}function ju(r,e,t,n,s,a){const i=r[t];if(i!=null){const o=Ae(i,"default");if(o&&n===void 0){const l=i.default;if(i.type!==Function&&!i.skipFactory&&de(l)){const{propsDefaults:u}=s;if(t in u)n=u[t];else{const c=ja(s);n=u[t]=l.call(null,e),c()}}else n=l;s.ce&&s.ce._setProp(t,n)}i[0]&&(a&&!o?n=!1:i[1]&&(n===""||n===Ln(t))&&(n=!0))}return n}const fb=new WeakMap;function wm(r,e,t=!1){const n=t?fb:e.propsCache,s=n.get(r);if(s)return s;const a=r.props,i={},o=[];let l=!1;if(!de(r)){const c=d=>{l=!0;const[f,h]=wm(d,e,!0);mt(i,f),h&&o.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(c),r.extends&&c(r.extends),r.mixins&&r.mixins.forEach(c)}if(!a&&!l)return Me(r)&&n.set(r,es),es;if(ae(a))for(let c=0;c<a.length;c++){const d=sn(a[c]);Ud(d)&&(i[d]=$e)}else if(a)for(const c in a){const d=sn(c);if(Ud(d)){const f=a[c],h=i[d]=ae(f)||de(f)?{type:f}:mt({},f),p=h.type;let m=!1,g=!0;if(ae(p))for(let _=0;_<p.length;++_){const b=p[_],y=de(b)&&b.name;if(y==="Boolean"){m=!0;break}else y==="String"&&(g=!1)}else m=de(p)&&p.name==="Boolean";h[0]=m,h[1]=g,(m||Ae(h,"default"))&&o.push(d)}}const u=[i,o];return Me(r)&&n.set(r,u),u}function Ud(r){return r[0]!=="$"&&!Gs(r)}const vm=r=>r[0]==="_"||r==="$stable",Rc=r=>ae(r)?r.map(_r):[_r(r)],hb=(r,e,t)=>{if(e._n)return e;const n=By((...s)=>Rc(e(...s)),t);return n._c=!1,n},xm=(r,e,t)=>{const n=r._ctx;for(const s in r){if(vm(s))continue;const a=r[s];if(de(a))e[s]=hb(s,a,n);else if(a!=null){const i=Rc(a);e[s]=()=>i}}},Em=(r,e)=>{const t=Rc(e);r.slots.default=()=>t},Sm=(r,e,t)=>{for(const n in e)(t||n!=="_")&&(r[n]=e[n])},pb=(r,e,t)=>{const n=r.slots=_m();if(r.vnode.shapeFlag&32){const s=e._;s?(Sm(n,e,t),t&&Lp(n,"_",s,!0)):xm(e,n)}else e&&Em(r,e)},mb=(r,e,t)=>{const{vnode:n,slots:s}=r;let a=!0,i=$e;if(n.shapeFlag&32){const o=e._;o?t&&o===1?a=!1:Sm(s,e,t):(a=!e.$stable,xm(e,s)),i=e}else e&&(Em(r,e),i={default:1});if(a)for(const o in s)!vm(o)&&i[o]==null&&delete s[o]},Rt=Ib;function gb(r){return _b(r)}function _b(r,e){const t=co();t.__VUE__=!0;const{insert:n,remove:s,patchProp:a,createElement:i,createText:o,createComment:l,setText:u,setElementText:c,parentNode:d,nextSibling:f,setScopeId:h=wr,insertStaticContent:p}=r,m=(w,x,P,N=null,I=null,$=null,q=void 0,U=null,D=!!x.dynamicChildren)=>{if(w===x)return;w&&!Cs(w,x)&&(N=Zt(w),Q(w,I,$,!0),w=null),x.patchFlag===-2&&(D=!1,x.dynamicChildren=null);const{type:j,ref:ne,shapeFlag:z}=x;switch(j){case yo:g(w,x,P,N);break;case kn:_(w,x,P,N);break;case wi:w==null&&b(x,P,N,q);break;case Et:re(w,x,P,N,I,$,q,U,D);break;default:z&1?E(w,x,P,N,I,$,q,U,D):z&6?ye(w,x,P,N,I,$,q,U,D):(z&64||z&128)&&j.process(w,x,P,N,I,$,q,U,D,Ar)}ne!=null&&I&&Li(ne,w&&w.ref,$,x||w,!x)},g=(w,x,P,N)=>{if(w==null)n(x.el=o(x.children),P,N);else{const I=x.el=w.el;x.children!==w.children&&u(I,x.children)}},_=(w,x,P,N)=>{w==null?n(x.el=l(x.children||""),P,N):x.el=w.el},b=(w,x,P,N)=>{[w.el,w.anchor]=p(w.children,x,P,N,w.el,w.anchor)},y=({el:w,anchor:x},P,N)=>{let I;for(;w&&w!==x;)I=f(w),n(w,P,N),w=I;n(x,P,N)},v=({el:w,anchor:x})=>{let P;for(;w&&w!==x;)P=f(w),s(w),w=P;s(x)},E=(w,x,P,N,I,$,q,U,D)=>{x.type==="svg"?q="svg":x.type==="math"&&(q="mathml"),w==null?A(x,P,N,I,$,q,U,D):k(w,x,I,$,q,U,D)},A=(w,x,P,N,I,$,q,U)=>{let D,j;const{props:ne,shapeFlag:z,transition:ee,dirs:oe}=w;if(D=w.el=i(w.type,$,ne&&ne.is,ne),z&8?c(D,w.children):z&16&&O(w.children,D,null,N,I,Xo(w,$),q,U),oe&&gn(w,null,N,"created"),S(D,w,w.scopeId,q,N),ne){for(const Ne in ne)Ne!=="value"&&!Gs(Ne)&&a(D,Ne,null,ne[Ne],$,N);"value"in ne&&a(D,"value",null,ne.value,$),(j=ne.onVnodeBeforeMount)&&fr(j,N,w)}oe&&gn(w,null,N,"beforeMount");const be=yb(I,ee);be&&ee.beforeEnter(D),n(D,x,P),((j=ne&&ne.onVnodeMounted)||be||oe)&&Rt(()=>{j&&fr(j,N,w),be&&ee.enter(D),oe&&gn(w,null,N,"mounted")},I)},S=(w,x,P,N,I)=>{if(P&&h(w,P),N)for(let $=0;$<N.length;$++)h(w,N[$]);if(I){let $=I.subTree;if(x===$||km($.type)&&($.ssContent===x||$.ssFallback===x)){const q=I.vnode;S(w,q,q.scopeId,q.slotScopeIds,I.parent)}}},O=(w,x,P,N,I,$,q,U,D=0)=>{for(let j=D;j<w.length;j++){const ne=w[j]=U?Kr(w[j]):_r(w[j]);m(null,ne,x,P,N,I,$,q,U)}},k=(w,x,P,N,I,$,q)=>{const U=x.el=w.el;let{patchFlag:D,dynamicChildren:j,dirs:ne}=x;D|=w.patchFlag&16;const z=w.props||$e,ee=x.props||$e;let oe;if(P&&_n(P,!1),(oe=ee.onVnodeBeforeUpdate)&&fr(oe,P,x,w),ne&&gn(x,w,P,"beforeUpdate"),P&&_n(P,!0),(z.innerHTML&&ee.innerHTML==null||z.textContent&&ee.textContent==null)&&c(U,""),j?K(w.dynamicChildren,j,U,P,N,Xo(x,I),$):q||F(w,x,U,null,P,N,Xo(x,I),$,!1),D>0){if(D&16)Z(U,z,ee,P,I);else if(D&2&&z.class!==ee.class&&a(U,"class",null,ee.class,I),D&4&&a(U,"style",z.style,ee.style,I),D&8){const be=x.dynamicProps;for(let Ne=0;Ne<be.length;Ne++){const Ie=be[Ne],At=z[Ie],wt=ee[Ie];(wt!==At||Ie==="value")&&a(U,Ie,At,wt,I,P)}}D&1&&w.children!==x.children&&c(U,x.children)}else!q&&j==null&&Z(U,z,ee,P,I);((oe=ee.onVnodeUpdated)||ne)&&Rt(()=>{oe&&fr(oe,P,x,w),ne&&gn(x,w,P,"updated")},N)},K=(w,x,P,N,I,$,q)=>{for(let U=0;U<x.length;U++){const D=w[U],j=x[U],ne=D.el&&(D.type===Et||!Cs(D,j)||D.shapeFlag&70)?d(D.el):P;m(D,j,ne,null,N,I,$,q,!0)}},Z=(w,x,P,N,I)=>{if(x!==P){if(x!==$e)for(const $ in x)!Gs($)&&!($ in P)&&a(w,$,x[$],null,I,N);for(const $ in P){if(Gs($))continue;const q=P[$],U=x[$];q!==U&&$!=="value"&&a(w,$,U,q,I,N)}"value"in P&&a(w,"value",x.value,P.value,I)}},re=(w,x,P,N,I,$,q,U,D)=>{const j=x.el=w?w.el:o(""),ne=x.anchor=w?w.anchor:o("");let{patchFlag:z,dynamicChildren:ee,slotScopeIds:oe}=x;oe&&(U=U?U.concat(oe):oe),w==null?(n(j,P,N),n(ne,P,N),O(x.children||[],P,ne,I,$,q,U,D)):z>0&&z&64&&ee&&w.dynamicChildren?(K(w.dynamicChildren,ee,P,I,$,q,U),(x.key!=null||I&&x===I.subTree)&&Om(w,x,!0)):F(w,x,P,ne,I,$,q,U,D)},ye=(w,x,P,N,I,$,q,U,D)=>{x.slotScopeIds=U,w==null?x.shapeFlag&512?I.ctx.activate(x,P,N,q,D):L(x,P,N,I,$,q,D):C(w,x,D)},L=(w,x,P,N,I,$,q)=>{const U=w.component=Mb(w,N,I);if(lm(w)&&(U.ctx.renderer=Ar),Db(U,!1,q),U.asyncDep){if(I&&I.registerDep(U,H,q),!w.el){const D=U.subTree=qe(kn);_(null,D,x,P)}}else H(U,w,x,P,I,$,q)},C=(w,x,P)=>{const N=x.component=w.component;if(Tb(w,x,P))if(N.asyncDep&&!N.asyncResolved){M(N,x,P);return}else N.next=x,N.update();else x.el=w.el,N.vnode=x},H=(w,x,P,N,I,$,q)=>{const U=()=>{if(w.isMounted){let{next:z,bu:ee,u:oe,parent:be,vnode:Ne}=w;{const cr=Am(w);if(cr){z&&(z.el=Ne.el,M(w,z,q)),cr.asyncDep.then(()=>{w.isUnmounted||U()});return}}let Ie=z,At;_n(w,!1),z?(z.el=Ne.el,M(w,z,q)):z=Ne,ee&&yi(ee),(At=z.props&&z.props.onVnodeBeforeUpdate)&&fr(At,be,z,Ne),_n(w,!0);const wt=Hd(w),ur=w.subTree;w.subTree=wt,m(ur,wt,d(ur.el),Zt(ur),w,I,$),z.el=wt.el,Ie===null&&Pb(w,wt.el),oe&&Rt(oe,I),(At=z.props&&z.props.onVnodeUpdated)&&Rt(()=>fr(At,be,z,Ne),I)}else{let z;const{el:ee,props:oe}=x,{bm:be,m:Ne,parent:Ie,root:At,type:wt}=w,ur=Ks(x);_n(w,!1),be&&yi(be),!ur&&(z=oe&&oe.onVnodeBeforeMount)&&fr(z,Ie,x),_n(w,!0);{At.ce&&At.ce._injectChildStyle(wt);const cr=w.subTree=Hd(w);m(null,cr,P,N,w,I,$),x.el=cr.el}if(Ne&&Rt(Ne,I),!ur&&(z=oe&&oe.onVnodeMounted)){const cr=x;Rt(()=>fr(z,Ie,cr),I)}(x.shapeFlag&256||Ie&&Ks(Ie.vnode)&&Ie.vnode.shapeFlag&256)&&w.a&&Rt(w.a,I),w.isMounted=!0,x=P=N=null}};w.scope.on();const D=w.effect=new Up(U);w.scope.off();const j=w.update=D.run.bind(D),ne=w.job=D.runIfDirty.bind(D);ne.i=w,ne.id=w.uid,D.scheduler=()=>Ic(ne),_n(w,!0),j()},M=(w,x,P)=>{x.component=w;const N=w.vnode.props;w.vnode=x,w.next=null,db(w,x.props,N,P),mb(w,x.children,P),hn(),jd(w),pn()},F=(w,x,P,N,I,$,q,U,D=!1)=>{const j=w&&w.children,ne=w?w.shapeFlag:0,z=x.children,{patchFlag:ee,shapeFlag:oe}=x;if(ee>0){if(ee&128){te(j,z,P,N,I,$,q,U,D);return}else if(ee&256){W(j,z,P,N,I,$,q,U,D);return}}oe&8?(ne&16&&bt(j,I,$),z!==j&&c(P,z)):ne&16?oe&16?te(j,z,P,N,I,$,q,U,D):bt(j,I,$,!0):(ne&8&&c(P,""),oe&16&&O(z,P,N,I,$,q,U,D))},W=(w,x,P,N,I,$,q,U,D)=>{w=w||es,x=x||es;const j=w.length,ne=x.length,z=Math.min(j,ne);let ee;for(ee=0;ee<z;ee++){const oe=x[ee]=D?Kr(x[ee]):_r(x[ee]);m(w[ee],oe,P,null,I,$,q,U,D)}j>ne?bt(w,I,$,!0,!1,z):O(x,P,N,I,$,q,U,D,z)},te=(w,x,P,N,I,$,q,U,D)=>{let j=0;const ne=x.length;let z=w.length-1,ee=ne-1;for(;j<=z&&j<=ee;){const oe=w[j],be=x[j]=D?Kr(x[j]):_r(x[j]);if(Cs(oe,be))m(oe,be,P,null,I,$,q,U,D);else break;j++}for(;j<=z&&j<=ee;){const oe=w[z],be=x[ee]=D?Kr(x[ee]):_r(x[ee]);if(Cs(oe,be))m(oe,be,P,null,I,$,q,U,D);else break;z--,ee--}if(j>z){if(j<=ee){const oe=ee+1,be=oe<ne?x[oe].el:N;for(;j<=ee;)m(null,x[j]=D?Kr(x[j]):_r(x[j]),P,be,I,$,q,U,D),j++}}else if(j>ee)for(;j<=z;)Q(w[j],I,$,!0),j++;else{const oe=j,be=j,Ne=new Map;for(j=be;j<=ee;j++){const Tt=x[j]=D?Kr(x[j]):_r(x[j]);Tt.key!=null&&Ne.set(Tt.key,j)}let Ie,At=0;const wt=ee-be+1;let ur=!1,cr=0;const ks=new Array(wt);for(j=0;j<wt;j++)ks[j]=0;for(j=oe;j<=z;j++){const Tt=w[j];if(At>=wt){Q(Tt,I,$,!0);continue}let dr;if(Tt.key!=null)dr=Ne.get(Tt.key);else for(Ie=be;Ie<=ee;Ie++)if(ks[Ie-be]===0&&Cs(Tt,x[Ie])){dr=Ie;break}dr===void 0?Q(Tt,I,$,!0):(ks[dr-be]=j+1,dr>=cr?cr=dr:ur=!0,m(Tt,x[dr],P,null,I,$,q,U,D),At++)}const Id=ur?bb(ks):es;for(Ie=Id.length-1,j=wt-1;j>=0;j--){const Tt=be+j,dr=x[Tt],kd=Tt+1<ne?x[Tt+1].el:N;ks[j]===0?m(null,dr,P,kd,I,$,q,U,D):ur&&(Ie<0||j!==Id[Ie]?ue(dr,P,kd,2):Ie--)}}},ue=(w,x,P,N,I=null)=>{const{el:$,type:q,transition:U,children:D,shapeFlag:j}=w;if(j&6){ue(w.component.subTree,x,P,N);return}if(j&128){w.suspense.move(x,P,N);return}if(j&64){q.move(w,x,P,Ar);return}if(q===Et){n($,x,P);for(let z=0;z<D.length;z++)ue(D[z],x,P,N);n(w.anchor,x,P);return}if(q===wi){y(w,x,P);return}if(N!==2&&j&1&&U)if(N===0)U.beforeEnter($),n($,x,P),Rt(()=>U.enter($),I);else{const{leave:z,delayLeave:ee,afterLeave:oe}=U,be=()=>n($,x,P),Ne=()=>{z($,()=>{be(),oe&&oe()})};ee?ee($,be,Ne):Ne()}else n($,x,P)},Q=(w,x,P,N=!1,I=!1)=>{const{type:$,props:q,ref:U,children:D,dynamicChildren:j,shapeFlag:ne,patchFlag:z,dirs:ee,cacheIndex:oe}=w;if(z===-2&&(I=!1),U!=null&&Li(U,null,P,w,!0),oe!=null&&(x.renderCache[oe]=void 0),ne&256){x.ctx.deactivate(w);return}const be=ne&1&&ee,Ne=!Ks(w);let Ie;if(Ne&&(Ie=q&&q.onVnodeBeforeUnmount)&&fr(Ie,x,w),ne&6)Le(w.component,P,N);else{if(ne&128){w.suspense.unmount(P,N);return}be&&gn(w,null,x,"beforeUnmount"),ne&64?w.type.remove(w,x,P,Ar,N):j&&!j.hasOnce&&($!==Et||z>0&&z&64)?bt(j,x,P,!1,!0):($===Et&&z&384||!I&&ne&16)&&bt(D,x,P),N&&Ee(w)}(Ne&&(Ie=q&&q.onVnodeUnmounted)||be)&&Rt(()=>{Ie&&fr(Ie,x,w),be&&gn(w,null,x,"unmounted")},P)},Ee=w=>{const{type:x,el:P,anchor:N,transition:I}=w;if(x===Et){Be(P,N);return}if(x===wi){v(w);return}const $=()=>{s(P),I&&!I.persisted&&I.afterLeave&&I.afterLeave()};if(w.shapeFlag&1&&I&&!I.persisted){const{leave:q,delayLeave:U}=I,D=()=>q(P,$);U?U(w.el,$,D):D()}else $()},Be=(w,x)=>{let P;for(;w!==x;)P=f(w),s(w),w=P;s(x)},Le=(w,x,P)=>{const{bum:N,scope:I,job:$,subTree:q,um:U,m:D,a:j}=w;Bd(D),Bd(j),N&&yi(N),I.stop(),$&&($.flags|=8,Q(q,w,x,P)),U&&Rt(U,x),Rt(()=>{w.isUnmounted=!0},x),x&&x.pendingBranch&&!x.isUnmounted&&w.asyncDep&&!w.asyncResolved&&w.suspenseId===x.pendingId&&(x.deps--,x.deps===0&&x.resolve())},bt=(w,x,P,N=!1,I=!1,$=0)=>{for(let q=$;q<w.length;q++)Q(w[q],x,P,N,I)},Zt=w=>{if(w.shapeFlag&6)return Zt(w.component.subTree);if(w.shapeFlag&128)return w.suspense.next();const x=f(w.anchor||w.el),P=x&&x[Hy];return P?f(P):x};let Mn=!1;const Dn=(w,x,P)=>{w==null?x._vnode&&Q(x._vnode,null,null,!0):m(x._vnode||null,w,x,null,null,null,P),x._vnode=w,Mn||(Mn=!0,jd(),sm(),Mn=!1)},Ar={p:m,um:Q,m:ue,r:Ee,mt:L,mc:O,pc:F,pbc:K,n:Zt,o:r};return{render:Dn,hydrate:void 0,createApp:lb(Dn)}}function Xo({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function _n({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function yb(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function Om(r,e,t=!1){const n=r.children,s=e.children;if(ae(n)&&ae(s))for(let a=0;a<n.length;a++){const i=n[a];let o=s[a];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[a]=Kr(s[a]),o.el=i.el),!t&&o.patchFlag!==-2&&Om(i,o)),o.type===yo&&(o.el=i.el)}}function bb(r){const e=r.slice(),t=[0];let n,s,a,i,o;const l=r.length;for(n=0;n<l;n++){const u=r[n];if(u!==0){if(s=t[t.length-1],r[s]<u){e[n]=s,t.push(n);continue}for(a=0,i=t.length-1;a<i;)o=a+i>>1,r[t[o]]<u?a=o+1:i=o;u<r[t[a]]&&(a>0&&(e[n]=t[a-1]),t[a]=n)}}for(a=t.length,i=t[a-1];a-- >0;)t[a]=i,i=e[i];return t}function Am(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Am(e)}function Bd(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const wb=Symbol.for("v-scx"),vb=()=>bi(wb);function Ue(r,e,t){return Tm(r,e,t)}function Tm(r,e,t=$e){const{immediate:n,deep:s,flush:a,once:i}=t,o=mt({},t),l=e&&n||!e&&a!=="post";let u;if(ca){if(a==="sync"){const h=vb();u=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=wr,h.resume=wr,h.pause=wr,h}}const c=pt;o.call=(h,p,m)=>Er(h,c,p,m);let d=!1;a==="post"?o.scheduler=h=>{Rt(h,c&&c.suspense)}:a!=="sync"&&(d=!0,o.scheduler=(h,p)=>{p?h():Ic(h)}),o.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,c&&(h.id=c.uid,h.i=c))};const f=My(r,e,o);return ca&&(u?u.push(f):l&&f()),f}function xb(r,e,t){const n=this.proxy,s=Ze(r)?r.includes(".")?Pm(n,r):()=>n[r]:r.bind(n,n);let a;de(e)?a=e:(a=e.handler,t=e);const i=ja(this),o=Tm(s,a.bind(n),t);return i(),o}function Pm(r,e){const t=e.split(".");return()=>{let n=r;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const Eb=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${sn(e)}Modifiers`]||r[`${Ln(e)}Modifiers`];function Sb(r,e,...t){if(r.isUnmounted)return;const n=r.vnode.props||$e;let s=t;const a=e.startsWith("update:"),i=a&&Eb(n,e.slice(7));i&&(i.trim&&(s=t.map(c=>Ze(c)?c.trim():c)),i.number&&(s=t.map(Ci)));let o,l=n[o=Vo(e)]||n[o=Vo(sn(e))];!l&&a&&(l=n[o=Vo(Ln(e))]),l&&Er(l,r,6,s);const u=n[o+"Once"];if(u){if(!r.emitted)r.emitted={};else if(r.emitted[o])return;r.emitted[o]=!0,Er(u,r,6,s)}}function Im(r,e,t=!1){const n=e.emitsCache,s=n.get(r);if(s!==void 0)return s;const a=r.emits;let i={},o=!1;if(!de(r)){const l=u=>{const c=Im(u,e,!0);c&&(o=!0,mt(i,c))};!t&&e.mixins.length&&e.mixins.forEach(l),r.extends&&l(r.extends),r.mixins&&r.mixins.forEach(l)}return!a&&!o?(Me(r)&&n.set(r,null),null):(ae(a)?a.forEach(l=>i[l]=null):mt(i,a),Me(r)&&n.set(r,i),i)}function _o(r,e){return!r||!lo(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ae(r,e[0].toLowerCase()+e.slice(1))||Ae(r,Ln(e))||Ae(r,e))}function Hd(r){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[a],slots:i,attrs:o,emit:l,render:u,renderCache:c,props:d,data:f,setupState:h,ctx:p,inheritAttrs:m}=r,g=ji(r);let _,b;try{if(t.shapeFlag&4){const v=s||n,E=v;_=_r(u.call(E,v,c,d,h,f,p)),b=o}else{const v=e;_=_r(v.length>1?v(d,{attrs:o,slots:i,emit:l}):v(d,null)),b=e.props?o:Ob(o)}}catch(v){Ys.length=0,ho(v,r,1),_=qe(kn)}let y=_;if(b&&m!==!1){const v=Object.keys(b),{shapeFlag:E}=y;v.length&&E&7&&(a&&v.some(gc)&&(b=Ab(b,a)),y=cs(y,b,!1,!0))}return t.dirs&&(y=cs(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(t.dirs):t.dirs),t.transition&&kc(y,t.transition),_=y,ji(g),_}const Ob=r=>{let e;for(const t in r)(t==="class"||t==="style"||lo(t))&&((e||(e={}))[t]=r[t]);return e},Ab=(r,e)=>{const t={};for(const n in r)(!gc(n)||!(n.slice(9)in e))&&(t[n]=r[n]);return t};function Tb(r,e,t){const{props:n,children:s,component:a}=r,{props:i,children:o,patchFlag:l}=e,u=a.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?qd(n,i,u):!!i;if(l&8){const c=e.dynamicProps;for(let d=0;d<c.length;d++){const f=c[d];if(i[f]!==n[f]&&!_o(u,f))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:n===i?!1:n?i?qd(n,i,u):!0:!!i;return!1}function qd(r,e,t){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let s=0;s<n.length;s++){const a=n[s];if(e[a]!==r[a]&&!_o(t,a))return!0}return!1}function Pb({vnode:r,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=t,e=e.parent;else break}}const km=r=>r.__isSuspense;function Ib(r,e){e&&e.pendingBranch?ae(r)?e.effects.push(...r):e.effects.push(r):Uy(r)}const Et=Symbol.for("v-fgt"),yo=Symbol.for("v-txt"),kn=Symbol.for("v-cmt"),wi=Symbol.for("v-stc"),Ys=[];let jt=null;function ge(r=!1){Ys.push(jt=r?null:[])}function kb(){Ys.pop(),jt=Ys[Ys.length-1]||null}let ua=1;function Zd(r,e=!1){ua+=r,r<0&&jt&&e&&(jt.hasOnce=!0)}function Rm(r){return r.dynamicChildren=ua>0?jt||es:null,kb(),ua>0&&jt&&jt.push(r),r}function ve(r,e,t,n,s,a){return Rm(V(r,e,t,n,s,a,!0))}function vi(r,e,t,n,s){return Rm(qe(r,e,t,n,s,!0))}function Cm(r){return r?r.__v_isVNode===!0:!1}function Cs(r,e){return r.type===e.type&&r.key===e.key}const $m=({key:r})=>r??null,xi=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?Ze(r)||it(r)||de(r)?{i:Bt,r,k:e,f:!!t}:r:null);function V(r,e=null,t=null,n=0,s=null,a=r===Et?0:1,i=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&$m(e),ref:e&&xi(e),scopeId:im,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bt};return o?(Cc(l,t),a&128&&r.normalize(l)):t&&(l.shapeFlag|=Ze(t)?8:16),ua>0&&!i&&jt&&(l.patchFlag>0||a&6)&&l.patchFlag!==32&&jt.push(l),l}const qe=Rb;function Rb(r,e=null,t=null,n=0,s=null,a=!1){if((!r||r===eb)&&(r=kn),Cm(r)){const o=cs(r,e,!0);return t&&Cc(o,t),ua>0&&!a&&jt&&(o.shapeFlag&6?jt[jt.indexOf(r)]=o:jt.push(o)),o.patchFlag=-2,o}if(Hb(r)&&(r=r.__vccOpts),e){e=Cb(e);let{class:o,style:l}=e;o&&!Ze(o)&&(e.class=Mr(o)),Me(l)&&(Pc(l)&&!ae(l)&&(l=mt({},l)),e.style=bc(l))}const i=Ze(r)?1:km(r)?128:qy(r)?64:Me(r)?4:de(r)?2:0;return V(r,e,t,n,s,i,a,!0)}function Cb(r){return r?Pc(r)||ym(r)?mt({},r):r:null}function cs(r,e,t=!1,n=!1){const{props:s,ref:a,patchFlag:i,children:o,transition:l}=r,u=e?Nb(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:r.type,props:u,key:u&&$m(u),ref:e&&e.ref?t&&a?ae(a)?a.concat(xi(e)):[a,xi(e)]:xi(e):a,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:o,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==Et?i===-1?16:i|16:i,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:l,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&cs(r.ssContent),ssFallback:r.ssFallback&&cs(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return l&&n&&kc(c,l.clone(c)),c}function Ht(r=" ",e=0){return qe(yo,null,r,e)}function $b(r,e){const t=qe(wi,null,r);return t.staticCount=e,t}function Mt(r="",e=!1){return e?(ge(),vi(kn,null,r)):qe(kn,null,r)}function _r(r){return r==null||typeof r=="boolean"?qe(kn):ae(r)?qe(Et,null,r.slice()):Cm(r)?Kr(r):qe(yo,null,String(r))}function Kr(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:cs(r)}function Cc(r,e){let t=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(ae(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),Cc(r,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!ym(e)?e._ctx=Bt:s===3&&Bt&&(Bt.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else de(e)?(e={default:e,_ctx:Bt},t=32):(e=String(e),n&64?(t=16,e=[Ht(e)]):t=8);r.children=e,r.shapeFlag|=t}function Nb(...r){const e={};for(let t=0;t<r.length;t++){const n=r[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=Mr([e.class,n.class]));else if(s==="style")e.style=bc([e.style,n.style]);else if(lo(s)){const a=e[s],i=n[s];i&&a!==i&&!(ae(a)&&a.includes(i))&&(e[s]=a?[].concat(a,i):i)}else s!==""&&(e[s]=n[s])}return e}function fr(r,e,t,n=null){Er(r,e,7,[t,n])}const jb=mm();let Lb=0;function Mb(r,e,t){const n=r.type,s=(e?e.appContext:r.appContext)||jb,a={uid:Lb++,vnode:r,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new uy(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:wm(n,s),emitsOptions:Im(n,s),emit:null,emitted:null,propsDefaults:$e,inheritAttrs:n.inheritAttrs,ctx:$e,data:$e,props:$e,attrs:$e,slots:$e,refs:$e,setupState:$e,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=Sb.bind(null,a),r.ce&&r.ce(a),a}let pt=null,Di,Lu;{const r=co(),e=(t,n)=>{let s;return(s=r[t])||(s=r[t]=[]),s.push(n),a=>{s.length>1?s.forEach(i=>i(a)):s[0](a)}};Di=e("__VUE_INSTANCE_SETTERS__",t=>pt=t),Lu=e("__VUE_SSR_SETTERS__",t=>ca=t)}const ja=r=>{const e=pt;return Di(r),r.scope.on(),()=>{r.scope.off(),Di(e)}},Vd=()=>{pt&&pt.scope.off(),Di(null)};function Nm(r){return r.vnode.shapeFlag&4}let ca=!1;function Db(r,e=!1,t=!1){e&&Lu(e);const{props:n,children:s}=r.vnode,a=Nm(r);cb(r,n,a,e),pb(r,s,t);const i=a?Fb(r,e):void 0;return e&&Lu(!1),i}function Fb(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,tb);const{setup:n}=t;if(n){hn();const s=r.setupContext=n.length>1?Bb(r):null,a=ja(r),i=Na(n,r,0,[r.props,s]),o=Cp(i);if(pn(),a(),(o||r.sp)&&!Ks(r)&&om(r),o){if(i.then(Vd,Vd),e)return i.then(l=>{zd(r,l)}).catch(l=>{ho(l,r,0)});r.asyncDep=i}else zd(r,i)}else jm(r)}function zd(r,e,t){de(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Me(e)&&(r.setupState=tm(e)),jm(r)}function jm(r,e,t){const n=r.type;r.render||(r.render=n.render||wr);{const s=ja(r);hn();try{rb(r)}finally{pn(),s()}}}const Ub={get(r,e){return nt(r,"get",""),r[e]}};function Bb(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,Ub),slots:r.slots,emit:r.emit,expose:e}}function bo(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(tm(ky(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in Xs)return Xs[t](r)},has(e,t){return t in e||t in Xs}})):r.proxy}function Hb(r){return de(r)&&"__vccOpts"in r}const $c=(r,e)=>jy(r,e,ca),qb="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Mu;const Gd=typeof window<"u"&&window.trustedTypes;if(Gd)try{Mu=Gd.createPolicy("vue",{createHTML:r=>r})}catch{}const Lm=Mu?r=>Mu.createHTML(r):r=>r,Zb="http://www.w3.org/2000/svg",Vb="http://www.w3.org/1998/Math/MathML",Cr=typeof document<"u"?document:null,Wd=Cr&&Cr.createElement("template"),zb={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,n)=>{const s=e==="svg"?Cr.createElementNS(Zb,r):e==="mathml"?Cr.createElementNS(Vb,r):t?Cr.createElement(r,{is:t}):Cr.createElement(r);return r==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:r=>Cr.createTextNode(r),createComment:r=>Cr.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>Cr.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,n,s,a){const i=t?t.previousSibling:e.lastChild;if(s&&(s===a||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===a||!(s=s.nextSibling)););else{Wd.innerHTML=Lm(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const o=Wd.content;if(n==="svg"||n==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}e.insertBefore(o,t)}return[i?i.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Gb=Symbol("_vtc");function Wb(r,e,t){const n=r[Gb];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const Jd=Symbol("_vod"),Jb=Symbol("_vsh"),Kb=Symbol(""),Xb=/(^|;)\s*display\s*:/;function Yb(r,e,t){const n=r.style,s=Ze(t);let a=!1;if(t&&!s){if(e)if(Ze(e))for(const i of e.split(";")){const o=i.slice(0,i.indexOf(":")).trim();t[o]==null&&Ei(n,o,"")}else for(const i in e)t[i]==null&&Ei(n,i,"");for(const i in t)i==="display"&&(a=!0),Ei(n,i,t[i])}else if(s){if(e!==t){const i=n[Kb];i&&(t+=";"+i),n.cssText=t,a=Xb.test(t)}}else e&&r.removeAttribute("style");Jd in r&&(r[Jd]=a?n.display:"",r[Jb]&&(n.display="none"))}const Kd=/\s*!important$/;function Ei(r,e,t){if(ae(t))t.forEach(n=>Ei(r,e,n));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const n=Qb(r,e);Kd.test(t)?r.setProperty(Ln(n),t.replace(Kd,""),"important"):r[n]=t}}const Xd=["Webkit","Moz","ms"],Yo={};function Qb(r,e){const t=Yo[e];if(t)return t;let n=sn(e);if(n!=="filter"&&n in r)return Yo[e]=n;n=jp(n);for(let s=0;s<Xd.length;s++){const a=Xd[s]+n;if(a in r)return Yo[e]=a}return e}const Yd="http://www.w3.org/1999/xlink";function Qd(r,e,t,n,s,a=oy(e)){n&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(Yd,e.slice(6,e.length)):r.setAttributeNS(Yd,e,t):t==null||a&&!Mp(t)?r.removeAttribute(e):r.setAttribute(e,a?"":xr(t)?String(t):t)}function ef(r,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?Lm(t):t);return}const a=r.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){const o=a==="OPTION"?r.getAttribute("value")||"":r.value,l=t==null?r.type==="checkbox"?"on":"":String(t);(o!==l||!("_value"in r))&&(r.value=l),t==null&&r.removeAttribute(e),r._value=t;return}let i=!1;if(t===""||t==null){const o=typeof r[e];o==="boolean"?t=Mp(t):t==null&&o==="string"?(t="",i=!0):o==="number"&&(t=0,i=!0)}try{r[e]=t}catch{}i&&r.removeAttribute(s||e)}function Qr(r,e,t,n){r.addEventListener(e,t,n)}function ew(r,e,t,n){r.removeEventListener(e,t,n)}const tf=Symbol("_vei");function tw(r,e,t,n,s=null){const a=r[tf]||(r[tf]={}),i=a[e];if(n&&i)i.value=n;else{const[o,l]=rw(e);if(n){const u=a[e]=aw(n,s);Qr(r,o,u,l)}else i&&(ew(r,o,i,l),a[e]=void 0)}}const rf=/(?:Once|Passive|Capture)$/;function rw(r){let e;if(rf.test(r)){e={};let n;for(;n=r.match(rf);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Ln(r.slice(2)),e]}let Qo=0;const nw=Promise.resolve(),sw=()=>Qo||(nw.then(()=>Qo=0),Qo=Date.now());function aw(r,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;Er(iw(n,t.value),e,5,[n])};return t.value=r,t.attached=sw(),t}function iw(r,e){if(ae(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const nf=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,ow=(r,e,t,n,s,a)=>{const i=s==="svg";e==="class"?Wb(r,n,i):e==="style"?Yb(r,t,n):lo(e)?gc(e)||tw(r,e,t,n,a):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):lw(r,e,n,i))?(ef(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Qd(r,e,n,i,a,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!Ze(n))?ef(r,sn(e),n,a,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),Qd(r,e,n,i))};function lw(r,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&nf(e)&&de(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=r.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return nf(e)&&Ze(t)?!1:e in r}const ds=r=>{const e=r.props["onUpdate:modelValue"]||!1;return ae(e)?t=>yi(e,t):e};function uw(r){r.target.composing=!0}function sf(r){const e=r.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Dr=Symbol("_assign"),Nc={created(r,{modifiers:{lazy:e,trim:t,number:n}},s){r[Dr]=ds(s);const a=n||s.props&&s.props.type==="number";Qr(r,e?"change":"input",i=>{if(i.target.composing)return;let o=r.value;t&&(o=o.trim()),a&&(o=Ci(o)),r[Dr](o)}),t&&Qr(r,"change",()=>{r.value=r.value.trim()}),e||(Qr(r,"compositionstart",uw),Qr(r,"compositionend",sf),Qr(r,"change",sf))},mounted(r,{value:e}){r.value=e??""},beforeUpdate(r,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:a}},i){if(r[Dr]=ds(i),r.composing)return;const o=(a||r.type==="number")&&!/^0\d/.test(r.value)?Ci(r.value):r.value,l=e??"";o!==l&&(document.activeElement===r&&r.type!=="range"&&(n&&e===t||s&&r.value.trim()===l)||(r.value=l))}},Fi={deep:!0,created(r,e,t){r[Dr]=ds(t),Qr(r,"change",()=>{const n=r._modelValue,s=da(r),a=r.checked,i=r[Dr];if(ae(n)){const o=wc(n,s),l=o!==-1;if(a&&!l)i(n.concat(s));else if(!a&&l){const u=[...n];u.splice(o,1),i(u)}}else if(ys(n)){const o=new Set(n);a?o.add(s):o.delete(s),i(o)}else i(Mm(r,a))})},mounted:af,beforeUpdate(r,e,t){r[Dr]=ds(t),af(r,e,t)}};function af(r,{value:e,oldValue:t},n){r._modelValue=e;let s;if(ae(e))s=wc(e,n.props.value)>-1;else if(ys(e))s=e.has(n.props.value);else{if(e===t)return;s=$a(e,Mm(r,!0))}r.checked!==s&&(r.checked=s)}const cw={deep:!0,created(r,{value:e,modifiers:{number:t}},n){const s=ys(e);Qr(r,"change",()=>{const a=Array.prototype.filter.call(r.options,i=>i.selected).map(i=>t?Ci(da(i)):da(i));r[Dr](r.multiple?s?new Set(a):a:a[0]),r._assigning=!0,po(()=>{r._assigning=!1})}),r[Dr]=ds(n)},mounted(r,{value:e}){of(r,e)},beforeUpdate(r,e,t){r[Dr]=ds(t)},updated(r,{value:e}){r._assigning||of(r,e)}};function of(r,e){const t=r.multiple,n=ae(e);if(!(t&&!n&&!ys(e))){for(let s=0,a=r.options.length;s<a;s++){const i=r.options[s],o=da(i);if(t)if(n){const l=typeof o;l==="string"||l==="number"?i.selected=e.some(u=>String(u)===String(o)):i.selected=wc(e,o)>-1}else i.selected=e.has(o);else if($a(da(i),e)){r.selectedIndex!==s&&(r.selectedIndex=s);return}}!t&&r.selectedIndex!==-1&&(r.selectedIndex=-1)}}function da(r){return"_value"in r?r._value:r.value}function Mm(r,e){const t=e?"_trueValue":"_falseValue";return t in r?r[t]:e}const dw=mt({patchProp:ow},zb);let lf;function fw(){return lf||(lf=gb(dw))}const hw=(...r)=>{const e=fw().createApp(...r),{mount:t}=e;return e.mount=n=>{const s=mw(n);if(!s)return;const a=e._component;!de(a)&&!a.render&&!a.template&&(a.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=t(s,!1,pw(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},e};function pw(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function mw(r){return Ze(r)?document.querySelector(r):r}const Du="RFC3986",Fu={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},gw="RFC1738",_w=Array.isArray,hr=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),el=1024,yw=(r,e,t,n,s)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=el){const l=a.length>=el?a.slice(o,o+el):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===gw&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=hr[d];continue}if(d<2048){u[u.length]=hr[192|d>>6]+hr[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=hr[224|d>>12]+hr[128|d>>6&63]+hr[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=hr[240|d>>18]+hr[128|d>>12&63]+hr[128|d>>6&63]+hr[128|d&63]}i+=u.join("")}return i};function bw(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function uf(r,e){if(_w(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const ww=Object.prototype.hasOwnProperty,Dm={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},mr=Array.isArray,vw=Array.prototype.push,Fm=function(r,e){vw.apply(r,mr(e)?e:[e])},xw=Date.prototype.toISOString,ze={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:yw,encodeValuesOnly:!1,format:Du,formatter:Fu[Du],indices:!1,serializeDate(r){return xw.call(r)},skipNulls:!1,strictNullHandling:!1};function Ew(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const tl={};function Um(r,e,t,n,s,a,i,o,l,u,c,d,f,h,p,m,g,_){let b=r,y=_,v=0,E=!1;for(;(y=y.get(tl))!==void 0&&!E;){const K=y.get(r);if(v+=1,typeof K<"u"){if(K===v)throw new RangeError("Cyclic object value");E=!0}typeof y.get(tl)>"u"&&(v=0)}if(typeof u=="function"?b=u(e,b):b instanceof Date?b=f==null?void 0:f(b):t==="comma"&&mr(b)&&(b=uf(b,function(K){return K instanceof Date?f==null?void 0:f(K):K})),b===null){if(a)return l&&!m?l(e,ze.encoder,g,"key",h):e;b=""}if(Ew(b)||bw(b)){if(l){const K=m?e:l(e,ze.encoder,g,"key",h);return[(p==null?void 0:p(K))+"="+(p==null?void 0:p(l(b,ze.encoder,g,"value",h)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(b)))]}const A=[];if(typeof b>"u")return A;let S;if(t==="comma"&&mr(b))m&&l&&(b=uf(b,l)),S=[{value:b.length>0?b.join(",")||null:void 0}];else if(mr(u))S=u;else{const K=Object.keys(b);S=c?K.sort(c):K}const O=o?String(e).replace(/\./g,"%2E"):String(e),k=n&&mr(b)&&b.length===1?O+"[]":O;if(s&&mr(b)&&b.length===0)return k+"[]";for(let K=0;K<S.length;++K){const Z=S[K],re=typeof Z=="object"&&typeof Z.value<"u"?Z.value:b[Z];if(i&&re===null)continue;const ye=d&&o?Z.replace(/\./g,"%2E"):Z,L=mr(b)?typeof t=="function"?t(k,ye):k:k+(d?"."+ye:"["+ye+"]");_.set(r,v);const C=new WeakMap;C.set(tl,_),Fm(A,Um(re,L,t,n,s,a,i,o,t==="comma"&&m&&mr(b)?null:l,u,c,d,f,h,p,m,g,C))}return A}function Sw(r=ze){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||ze.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Du;if(typeof r.format<"u"){if(!ww.call(Fu,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=Fu[t];let s=ze.filter;(typeof r.filter=="function"||mr(r.filter))&&(s=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in Dm?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=ze.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:ze.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:ze.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:ze.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:ze.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?ze.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:ze.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:ze.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:ze.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:ze.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:ze.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:ze.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:ze.strictNullHandling}}function Ow(r,e={}){let t=r;const n=Sw(e);let s,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):mr(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Dm[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];n.skipNulls&&t[h]===null||Fm(i,Um(t[h],h,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}const c=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const zn="4.90.0";let cf=!1,Qs,Bm,Hm,Uu,qm,Zm,Vm,zm,Gm;function Aw(r,e={auto:!1}){if(cf)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Qs)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Qs}'\``);cf=e.auto,Qs=r.kind,Bm=r.fetch,Hm=r.FormData,Uu=r.File,qm=r.ReadableStream,Zm=r.getMultipartRequestOptions,Vm=r.getDefaultAgent,zm=r.fileFromPath,Gm=r.isFsReadStream}class Tw{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Pw({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Tw(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Wm=()=>{Qs||Aw(Pw(),{auto:!0})};Wm();class se extends Error{}class tt extends se{constructor(e,t,n,s){super(`${tt.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new wo({message:n,cause:Hu(t)});const a=t==null?void 0:t.error;return e===400?new Jm(e,a,n,s):e===401?new Km(e,a,n,s):e===403?new Xm(e,a,n,s):e===404?new Ym(e,a,n,s):e===409?new Qm(e,a,n,s):e===422?new eg(e,a,n,s):e===429?new tg(e,a,n,s):e>=500?new rg(e,a,n,s):new tt(e,a,n,s)}}class Lt extends tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class wo extends tt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class vo extends wo{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Jm extends tt{}class Km extends tt{}class Xm extends tt{}class Ym extends tt{}class Qm extends tt{}class eg extends tt{}class tg extends tt{}class rg extends tt{}class ng extends se{constructor(){super("Could not parse response content as the length limit was reached")}}class sg extends se{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var Xa=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},yn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},It;class xo{constructor(){It.set(this,void 0),this.buffer=new Uint8Array,Xa(this,It,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const s=[];let a;for(;(a=Iw(this.buffer,yn(this,It,"f")))!=null;){if(a.carriage&&yn(this,It,"f")==null){Xa(this,It,a.index,"f");continue}if(yn(this,It,"f")!=null&&(a.index!==yn(this,It,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,yn(this,It,"f")-1))),this.buffer=this.buffer.slice(yn(this,It,"f")),Xa(this,It,null,"f");continue}const i=yn(this,It,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),Xa(this,It,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new se(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new se(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new se("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}It=new WeakMap;xo.NEWLINE_CHARS=new Set([`
`,"\r"]);xo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Iw(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function kw(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function ag(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class yr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Rw(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new tt(void 0,o.error,void 0,fg(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new tt(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new yr(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new xo,o=ag(e);for await(const l of o)for(const u of i.decode(l))yield u;for(const l of i.flush())yield l}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new yr(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new yr(()=>s(e),this.controller),new yr(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new qm({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Rw(r,e){if(!r.body)throw e.abort(),new se("Attempted to iterate over a response with no body");const t=new $w,n=new xo,s=ag(r.body);for await(const a of Cw(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Cw(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=kw(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class $w{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Nw(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Nw(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}const ig=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",og=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Eo(r),Eo=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",jw=r=>og(r)||ig(r)||Gm(r);async function lg(r,e,t){var s;if(r=await r,og(r))return r;if(ig(r)){const a=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=Eo(a)?[await a.arrayBuffer()]:[a];return new Uu(i,e,t)}const n=await Lw(r);if(e||(e=Dw(r)??"unknown_file"),!(t!=null&&t.type)){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new Uu(n,e,t)}async function Lw(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Eo(r))e.push(await r.arrayBuffer());else if(Fw(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Mw(r)}`);return e}function Mw(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Dw(r){var e;return rl(r.name)||rl(r.filename)||((e=rl(r.path))==null?void 0:e.split(/[\\/]/).pop())}const rl=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Fw=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",df=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",fs=async r=>{const e=await Uw(r.body);return Zm(e,r)},Uw=async r=>{const e=new Hm;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Bu(e,t,n))),e},Bu=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(jw(t)){const n=await lg(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Bu(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Bu(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var as={},Bw=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},Hw=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ya;Wm();async function ug(r){var i;const{response:e}=r;if(r.options.stream)return is("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):yr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return is("response",e.status,e.url,e.headers,o),cg(o,e)}const a=await e.text();return is("response",e.status,e.url,e.headers,a),a}function cg(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class So extends Promise{constructor(e,t=ug){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new So(this.responsePromise,async t=>cg(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class qw{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=nl("maxRetries",t),this.timeout=nl("timeout",n),this.httpAgent=s,this.fetch=a??Bm}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Ww(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Yw()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const a=s&&Eo(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var p;e={...e};const{method:n,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:df(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(s,a);"timeout"in e&&nl("timeout",e.timeout),e.timeout=e.timeout??this.timeout;const c=e.httpAgent??this.httpAgent??Vm(u),d=e.timeout+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:e,headers:i,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:f,...c&&{agent:c},signal:e.signal??null},url:u,timeout:e.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return mf(a,i),mf(a,t),df(e.body)&&Qs!=="node"&&delete a["content-type"],ei(i,"x-stainless-retry-count")===void 0&&ei(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),ei(i,"x-stainless-timeout")===void 0&&ei(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(e.timeout)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return tt.generate(e,t,n,s)}request(e,t=null){return new So(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:n}),is("request",i,n,a.headers),(d=n.signal)!=null&&d.aborted)throw new Lt;const l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(Hu);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new Lt;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new vo:new wo({cause:u})}const c=fg(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const b=`retrying, ${t} attempts remaining`;return is(`response (error; ${b})`,u.status,i,c),this.retryRequest(n,t,c)}const h=await u.text().catch(b=>Hu(b).message),p=Jw(h),m=p?void 0:h;throw is(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Zw(this,n,e)}buildURL(e,t){const n=Xw(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return hg(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new se(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await La(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${zn}`}}class dg{constructor(e,t,n,s){Ya.set(this,void 0),Bw(this,Ya,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new se("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await Hw(this,Ya,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ya=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Zw extends So{constructor(e,t,n){super(t,async s=>new n(e,s.response,await ug(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const fg=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Vw={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ye=r=>typeof r=="object"&&r!==null&&!hg(r)&&Object.keys(r).every(e=>pg(Vw,e)),zw=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zn,"X-Stainless-OS":hf(Deno.build.os),"X-Stainless-Arch":ff(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zn,"X-Stainless-OS":hf(process.platform),"X-Stainless-Arch":ff(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Gw();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Gw(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const ff=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",hf=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let pf;const Ww=()=>pf??(pf=zw()),Jw=r=>{try{return JSON.parse(r)}catch{return}},Kw=/^[a-z][a-z0-9+.-]*:/i,Xw=r=>Kw.test(r),La=r=>new Promise(e=>setTimeout(e,r)),nl=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new se(`${r} must be an integer`);if(e<0)throw new se(`${r} must be a positive integer`);return e},Hu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Qa=r=>{var e,t,n,s;if(typeof process<"u")return((e=as==null?void 0:as[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function hg(r){if(!r)return!0;for(const e in r)return!1;return!0}function pg(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function mf(r,e){for(const t in e){if(!pg(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}const gf=new Set(["authorization","api-key"]);function is(r,...e){if(typeof process<"u"&&(as==null?void 0:as.DEBUG)==="true"){const t=e.map(n=>{if(!n)return n;if(n.headers){const a={...n,headers:{...n.headers}};for(const i in n.headers)gf.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(const a in n)gf.has(a.toLowerCase())&&(s??(s={...n}),s[a]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}const Yw=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Qw=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ev=r=>typeof(r==null?void 0:r.get)=="function",ei=(r,e)=>{var n;const t=e.toLowerCase();if(ev(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),s]){const i=r.get(a);if(i)return i}}for(const[s,a]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function sl(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class jc extends dg{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Ot extends dg{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class _e{constructor(e){this._client=e}}let mg=class extends _e{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,tv,{query:t,...n})}},Oo=class extends _e{constructor(){super(...arguments),this.messages=new mg(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/chat/completions",Ao,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Ao extends Ot{}class tv extends Ot{}Oo.ChatCompletionsPage=Ao;Oo.Messages=mg;let To=class extends _e{constructor(){super(...arguments),this.completions=new Oo(this._client)}};To.Completions=Oo;To.ChatCompletionsPage=Ao;class gg extends _e{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class _g extends _e{create(e,t){return this._client.post("/audio/transcriptions",fs({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class yg extends _e{create(e,t){return this._client.post("/audio/translations",fs({body:e,...t,__metadata:{model:e.model}}))}}class Ma extends _e{constructor(){super(...arguments),this.transcriptions=new _g(this._client),this.translations=new yg(this._client),this.speech=new gg(this._client)}}Ma.Transcriptions=_g;Ma.Translations=yg;Ma.Speech=gg;class Lc extends _e{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/batches",Mc,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Mc extends Ot{}Lc.BatchesPage=Mc;class Dc extends _e{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/assistants",Fc,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Fc extends Ot{}Dc.AssistantsPage=Fc;function _f(r){return typeof r.parse=="function"}const os=r=>(r==null?void 0:r.role)==="assistant",bg=r=>(r==null?void 0:r.role)==="function",wg=r=>(r==null?void 0:r.role)==="tool";var Kt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},De=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},qu,Si,Oi,Ds,Fs,Ai,Us,kr,Bs,Ui,Bi,Gn,vg;class Uc{constructor(){qu.add(this),this.controller=new AbortController,Si.set(this,void 0),Oi.set(this,()=>{}),Ds.set(this,()=>{}),Fs.set(this,void 0),Ai.set(this,()=>{}),Us.set(this,()=>{}),kr.set(this,{}),Bs.set(this,!1),Ui.set(this,!1),Bi.set(this,!1),Gn.set(this,!1),Kt(this,Si,new Promise((e,t)=>{Kt(this,Oi,e,"f"),Kt(this,Ds,t,"f")}),"f"),Kt(this,Fs,new Promise((e,t)=>{Kt(this,Ai,e,"f"),Kt(this,Us,t,"f")}),"f"),De(this,Si,"f").catch(()=>{}),De(this,Fs,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},De(this,qu,"m",vg).bind(this))},0)}_connected(){this.ended||(De(this,Oi,"f").call(this),this._emit("connect"))}get ended(){return De(this,Bs,"f")}get errored(){return De(this,Ui,"f")}get aborted(){return De(this,Bi,"f")}abort(){this.controller.abort()}on(e,t){return(De(this,kr,"f")[e]||(De(this,kr,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=De(this,kr,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(De(this,kr,"f")[e]||(De(this,kr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Kt(this,Gn,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Kt(this,Gn,!0,"f"),await De(this,Fs,"f")}_emit(e,...t){if(De(this,Bs,"f"))return;e==="end"&&(Kt(this,Bs,!0,"f"),De(this,Ai,"f").call(this));const n=De(this,kr,"f")[e];if(n&&(De(this,kr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!De(this,Gn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),De(this,Ds,"f").call(this,s),De(this,Us,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!De(this,Gn,"f")&&!(n!=null&&n.length)&&Promise.reject(s),De(this,Ds,"f").call(this,s),De(this,Us,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Si=new WeakMap,Oi=new WeakMap,Ds=new WeakMap,Fs=new WeakMap,Ai=new WeakMap,Us=new WeakMap,kr=new WeakMap,Bs=new WeakMap,Ui=new WeakMap,Bi=new WeakMap,Gn=new WeakMap,qu=new WeakSet,vg=function(e){if(Kt(this,Ui,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Lt),e instanceof Lt)return Kt(this,Bi,!0,"f"),this._emit("abort",e);if(e instanceof se)return this._emit("error",e);if(e instanceof Error){const t=new se(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new se(String(e)))};function rv(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Bc(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function nv(r,{parser:e,callback:t}){const n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function Da(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function sv(r,e){return!e||!xg(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Hc(r,e)}function Hc(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new ng;if(n.finish_reason==="content_filter")throw new sg;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>iv(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?av(e,n.message.content):null}}});return{...r,choices:t}}function av(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function iv(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Da(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ov(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return Da(t)||(t==null?void 0:t.function.strict)||!1}function xg(r){var e;return Bc(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>Da(t)||t.type==="function"&&t.function.strict===!0))??!1}function lv(r){for(const e of r??[]){if(e.type!=="function")throw new se(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new se(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var xt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},rt,Zu,Hi,Vu,zu,Gu,Eg,Wu;const yf=10;class Sg extends Uc{constructor(){super(...arguments),rt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(bg(e)||wg(e))&&e.content)this._emit("functionCallResult",e.content);else if(os(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(os(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new se("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),xt(this,rt,"m",Zu).call(this)}async finalMessage(){return await this.done(),xt(this,rt,"m",Hi).call(this)}async finalFunctionCall(){return await this.done(),xt(this,rt,"m",Vu).call(this)}async finalFunctionCallResult(){return await this.done(),xt(this,rt,"m",zu).call(this)}async totalUsage(){return await this.done(),xt(this,rt,"m",Gu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=xt(this,rt,"m",Hi).call(this);t&&this._emit("finalMessage",t);const n=xt(this,rt,"m",Zu).call(this);n&&this._emit("finalContent",n);const s=xt(this,rt,"m",Vu).call(this);s&&this._emit("finalFunctionCall",s);const a=xt(this,rt,"m",zu).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",xt(this,rt,"m",Gu).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),xt(this,rt,"m",Eg).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Hc(a,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;const s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=yf}=n||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!m)throw new se("missing message in ChatCompletion response");if(!m.function_call)return;const{name:g,arguments:_}=m.function_call,b=c[g];if(b){if(l&&l!==g){const A=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:g,content:A});continue}}else{const A=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:A});continue}let y;try{y=_f(b)?await b.parse(_):_}catch(A){this._addMessage({role:s,name:g,content:A instanceof Error?A.message:String(A)});continue}const v=await b.function(y,this),E=xt(this,rt,"m",Wu).call(this,v);if(this._addMessage({role:s,name:g,content:E}),l)return}}async _runTools(e,t,n){var h,p,m;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((h=a==null?void 0:a.function)==null?void 0:h.name),{maxChatCompletions:u=yf}=n||{},c=t.tools.map(g=>{if(Da(g)){if(!g.$callback)throw new se("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),d={};for(const g of c)g.type==="function"&&(d[g.function.name||g.function.function.name]=g.function);const f="tools"in t?c.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<u;++g){const b=(p=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},n)).choices[0])==null?void 0:p.message;if(!b)throw new se("missing message in ChatCompletion response");if(!((m=b.tool_calls)!=null&&m.length))return;for(const y of b.tool_calls){if(y.type!=="function")continue;const v=y.id,{name:E,arguments:A}=y.function,S=d[E];if(S){if(l&&l!==E){const Z=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:v,content:Z});continue}}else{const Z=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(d).map(re=>JSON.stringify(re)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:v,content:Z});continue}let O;try{O=_f(S)?await S.parse(A):A}catch(Z){const re=Z instanceof Error?Z.message:String(Z);this._addMessage({role:s,tool_call_id:v,content:re});continue}const k=await S.function(O,this),K=xt(this,rt,"m",Wu).call(this,k);if(this._addMessage({role:s,tool_call_id:v,content:K}),l)return}}}}rt=new WeakSet,Zu=function(){return xt(this,rt,"m",Hi).call(this).content??null},Hi=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(os(t)){const{function_call:n,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new se("stream ended without producing a ChatCompletionMessage with role=assistant")},Vu=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(os(s)&&(s!=null&&s.function_call))return s.function_call;if(os(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},zu=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(bg(t)&&t.content!=null||wg(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Gu=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Eg=function(e){if(e.n!=null&&e.n>1)throw new se("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Wu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class fa extends Sg{static runFunctions(e,t,n){const s=new fa,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new fa,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),os(e)&&e.content&&this._emit("content",e.content)}}const Og=1,Ag=2,Tg=4,Pg=8,Ig=16,kg=32,Rg=64,Cg=128,$g=256,Ng=Cg|$g,jg=Ig|kg|Ng|Rg,Lg=Og|Ag|jg,Mg=Tg|Pg,uv=Lg|Mg,Je={STR:Og,NUM:Ag,ARR:Tg,OBJ:Pg,NULL:Ig,BOOL:kg,NAN:Rg,INFINITY:Cg,MINUS_INFINITY:$g,INF:Ng,SPECIAL:jg,ATOM:Lg,COLLECTION:Mg,ALL:uv};class cv extends Error{}class dv extends Error{}function fv(r,e=Je.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return hv(r.trim(),e)}const hv=(r,e)=>{const t=r.length;let n=0;const s=f=>{throw new cv(`${f} at position ${n}`)},a=f=>{throw new dv(`${f} at position ${n}`)},i=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?u():r.substring(n,n+4)==="null"||Je.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Je.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Je.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Je.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Je.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Je.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):c()),o=()=>{const f=n;let h=!1;for(n++;n<t&&(r[n]!=='"'||h&&r[n-1]==="\\");)h=r[n]==="\\"?!h:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(h)))}catch(p){a(String(p))}else if(Je.STR&e)try{return JSON.parse(r.substring(f,n-Number(h))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const f={};try{for(;r[n]!=="}";){if(d(),n>=t&&Je.OBJ&e)return f;const h=o();d(),n++;try{const p=i();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(Je.OBJ&e)return f;throw p}d(),r[n]===","&&n++}}catch{if(Je.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},u=()=>{n++;const f=[];try{for(;r[n]!=="]";)f.push(i()),d(),r[n]===","&&n++}catch{if(Je.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},c=()=>{if(n===0){r==="-"&&Je.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(h){if(Je.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(h))}}const f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(Je.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&Je.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(p){a(String(p))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},bf=r=>fv(r,Je.ALL^Je.NUM);var Un=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ce=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ve,Pr,Bn,qr,al,ti,il,ol,ll,ri,ul,wf;class ha extends Sg{constructor(e){super(),Ve.add(this),Pr.set(this,void 0),Bn.set(this,void 0),qr.set(this,void 0),Un(this,Pr,e,"f"),Un(this,Bn,[],"f")}get currentChatCompletionSnapshot(){return Ce(this,qr,"f")}static fromReadableStream(e){const t=new ha(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new ha(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ce(this,Ve,"m",al).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Ce(this,Ve,"m",il).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Lt;return this._addChatCompletion(Ce(this,Ve,"m",ri).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Ce(this,Ve,"m",al).call(this),this._connected();const s=yr.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(Ce(this,Ve,"m",ri).call(this)),Ce(this,Ve,"m",il).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new Lt;return this._addChatCompletion(Ce(this,Ve,"m",ri).call(this))}[(Pr=new WeakMap,Bn=new WeakMap,qr=new WeakMap,Ve=new WeakSet,al=function(){this.ended||Un(this,qr,void 0,"f")},ti=function(t){let n=Ce(this,Bn,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ce(this,Bn,"f")[t.index]=n,n)},il=function(t){var s,a,i,o,l,u,c,d,f,h,p,m,g,_,b;if(this.ended)return;const n=Ce(this,Ve,"m",wf).call(this,t);this._emit("chunk",t,n);for(const y of t.choices){const v=n.choices[y.index];y.delta.content!=null&&((s=v.message)==null?void 0:s.role)==="assistant"&&((a=v.message)!=null&&a.content)&&(this._emit("content",y.delta.content,v.message.content),this._emit("content.delta",{delta:y.delta.content,snapshot:v.message.content,parsed:v.message.parsed})),y.delta.refusal!=null&&((i=v.message)==null?void 0:i.role)==="assistant"&&((o=v.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:y.delta.refusal,snapshot:v.message.refusal}),((l=y.logprobs)==null?void 0:l.content)!=null&&((u=v.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=y.logprobs)==null?void 0:c.content,snapshot:((d=v.logprobs)==null?void 0:d.content)??[]}),((f=y.logprobs)==null?void 0:f.refusal)!=null&&((h=v.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=y.logprobs)==null?void 0:p.refusal,snapshot:((m=v.logprobs)==null?void 0:m.refusal)??[]});const E=Ce(this,Ve,"m",ti).call(this,v);v.finish_reason&&(Ce(this,Ve,"m",ll).call(this,v),E.current_tool_call_index!=null&&Ce(this,Ve,"m",ol).call(this,v,E.current_tool_call_index));for(const A of y.delta.tool_calls??[])E.current_tool_call_index!==A.index&&(Ce(this,Ve,"m",ll).call(this,v),E.current_tool_call_index!=null&&Ce(this,Ve,"m",ol).call(this,v,E.current_tool_call_index)),E.current_tool_call_index=A.index;for(const A of y.delta.tool_calls??[]){const S=(g=v.message.tool_calls)==null?void 0:g[A.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=S.function)==null?void 0:_.name,index:A.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:((b=A.function)==null?void 0:b.arguments)??""}):(S==null||S.type,void 0))}}},ol=function(t,n){var i,o,l;if(Ce(this,Ve,"m",ti).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=Ce(this,Pr,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>c.type==="function"&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Da(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},ll=function(t){var s,a;const n=Ce(this,Ve,"m",ti).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=Ce(this,Ve,"m",ul).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ri=function(){if(this.ended)throw new se("stream has ended, this shouldn't happen");const t=Ce(this,qr,"f");if(!t)throw new se("request ended without sending any chunks");return Un(this,qr,void 0,"f"),Un(this,Bn,[],"f"),pv(t,Ce(this,Pr,"f"))},ul=function(){var n;const t=(n=Ce(this,Pr,"f"))==null?void 0:n.response_format;return Bc(t)?t:null},wf=function(t){var n,s,a,i;let o=Ce(this,qr,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=Un(this,qr,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...p}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:A,refusal:S,...O}=h;Object.assign(m.logprobs,O),A&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...A)),S&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...S))}if(d&&(m.finish_reason=d,Ce(this,Pr,"f")&&xg(Ce(this,Pr,"f")))){if(d==="length")throw new ng;if(d==="content_filter")throw new sg}if(Object.assign(m,p),!c)continue;const{content:g,refusal:_,function_call:b,role:y,tool_calls:v,...E}=c;if(Object.assign(m.message,E),_&&(m.message.refusal=(m.message.refusal||"")+_),y&&(m.message.role=y),b&&(m.message.function_call?(b.name&&(m.message.function_call.name=b.name),b.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=b.arguments)):m.message.function_call=b),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&Ce(this,Ve,"m",ul).call(this)&&(m.message.parsed=bf(m.message.content))),v){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:A,id:S,type:O,function:k,...K}of v){const Z=(i=m.message.tool_calls)[A]??(i[A]={});Object.assign(Z,K),S&&(Z.id=S),O&&(Z.type=O),k&&(Z.function??(Z.function={name:k.name??"",arguments:""})),k!=null&&k.name&&(Z.function.name=k.name),k!=null&&k.arguments&&(Z.function.arguments+=k.arguments,ov(Ce(this,Pr,"f"),Z)&&(Z.function.parsed_arguments=bf(Z.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new yr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function pv(r,e){const{id:t,choices:n,created:s,model:a,system_fingerprint:i,...o}=r,l={...o,id:t,choices:n.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new se(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:g,..._}=u,b=u.role;if(!b)throw new se(`missing role for choice ${d}`);if(m){const{arguments:y,name:v}=m;if(y==null)throw new se(`missing function_call.arguments for choice ${d}`);if(!v)throw new se(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:y,name:v},role:b,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return g?{...h,index:d,finish_reason:c,logprobs:f,message:{..._,role:b,content:p,refusal:u.refusal??null,tool_calls:g.map((y,v)=>{const{function:E,type:A,id:S,...O}=y,{arguments:k,name:K,...Z}=E||{};if(S==null)throw new se(`missing choices[${d}].tool_calls[${v}].id
${ni(r)}`);if(A==null)throw new se(`missing choices[${d}].tool_calls[${v}].type
${ni(r)}`);if(K==null)throw new se(`missing choices[${d}].tool_calls[${v}].function.name
${ni(r)}`);if(k==null)throw new se(`missing choices[${d}].tool_calls[${v}].function.arguments
${ni(r)}`);return{...O,id:S,type:A,function:{...Z,name:K,arguments:k}}})}}:{...h,message:{..._,content:p,role:b,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return sv(l,e)}function ni(r){return JSON.stringify(r)}class ls extends ha{static fromReadableStream(e){const t=new ls(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ls(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new ls(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let Dg=class extends _e{parse(e,t){return lv(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Hc(n,e))}runFunctions(e,t){return e.stream?ls.runFunctions(this._client,e,t):fa.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ls.runTools(this._client,e,t):fa.runTools(this._client,e,t)}stream(e,t){return ha.createChatCompletion(this._client,e,t)}};class Ju extends _e{constructor(){super(...arguments),this.completions=new Dg(this._client)}}(function(r){r.Completions=Dg})(Ju||(Ju={}));class Fg extends _e{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Ug extends _e{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Po extends _e{constructor(){super(...arguments),this.sessions=new Fg(this._client),this.transcriptionSessions=new Ug(this._client)}}Po.Sessions=Fg;Po.TranscriptionSessions=Ug;var X=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},et,Ku,gr,Ti,Xt,xn,Jn,vn,qi,Ct,Pi,Ii,ea,Hs,qs,vf,xf,Ef,Sf,Of,Af,Tf;class Yt extends Uc{constructor(){super(...arguments),et.add(this),Ku.set(this,[]),gr.set(this,{}),Ti.set(this,{}),Xt.set(this,void 0),xn.set(this,void 0),Jn.set(this,void 0),vn.set(this,void 0),qi.set(this,void 0),Ct.set(this,void 0),Pi.set(this,void 0),Ii.set(this,void 0),ea.set(this,void 0)}[(Ku=new WeakMap,gr=new WeakMap,Ti=new WeakMap,Xt=new WeakMap,xn=new WeakMap,Jn=new WeakMap,vn=new WeakMap,qi=new WeakMap,Ct=new WeakMap,Pi=new WeakMap,Ii=new WeakMap,ea=new WeakMap,et=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Yt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=yr.fromReadableStream(e,this.controller);for await(const i of s)X(this,et,"m",Hs).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Lt;return this._addRun(X(this,et,"m",qs).call(this))}toReadableStream(){return new yr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new Yt;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const c of l)X(this,et,"m",Hs).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new Lt;return this._addRun(X(this,et,"m",qs).call(this))}static createThreadAssistantStream(e,t,n){const s=new Yt;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new Yt;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return X(this,Pi,"f")}currentRun(){return X(this,Ii,"f")}currentMessageSnapshot(){return X(this,Xt,"f")}currentRunStepSnapshot(){return X(this,ea,"f")}async finalRunSteps(){return await this.done(),Object.values(X(this,gr,"f"))}async finalMessages(){return await this.done(),Object.values(X(this,Ti,"f"))}async finalRun(){if(await this.done(),!X(this,xn,"f"))throw Error("Final run was not received.");return X(this,xn,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)X(this,et,"m",Hs).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new Lt;return this._addRun(X(this,et,"m",qs).call(this))}async _createAssistantStream(e,t,n,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)X(this,et,"m",Hs).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Lt;return this._addRun(X(this,et,"m",qs).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(sl(a)&&sl(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!sl(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}}Hs=function(e){if(!this.ended)switch(Pt(this,Pi,e,"f"),X(this,et,"m",Ef).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":X(this,et,"m",Tf).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":X(this,et,"m",xf).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":X(this,et,"m",vf).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},qs=function(){if(this.ended)throw new se("stream has ended, this shouldn't happen");if(!X(this,xn,"f"))throw Error("Final run has not been received");return X(this,xn,"f")},vf=function(e){const[t,n]=X(this,et,"m",Of).call(this,e,X(this,Xt,"f"));Pt(this,Xt,t,"f"),X(this,Ti,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=X(this,Jn,"f")){if(X(this,vn,"f"))switch(X(this,vn,"f").type){case"text":this._emit("textDone",X(this,vn,"f").text,X(this,Xt,"f"));break;case"image_file":this._emit("imageFileDone",X(this,vn,"f").image_file,X(this,Xt,"f"));break}Pt(this,Jn,s.index,"f")}Pt(this,vn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(X(this,Jn,"f")!==void 0){const s=e.data.content[X(this,Jn,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,X(this,Xt,"f"));break;case"text":this._emit("textDone",s.text,X(this,Xt,"f"));break}}X(this,Xt,"f")&&this._emit("messageDone",e.data),Pt(this,Xt,void 0,"f")}},xf=function(e){const t=X(this,et,"m",Sf).call(this,e);switch(Pt(this,ea,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==X(this,qi,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(X(this,Ct,"f")&&this._emit("toolCallDone",X(this,Ct,"f")),Pt(this,qi,a.index,"f"),Pt(this,Ct,t.step_details.tool_calls[a.index],"f"),X(this,Ct,"f")&&this._emit("toolCallCreated",X(this,Ct,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Pt(this,ea,void 0,"f"),e.data.step_details.type=="tool_calls"&&X(this,Ct,"f")&&(this._emit("toolCallDone",X(this,Ct,"f")),Pt(this,Ct,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Ef=function(e){X(this,Ku,"f").push(e),this._emit("event",e)},Sf=function(e){switch(e.event){case"thread.run.step.created":return X(this,gr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=X(this,gr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Yt.accumulateDelta(t,n.delta);X(this,gr,"f")[e.data.id]=s}return X(this,gr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":X(this,gr,"f")[e.data.id]=e.data;break}if(X(this,gr,"f")[e.data.id])return X(this,gr,"f")[e.data.id];throw new Error("No snapshot available")},Of=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=X(this,et,"m",Af).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Af=function(e,t){return Yt.accumulateDelta(t,e)},Tf=function(e){switch(Pt(this,Ii,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Pt(this,xn,e.data,"f"),X(this,Ct,"f")&&(this._emit("toolCallDone",X(this,Ct,"f")),Pt(this,Ct,void 0,"f"));break}};class qc extends _e{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Zc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Zc extends Ot{}qc.MessagesPage=Zc;class Vc extends _e{retrieve(e,t,n,s={},a){return Ye(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},s){return Ye(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,zc,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class zc extends Ot{}Vc.RunStepsPage=zc;class Fa extends _e{constructor(){super(...arguments),this.steps=new Vc(this._client)}create(e,t,n){const{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Gc,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Yt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await La(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Yt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return Yt.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Gc extends Ot{}Fa.RunsPage=Gc;Fa.Steps=Vc;Fa.RunStepsPage=zc;class bs extends _e{constructor(){super(...arguments),this.runs=new Fa(this._client),this.messages=new qc(this._client)}create(e={},t){return Ye(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Yt.createThreadAssistantStream(e,this._client.beta.threads,t)}}bs.Runs=Fa;bs.RunsPage=Gc;bs.Messages=qc;bs.MessagesPage=Zc;class ws extends _e{constructor(){super(...arguments),this.realtime=new Po(this._client),this.chat=new Ju(this._client),this.assistants=new Dc(this._client),this.threads=new bs(this._client)}}ws.Realtime=Po;ws.Assistants=Dc;ws.AssistantsPage=Fc;ws.Threads=bs;class Bg extends _e{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Hg extends _e{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}let Wc=class extends _e{create(e,t){return this._client.post("/files",fs({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/files",Jc,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await La(t),i=await this.retrieve(e),Date.now()-a>n)throw new vo({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class Jc extends Ot{}Wc.FileObjectsPage=Jc;class Kc extends _e{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Xc,{query:t,...n})}}class Xc extends Ot{}Kc.FineTuningJobCheckpointsPage=Xc;class vs extends _e{constructor(){super(...arguments),this.checkpoints=new Kc(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Yc,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Ye(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Qc,{query:t,...n})}}class Yc extends Ot{}class Qc extends Ot{}vs.FineTuningJobsPage=Yc;vs.FineTuningJobEventsPage=Qc;vs.Checkpoints=Kc;vs.FineTuningJobCheckpointsPage=Xc;class Ua extends _e{constructor(){super(...arguments),this.jobs=new vs(this._client)}}Ua.Jobs=vs;Ua.FineTuningJobsPage=Yc;Ua.FineTuningJobEventsPage=Qc;class qg extends _e{createVariation(e,t){return this._client.post("/images/variations",fs({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",fs({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ed extends _e{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",td,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class td extends jc{}ed.ModelsPage=td;class Zg extends _e{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function mv(r,e){return!e||!_v(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Vg(r,e)}function Vg(r,e){const t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:wv(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:gv(e,i.text)}:i);return{...s,content:a}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||zg(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const s of n.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function gv(r,e){var t,n,s,a;return((n=(t=r.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((s=r.text)==null?void 0:s.format)?((a=r.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function _v(r){var e;return!!Bc((e=r.text)==null?void 0:e.format)}function yv(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function bv(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function wv(r,e){const t=bv(r.tools??[],e.name);return{...e,...e,parsed_arguments:yv(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function zg(r){const e=[];for(const t of r.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}class Gg extends _e{list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,xv,{query:t,...n})}}var Hn=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Zr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},qn,si,Vr,ai,Pf,If,kf,Rf;class rd extends Uc{constructor(e){super(),qn.add(this),si.set(this,void 0),Vr.set(this,void 0),ai.set(this,void 0),Hn(this,si,e,"f")}static createResponse(e,t,n){const s=new rd(t);return s._run(()=>s._createResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Zr(this,qn,"m",Pf).call(this);const a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)Zr(this,qn,"m",If).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Lt;return Zr(this,qn,"m",kf).call(this)}[(si=new WeakMap,Vr=new WeakMap,ai=new WeakMap,qn=new WeakSet,Pf=function(){this.ended||Hn(this,Vr,void 0,"f")},If=function(t){if(this.ended)return;const n=Zr(this,qn,"m",Rf).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new se(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new se(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new se(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new se(`missing output at index ${t.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:this._emit(t.type,t);break}},kf=function(){if(this.ended)throw new se("stream has ended, this shouldn't happen");const t=Zr(this,Vr,"f");if(!t)throw new se("request ended without sending any events");Hn(this,Vr,void 0,"f");const n=vv(t,Zr(this,si,"f"));return Hn(this,ai,n,"f"),n},Rf=function(t){let n=Zr(this,Vr,"f");if(!n){if(t.type!=="response.created")throw new se(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Hn(this,Vr,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const s=n.output[t.output_index];if(!s)throw new se(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{const s=n.output[t.output_index];if(!s)throw new se(`missing output at index ${t.output_index}`);if(s.type==="message"){const a=s.content[t.content_index];if(!a)throw new se(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new se(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const s=n.output[t.output_index];if(!s)throw new se(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Hn(this,Vr,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Zr(this,ai,"f");if(!e)throw new se("stream ended without producing a ChatCompletion");return e}}function vv(r,e){return mv(r,e)}class nd extends _e{constructor(){super(...arguments),this.inputItems=new Gg(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&zg(n),n))}retrieve(e,t={},n){return Ye(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Vg(n,e))}stream(e,t){return rd.createResponse(this._client,e,t)}}class xv extends Ot{}nd.InputItems=Gg;class Wg extends _e{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,fs({body:t,...n}))}}class sd extends _e{constructor(){super(...arguments),this.parts=new Wg(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}sd.Parts=Wg;const Ev=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};class Io extends _e{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Ye(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ko,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await La(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,ad,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class ko extends Ot{}class ad extends jc{}Io.VectorStoreFilesPage=ko;Io.FileContentResponsesPage=ad;class Jg extends _e{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Ye(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ko,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await La(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),u=[...n];async function c(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},s);u.push(p.id)}}const d=Array(i).fill(l).map(c);return await Ev(d),await this.createAndPoll(e,{file_ids:u})}}class mn extends _e{constructor(){super(...arguments),this.files=new Io(this._client),this.fileBatches=new Jg(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Ye(e)?this.list({},e):this._client.getAPIList("/vector_stores",id,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,od,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class id extends Ot{}class od extends jc{}mn.VectorStoresPage=id;mn.VectorStoreSearchResponsesPage=od;mn.Files=Io;mn.VectorStoreFilesPage=ko;mn.FileContentResponsesPage=ad;mn.FileBatches=Jg;var Kg;let pe=class extends qw{constructor({baseURL:e=Qa("OPENAI_BASE_URL"),apiKey:t=Qa("OPENAI_API_KEY"),organization:n=Qa("OPENAI_ORG_ID")??null,project:s=Qa("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new se("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Qw())throw new se(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Bg(this),this.chat=new To(this),this.embeddings=new Hg(this),this.files=new Wc(this),this.images=new qg(this),this.audio=new Ma(this),this.moderations=new Zg(this),this.models=new ed(this),this.fineTuning=new Ua(this),this.vectorStores=new mn(this),this.beta=new ws(this),this.batches=new Lc(this),this.uploads=new sd(this),this.responses=new nd(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ow(e,{arrayFormat:"brackets"})}};Kg=pe;pe.OpenAI=Kg;pe.DEFAULT_TIMEOUT=6e5;pe.OpenAIError=se;pe.APIError=tt;pe.APIConnectionError=wo;pe.APIConnectionTimeoutError=vo;pe.APIUserAbortError=Lt;pe.NotFoundError=Ym;pe.ConflictError=Qm;pe.RateLimitError=tg;pe.BadRequestError=Jm;pe.AuthenticationError=Km;pe.InternalServerError=rg;pe.PermissionDeniedError=Xm;pe.UnprocessableEntityError=eg;pe.toFile=lg;pe.fileFromPath=zm;pe.Completions=Bg;pe.Chat=To;pe.ChatCompletionsPage=Ao;pe.Embeddings=Hg;pe.Files=Wc;pe.FileObjectsPage=Jc;pe.Images=qg;pe.Audio=Ma;pe.Moderations=Zg;pe.Models=ed;pe.ModelsPage=td;pe.FineTuning=Ua;pe.VectorStores=mn;pe.VectorStoresPage=id;pe.VectorStoreSearchResponsesPage=od;pe.Beta=ws;pe.Batches=Lc;pe.BatchesPage=Mc;pe.Uploads=sd;pe.Responses=nd;function Cf(r,e=ld){r=r.trim();const t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function ld(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="";const t=[];let n=!1,s=!1;for(let a of r){if(n)a==='"'&&!s?n=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')n=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}n&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}function xs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var cl,$f;function Sv(){return $f||($f=1,cl=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),cl}var Ov=Sv();const Av=xs(Ov);var ii={exports:{}},Nf;function Tv(){if(Nf)return ii.exports;Nf=1;const r=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+n.source,"gu"),o=new RegExp("\\d+"+n.source,"gu"),l=(f,h,p)=>{let m=!1,g=!1,_=!1;for(let b=0;b<f.length;b++){const y=f[b];m&&r.test(y)?(f=f.slice(0,b)+"-"+f.slice(b),m=!1,_=g,g=!0,b++):g&&_&&e.test(y)?(f=f.slice(0,b-1)+"-"+f.slice(b-1),_=g,g=!1,m=!0):(m=h(y)===y&&p(y)!==y,_=g,g=p(y)===y&&h(y)!==y)}return f},u=(f,h)=>(t.lastIndex=0,f.replace(t,p=>h(p))),c=(f,h)=>(i.lastIndex=0,o.lastIndex=0,f.replace(i,(p,m)=>h(m)).replace(o,p=>h(p))),d=(f,h)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(h={pascalCase:!1,preserveConsecutiveUppercase:!1,...h},Array.isArray(f)?f=f.map(_=>_.trim()).filter(_=>_.length).join("-"):f=f.trim(),f.length===0)return"";const p=h.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(h.locale),m=h.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(h.locale);return f.length===1?h.pascalCase?m(f):p(f):(f!==p(f)&&(f=l(f,p,m)),f=f.replace(a,""),h.preserveConsecutiveUppercase?f=u(f,p):f=p(f),h.pascalCase&&(f=m(f.charAt(0))+f.slice(1)),c(f,m))};return ii.exports=d,ii.exports.default=d,ii.exports}Tv();function Pv(r,e){return(e==null?void 0:e[r])||Av(r)}function Iv(r,e,t){const n={};for(const s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function jf(r){return Array.isArray(r)?[...r]:{...r}}function kv(r,e){const t=jf(r);for(const[n,s]of Object.entries(e)){const[a,...i]=n.split(".").reverse();let o=t;for(const l of i.reverse()){if(o[l]===void 0)break;o[l]=jf(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function Xg(r){const e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}class Rn{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Xg(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(n)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Rn||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=n;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?i[u]={}:Array.isArray(a[u])&&(i[u]=[])),a=a[u],i=i[u]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Iv(Object.keys(t).length?kv(n,t):n,Pv,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Es(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?Ro(r,e)??[...r,...e]:e===""?r:[...r,{type:"text",text:e}]}function Rv(r,e){return r==="error"||e==="error"?"error":"success"}function Cv(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,s+1));const a={};for(const i of Object.keys(n))a[i]=t(n[i],s+1);return a}return JSON.stringify(t(r,0),null,2)}class Ss extends Rn{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=Cv(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function gt(r,e){const t={...r};for(const[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=gt(t[n],s);else if(Array.isArray(t[n]))t[n]=Ro(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Ro(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{const t=[...r];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const s=t.findIndex(a=>a.index===n.index);s!==-1?t[s]=gt(t[s],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function $v(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Ro(r,e);if(typeof r=="object"&&typeof e=="object")return gt(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}class Os extends Ss{}function Nv(r){return typeof r.role=="string"}function Co(r){return typeof(r==null?void 0:r._getType)=="function"}function jv(r){return Co(r)&&typeof r.concat=="function"}class Lv extends Ss{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class ud extends Os{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new ud({content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),artifact:$v(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Rv(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Mv(r){const e=[],t=[];for(const n of r)if(n.function){const s=n.function.name;try{const a=JSON.parse(n.function.arguments),i={name:s||"",args:a||{},id:n.id};e.push(i)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}class pa extends Ss{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;const a=(s=n.additional_kwargs)==null?void 0:s.tool_calls,i=n.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,l]=Mv(a);n.tool_calls=o??[],n.invalid_tool_calls=l??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Ba(r){return r._getType()==="ai"}function Lf(r){return r._getType()==="ai"}class an extends Os{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=ld(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");n.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var n,s,a,i,o,l,u,c,d,f,h,p,m,g,_,b,y,v,E,A,S,O,k,K,Z,re,ye,L,C,H,M,F,W,te,ue,Q,Ee,Be,Le,bt;const t={content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Zt=Ro(this.tool_call_chunks,e.tool_call_chunks);Zt!==void 0&&Zt.length>0&&(t.tool_call_chunks=Zt)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Zt={...(((s=(n=this.usage_metadata)==null?void 0:n.input_token_details)==null?void 0:s.audio)!==void 0||((i=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0)&&{audio:(((l=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:l.audio)??0)+(((c=(u=e.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:c.audio)??0)},...(((f=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:f.cache_read)!==void 0||((p=(h=e.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(m=this.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:g.cache_read)??0)+(((b=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:b.cache_read)??0)},...(((v=(y=this.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:v.cache_creation)!==void 0||((A=(E=e.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:A.cache_creation)!==void 0)&&{cache_creation:(((O=(S=this.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:O.cache_creation)??0)+(((K=(k=e.usage_metadata)==null?void 0:k.input_token_details)==null?void 0:K.cache_creation)??0)}},Mn={...(((re=(Z=this.usage_metadata)==null?void 0:Z.output_token_details)==null?void 0:re.audio)!==void 0||((L=(ye=e.usage_metadata)==null?void 0:ye.output_token_details)==null?void 0:L.audio)!==void 0)&&{audio:(((H=(C=this.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:H.audio)??0)+(((F=(M=e.usage_metadata)==null?void 0:M.output_token_details)==null?void 0:F.audio)??0)},...(((te=(W=this.usage_metadata)==null?void 0:W.output_token_details)==null?void 0:te.reasoning)!==void 0||((Q=(ue=e.usage_metadata)==null?void 0:ue.output_token_details)==null?void 0:Q.reasoning)!==void 0)&&{reasoning:(((Be=(Ee=this.usage_metadata)==null?void 0:Ee.output_token_details)==null?void 0:Be.reasoning)??0)+(((bt=(Le=e.usage_metadata)==null?void 0:Le.output_token_details)==null?void 0:bt.reasoning)??0)}},Dn=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Ar=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Pd={input_tokens:Dn.input_tokens+Ar.input_tokens,output_tokens:Dn.output_tokens+Ar.output_tokens,total_tokens:Dn.total_tokens+Ar.total_tokens,...Object.keys(Zt).length>0&&{input_token_details:Zt},...Object.keys(Mn).length>0&&{output_token_details:Mn}};t.usage_metadata=Pd}return new an(t)}}class Ha extends Ss{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ha}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class $o extends Os{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new $o({content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class No extends Os{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new No({content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class jo extends Ss{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Lo extends Os{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Lo({content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Mf extends Ss{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class ma extends Os{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new ma({content:Es(this.content,e.content),additional_kwargs:gt(this.additional_kwargs,e.additional_kwargs),response_metadata:gt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Yg(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Qg(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}class Dv extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Fv(r){return Qg(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function Uv(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function dl(r){let e,t;if(Uv(r)){const n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{const{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new jo(t);if(e==="ai"||e==="assistant"){const{tool_calls:n,...s}=t;if(!Array.isArray(n))return new pa(t);const a=n.map(Fv);return new pa({...s,tool_calls:a})}else{if(e==="system")return new Mf(t);if(e==="developer")return new Mf({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Lv({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Yg(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Zs(r){if(typeof r=="string")return new jo(r);if(Co(r))return r;if(Array.isArray(r)){const[e,t]=r;return dl({type:e,content:t})}else if(Nv(r)){const{role:e,...t}=r;return dl({...t,type:e})}else return dl(r)}function e_(r,e="Human",t="AI"){const n=[];for(const s of r){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${a}: ${i}${o}`)}return n.join(`
`)}function Bv(r){var t;const e=r._getType();if(e==="human")return new Lo({...r});if(e==="ai"){let n={...r};return"tool_calls"in n&&(n={...n,tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new an({...n})}else{if(e==="system")return new ma({...r});if(e==="function")return new No({...r});if(Ha.isInstance(r))return new $o({...r});throw new Error("Unknown message type.")}}var we;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},r.getValidEnumValues=s=>{const a=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return r.objectValues(i)},r.objectValues=s=>r.objectKeys(s).map(function(a){return s[a]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},r.find=(s,a)=>{for(const i of s)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=n,r.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(we||(we={}));var Xu;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Xu||(Xu={}));const G=we.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),$r=r=>{switch(typeof r){case"undefined":return G.undefined;case"string":return G.string;case"number":return isNaN(r)?G.nan:G.number;case"boolean":return G.boolean;case"function":return G.function;case"bigint":return G.bigint;case"symbol":return G.symbol;case"object":return Array.isArray(r)?G.array:r===null?G.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?G.promise:typeof Map<"u"&&r instanceof Map?G.map:typeof Set<"u"&&r instanceof Set?G.set:typeof Date<"u"&&r instanceof Date?G.date:G.object;default:return G.unknown}},R=we.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Hv=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Dt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let o=n,l=0;for(;l<i.path.length;){const u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),n}static assert(e){if(!(e instanceof Dt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,we.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Dt.create=r=>new Dt(r);const hs=(r,e)=>{let t;switch(r.code){case R.invalid_type:r.received===G.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case R.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,we.jsonStringifyReplacer)}`;break;case R.unrecognized_keys:t=`Unrecognized key(s) in object: ${we.joinValues(r.keys,", ")}`;break;case R.invalid_union:t="Invalid input";break;case R.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${we.joinValues(r.options)}`;break;case R.invalid_enum_value:t=`Invalid enum value. Expected ${we.joinValues(r.options)}, received '${r.received}'`;break;case R.invalid_arguments:t="Invalid function arguments";break;case R.invalid_return_type:t="Invalid function return type";break;case R.invalid_date:t="Invalid date";break;case R.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:we.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case R.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case R.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case R.custom:t="Invalid input";break;case R.invalid_intersection_types:t="Intersection results could not be merged";break;case R.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case R.not_finite:t="Number must be finite";break;default:t=e.defaultError,we.assertNever(r)}return{message:t}};let t_=hs;function qv(r){t_=r}function Zi(){return t_}const Vi=r=>{const{data:e,path:t,errorMaps:n,issueData:s}=r,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=n.filter(u=>!!u).slice().reverse();for(const u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},Zv=[];function B(r,e){const t=Zi(),n=Vi({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===hs?void 0:hs].filter(s=>!!s)});r.common.issues.push(n)}class ot{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return ie;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const a=await s.key,i=await s.value;n.push({key:a,value:i})}return ot.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return ie;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const ie=Object.freeze({status:"aborted"}),Kn=r=>({status:"dirty",value:r}),_t=r=>({status:"valid",value:r}),Yu=r=>r.status==="aborted",Qu=r=>r.status==="dirty",Cn=r=>r.status==="valid",ga=r=>typeof Promise<"u"&&r instanceof Promise;function zi(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function r_(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var J;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(J||(J={}));var Vs,zs;class Sr{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Df=(r,e)=>{if(Cn(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Dt(r.common.issues);return this._error=t,this._error}}};function le(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var l,u;const{message:c}=r;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??n)!==null&&l!==void 0?l:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??t)!==null&&u!==void 0?u:o.defaultError}},description:s}}class he{get description(){return this._def.description}_getType(e){return $r(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:$r(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ot,ctx:{common:e.parent.common,data:e.data,parsedType:$r(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ga(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$r(e)},a=this._parseSync({data:e,path:s.path,parent:s});return Df(s,a)}"~validate"(e){var t,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$r(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return Cn(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((n=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>Cn(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$r(e)},s=this._parse({data:e,path:n.path,parent:n}),a=await(ga(s)?s:Promise.resolve(s));return Df(n,a)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:R.custom,...n(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new ar({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return rr.create(this,this._def)}nullable(){return cn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tr.create(this)}promise(){return ms.create(this,this._def)}or(e){return wa.create([this,e],this._def)}and(e){return va.create(this,e,this._def)}transform(e){return new ar({...le(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Aa({...le(this._def),innerType:this,defaultValue:t,typeName:T.ZodDefault})}brand(){return new cd({typeName:T.ZodBranded,type:this,...le(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ta({...le(this._def),innerType:this,catchValue:t,typeName:T.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return qa.create(this,e)}readonly(){return Pa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Vv=/^c[^\s-]{8,}$/i,zv=/^[0-9a-z]+$/,Gv=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Wv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Jv=/^[a-z0-9_-]{21}$/i,Kv=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Xv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Yv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Qv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let fl;const e0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,t0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,r0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,n0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,s0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,a0=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,n_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",i0=new RegExp(`^${n_}$`);function s_(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function o0(r){return new RegExp(`^${s_(r)}$`)}function a_(r){let e=`${n_}T${s_(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function l0(r,e){return!!((e==="v4"||!e)&&e0.test(r)||(e==="v6"||!e)&&r0.test(r))}function u0(r,e){if(!Kv.test(r))return!1;try{const[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function c0(r,e){return!!((e==="v4"||!e)&&t0.test(r)||(e==="v6"||!e)&&n0.test(r))}class Qt extends he{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==G.string){const a=this._getOrReturnCtx(e);return B(a,{code:R.invalid_type,expected:G.string,received:a.parsedType}),ie}const n=new ot;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),B(s,{code:R.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),B(s,{code:R.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?B(s,{code:R.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&B(s,{code:R.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")Yv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"email",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")fl||(fl=new RegExp(Qv,"u")),fl.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"emoji",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")Wv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"uuid",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")Jv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"nanoid",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")Vv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"cuid",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")zv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"cuid2",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")Gv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"ulid",code:R.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),B(s,{validation:"url",code:R.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"regex",code:R.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?a_(a).test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?i0.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?o0(a).test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{code:R.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?Xv.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"duration",code:R.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?l0(e.data,a.version)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"ip",code:R.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?u0(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"jwt",code:R.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?c0(e.data,a.version)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"cidr",code:R.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?s0.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"base64",code:R.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?a0.test(e.data)||(s=this._getOrReturnCtx(e,s),B(s,{validation:"base64url",code:R.invalid_string,message:a.message}),n.dirty()):we.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:R.invalid_string,...J.errToObj(n)})}_addCheck(e){return new Qt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...J.errToObj(e)})}url(e){return this._addCheck({kind:"url",...J.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...J.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...J.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...J.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...J.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...J.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...J.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...J.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...J.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...J.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...J.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...J.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...J.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...J.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...J.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...J.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...J.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...J.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...J.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...J.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...J.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...J.errToObj(t)})}nonempty(e){return this.min(1,J.errToObj(e))}trim(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Qt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Qt.create=r=>{var e;return new Qt({checks:[],typeName:T.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...le(r)})};function d0(r,e){const t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,a=parseInt(r.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class on extends he{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==G.number){const a=this._getOrReturnCtx(e);return B(a,{code:R.invalid_type,expected:G.number,received:a.parsedType}),ie}let n;const s=new ot;for(const a of this._def.checks)a.kind==="int"?we.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:R.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?d0(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),B(n,{code:R.not_finite,message:a.message}),s.dirty()):we.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,n,s){return new on({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:J.toString(s)}]})}_addCheck(e){return new on({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:J.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:J.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:J.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:J.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&we.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}on.create=r=>new on({checks:[],typeName:T.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...le(r)});class ln extends he{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==G.bigint)return this._getInvalidInput(e);let n;const s=new ot;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),B(n,{code:R.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):we.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return B(t,{code:R.invalid_type,expected:G.bigint,received:t.parsedType}),ie}gte(e,t){return this.setLimit("min",e,!0,J.toString(t))}gt(e,t){return this.setLimit("min",e,!1,J.toString(t))}lte(e,t){return this.setLimit("max",e,!0,J.toString(t))}lt(e,t){return this.setLimit("max",e,!1,J.toString(t))}setLimit(e,t,n,s){return new ln({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:J.toString(s)}]})}_addCheck(e){return new ln({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:J.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:J.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:J.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:J.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:J.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ln.create=r=>{var e;return new ln({checks:[],typeName:T.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...le(r)})};class _a extends he{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==G.boolean){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.boolean,received:n.parsedType}),ie}return _t(e.data)}}_a.create=r=>new _a({typeName:T.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...le(r)});class $n extends he{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==G.date){const a=this._getOrReturnCtx(e);return B(a,{code:R.invalid_type,expected:G.date,received:a.parsedType}),ie}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return B(a,{code:R.invalid_date}),ie}const n=new ot;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),B(s,{code:R.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),B(s,{code:R.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):we.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new $n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:J.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:J.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}$n.create=r=>new $n({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:T.ZodDate,...le(r)});class Gi extends he{_parse(e){if(this._getType(e)!==G.symbol){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.symbol,received:n.parsedType}),ie}return _t(e.data)}}Gi.create=r=>new Gi({typeName:T.ZodSymbol,...le(r)});class ya extends he{_parse(e){if(this._getType(e)!==G.undefined){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.undefined,received:n.parsedType}),ie}return _t(e.data)}}ya.create=r=>new ya({typeName:T.ZodUndefined,...le(r)});class ba extends he{_parse(e){if(this._getType(e)!==G.null){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.null,received:n.parsedType}),ie}return _t(e.data)}}ba.create=r=>new ba({typeName:T.ZodNull,...le(r)});class ps extends he{constructor(){super(...arguments),this._any=!0}_parse(e){return _t(e.data)}}ps.create=r=>new ps({typeName:T.ZodAny,...le(r)});class On extends he{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _t(e.data)}}On.create=r=>new On({typeName:T.ZodUnknown,...le(r)});class Ur extends he{_parse(e){const t=this._getOrReturnCtx(e);return B(t,{code:R.invalid_type,expected:G.never,received:t.parsedType}),ie}}Ur.create=r=>new Ur({typeName:T.ZodNever,...le(r)});class Wi extends he{_parse(e){if(this._getType(e)!==G.undefined){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.void,received:n.parsedType}),ie}return _t(e.data)}}Wi.create=r=>new Wi({typeName:T.ZodVoid,...le(r)});class tr extends he{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==G.array)return B(t,{code:R.invalid_type,expected:G.array,received:t.parsedType}),ie;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(B(t,{code:i?R.too_big:R.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(B(t,{code:R.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(B(t,{code:R.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new Sr(t,i,t.path,o)))).then(i=>ot.mergeArray(n,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new Sr(t,i,t.path,o)));return ot.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new tr({...this._def,minLength:{value:e,message:J.toString(t)}})}max(e,t){return new tr({...this._def,maxLength:{value:e,message:J.toString(t)}})}length(e,t){return new tr({...this._def,exactLength:{value:e,message:J.toString(t)}})}nonempty(e){return this.min(1,e)}}tr.create=(r,e)=>new tr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...le(e)});function Wn(r){if(r instanceof Fe){const e={};for(const t in r.shape){const n=r.shape[t];e[t]=rr.create(Wn(n))}return new Fe({...r._def,shape:()=>e})}else return r instanceof tr?new tr({...r._def,type:Wn(r.element)}):r instanceof rr?rr.create(Wn(r.unwrap())):r instanceof cn?cn.create(Wn(r.unwrap())):r instanceof Or?Or.create(r.items.map(e=>Wn(e))):r}class Fe extends he{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=we.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==G.object){const u=this._getOrReturnCtx(e);return B(u,{code:R.invalid_type,expected:G.object,received:u.parsedType}),ie}const{status:n,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ur&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const l=[];for(const u of i){const c=a[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Sr(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ur){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(B(s,{code:R.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Sr(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>ot.mergeObjectSync(n,u)):ot.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return J.errToObj,new Fe({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,a,i,o;const l=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=J.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Fe({...this._def,unknownKeys:"strip"})}passthrough(){return new Fe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Fe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Fe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Fe({...this._def,catchall:e})}pick(e){const t={};return we.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new Fe({...this._def,shape:()=>t})}omit(e){const t={};return we.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new Fe({...this._def,shape:()=>t})}deepPartial(){return Wn(this)}partial(e){const t={};return we.objectKeys(this.shape).forEach(n=>{const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new Fe({...this._def,shape:()=>t})}required(e){const t={};return we.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof rr;)a=a._def.innerType;t[n]=a}}),new Fe({...this._def,shape:()=>t})}keyof(){return i_(we.objectKeys(this.shape))}}Fe.create=(r,e)=>new Fe({shape:()=>r,unknownKeys:"strip",catchall:Ur.create(),typeName:T.ZodObject,...le(e)});Fe.strictCreate=(r,e)=>new Fe({shape:()=>r,unknownKeys:"strict",catchall:Ur.create(),typeName:T.ZodObject,...le(e)});Fe.lazycreate=(r,e)=>new Fe({shape:r,unknownKeys:"strip",catchall:Ur.create(),typeName:T.ZodObject,...le(e)});class wa extends he{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new Dt(o.ctx.common.issues));return B(t,{code:R.invalid_union,unionErrors:i}),ie}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of n){const u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new Dt(l));return B(t,{code:R.invalid_union,unionErrors:o}),ie}}get options(){return this._def.options}}wa.create=(r,e)=>new wa({options:r,typeName:T.ZodUnion,...le(e)});const Rr=r=>r instanceof Ea?Rr(r.schema):r instanceof ar?Rr(r.innerType()):r instanceof Sa?[r.value]:r instanceof un?r.options:r instanceof Oa?we.objectValues(r.enum):r instanceof Aa?Rr(r._def.innerType):r instanceof ya?[void 0]:r instanceof ba?[null]:r instanceof rr?[void 0,...Rr(r.unwrap())]:r instanceof cn?[null,...Rr(r.unwrap())]:r instanceof cd||r instanceof Pa?Rr(r.unwrap()):r instanceof Ta?Rr(r._def.innerType):[];class Mo extends he{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==G.object)return B(t,{code:R.invalid_type,expected:G.object,received:t.parsedType}),ie;const n=this.discriminator,s=t.data[n],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(B(t,{code:R.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ie)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const s=new Map;for(const a of t){const i=Rr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Mo({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...le(n)})}}function ec(r,e){const t=$r(r),n=$r(e);if(r===e)return{valid:!0,data:r};if(t===G.object&&n===G.object){const s=we.objectKeys(e),a=we.objectKeys(r).filter(o=>s.indexOf(o)!==-1),i={...r,...e};for(const o of a){const l=ec(r[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===G.array&&n===G.array){if(r.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],l=ec(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===G.date&&n===G.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class va extends he{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(a,i)=>{if(Yu(a)||Yu(i))return ie;const o=ec(a.value,i.value);return o.valid?((Qu(a)||Qu(i))&&t.dirty(),{status:t.value,value:o.data}):(B(n,{code:R.invalid_intersection_types}),ie)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}va.create=(r,e,t)=>new va({left:r,right:e,typeName:T.ZodIntersection,...le(t)});class Or extends he{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==G.array)return B(n,{code:R.invalid_type,expected:G.array,received:n.parsedType}),ie;if(n.data.length<this._def.items.length)return B(n,{code:R.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ie;!this._def.rest&&n.data.length>this._def.items.length&&(B(n,{code:R.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Sr(n,i,n.path,o)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>ot.mergeArray(t,i)):ot.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Or({...this._def,rest:e})}}Or.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Or({items:r,typeName:T.ZodTuple,rest:null,...le(e)})};class xa extends he{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==G.object)return B(n,{code:R.invalid_type,expected:G.object,received:n.parsedType}),ie;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in n.data)s.push({key:a._parse(new Sr(n,o,n.path,o)),value:i._parse(new Sr(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?ot.mergeObjectAsync(t,s):ot.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof he?new xa({keyType:e,valueType:t,typeName:T.ZodRecord,...le(n)}):new xa({keyType:Qt.create(),valueType:e,typeName:T.ZodRecord,...le(t)})}}class Ji extends he{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==G.map)return B(n,{code:R.invalid_type,expected:G.map,received:n.parsedType}),ie;const s=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([o,l],u)=>({key:s._parse(new Sr(n,o,n.path,[u,"key"])),value:a._parse(new Sr(n,l,n.path,[u,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return ie;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of i){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return ie;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}}Ji.create=(r,e,t)=>new Ji({valueType:e,keyType:r,typeName:T.ZodMap,...le(t)});class Nn extends he{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==G.set)return B(n,{code:R.invalid_type,expected:G.set,received:n.parsedType}),ie;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(B(n,{code:R.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(B(n,{code:R.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(l){const u=new Set;for(const c of l){if(c.status==="aborted")return ie;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}const o=[...n.data.values()].map((l,u)=>a._parse(new Sr(n,l,n.path,u)));return n.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new Nn({...this._def,minSize:{value:e,message:J.toString(t)}})}max(e,t){return new Nn({...this._def,maxSize:{value:e,message:J.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Nn.create=(r,e)=>new Nn({valueType:r,minSize:null,maxSize:null,typeName:T.ZodSet,...le(e)});class us extends he{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==G.function)return B(t,{code:R.invalid_type,expected:G.function,received:t.parsedType}),ie;function n(o,l){return Vi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Zi(),hs].filter(u=>!!u),issueData:{code:R.invalid_arguments,argumentsError:l}})}function s(o,l){return Vi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Zi(),hs].filter(u=>!!u),issueData:{code:R.invalid_return_type,returnTypeError:l}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof ms){const o=this;return _t(async function(...l){const u=new Dt([]),c=await o._def.args.parseAsync(l,a).catch(h=>{throw u.addIssue(n(l,h)),u}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw u.addIssue(s(d,h)),u})})}else{const o=this;return _t(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new Dt([n(l,u.error)]);const c=Reflect.apply(i,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new Dt([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new us({...this._def,args:Or.create(e).rest(On.create())})}returns(e){return new us({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new us({args:e||Or.create([]).rest(On.create()),returns:t||On.create(),typeName:T.ZodFunction,...le(n)})}}class Ea extends he{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ea.create=(r,e)=>new Ea({getter:r,typeName:T.ZodLazy,...le(e)});class Sa extends he{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return B(t,{received:t.data,code:R.invalid_literal,expected:this._def.value}),ie}return{status:"valid",value:e.data}}get value(){return this._def.value}}Sa.create=(r,e)=>new Sa({value:r,typeName:T.ZodLiteral,...le(e)});function i_(r,e){return new un({values:r,typeName:T.ZodEnum,...le(e)})}class un extends he{constructor(){super(...arguments),Vs.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return B(t,{expected:we.joinValues(n),received:t.parsedType,code:R.invalid_type}),ie}if(zi(this,Vs)||r_(this,Vs,new Set(this._def.values)),!zi(this,Vs).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return B(t,{received:t.data,code:R.invalid_enum_value,options:n}),ie}return _t(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return un.create(e,{...this._def,...t})}exclude(e,t=this._def){return un.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}Vs=new WeakMap;un.create=i_;class Oa extends he{constructor(){super(...arguments),zs.set(this,void 0)}_parse(e){const t=we.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==G.string&&n.parsedType!==G.number){const s=we.objectValues(t);return B(n,{expected:we.joinValues(s),received:n.parsedType,code:R.invalid_type}),ie}if(zi(this,zs)||r_(this,zs,new Set(we.getValidEnumValues(this._def.values))),!zi(this,zs).has(e.data)){const s=we.objectValues(t);return B(n,{received:n.data,code:R.invalid_enum_value,options:s}),ie}return _t(e.data)}get enum(){return this._def.values}}zs=new WeakMap;Oa.create=(r,e)=>new Oa({values:r,typeName:T.ZodNativeEnum,...le(e)});class ms extends he{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==G.promise&&t.common.async===!1)return B(t,{code:R.invalid_type,expected:G.promise,received:t.parsedType}),ie;const n=t.parsedType===G.promise?t.data:Promise.resolve(t.data);return _t(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ms.create=(r,e)=>new ms({type:r,typeName:T.ZodPromise,...le(e)});class ar extends he{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{B(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return ie;const l=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return l.status==="aborted"?ie:l.status==="dirty"||t.value==="dirty"?Kn(l.value):l});{if(t.value==="aborted")return ie;const o=this._def.schema._parseSync({data:i,path:n.path,parent:n});return o.status==="aborted"?ie:o.status==="dirty"||t.value==="dirty"?Kn(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?ie:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?ie:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Cn(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Cn(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);we.assertNever(s)}}ar.create=(r,e,t)=>new ar({schema:r,typeName:T.ZodEffects,effect:e,...le(t)});ar.createWithPreprocess=(r,e,t)=>new ar({schema:e,effect:{type:"preprocess",transform:r},typeName:T.ZodEffects,...le(t)});class rr extends he{_parse(e){return this._getType(e)===G.undefined?_t(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rr.create=(r,e)=>new rr({innerType:r,typeName:T.ZodOptional,...le(e)});class cn extends he{_parse(e){return this._getType(e)===G.null?_t(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}cn.create=(r,e)=>new cn({innerType:r,typeName:T.ZodNullable,...le(e)});class Aa extends he{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===G.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Aa.create=(r,e)=>new Aa({innerType:r,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...le(e)});class Ta extends he{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ga(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Dt(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Dt(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Ta.create=(r,e)=>new Ta({innerType:r,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...le(e)});class Ki extends he{_parse(e){if(this._getType(e)!==G.nan){const n=this._getOrReturnCtx(e);return B(n,{code:R.invalid_type,expected:G.nan,received:n.parsedType}),ie}return{status:"valid",value:e.data}}}Ki.create=r=>new Ki({typeName:T.ZodNaN,...le(r)});const f0=Symbol("zod_brand");class cd extends he{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class qa extends he{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ie:a.status==="dirty"?(t.dirty(),Kn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ie:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new qa({in:e,out:t,typeName:T.ZodPipeline})}}class Pa extends he{_parse(e){const t=this._def.innerType._parse(e),n=s=>(Cn(s)&&(s.value=Object.freeze(s.value)),s);return ga(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}Pa.create=(r,e)=>new Pa({innerType:r,typeName:T.ZodReadonly,...le(e)});function Ff(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function o_(r,e={},t){return r?ps.create().superRefine((n,s)=>{var a,i;const o=r(n);if(o instanceof Promise)return o.then(l=>{var u,c;if(!l){const d=Ff(e,n),f=(c=(u=d.fatal)!==null&&u!==void 0?u:t)!==null&&c!==void 0?c:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const l=Ff(e,n),u=(i=(a=l.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0;s.addIssue({code:"custom",...l,fatal:u})}}):ps.create()}const h0={object:Fe.lazycreate};var T;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(T||(T={}));const p0=(r,e={message:`Input not instance of ${r.name}`})=>o_(t=>t instanceof r,e),l_=Qt.create,u_=on.create,m0=Ki.create,g0=ln.create,c_=_a.create,_0=$n.create,y0=Gi.create,b0=ya.create,w0=ba.create,v0=ps.create,x0=On.create,E0=Ur.create,S0=Wi.create,O0=tr.create,A0=Fe.create,T0=Fe.strictCreate,P0=wa.create,I0=Mo.create,k0=va.create,R0=Or.create,C0=xa.create,$0=Ji.create,N0=Nn.create,j0=us.create,L0=Ea.create,M0=Sa.create,D0=un.create,F0=Oa.create,U0=ms.create,Uf=ar.create,B0=rr.create,H0=cn.create,q0=ar.createWithPreprocess,Z0=qa.create,V0=()=>l_().optional(),z0=()=>u_().optional(),G0=()=>c_().optional(),W0={string:r=>Qt.create({...r,coerce:!0}),number:r=>on.create({...r,coerce:!0}),boolean:r=>_a.create({...r,coerce:!0}),bigint:r=>ln.create({...r,coerce:!0}),date:r=>$n.create({...r,coerce:!0})},J0=ie;var An=Object.freeze({__proto__:null,defaultErrorMap:hs,setErrorMap:qv,getErrorMap:Zi,makeIssue:Vi,EMPTY_PATH:Zv,addIssueToContext:B,ParseStatus:ot,INVALID:ie,DIRTY:Kn,OK:_t,isAborted:Yu,isDirty:Qu,isValid:Cn,isAsync:ga,get util(){return we},get objectUtil(){return Xu},ZodParsedType:G,getParsedType:$r,ZodType:he,datetimeRegex:a_,ZodString:Qt,ZodNumber:on,ZodBigInt:ln,ZodBoolean:_a,ZodDate:$n,ZodSymbol:Gi,ZodUndefined:ya,ZodNull:ba,ZodAny:ps,ZodUnknown:On,ZodNever:Ur,ZodVoid:Wi,ZodArray:tr,ZodObject:Fe,ZodUnion:wa,ZodDiscriminatedUnion:Mo,ZodIntersection:va,ZodTuple:Or,ZodRecord:xa,ZodMap:Ji,ZodSet:Nn,ZodFunction:us,ZodLazy:Ea,ZodLiteral:Sa,ZodEnum:un,ZodNativeEnum:Oa,ZodPromise:ms,ZodEffects:ar,ZodTransformer:ar,ZodOptional:rr,ZodNullable:cn,ZodDefault:Aa,ZodCatch:Ta,ZodNaN:Ki,BRAND:f0,ZodBranded:cd,ZodPipeline:qa,ZodReadonly:Pa,custom:o_,Schema:he,ZodSchema:he,late:h0,get ZodFirstPartyTypeKind(){return T},coerce:W0,any:v0,array:O0,bigint:g0,boolean:c_,date:_0,discriminatedUnion:I0,effect:Uf,enum:D0,function:j0,instanceof:p0,intersection:k0,lazy:L0,literal:M0,map:$0,nan:m0,nativeEnum:F0,never:E0,null:w0,nullable:H0,number:u_,object:A0,oboolean:G0,onumber:z0,optional:B0,ostring:V0,pipeline:Z0,preprocess:q0,promise:U0,record:C0,set:N0,strictObject:T0,string:l_,symbol:y0,transformer:Uf,tuple:R0,undefined:b0,union:P0,unknown:x0,void:S0,NEVER:J0,ZodIssueCode:R,quotelessJson:Hv,ZodError:Dt}),$s={exports:{}},hl={},pl,Bf;function K0(){if(Bf)return pl;Bf=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return pl=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var a=this._errors[s],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=n&&(t=a,n=o)}return t},pl}var Hf;function X0(){return Hf||(Hf=1,function(r){var e=K0();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<n.retries;i++)a.push(this.createTimeout(i,n));return t&&t.forever&&!a.length&&a.push(this.createTimeout(i,n)),a.sort(function(o,l){return o-l}),a},r.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,a=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return a=Math.min(a,n.maxTimeout),a},r.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],l=t[o];t[o]=(function(c){var d=r.operation(n),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(t,f)})}).bind(t,l),t[o].options=n}}}(hl)),hl}var ml,qf;function Y0(){return qf||(qf=1,ml=X0()),ml}var Zf;function Q0(){if(Zf)return $s.exports;Zf=1;const r=Y0(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const n=(i,o,l)=>{const u=l.retries-(o-1);return i.attemptNumber=o,i.retriesLeft=u,i},s=i=>e.includes(i),a=(i,o)=>new Promise((l,u)=>{o={onFailedAttempt:()=>{},retries:10,...o};const c=r.operation(o);c.attempt(async d=>{try{l(await i(d))}catch(f){if(!(f instanceof Error)){u(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)c.stop(),u(f.originalError);else if(f instanceof TypeError&&!s(f.message))c.stop(),u(f);else{n(f,d,o);try{await o.onFailedAttempt(f)}catch(h){u(h);return}c.retry(f)||u(c.mainError())}}})});return $s.exports=a,$s.exports.default=a,$s.exports.AbortError=t,$s.exports}var ex=Q0();const Xi=xs(ex),tx=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ta(r){return typeof r=="string"&&tx.test(r)}var Qe=[];for(var gl=0;gl<256;++gl)Qe.push((gl+256).toString(16).slice(1));function rx(r,e=0){return(Qe[r[e+0]]+Qe[r[e+1]]+Qe[r[e+2]]+Qe[r[e+3]]+"-"+Qe[r[e+4]]+Qe[r[e+5]]+"-"+Qe[r[e+6]]+Qe[r[e+7]]+"-"+Qe[r[e+8]]+Qe[r[e+9]]+"-"+Qe[r[e+10]]+Qe[r[e+11]]+Qe[r[e+12]]+Qe[r[e+13]]+Qe[r[e+14]]+Qe[r[e+15]]).toLowerCase()}var oi,nx=new Uint8Array(16);function sx(){if(!oi&&(oi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oi(nx)}var ax=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Vf={randomUUID:ax};function ht(r,e,t){if(Vf.randomUUID&&!r)return Vf.randomUUID();r=r||{};var n=r.random||(r.rng||sx)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,rx(n)}var li={},_l={exports:{}},zf;function ix(){return zf||(zf=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],h]:l._events[p].push(h):(l._events[p]=h,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,p){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,b,y;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,f),!0;case 5:return g.fn.call(g.context,c,d,f,h),!0;case 6:return g.fn.call(g.context,c,d,f,h,p),!0}for(y=1,b=new Array(_-1);y<_;y++)b[y-1]=arguments[y];g.fn.apply(g.context,b)}else{var v=g.length,E;for(y=0;y<v;y++)switch(g[y].once&&this.removeListener(u,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,c);break;case 3:g[y].fn.call(g[y].context,c,d);break;case 4:g[y].fn.call(g[y].context,c,d,f);break;default:if(!b)for(E=1,b=new Array(_-1);E<_;E++)b[E-1]=arguments[E];g[y].fn.apply(g[y].context,b)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var m=0,g=[],_=p.length;m<_;m++)(p[m].fn!==c||f&&!p[m].once||d&&p[m].context!==d)&&g.push(p[m]);g.length?this._events[h]=g.length===1?g[0]:g:i(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(_l)),_l.exports}var Ns={exports:{}},yl,Gf;function ox(){return Gf||(Gf=1,yl=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))),yl}var Wf;function lx(){if(Wf)return Ns.exports;Wf=1;const r=ox();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(n,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(n);return}const l=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const u=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,c=a instanceof Error?a:new e(u);typeof n.cancel=="function"&&n.cancel(),o(c)},s);r(n.then(i,o),()=>{clearTimeout(l)})});return Ns.exports=t,Ns.exports.default=t,Ns.exports.TimeoutError=e,Ns.exports}var ui={},ci={},Jf;function ux(){if(Jf)return ci;Jf=1,Object.defineProperty(ci,"__esModule",{value:!0});function r(e,t,n){let s=0,a=e.length;for(;a>0;){const i=a/2|0;let o=s+i;n(e[o],t)<=0?(s=++o,a-=i+1):a=i}return s}return ci.default=r,ci}var Kf;function cx(){if(Kf)return ui;Kf=1,Object.defineProperty(ui,"__esModule",{value:!0});const r=ux();class e{constructor(){this._queue=[]}enqueue(n,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=r.default(this._queue,a,(o,l)=>l.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(s=>s.priority===n.priority).map(s=>s.run)}get size(){return this._queue.length}}return ui.default=e,ui}var Xf;function dx(){if(Xf)return li;Xf=1,Object.defineProperty(li,"__esModule",{value:!0});const r=ix(),e=lx(),t=cx(),n=()=>{},s=new e.TimeoutError;class a extends r{constructor(o){var l,u,c,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(u=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(c=o.interval)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((u,c)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&c(s)});u(await f)}catch(f){c(f)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async u=>this.add(u,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return li.default=a,li}var fx=dx();const Fr=xs(fx),hx=(...r)=>fetch(...r),px=Symbol.for("ls:fetch_implementation"),Y=()=>globalThis[px]??hx,mx=[400,401,403,404,405,406,407,408],gx=[409];let Yf=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Fr?this.queue=new Fr.default({concurrency:this.maxConcurrency}):this.queue=new Fr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const n=this.onFailedResponseHook;return this.queue.add(()=>Xi(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(mx.includes(+i))throw s;if(gx.includes(+i))return;n&&await n(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>Y()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function Qf(r){return typeof(r==null?void 0:r._getType)=="function"}function eh(r){const e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}function ce(r,e){if(!ta(r)){const t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}const th={};function d_(r){th[r]||(console.warn(r),th[r]=!0)}var di={exports:{}},bl,rh;function Do(){if(rh)return bl;rh=1;const r="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=e-6;return bl={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},bl}var wl,nh;function Fo(){if(nh)return wl;nh=1;var r={};return wl=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},wl}var sh;function Za(){return sh||(sh=1,function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Do(),a=Fo();e=r.exports={};const i=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[f,n]],p=g=>{for(const[_,b]of h)g=g.split(`${_}*`).join(`${_}{0,${b}}`).split(`${_}+`).join(`${_}{1,${b}}`);return g},m=(g,_,b)=>{const y=p(_),v=d++;a(g,v,_),c[g]=v,l[v]=_,u[v]=y,i[v]=new RegExp(_,b?"g":void 0),o[v]=new RegExp(y,b?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(di,di.exports)),di.exports}var vl,ah;function dd(){if(ah)return vl;ah=1;const r=Object.freeze({loose:!0}),e=Object.freeze({});return vl=n=>n?typeof n!="object"?r:n:e,vl}var xl,ih;function f_(){if(ih)return xl;ih=1;const r=/^[0-9]+$/,e=(n,s)=>{const a=r.test(n),i=r.test(s);return a&&i&&(n=+n,s=+s),n===s?0:a&&!i?-1:i&&!a?1:n<s?-1:1};return xl={compareIdentifiers:e,rcompareIdentifiers:(n,s)=>e(s,n)},xl}var El,oh;function yt(){if(oh)return El;oh=1;const r=Fo(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Do(),{safeRe:n,safeSrc:s,t:a}=Za(),i=dd(),{compareIdentifiers:o}=f_();class l{constructor(c,d){if(d=i(d),c instanceof l){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);r("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const f=c.trim().match(d.loose?n[a.LOOSE]:n[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<t)return p}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(r("SemVer.compare",this.version,this.options,c),!(c instanceof l)){if(typeof c=="string"&&c===this.version)return 0;c=new l(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof l||(c=new l(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof l||(c=new l(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const f=this.prerelease[d],h=c.prerelease[d];if(r("prerelease compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}compareBuild(c){c instanceof l||(c=new l(c,this.options));let d=0;do{const f=this.build[d],h=c.build[d];if(r("build compare",d,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++d)}inc(c,d,f){if(c.startsWith("pre")){if(!d&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const h=new RegExp(`^${this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]}$`),p=`-${d}`.match(h);if(!p||p[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,f),this.inc("pre",d,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,f),this.inc("pre",d,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(d){let p=[d,h];f===!1&&(p=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return El=l,El}var Sl,lh;function As(){if(lh)return Sl;lh=1;const r=yt();return Sl=(t,n,s=!1)=>{if(t instanceof r)return t;try{return new r(t,n)}catch(a){if(!s)return null;throw a}},Sl}var Ol,uh;function _x(){if(uh)return Ol;uh=1;const r=As();return Ol=(t,n)=>{const s=r(t,n);return s?s.version:null},Ol}var Al,ch;function yx(){if(ch)return Al;ch=1;const r=As();return Al=(t,n)=>{const s=r(t.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Al}var Tl,dh;function bx(){if(dh)return Tl;dh=1;const r=yt();return Tl=(t,n,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(n,a,i).version}catch{return null}},Tl}var Pl,fh;function wx(){if(fh)return Pl;fh=1;const r=As();return Pl=(t,n)=>{const s=r(t,null,!0),a=r(n,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,l=o?s:a,u=o?a:s,c=!!l.prerelease.length;if(!!u.prerelease.length&&!c){if(!u.patch&&!u.minor)return"major";if(u.compareMain(l)===0)return u.minor&&!u.patch?"minor":"patch"}const f=c?"pre":"";return s.major!==a.major?f+"major":s.minor!==a.minor?f+"minor":s.patch!==a.patch?f+"patch":"prerelease"},Pl}var Il,hh;function vx(){if(hh)return Il;hh=1;const r=yt();return Il=(t,n)=>new r(t,n).major,Il}var kl,ph;function xx(){if(ph)return kl;ph=1;const r=yt();return kl=(t,n)=>new r(t,n).minor,kl}var Rl,mh;function Ex(){if(mh)return Rl;mh=1;const r=yt();return Rl=(t,n)=>new r(t,n).patch,Rl}var Cl,gh;function Sx(){if(gh)return Cl;gh=1;const r=As();return Cl=(t,n)=>{const s=r(t,n);return s&&s.prerelease.length?s.prerelease:null},Cl}var $l,_h;function or(){if(_h)return $l;_h=1;const r=yt();return $l=(t,n,s)=>new r(t,s).compare(new r(n,s)),$l}var Nl,yh;function Ox(){if(yh)return Nl;yh=1;const r=or();return Nl=(t,n,s)=>r(n,t,s),Nl}var jl,bh;function Ax(){if(bh)return jl;bh=1;const r=or();return jl=(t,n)=>r(t,n,!0),jl}var Ll,wh;function fd(){if(wh)return Ll;wh=1;const r=yt();return Ll=(t,n,s)=>{const a=new r(t,s),i=new r(n,s);return a.compare(i)||a.compareBuild(i)},Ll}var Ml,vh;function Tx(){if(vh)return Ml;vh=1;const r=fd();return Ml=(t,n)=>t.sort((s,a)=>r(s,a,n)),Ml}var Dl,xh;function Px(){if(xh)return Dl;xh=1;const r=fd();return Dl=(t,n)=>t.sort((s,a)=>r(a,s,n)),Dl}var Fl,Eh;function Uo(){if(Eh)return Fl;Eh=1;const r=or();return Fl=(t,n,s)=>r(t,n,s)>0,Fl}var Ul,Sh;function hd(){if(Sh)return Ul;Sh=1;const r=or();return Ul=(t,n,s)=>r(t,n,s)<0,Ul}var Bl,Oh;function h_(){if(Oh)return Bl;Oh=1;const r=or();return Bl=(t,n,s)=>r(t,n,s)===0,Bl}var Hl,Ah;function p_(){if(Ah)return Hl;Ah=1;const r=or();return Hl=(t,n,s)=>r(t,n,s)!==0,Hl}var ql,Th;function pd(){if(Th)return ql;Th=1;const r=or();return ql=(t,n,s)=>r(t,n,s)>=0,ql}var Zl,Ph;function md(){if(Ph)return Zl;Ph=1;const r=or();return Zl=(t,n,s)=>r(t,n,s)<=0,Zl}var Vl,Ih;function m_(){if(Ih)return Vl;Ih=1;const r=h_(),e=p_(),t=Uo(),n=pd(),s=hd(),a=md();return Vl=(o,l,u,c)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return r(o,u,c);case"!=":return e(o,u,c);case">":return t(o,u,c);case">=":return n(o,u,c);case"<":return s(o,u,c);case"<=":return a(o,u,c);default:throw new TypeError(`Invalid operator: ${l}`)}},Vl}var zl,kh;function Ix(){if(kh)return zl;kh=1;const r=yt(),e=As(),{safeRe:t,t:n}=Za();return zl=(a,i)=>{if(a instanceof r)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const h=i.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const l=o[2],u=o[3]||"0",c=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",f=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${u}.${c}${d}${f}`,i)},zl}var Gl,Rh;function kx(){if(Rh)return Gl;Rh=1;class r{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,n)}return this}}return Gl=r,Gl}var Wl,Ch;function lr(){if(Ch)return Wl;Ch=1;const r=/\s+/g;class e{constructor(C,H){if(H=s(H),C instanceof e)return C.loose===!!H.loose&&C.includePrerelease===!!H.includePrerelease?C:new e(C.raw,H);if(C instanceof a)return this.raw=C.value,this.set=[[C]],this.formatted=void 0,this;if(this.options=H,this.loose=!!H.loose,this.includePrerelease=!!H.includePrerelease,this.raw=C.trim().replace(r," "),this.set=this.raw.split("||").map(M=>this.parseRange(M.trim())).filter(M=>M.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const M=this.set[0];if(this.set=this.set.filter(F=>!m(F[0])),this.set.length===0)this.set=[M];else if(this.set.length>1){for(const F of this.set)if(F.length===1&&g(F[0])){this.set=[F];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let C=0;C<this.set.length;C++){C>0&&(this.formatted+="||");const H=this.set[C];for(let M=0;M<H.length;M++)M>0&&(this.formatted+=" "),this.formatted+=H[M].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(C){const M=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+C,F=n.get(M);if(F)return F;const W=this.options.loose,te=W?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];C=C.replace(te,re(this.options.includePrerelease)),i("hyphen replace",C),C=C.replace(l[u.COMPARATORTRIM],c),i("comparator trim",C),C=C.replace(l[u.TILDETRIM],d),i("tilde trim",C),C=C.replace(l[u.CARETTRIM],f),i("caret trim",C);let ue=C.split(" ").map(Le=>b(Le,this.options)).join(" ").split(/\s+/).map(Le=>Z(Le,this.options));W&&(ue=ue.filter(Le=>(i("loose invalid filter",Le,this.options),!!Le.match(l[u.COMPARATORLOOSE])))),i("range list",ue);const Q=new Map,Ee=ue.map(Le=>new a(Le,this.options));for(const Le of Ee){if(m(Le))return[Le];Q.set(Le.value,Le)}Q.size>1&&Q.has("")&&Q.delete("");const Be=[...Q.values()];return n.set(M,Be),Be}intersects(C,H){if(!(C instanceof e))throw new TypeError("a Range is required");return this.set.some(M=>_(M,H)&&C.set.some(F=>_(F,H)&&M.every(W=>F.every(te=>W.intersects(te,H)))))}test(C){if(!C)return!1;if(typeof C=="string")try{C=new o(C,this.options)}catch{return!1}for(let H=0;H<this.set.length;H++)if(ye(this.set[H],C,this.options))return!0;return!1}}Wl=e;const t=kx(),n=new t,s=dd(),a=Bo(),i=Fo(),o=yt(),{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=Za(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=Do(),m=L=>L.value==="<0.0.0-0",g=L=>L.value==="",_=(L,C)=>{let H=!0;const M=L.slice();let F=M.pop();for(;H&&M.length;)H=M.every(W=>F.intersects(W,C)),F=M.pop();return H},b=(L,C)=>(i("comp",L,C),L=A(L,C),i("caret",L),L=v(L,C),i("tildes",L),L=O(L,C),i("xrange",L),L=K(L,C),i("stars",L),L),y=L=>!L||L.toLowerCase()==="x"||L==="*",v=(L,C)=>L.trim().split(/\s+/).map(H=>E(H,C)).join(" "),E=(L,C)=>{const H=C.loose?l[u.TILDELOOSE]:l[u.TILDE];return L.replace(H,(M,F,W,te,ue)=>{i("tilde",L,M,F,W,te,ue);let Q;return y(F)?Q="":y(W)?Q=`>=${F}.0.0 <${+F+1}.0.0-0`:y(te)?Q=`>=${F}.${W}.0 <${F}.${+W+1}.0-0`:ue?(i("replaceTilde pr",ue),Q=`>=${F}.${W}.${te}-${ue} <${F}.${+W+1}.0-0`):Q=`>=${F}.${W}.${te} <${F}.${+W+1}.0-0`,i("tilde return",Q),Q})},A=(L,C)=>L.trim().split(/\s+/).map(H=>S(H,C)).join(" "),S=(L,C)=>{i("caret",L,C);const H=C.loose?l[u.CARETLOOSE]:l[u.CARET],M=C.includePrerelease?"-0":"";return L.replace(H,(F,W,te,ue,Q)=>{i("caret",L,F,W,te,ue,Q);let Ee;return y(W)?Ee="":y(te)?Ee=`>=${W}.0.0${M} <${+W+1}.0.0-0`:y(ue)?W==="0"?Ee=`>=${W}.${te}.0${M} <${W}.${+te+1}.0-0`:Ee=`>=${W}.${te}.0${M} <${+W+1}.0.0-0`:Q?(i("replaceCaret pr",Q),W==="0"?te==="0"?Ee=`>=${W}.${te}.${ue}-${Q} <${W}.${te}.${+ue+1}-0`:Ee=`>=${W}.${te}.${ue}-${Q} <${W}.${+te+1}.0-0`:Ee=`>=${W}.${te}.${ue}-${Q} <${+W+1}.0.0-0`):(i("no pr"),W==="0"?te==="0"?Ee=`>=${W}.${te}.${ue}${M} <${W}.${te}.${+ue+1}-0`:Ee=`>=${W}.${te}.${ue}${M} <${W}.${+te+1}.0-0`:Ee=`>=${W}.${te}.${ue} <${+W+1}.0.0-0`),i("caret return",Ee),Ee})},O=(L,C)=>(i("replaceXRanges",L,C),L.split(/\s+/).map(H=>k(H,C)).join(" ")),k=(L,C)=>{L=L.trim();const H=C.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return L.replace(H,(M,F,W,te,ue,Q)=>{i("xRange",L,M,F,W,te,ue,Q);const Ee=y(W),Be=Ee||y(te),Le=Be||y(ue),bt=Le;return F==="="&&bt&&(F=""),Q=C.includePrerelease?"-0":"",Ee?F===">"||F==="<"?M="<0.0.0-0":M="*":F&&bt?(Be&&(te=0),ue=0,F===">"?(F=">=",Be?(W=+W+1,te=0,ue=0):(te=+te+1,ue=0)):F==="<="&&(F="<",Be?W=+W+1:te=+te+1),F==="<"&&(Q="-0"),M=`${F+W}.${te}.${ue}${Q}`):Be?M=`>=${W}.0.0${Q} <${+W+1}.0.0-0`:Le&&(M=`>=${W}.${te}.0${Q} <${W}.${+te+1}.0-0`),i("xRange return",M),M})},K=(L,C)=>(i("replaceStars",L,C),L.trim().replace(l[u.STAR],"")),Z=(L,C)=>(i("replaceGTE0",L,C),L.trim().replace(l[C.includePrerelease?u.GTE0PRE:u.GTE0],"")),re=L=>(C,H,M,F,W,te,ue,Q,Ee,Be,Le,bt)=>(y(M)?H="":y(F)?H=`>=${M}.0.0${L?"-0":""}`:y(W)?H=`>=${M}.${F}.0${L?"-0":""}`:te?H=`>=${H}`:H=`>=${H}${L?"-0":""}`,y(Ee)?Q="":y(Be)?Q=`<${+Ee+1}.0.0-0`:y(Le)?Q=`<${Ee}.${+Be+1}.0-0`:bt?Q=`<=${Ee}.${Be}.${Le}-${bt}`:L?Q=`<${Ee}.${Be}.${+Le+1}-0`:Q=`<=${Q}`,`${H} ${Q}`.trim()),ye=(L,C,H)=>{for(let M=0;M<L.length;M++)if(!L[M].test(C))return!1;if(C.prerelease.length&&!H.includePrerelease){for(let M=0;M<L.length;M++)if(i(L[M].semver),L[M].semver!==a.ANY&&L[M].semver.prerelease.length>0){const F=L[M].semver;if(F.major===C.major&&F.minor===C.minor&&F.patch===C.patch)return!0}return!1}return!0};return Wl}var Jl,$h;function Bo(){if($h)return Jl;$h=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(c,d){if(d=t(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const d=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Jl=e;const t=dd(),{safeRe:n,t:s}=Za(),a=m_(),i=Fo(),o=yt(),l=lr();return Jl}var Kl,Nh;function Ho(){if(Nh)return Kl;Nh=1;const r=lr();return Kl=(t,n,s)=>{try{n=new r(n,s)}catch{return!1}return n.test(t)},Kl}var Xl,jh;function Rx(){if(jh)return Xl;jh=1;const r=lr();return Xl=(t,n)=>new r(t,n).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),Xl}var Yl,Lh;function Cx(){if(Lh)return Yl;Lh=1;const r=yt(),e=lr();return Yl=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===-1)&&(i=u,o=new r(i,a))}),i},Yl}var Ql,Mh;function $x(){if(Mh)return Ql;Mh=1;const r=yt(),e=lr();return Ql=(n,s,a)=>{let i=null,o=null,l=null;try{l=new e(s,a)}catch{return null}return n.forEach(u=>{l.test(u)&&(!i||o.compare(u)===1)&&(i=u,o=new r(i,a))}),i},Ql}var eu,Dh;function Nx(){if(Dh)return eu;Dh=1;const r=yt(),e=lr(),t=Uo();return eu=(s,a)=>{s=new e(s,a);let i=new r("0.0.0");if(s.test(i)||(i=new r("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const l=s.set[o];let u=null;l.forEach(c=>{const d=new r(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!u||t(d,u))&&(u=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),u&&(!i||t(i,u))&&(i=u)}return i&&s.test(i)?i:null},eu}var tu,Fh;function jx(){if(Fh)return tu;Fh=1;const r=lr();return tu=(t,n)=>{try{return new r(t,n).range||"*"}catch{return null}},tu}var ru,Uh;function gd(){if(Uh)return ru;Uh=1;const r=yt(),e=Bo(),{ANY:t}=e,n=lr(),s=Ho(),a=Uo(),i=hd(),o=md(),l=pd();return ru=(c,d,f,h)=>{c=new r(c,h),d=new n(d,h);let p,m,g,_,b;switch(f){case">":p=a,m=o,g=i,_=">",b=">=";break;case"<":p=i,m=l,g=a,_="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(c,d,h))return!1;for(let y=0;y<d.set.length;++y){const v=d.set[y];let E=null,A=null;if(v.forEach(S=>{S.semver===t&&(S=new e(">=0.0.0")),E=E||S,A=A||S,p(S.semver,E.semver,h)?E=S:g(S.semver,A.semver,h)&&(A=S)}),E.operator===_||E.operator===b||(!A.operator||A.operator===_)&&m(c,A.semver))return!1;if(A.operator===b&&g(c,A.semver))return!1}return!0},ru}var nu,Bh;function Lx(){if(Bh)return nu;Bh=1;const r=gd();return nu=(t,n,s)=>r(t,n,">",s),nu}var su,Hh;function Mx(){if(Hh)return su;Hh=1;const r=gd();return su=(t,n,s)=>r(t,n,"<",s),su}var au,qh;function Dx(){if(qh)return au;qh=1;const r=lr();return au=(t,n,s)=>(t=new r(t,s),n=new r(n,s),t.intersects(n,s)),au}var iu,Zh;function Fx(){if(Zh)return iu;Zh=1;const r=Ho(),e=or();return iu=(t,n,s)=>{const a=[];let i=null,o=null;const l=t.sort((f,h)=>e(f,h,s));for(const f of l)r(f,n,s)?(o=f,i||(i=f)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const u=[];for(const[f,h]of a)f===h?u.push(f):!h&&f===l[0]?u.push("*"):h?f===l[0]?u.push(`<=${h}`):u.push(`${f} - ${h}`):u.push(`>=${f}`);const c=u.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return c.length<d.length?c:n},iu}var ou,Vh;function Ux(){if(Vh)return ou;Vh=1;const r=lr(),e=Bo(),{ANY:t}=e,n=Ho(),s=or(),a=(d,f,h={})=>{if(d===f)return!0;d=new r(d,h),f=new r(f,h);let p=!1;e:for(const m of d.set){for(const g of f.set){const _=l(m,g,h);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(d,f,h)=>{if(d===f)return!0;if(d.length===1&&d[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;h.includePrerelease?d=i:d=o}if(f.length===1&&f[0].semver===t){if(h.includePrerelease)return!0;f=o}const p=new Set;let m,g;for(const O of d)O.operator===">"||O.operator===">="?m=u(m,O,h):O.operator==="<"||O.operator==="<="?g=c(g,O,h):p.add(O.semver);if(p.size>1)return null;let _;if(m&&g){if(_=s(m.semver,g.semver,h),_>0)return null;if(_===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const O of p){if(m&&!n(O,String(m),h)||g&&!n(O,String(g),h))return null;for(const k of f)if(!n(O,String(k),h))return!1;return!0}let b,y,v,E,A=g&&!h.includePrerelease&&g.semver.prerelease.length?g.semver:!1,S=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;A&&A.prerelease.length===1&&g.operator==="<"&&A.prerelease[0]===0&&(A=!1);for(const O of f){if(E=E||O.operator===">"||O.operator===">=",v=v||O.operator==="<"||O.operator==="<=",m){if(S&&O.semver.prerelease&&O.semver.prerelease.length&&O.semver.major===S.major&&O.semver.minor===S.minor&&O.semver.patch===S.patch&&(S=!1),O.operator===">"||O.operator===">="){if(b=u(m,O,h),b===O&&b!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(O),h))return!1}if(g){if(A&&O.semver.prerelease&&O.semver.prerelease.length&&O.semver.major===A.major&&O.semver.minor===A.minor&&O.semver.patch===A.patch&&(A=!1),O.operator==="<"||O.operator==="<="){if(y=c(g,O,h),y===O&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(O),h))return!1}if(!O.operator&&(g||m)&&_!==0)return!1}return!(m&&v&&!g&&_!==0||g&&E&&!m&&_!==0||S||A)},u=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p>0?d:p<0||f.operator===">"&&d.operator===">="?f:d},c=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p<0?d:p>0||f.operator==="<"&&d.operator==="<="?f:d};return ou=a,ou}var lu,zh;function Bx(){if(zh)return lu;zh=1;const r=Za(),e=Do(),t=yt(),n=f_(),s=As(),a=_x(),i=yx(),o=bx(),l=wx(),u=vx(),c=xx(),d=Ex(),f=Sx(),h=or(),p=Ox(),m=Ax(),g=fd(),_=Tx(),b=Px(),y=Uo(),v=hd(),E=h_(),A=p_(),S=pd(),O=md(),k=m_(),K=Ix(),Z=Bo(),re=lr(),ye=Ho(),L=Rx(),C=Cx(),H=$x(),M=Nx(),F=jx(),W=gd(),te=Lx(),ue=Mx(),Q=Dx(),Ee=Fx(),Be=Ux();return lu={parse:s,valid:a,clean:i,inc:o,diff:l,major:u,minor:c,patch:d,prerelease:f,compare:h,rcompare:p,compareLoose:m,compareBuild:g,sort:_,rsort:b,gt:y,lt:v,eq:E,neq:A,gte:S,lte:O,cmp:k,coerce:K,Comparator:Z,Range:re,satisfies:ye,toComparators:L,maxSatisfying:C,minSatisfying:H,minVersion:M,validRange:F,outside:W,gtr:te,ltr:ue,intersects:Q,simplifyRange:Ee,subset:Be,SemVer:t,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},lu}Bx();function zr(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);const[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${r}`);return[s,a,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}class Hx extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function me(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}n=await r.text();const s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;throw r.status===409?new Hx(s):new Error(s)}var Gh="[...]",qx={result:"[Circular]"},Yi=[],Xn=[];const Zx=new TextEncoder;function Vx(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function fi(r){return Zx.encode(r)}function kt(r,e,t,n){var s;try{const a=JSON.stringify(r,e,t);return fi(a)}catch(a){if(!((s=a.message)!=null&&s.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),fi("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof n>"u"&&(n=Vx()),tc(r,"",0,[],void 0,0,n);let i;try{Xn.length===0?i=JSON.stringify(r,e,t):i=JSON.stringify(r,zx(e),t)}catch{return fi("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Yi.length!==0;){const o=Yi.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return fi(i)}}function uu(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),Yi.push([n,t,e,s])):Xn.push([e,t,r]):(n[t]=r,Yi.push([n,t,e]))}function tc(r,e,t,n,s,a,i){a+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){uu(qx,r,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){uu(Gh,r,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){uu(Gh,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)tc(r[o],o,o,n,r,a,i);else{var l=Object.keys(r);for(o=0;o<l.length;o++){var u=l[o];tc(r[u],u,o,n,r,a,i)}}n.pop()}}function zx(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Xn.length>0)for(var n=0;n<Xn.length;n++){var s=Xn[n];if(s[1]===e&&s[0]===t){t=s[2],Xn.splice(n,1);break}}return r.call(this,e,t)}}function Wh(r){const e=y_(),t=aE(),n=r.extra??{},s=n.metadata;return r.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...s}},r}const Gx=r=>{const e=(r==null?void 0:r.toString())??en("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Wx=r=>{const t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function Jx(r){const e=[];for await(const t of r)e.push(t);return e}function cu(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Kx=async r=>{if((r==null?void 0:r.status)===429){const e=parseInt(r.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function Jh(r){return typeof r=="number"?Number(r.toFixed(4)):r}class Xx{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(a=>{t=a}),s=kt(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),n+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),n+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const Yx=20971520,Qx=2500;class Ia{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Xx}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Tn("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Ia.getDefaultClientConfig();if(this.tracingSampleRate=Gx(e.tracingSamplingRate),this.apiUrl=cu(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=cu(e.apiKey??t.apiKey),this.webUrl=cu(e.webUrl??t.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Yf(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new Yf({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:Kx}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=en("API_KEY"),t=en("ENDPOINT")??"https://api.smith.langchain.com",n=en("HIDE_INPUTS")==="true",s=en("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:Wx(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${g_}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(Y(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(Y(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(o,`Failed to fetch ${e}`);const l=n?n(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(Y(),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const n=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):n.push(s);return n}else{const n=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?n.push(s):this.filteredPostUuids.add(a):n.push(s))}return n}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??Yx}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop(e);if(!n.length){s();break}const a=this._processBatch(n,s).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var n;if(!e.length){t();return}try{const s={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(n=a==null?void 0:a.batch_ingest_config)!=null&&n.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Wh(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await Y()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(Qx),...this.fetchOptions});return await me(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=Wh(s),i=await this.caller.call(Y(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:kt(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let n=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(n.length>0&&s.length>0){const o=n.reduce((u,c)=>(c.id&&(u[c.id]=c),u),{}),l=[];for(const u of s)u.id!==void 0&&o[u.id]?o[u.id]={...o[u.id],...u}:l.push(u);n=Object.values(o),s=l}const a={post:n,patch:s};if(!a.post.length&&!a.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const l=o,u=a[l].reverse();let c=u.pop();for(;c!==void 0;)i[l].push(c),c=u.pop()}(i.post.length>0||i.patch.length>0)&&await this._postBatchIngestRuns(kt(i))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(Y(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const n={};let s=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const c=s.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",s],["patch",a]])for(const f of d){const{inputs:h,outputs:p,events:m,attachments:g,..._}=f,b={inputs:h,outputs:p,events:m},y=kt(_);u.push({name:`${c}.${_.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(const[v,E]of Object.entries(b)){if(E===void 0)continue;const A=kt(E);u.push({name:`${c}.${_.id}.${v}`,payload:new Blob([A],{type:`application/json; length=${A.length}`})})}if(_.id!==void 0){const v=n[_.id];if(v){delete n[_.id];for(const[E,A]of Object.entries(v)){let S,O;if(Array.isArray(A)?[S,O]=A:(S=A.mimeType,O=A.data),E.includes(".")){console.warn(`Skipping attachment '${E}' for run ${_.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${_.id}.${E}`,payload:new Blob([O],{type:`${S}; length=${O.byteLength}`})})}}}l.push(`trace=${_.trace_id},id=${_.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const l of e)s.push(new Blob([`--${n}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${l.name}"\r
`,`Content-Type: ${l.payload.type}\r
\r
`])),s.push(l.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${n}--\r
`]));const i=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(Y(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${t}`)}}async updateRun(e,t){ce(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(Y(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:kt(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ce(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:en("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Jx(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=n[e.id]||[];for(const a in n)a!==e.id&&(s[a].child_runs=n[a]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:g,limit:_,select:b}=e;let y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){const S=Array.isArray(n)?n:[n],O=await Promise.all(S.map(k=>this.readProject({projectName:k}).then(K=>K.id)));y.push(...O)}const v=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],E={session:y.length?y:null,run_type:c,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:_,trace:a,select:b||v,is_root:u};let A=0;for await(const S of this._getCursorPaginatedList("/runs/query",E))if(_){if(A>=_)break;if(S.length+A>_){yield*S.slice(0,_-A);break}A+=S.length,yield*S}else yield*S}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:g}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(A=>this.readProject({projectName:A}).then(S=>S.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:_,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:g}).filter(([A,S])=>S!==void 0));return await(await this.caller.call(Y(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||ht()};ce(e);const a=await(await this.caller.call(Y(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){ce(e);const t=await this.caller.call(Y(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(t,"unshare run",!0)}async readRunSharedLink(e){ce(e);const n=await(await this.caller.call(Y(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)n.append("id",i);return ce(e),await(await this.caller.call(Y(),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ce(e);const s=await(await this.caller.call(Y(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};ce(e);const a=await(await this.caller.call(Y(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){ce(e);const t=await this.caller.call(Y(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(t,"unshare dataset",!0)}async readSharedDataset(e){return ce(e),await(await this.caller.call(Y(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const n={};t!=null&&t.exampleIds&&(n.id=t.exampleIds);const s=new URLSearchParams;Object.entries(n).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const a=await this.caller.call(Y(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};n&&(u.metadata=n);const c={name:e,extra:u,description:t};i!==null&&(c.reference_dataset_id=i);const d=await this.caller.call(Y(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;s&&(l={...l||{},metadata:s});const u={name:t,extra:l,description:n,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(Y(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ce(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(Y(),`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ce(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,ce(n);const s=await this.caller.call(Y(),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(s,`delete session ${n} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:a,dataType:i,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),n.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);const c=await this.caller.call(Y(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(Y(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)ce(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(n,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(const u of n)l.append("id",u);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;ce(a);const i=await this.caller.call(Y(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:s,tag:a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:n})).id;ce(i);const o=await this.caller.call(Y(),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)ce(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(Y(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(a,`delete ${n}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),ce(s);const a={tag:n},i=await this.caller.call(Y(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(i,"index dataset"),await i.json()}async similarExamples(e,t,n,{filter:s}={}){const a={limit:n,inputs:e};s!==void 0&&(a.filter=s),ce(t);const i=await this.caller.call(Y(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,n){var c;if(Kh(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n==null?void 0:n.datasetId:e.dataset_id;const a=t?n==null?void 0:n.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(t?n==null?void 0:n.createdAt:e.created_at)||new Date;let o;Kh(e)?o=e:o={inputs:e,outputs:t,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??ht())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const b=e;let y=b[0].dataset_id;const v=b[0].dataset_name;if(y===void 0&&v===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&v!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:v})).id);const E=await this._uploadExamplesMultipart(y,b);return await Promise.all(E.example_ids.map(S=>this.readExample(S)))}const{inputs:t,outputs:n,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:u,exampleIds:c,datasetId:d,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let h=d;const p=f;if(h===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(await this.readDataset({datasetName:p})).id);const m=t.map((b,y)=>({dataset_id:h,inputs:b,outputs:n==null?void 0:n[y],metadata:s==null?void 0:s[y],split:a==null?void 0:a[y],id:c==null?void 0:c[y],attachments:u==null?void 0:u[y],source_run_id:i==null?void 0:i[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:l==null?void 0:l[y]})),g=await this._uploadExamplesMultipart(h,m);return await Promise.all(g.example_ids.map(b=>this.readExample(b)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const s=e.map(i=>Qf(i)?eh(i):i),a=Qf(t)?eh(t):t;return this.createExample({input:s},{output:a},n)}async readExample(e){ce(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...a}=n,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:u,filter:c,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:f}),p=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;p&&h.append("as_of",p);const m=i??!0;if(h.append("inline_s3_urls",m.toString()),n!==void 0)for(const _ of n)h.append("id",_);if(a!==void 0)for(const _ of a)h.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);h.append("metadata",_)}l!==void 0&&h.append("limit",l.toString()),u!==void 0&&h.append("offset",u.toString()),c!==void 0&&h.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>h.append("select",_));let g=0;for await(const _ of this._getPaginated("/examples",h)){for(const b of _){const{attachment_urls:y,...v}=b,E=v;y&&(E.attachments=Object.entries(y).reduce((A,[S,O])=>(A[S.slice(11)]={presigned_url:O.presigned_url,mime_type:O.mime_type||void 0},A),{})),yield E,g++}if(l!==void 0&&g>=l)break}}async deleteExample(e){ce(e);const t=`/examples/${e}`,n=await this.caller.call(Y(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n;t?n=e:n=e.id,ce(n);let s;t?s={id:n,...t}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,ce(a),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(Y(),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,ce(s);const a=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,ce(i);const o={split_name:n,examples:s.map(u=>(ce(u),u)),remove:a},l=await this.caller.call(Y(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){d_("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a),[l,u]=await this._logEvaluationFeedback(o,i,n);return u[0]}async createFeedback(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var b;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((b=p.metadata.__run)==null?void 0:b.run_id)!==void 0&&ce(p.metadata.__run.run_id);const m={id:c??ht(),run_id:e,key:t,score:Jh(n),value:s,correction:a,comment:i,feedback_source:p,comparative_experiment_id:h,feedbackConfig:d,session_id:f},g=`${this.apiUrl}/feedback`,_=await this.caller.call(Y(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(_,"create feedback",!0),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:a}){const i={};t!=null&&(i.score=Jh(t)),n!=null&&(i.value=n),s!=null&&(i.correction=s),a!=null&&(i.comment=a),ce(e);const o=await this.caller.call(Y(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(o,"update feedback",!0)}async readFeedback(e){ce(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ce(e);const t=`/feedback/${e}`,n=await this.caller.call(Y(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(n,`delete ${t}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const a of t)s.append("key",a);if(n)for(const a of n)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){const a={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?a.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(a.expires_in=n):a.expires_in={hours:3},await(await this.caller.call(Y(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:a,metadata:i,id:o}){var c;if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:a,created_at:(c=s??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(Y(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){ce(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=n||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,n){const[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:n,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((l,u)=>{ce(l,`queueIds[${u}]`),i.append("ids",l)}),n&&i.append("name",n),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:n,queueId:s}=e,a={name:t,description:n,id:s||ht()},i=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:n,description:s}=t,a=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(a,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>ce(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${ce(e,"queueId")}/run`,s=await this.caller.call(Y(),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/runs/${ce(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(Y(),`${this.apiUrl}/annotation-queues/${ce(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(Y(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const s=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,s,a]=zr(e),i=await this.caller.call(Y(),`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[t,n,s]=zr(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){const[t,n,s]=zr(e),a=await this.caller.call(Y(),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await me(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t!=null&&t.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=zr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},l=await this.caller.call(Y(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=zr(e),o=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(Y(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(u,"create commit");const c=await u.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const l of t){const u=l.id,c={...l.metadata&&{metadata:l.metadata},...l.split&&{split:l.split}},d=kt(c),f=new Blob([d],{type:"application/json"});if(n.append(u,f),l.inputs){const h=kt(l.inputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.inputs`,p)}if(l.outputs){const h=kt(l.outputs),p=new Blob([h],{type:"application/json"});n.append(`${u}.outputs`,p)}if(l.attachments)for(const[h,p]of Object.entries(l.attachments)){let m,g;Array.isArray(p)?[m,g]=p:(m=p.mimeType,g=p.data);const _=new Blob([g],{type:`${m}; length=${g.byteLength}`});n.append(`${u}.attachment.${h}`,_)}if(l.attachments_operations){const h=kt(l.attachments_operations),p=new Blob([h],{type:"application/json"});n.append(`${u}.attachments_operations`,p)}}const s=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(Y(),`${this.apiUrl}/v1/platform/datasets/${s}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const n=new FormData;for(const i of t){const o=(i.id??ht()).toString(),l={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=kt(l),c=new Blob([u],{type:"application/json"});if(n.append(o,c),i.inputs){const d=kt(i.inputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,f)}if(i.outputs){const d=kt(i.outputs),f=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,f)}if(i.attachments)for(const[d,f]of Object.entries(i.attachments)){let h,p;Array.isArray(f)?[h,p]=f:(h=f.mimeType,p=f.data);const m=new Blob([p],{type:`${h}; length=${p.byteLength}`});n.append(`${o}.attachment.${d}`,m)}}return await(await this.caller.call(Y(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s]=zr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(Y(),`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await me(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,s]=zr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(Y(),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[n,s,a]=zr(e),i=await this.caller.call(Y(),`${this.apiUrl}/commits/${n}/${s}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await me(i,"pull prompt commit");const o=await i.json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,n),o=new Ia({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(i),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return ce(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=n){const o=i[i.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function Kh(r){return"dataset_id"in r||"dataset_name"in r}const g_="0.3.15";var ra={};let Ir;const eE=()=>typeof window<"u"&&typeof window.document<"u",tE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",rE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),__=()=>typeof Deno<"u",nE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!__(),sE=()=>Ir||(eE()?Ir="browser":nE()?Ir="node":tE()?Ir="webworker":rE()?Ir="jsdom":__()?Ir="deno":Ir="other",Ir);let du;function y_(){if(du===void 0){const r=sE(),e=oE();du={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:g_,...e}}return du}function aE(){const r=iE()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,s]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function iE(){try{return typeof process<"u"&&ra?Object.entries(ra).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function Tn(r){try{return typeof process<"u"?ra==null?void 0:ra[r]:void 0}catch{return}}function en(r){return Tn(`LANGSMITH_${r}`)||Tn(`LANGCHAIN_${r}`)}let fu;function oE(){if(fu!==void 0)return fu;const r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of r){const n=Tn(t);n!==void 0&&(e[t]=n)}return fu=e,e}const lE=r=>!!["TRACING_V2","TRACING"].find(t=>en(t)==="true"),hu=Symbol.for("lc:context_variables");function uE(r){return r.replace(/[-:.]/g,"")}function cE(r,e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return uE(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}class Qi{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let n={},s=[];for(const a of t){const[i,o]=a.split("="),l=decodeURIComponent(o);i==="langsmith-metadata"?n=JSON.parse(l):i==="langsmith-tags"&&(s=l.split(","))}return new Qi(n,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Nt{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),b_(e)){Object.assign(this,{...e});return}const t=Nt.getDefaultConfig(),{metadata:n,...s}=e,a=s.client??Nt.getSharedClient(),i={...n,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=cE(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}static getDefaultConfig(){return{id:ht(),run_type:"chain",project_name:en("PROJECT")??Tn("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Tn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Tn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Nt.sharedClient||(Nt.sharedClient=new Ia),Nt.sharedClient}createChild(e){var l,u,c,d,f,h;const t=this.child_execution_order+1,n=new Nt({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});hu in this&&(n[hu]=this[hu]);const s=Symbol.for("lc:child_config"),a=((l=e.extra)==null?void 0:l[s])??this.extra[s];if(fE(a)){const p={...a},m=dE(p.callbacks)?(c=(u=p.callbacks).copy)==null?void 0:c.call(u):void 0;m&&(Object.assign(m,{_parentRunId:n.id}),(h=(f=(d=m.handlers)==null?void 0:d.find(w_))==null?void 0:f.updateFromRunTree)==null||h.call(f,n),p.callbacks=m),n.extra[s]=p}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){var l;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[u,c]of Object.entries(t))s.runtime[u]||(s.runtime[u]=c);let a,i;return n?(i=(l=e.parent_run)==null?void 0:l.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=y_(),n=await this._convertToCreate(this,t,!0);if(await this.client.createRun(n),!e){d_("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var u,c,d,f;const n=e==null?void 0:e.callbacks;let s,a,i,o=lE();if(n){const h=((u=n==null?void 0:n.getParentRunId)==null?void 0:u.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(m=>(m==null?void 0:m.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),a=p==null?void 0:p.projectName,i=p==null?void 0:p.client,o=o||!!p}return s?new Nt({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=s==null?void 0:s.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Nt({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(c=>{const[d,f]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=i[0].uuid,l={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=i.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:a};if(n.baggage&&typeof n.baggage=="string"){const c=Qi.fromHeader(n.baggage);l.metadata=c.metadata,l.tags=c.tags}return new Nt(l)}toHeaders(e){var n;const t={"langsmith-trace":this.dotted_order,baggage:new Qi((n=this.extra)==null?void 0:n.metadata,this.tags).toHeader()};if(e)for(const[s,a]of Object.entries(t))e.set(s,a);return t}}Object.defineProperty(Nt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function b_(r){return r!==void 0&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function w_(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Xh(r){return Array.isArray(r)&&r.some(e=>w_(e))}function dE(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function fE(r){var e;return r!==void 0&&typeof r.callbacks=="object"&&(Xh((e=r.callbacks)==null?void 0:e.handlers)||Xh(r.callbacks))}let hE=class{getStore(){}run(e,t){return t()}};const pu=Symbol.for("ls:tracing_async_local_storage"),pE=new hE;let mE=class{getInstance(){return globalThis[pu]??pE}initializeGlobalInstance(e){globalThis[pu]===void 0&&(globalThis[pu]=e)}};const gE=new mE,_E=()=>{const r=gE.getInstance().getStore();if(!b_(r))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return r};function _d(r){return typeof r=="function"&&"langsmith:traceable"in r}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const yE=Object.prototype.hasOwnProperty;function rc(r,e){return yE.call(r,e)}function nc(r){if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)rc(r,t)&&e.push(t);return e}function br(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function sc(r){let e=0;const t=r.length;let n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Zn(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function bE(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function ac(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ac(r[t]))return!0}else if(typeof r=="object"){const t=nc(r),n=t.length;for(var e=0;e<n;e++)if(ac(r[t[e]]))return!0}}return!1}function Yh(r,e){const t=[r];for(const n in e){const s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}class wE extends Error{constructor(e,t,n,s,a){super(Yh(e,{name:t,index:n,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=Yh(e,{name:t,index:n,operation:s,tree:a})}}const He=wE,Yn={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=ic(t,this.path);n&&(n=br(n));const s=na(t,{op:"remove",path:this.from}).removed;return na(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){const n=ic(t,this.from);return na(t,{op:"add",path:this.path,value:br(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:to(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}};var vE={add:function(r,e,t){return sc(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Yn.move,copy:Yn.copy,test:Yn.test,_get:Yn._get};function ic(r,e){if(e=="")return r;var t={op:"_get",path:e};return na(r,t),t.value}function na(r,e,t=!1,n=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):oc(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=ic(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=to(r,e.value),i.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new He("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,r);return i}}else{n||(r=br(r));const o=(e.path||"").split("/");let l=r,u=1,c=o.length,d,f,h;for(typeof t=="function"?h=t:h=oc;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=bE(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,r,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(t&&!sc(f))throw new He("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,r);sc(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>l.length)throw new He("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,r);const p=vE[e.op].call(e,l,f,r);if(p.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}}else if(u>=c){const p=Yn[e.op].call(e,l,f,r);if(p.test===!1)throw new He("Test operation failed","TEST_OPERATION_FAILED",a,e,r);return p}if(l=l[f],t&&u<c&&(!l||typeof l!="object"))throw new He("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,r)}}}function eo(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new He("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=br(r));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=na(r,e[i],t,!0,s,i),r=a[i].newDocument;return a.newDocument=r,a}function oc(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new He("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Yn[r.op]){if(typeof r.path!="string")throw new He("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new He('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new He("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new He("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&ac(r.value))throw new He("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,a=n.split("/").length;if(s!==a+1&&s!==a)throw new He("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new He("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},o=xE([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new He("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new He("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function xE(r,e,t){try{if(!Array.isArray(r))throw new He("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)eo(br(e),br(r),t||!0);else{t=t||oc;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof He)return s;throw s}}function to(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,a,i;if(t&&n){if(a=r.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!to(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!to(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function v_(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=nc(e),i=nc(r),o=!1,l=i.length-1;l>=0;l--){var u=i[l],c=r[u];if(rc(e,u)&&!(e[u]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?v_(c,d,t,n+"/"+Zn(u),s):c!==d&&(s&&t.push({op:"test",path:n+"/"+Zn(u),value:br(c)}),t.push({op:"replace",path:n+"/"+Zn(u),value:br(d)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Zn(u),value:br(c)}),t.push({op:"remove",path:n+"/"+Zn(u)}),o=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}))}if(!(!o&&a.length==i.length))for(var l=0;l<a.length;l++){var u=a[l];!rc(r,u)&&e[u]!==void 0&&t.push({op:"add",path:n+"/"+Zn(u),value:br(e[u])})}}}function EE(r,e,t=!1){var n=[];return v_(r,e,n,"",t),n}var mu={};const SE=()=>typeof window<"u"&&typeof window.document<"u",OE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",AE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),yd=()=>typeof Deno<"u",TE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!yd(),PE=()=>{let r;return SE()?r="browser":TE()?r="node":OE()?r="webworker":AE()?r="jsdom":yd()?r="deno":r="other",r};let gu;async function IE(){return gu===void 0&&(gu={library:"langchain-js",runtime:PE()}),gu}function vr(r){try{return typeof process<"u"?mu==null?void 0:mu[r]:yd()?Deno==null?void 0:Deno.env.get(r):void 0}catch{return}}class kE{}function RE(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}class Va extends kE{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Xg(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:vr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Rn.prototype.toJSON.call(this)}toJSONNotImplemented(){return Rn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Va{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}return new t}}const CE=r=>{const e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function _u(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function $E(r){return r.replace(/[-:.]/g,"")}function NE(r,e,t){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return $E(`${new Date(r).toISOString().slice(0,-1)}${n}Z`)+e}function js(r){return typeof r._addRunToRunMap=="function"}class za extends Va{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=NE(e.start_time,e.id,e.execution_order),n={...e};if(n.parent_run_id!==void 0){const s=this.runMap.get(n.parent_run_id);s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;return this.runMap.set(n.id,n),n}async _endTrace(e){var n;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForLLMStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChatModelStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,t,n,s,a,i,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,a,i,o,l){var c,d;const u=this.runMap.get(n)??this._createRunForChainStart(e,t,n,s,a,i,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=_u(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=_u(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,t,n,s,a){var o;const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=_u(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForToolStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onToolStart)==null?void 0:c.call(this,l)),l}async handleToolEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var a;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,n))}async handleAgentEnd(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}_createRunForRetrieverStart(e,t,n,s,a,i,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,s,a,i,o){var u,c;const l=this.runMap.get(n)??this._createRunForRetrieverStart(e,t,n,s,a,i,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,l)),l}async handleRetrieverEnd(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;const n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;const n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,a,i){var l;const o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}var ki={exports:{}};ki.exports;var Qh;function jE(){return Qh||(Qh=1,function(r){const t=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,n=(a=0)=>(i,o,l)=>`\x1B[${38+a};2;${i};${o};${l}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,l]of Object.entries(i)){for(const[u,c]of Object.entries(l))i[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=i[u],a.set(c[0],c[1]);Object.defineProperty(i,o,{value:l,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=t(),i.color.ansi16m=n(),i.bgColor.ansi256=t(10),i.bgColor.ansi16m=n(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(r,"exports",{enumerable:!0,get:s})}(ki)),ki.exports}var LE=jE();const x_=xs(LE);function lt(r,e){return`${r.open}${e}${r.close}`}function Ut(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function ep(r){return typeof r=="string"?r.trim():r==null?r:Ut(r,r.toString())}function Gr(r){if(!r.end_time)return"";const e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:vt}=x_;class tp extends za{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?lt(x_.bold,o):o}).join(" > ");return lt(vt.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ut(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[chain/end]")} [${t}] [${Gr(e)}] Exiting Chain run with output: ${Ut(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[chain/error]")} [${t}] [${Gr(e)}] Chain run errored with error: ${Ut(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${lt(vt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ut(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[llm/end]")} [${t}] [${Gr(e)}] Exiting LLM run with output: ${Ut(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[llm/error]")} [${t}] [${Gr(e)}] LLM run errored with error: ${Ut(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${ep(e.inputs.input)}"`)}onToolEnd(e){var n;const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[tool/end]")} [${t}] [${Gr(e)}] Exiting Tool run with output: "${ep((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[tool/error]")} [${t}] [${Gr(e)}] Tool run errored with error: ${Ut(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ut(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.cyan,"[retriever/end]")} [${t}] [${Gr(e)}] Exiting Retriever run with output: ${Ut(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${lt(vt.red,"[retriever/error]")} [${t}] [${Gr(e)}] Retriever run errored with error: ${Ut(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${lt(vt.blue,"[agent/action]")} [${n}] Agent selected action: ${Ut(t.actions[t.actions.length-1],"[action]")}`)}}let yu;const ME=()=>{if(yu===void 0){const r=vr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};yu=new Ia(r)}return yu};class sa extends za{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:s}=e;this.projectName=n??vr("LANGCHAIN_PROJECT")??vr("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??ME();const a=sa.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await IE()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();const s=[t];for(;s.length>0;){const a=s.shift();!a||n.has(a.id)||(n.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},n=[];for(const[s,a]of this.runMap){const i=new Nt({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,n.push([s,a.dotted_order])}n.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(const[s]of n){const a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){const o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return _E()}catch{return}}}const E_=Symbol.for("ls:tracing_async_local_storage"),Ri=Symbol.for("lc:context_variables"),DE=r=>{globalThis[E_]=r},ka=()=>globalThis[E_];let aa;function FE(){const r="default"in Fr?Fr.default:Fr;return new r({autoStart:!0,concurrency:1})}function UE(){return typeof aa>"u"&&(aa=FE()),aa}async function Ge(r,e){if(e===!0){const t=ka();t!==void 0?await t.run(void 0,async()=>r()):await r()}else aa=UE(),aa.add(async()=>{const t=ka();t!==void 0?await t.run(void 0,async()=>r()):await r()})}const BE=r=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>vr(t)==="true");function S_(r){var n;const e=ka();if(e===void 0)return;const t=e.getStore();return(n=t==null?void 0:t[Ri])==null?void 0:n[r]}const HE=Symbol("lc:configure_hooks"),qE=()=>S_(HE)||[];class ZE{setHandler(e){return this.setHandlers([e])}}class qo{constructor(e,t,n,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class VE extends qo{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class rp extends qo{async handleLLMNewToken(e,t,n,s,a,i){await Promise.all(this.handlers.map(o=>Ge(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleLLMEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;if(!i.ignoreLLM)try{await((o=i.handleLLMEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class zE extends qo{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class GE extends qo{getChild(e){const t=new St(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ge(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class St extends ZE{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ht();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return js(f)&&f._createRunForLLMStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),Ge(async()=>{var h;try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new rp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{const d=c===0&&n?n:ht();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return js(f)&&f._createRunForChatModelStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),Ge(async()=>{var h,p;try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=e_(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new rp(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return js(l)&&l._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),Ge(async()=>{var u;try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new zE(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return js(l)&&l._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Ge(async()=>{var u;try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new GE(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=ht(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return js(l)&&l._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),Ge(async()=>{var u;try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new VE(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,a){await Promise.all(this.handlers.map(i=>Ge(async()=>{var o;if(!i.ignoreCustomEvent)try{await((o=i.handleCustomEvent)==null?void 0:o.call(i,e,t,n,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new St(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);n.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);n.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)n.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends Va{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,a,i,o){return this._configureSync(e,t,n,s,a,i,o)}static _configureSync(e,t,n,s,a,i,o){var f,h;let l;(e||t)&&(Array.isArray(e)||!e?(l=new St,l.setHandlers((e==null?void 0:e.map(ro))??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(ro):t==null?void 0:t.handlers,!1));const u=vr("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=((f=sa.getTraceableRunTree())==null?void 0:f.tracingEnabled)||BE(),d=c||(vr("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new St),u&&!l.handlers.some(p=>p.name===tp.prototype.name)){const p=new tp;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new sa;l.addHandler(p,!0),l._parentRunId=((h=sa.getTraceableRunTree())==null?void 0:h.id)??l._parentRunId}}for(const{contextVar:p,inheritable:m=!0,handlerClass:g,envVar:_}of qE()){const b=_&&vr(_)==="true"&&g;let y;const v=p!==void 0?S_(p):void 0;v&&CE(v)?y=v:b&&(y=new g({})),y!==void 0&&(l||(l=new St),l.handlers.some(E=>E.name===y.name)||l.addHandler(y,m))}return(n||s)&&l&&(l.addTags(n??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}function ro(r){return"name"in r?r:Va.fromMethods(r)}class WE{getStore(){}run(e,t){return t()}enterWith(e){}}const JE=new WE,np=Symbol.for("lc:child_config");class KE{getInstance(){return ka()??JE}getRunnableConfig(){var t,n;return(n=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:n[np]}runWithConfig(e,t,n){var c;const s=St._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),i=a.getStore(),o=s==null?void 0:s.getParentRunId(),l=(c=s==null?void 0:s.handlers)==null?void 0:c.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let u;return l&&o?u=l.convertToRunTree(o):n||(u=new Nt({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[np]:e}),i!==void 0&&i[Ri]!==void 0&&(u===void 0&&(u={}),u[Ri]=i[Ri]),a.run(u,t)}initializeGlobalInstance(e){ka()===void 0&&DE(e)}}const dn=new KE,bu=25;async function nr(r){return St._configureSync(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function sp(...r){const e={};for(const t of r.filter(n=>!!n))for(const n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){const s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){const s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(ro(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(ro(o),!0);e.callbacks=i}else e.callbacks=new St(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=n;e[s]=t[s]??e[s]}return e}const XE=new Set(["string","number","boolean"]);function Te(r){var n;const e=dn.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:a,...i}=e;t=Object.entries(i).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),t)}if(r&&(t=Object.entries(r).reduce((s,[a,i])=>(i!==void 0&&(s[a]=i),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))XE.has(typeof t.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function at(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:a,runId:i}={}){const o=Te(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function gs(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function fn(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Ft extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Ft({start(n){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){n.close();return}return n.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Ft({async pull(t){const{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function O_(r,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const a=await r.next();for(const i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function sr(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){const t={...r};for(const[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=sr(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}class Ts{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((n,s)=>{dn.runWithConfig(gs(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,s):this.firstResult.then(a=>n(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?dn.runWithConfig(gs(this.config),this.signal?async()=>fn(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function YE(r,e,t,n,...s){const a=new Ts({generator:e,startSetup:t,signal:n}),i=await a.setup;return{output:r(a,i,...s),setup:i}}class Xr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=eo({},t);return new Ra({ops:t,state:n[n.length-1].newDocument})}}class Ra extends Xr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=eo(this.state,e.ops);return new Ra({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=eo({},e.ops);return new Ra({ops:e.ops,state:t[t.length-1].newDocument})}}const QE=r=>r.name==="log_stream_tracer";async function ap(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function ip(r,e){const{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function eS(r){return r!==void 0&&r.message!==void 0}class op extends za{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Xr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Xr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await ap(e,this._schemaFormat)),await this.writer.write(new Xr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await ap(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await ip(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Xr({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Xr({ops:[{op:"replace",path:"/final_output",value:await ip(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?eS(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new an({id:`run-${e.id}`,content:t}):i=t;const o=new Xr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}const lp="__run";class _s{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new _s({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class jn extends _s{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new jn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function hi({name:r,serialized:e}){return r!==void 0?r:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const tS=r=>r.name==="event_stream_tracer";class rS extends za{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new _s({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(l=>{o=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:a(s.runType,n.value)}},s),yield n.value;for await(const u of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:a(s.runType,u)}},s),yield u}finally{o()}}else{yield n.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var i,o;const t=hi(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,n){const s=this.runInfoMap.get(e.id);let a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?a=new an({content:t,id:`run-${e.id}`}):a=n.chunk.message;else if(s.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?a=new _s({text:t}):a=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var i,o,l;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(i=e.outputs)==null?void 0:i.generations;let a;if(t.runType==="chat_model"){for(const u of s??[]){if(a!==void 0)break;a=(o=u[0])==null?void 0:o.message}n="on_chat_model_end"}else if(t.runType==="llm")a={generations:s==null?void 0:s.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var i,o;const t=hi(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,a;const t=hi(e),n={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},n)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,i;const t=hi(e),s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((i=e.extra)==null?void 0:i.metadata)??{}},s)}async onRetrieverEnd(e){var n;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const nS=[400,401,402,403,404,405,406,407,409],sS=r=>{var t,n;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const e=((t=r==null?void 0:r.response)==null?void 0:t.status)??(r==null?void 0:r.status);if(e&&nS.includes(+e))throw r;if(((n=r==null?void 0:r.error)==null?void 0:n.code)==="insufficient_quota"){const s=new Error(r==null?void 0:r.message);throw s.name="InsufficientQuotaError",s}};class bd{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??sS;const t="default"in Fr?Fr.default:Fr;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Xi(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class A_ extends za{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function wd(r){return r?r.lc_runnable:!1}class aS{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),n}}const iS=Symbol("Let zodToJsonSchema decide on which parser to use"),oS={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},lS=r=>({...oS,...r}),uS=r=>{const e=lS(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function T_(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function ke(r,e,t,n,s){r[e]=t,T_(r,e,n,s)}function cS(){return{}}function dS(r,e){var n,s,a;const t={type:"array"};return(n=r.type)!=null&&n._def&&((a=(s=r.type)==null?void 0:s._def)==null?void 0:a.typeName)!==T.ZodAny&&(t.items=Pe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&ke(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&ke(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(ke(t,"minItems",r.exactLength.value,r.exactLength.message,e),ke(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function fS(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?ke(t,"minimum",n.value,n.message,e):ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ke(t,"maximum",n.value,n.message,e):ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":ke(t,"multipleOf",n.value,n.message,e);break}return t}function hS(){return{type:"boolean"}}function P_(r,e){return Pe(r.type._def,e)}const pS=(r,e)=>Pe(r.innerType._def,e);function I_(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>I_(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return mS(r,e)}}const mS=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":ke(t,"minimum",n.value,n.message,e);break;case"max":ke(t,"maximum",n.value,n.message,e);break}return t};function gS(r,e){return{...Pe(r.innerType._def,e),default:r.defaultValue()}}function _S(r,e){return e.effectStrategy==="input"?Pe(r.schema._def,e):{}}function yS(r){return{type:"string",enum:Array.from(r.values)}}const bS=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function wS(r,e){const t=[Pe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Pe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(bS(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function vS(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let wu;const Vt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(wu===void 0&&(wu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),wu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function k_(r,e){const t={type:"string"};if(r.checks)for(const n of r.checks)switch(n.kind){case"min":ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":zt(t,"email",n.message,e);break;case"format:idn-email":zt(t,"idn-email",n.message,e);break;case"pattern:zod":ut(t,Vt.email,n.message,e);break}break;case"url":zt(t,"uri",n.message,e);break;case"uuid":zt(t,"uuid",n.message,e);break;case"regex":ut(t,n.regex,n.message,e);break;case"cuid":ut(t,Vt.cuid,n.message,e);break;case"cuid2":ut(t,Vt.cuid2,n.message,e);break;case"startsWith":ut(t,RegExp(`^${vu(n.value,e)}`),n.message,e);break;case"endsWith":ut(t,RegExp(`${vu(n.value,e)}$`),n.message,e);break;case"datetime":zt(t,"date-time",n.message,e);break;case"date":zt(t,"date",n.message,e);break;case"time":zt(t,"time",n.message,e);break;case"duration":zt(t,"duration",n.message,e);break;case"length":ke(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),ke(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{ut(t,RegExp(vu(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&zt(t,"ipv4",n.message,e),n.version!=="v4"&&zt(t,"ipv6",n.message,e);break}case"base64url":ut(t,Vt.base64url,n.message,e);break;case"jwt":ut(t,Vt.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&ut(t,Vt.ipv4Cidr,n.message,e),n.version!=="v4"&&ut(t,Vt.ipv6Cidr,n.message,e);break}case"emoji":ut(t,Vt.emoji(),n.message,e);break;case"ulid":{ut(t,Vt.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{zt(t,"binary",n.message,e);break}case"contentEncoding:base64":{ke(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{ut(t,Vt.base64,n.message,e);break}}break}case"nanoid":ut(t,Vt.nanoid,n.message,e)}return t}function vu(r,e){return e.patternStrategy==="escape"?ES(r):r}const xS=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ES(r){let e="";for(let t=0;t<r.length;t++)xS.has(r[t])||(e+="\\"),e+=r[t];return e}function zt(r,e,t,n){var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):ke(r,"format",e,t,n)}function ut(r,e,t,n){var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:up(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):ke(r,"pattern",up(e,n),t,n)}function up(r,e){var l;if(!e.applyRegexFlags||!r.flags)return r.source;const t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source;let s="",a=!1,i=!1,o=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(t.i){if(i){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&((l=n[u+2])!=null&&l.match(/[a-z]/))?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=i?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:i&&n[u]==="]"?i=!1:!i&&n[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function R_(r,e){var n,s,a,i,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===T.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>({...u,[c]:Pe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Pe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===T.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=k_(r.keyType._def,e);return{...t,propertyNames:c}}else{if(((i=r.keyType)==null?void 0:i._def.typeName)===T.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(((o=r.keyType)==null?void 0:o._def.typeName)===T.ZodBranded&&r.keyType._def.type._def.typeName===T.ZodString&&((l=r.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=P_(r.keyType._def,e);return{...t,propertyNames:c}}}return t}function SS(r,e){if(e.mapStrategy==="record")return R_(r,e);const t=Pe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Pe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function OS(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function AS(){return{not:{}}}function TS(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const no={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function PS(r,e){if(e.target==="openApi3")return cp(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in no&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=no[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return cp(r,e)}const cp=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Pe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function IS(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:no[r.innerType._def.typeName],nullable:!0}:{type:[no[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Pe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=Pe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function kS(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",T_(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?ke(t,"minimum",n.value,n.message,e):ke(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ke(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ke(t,"maximum",n.value,n.message,e):ke(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ke(t,"maximum",n.value,n.message,e));break;case"multipleOf":ke(t,"multipleOf",n.value,n.message,e);break}return t}function RS(r,e){const t=e.target==="openAi",n={type:"object",properties:{}},s=[],a=r.shape();for(const o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let u=$S(l);u&&t&&(l instanceof rr&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=Pe(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(n.properties[o]=c,u||s.push(o))}s.length&&(n.required=s);const i=CS(r,e);return i!==void 0&&(n.additionalProperties=i),n}function CS(r,e){if(r.catchall._def.typeName!=="ZodNever")return Pe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function $S(r){try{return r.isOptional()}catch{return!0}}const NS=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Pe(r.innerType._def,e);const t=Pe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},jS=(r,e)=>{if(e.pipeStrategy==="input")return Pe(r.in._def,e);if(e.pipeStrategy==="output")return Pe(r.out._def,e);const t=Pe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Pe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function LS(r,e){return Pe(r.type._def,e)}function MS(r,e){const n={type:"array",uniqueItems:!0,items:Pe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&ke(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&ke(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function DS(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Pe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Pe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Pe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function FS(){return{not:{}}}function US(){return{}}const BS=(r,e)=>Pe(r.innerType._def,e),HS=(r,e,t)=>{switch(e){case T.ZodString:return k_(r,t);case T.ZodNumber:return kS(r,t);case T.ZodObject:return RS(r,t);case T.ZodBigInt:return fS(r,t);case T.ZodBoolean:return hS();case T.ZodDate:return I_(r,t);case T.ZodUndefined:return FS();case T.ZodNull:return TS(t);case T.ZodArray:return dS(r,t);case T.ZodUnion:case T.ZodDiscriminatedUnion:return PS(r,t);case T.ZodIntersection:return wS(r,t);case T.ZodTuple:return DS(r,t);case T.ZodRecord:return R_(r,t);case T.ZodLiteral:return vS(r,t);case T.ZodEnum:return yS(r);case T.ZodNativeEnum:return OS(r);case T.ZodNullable:return IS(r,t);case T.ZodOptional:return NS(r,t);case T.ZodMap:return SS(r,t);case T.ZodSet:return MS(r,t);case T.ZodLazy:return()=>r.getter()._def;case T.ZodPromise:return LS(r,t);case T.ZodNaN:case T.ZodNever:return AS();case T.ZodEffects:return _S(r,t);case T.ZodAny:return cS();case T.ZodUnknown:return US();case T.ZodDefault:return gS(r,t);case T.ZodBranded:return P_(r,t);case T.ZodReadonly:return BS(r,t);case T.ZodCatch:return pS(r,t);case T.ZodPipeline:return jS(r,t);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(n=>{})()}};function Pe(r,e,t=!1){var o;const n=e.seen.get(r);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,r,e,n,t);if(l!==iS)return l}if(n&&!t){const l=qS(n,e);if(l!==void 0)return l}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=HS(r,r.typeName,e),i=typeof a=="function"?Pe(a(),e):a;if(i&&VS(r,e,i),e.postProcess){const l=e.postProcess(i,r,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}const qS=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:ZS(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},ZS=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},VS=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),Ga=(r,e)=>{const t=uS(e),n=void 0,s=e==null?void 0:e.name,a=Pe(r._def,t,!1)??{},i=s===void 0?n?{...a,[t.definitionPath]:n}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:a}};return t.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function xu(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}const zS=["*","_","`"];function GS(r){let e="";for(const[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function WS(r,e,t){const{firstNode:n,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{};let u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const h="default",p={[h]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),s!==void 0&&(p[s]="{0}([{1}]):::last");for(const[m,g]of Object.entries(r)){const _=g.name.split(":").pop()??"";let y=zS.some(E=>_.startsWith(E)&&_.endsWith(E))?`<p>${_}</p>`:_;Object.keys(g.metadata??{}).length&&(y+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([E,A])=>`${E} = ${A}`).join(`
`)}</em></small>`);const v=(p[m]??p[h]).replace("{0}",xu(m)).replace("{1}",y);u+=`	${v}
`}}const c={};for(const h of e){const p=h.source.split(":"),m=h.target.split(":"),g=p.filter((_,b)=>_===m[b]).join(":");c[g]||(c[g]=[]),c[g].push(h)}const d=new Set;function f(h,p){const m=h.length===1&&h[0].source===h[0].target;if(p&&!m){const g=p.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),u+=`	subgraph ${g}
`}for(const g of h){const{source:_,target:b,data:y,conditional:v}=g;let E="";if(y!==void 0){let A=y;const S=A.split(" ");S.length>l&&(A=Array.from({length:Math.ceil(S.length/l)},(O,k)=>S.slice(k*l,(k+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),E=v?` -. &nbsp;${A}&nbsp; .-> `:` -- &nbsp;${A}&nbsp; --> `}else E=v?" -.-> ":" --> ";u+=`	${xu(_)}${E}${xu(b)};
`}for(const g in c)g.startsWith(`${p}:`)&&g!==p&&f(c[g],g);p&&!m&&(u+=`	end
`)}f(c[""]??[],"");for(const h in c)!h.includes(":")&&h!==""&&f(c[h],h);return i&&(u+=GS(a??{})),u}async function JS(r,e){let{backgroundColor:t="white"}=e??{};const n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${n}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function KS(r,e){if(r!==void 0&&!ta(r))return r;if(wd(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function XS(r){return wd(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Ga(r.data.schema),title:r.data.name}}}class Zo{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=ta(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...XS(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??ht(),a={id:s,data:e,name:KS(t,e),metadata:n};return this.nodes[s]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(a),a}firstNode(){return dp(this)}lastNode(){return fp(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(u=>u.id).every(ta)&&(n="");const a=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[a(u)]={...c,id:a(u)}});const i=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];const o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&dp(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&fp(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const n=s=>{const a=e[s];return ta(s)&&t.get(a)===1?a:s};return new Zo({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[n(s),{...a,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},i=this.reid(),o=i.firstNode(),l=i.lastNode();return WS(i.nodes,i.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return JS(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function dp(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function fp(r,e=[]){const t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(const s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function YS(r){const e=new TextEncoder,t=new ReadableStream({async start(n){for await(const s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Ft.fromReadableStream(t)}function hp(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}const QS=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function lc(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*pp(r,e){for(;;){const{value:t,done:n}=dn.runWithConfig(gs(r),e.next.bind(e),!0);if(n)break;yield t}}async function*uc(r,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:n,done:s}=await dn.runWithConfig(gs(r),t.next.bind(e),!0);if(s)break;yield n}}function Ke(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}class Xe extends Rn{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Pn({bound:this,kwargs:e,config:{}})}map(){return new so({bound:this})}withRetry(e){return new eO({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Pn({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new rO({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Te);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>Te(a===0?e:n))}return Array.from({length:t},()=>Te(e))}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=((l=s[0])==null?void 0:l.maxConcurrency)??(n==null?void 0:n.maxConcurrency),i=new bd({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>i.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(n!=null&&n.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Te(t),s=new Ts({generator:this._streamIterator(e,n),config:n});return await s.setup,Ft.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Te(e):t=Te({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const s=Te(n),a=await nr(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),Ke(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,t,s,i);o=await fn(l,n==null?void 0:n.signal)}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(Ke(o,"output"))),o}async _batchWithConfig(e,t,n,s){var u;const a=this._getOptionsList(n??{},t.length),i=await Promise.all(a.map(nr)),o=await Promise.all(i.map(async(c,d)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),Ke(t[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,f}));let l;try{const c=e.call(this,t,a,o,s);l=await fn(c,(u=a==null?void 0:a[0])==null?void 0:u.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(Ke(l,"output")))),l}async*_transformStreamWithConfig(e,t,n){let s,a=!0,i,o=!0;const l=Te(n),u=await nr(l);async function*c(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=sr(s,f)}catch{s=void 0,a=!1}yield f}}let d;try{const f=await YE(t.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),n==null?void 0:n.signal,l);delete l.runId,d=f.setup;const h=d==null?void 0:d.handlers.find(tS);let p=f.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const m=d==null?void 0:d.handlers.find(QE);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,o)if(i===void 0)i=g;else try{i=sr(i,g)}catch{i=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Ke(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:Ke(s,"input")}))}getGraph(e){const t=new Zo,n=t.addNode({name:`${this.getName()}Input`,schema:An.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:An.any()});return t.addEdge(n,s),t.addEdge(s,a),t}pipe(e){return new Lr({first:this,last:En(e)})}pick(e){return this.pipe(new nO(e))}assign(e){return this.pipe(new C_(new Ps({steps:e})))}async*transform(e,t){let n;for await(const s of e)n===void 0?n=s:n=sr(n,s);yield*this._streamIterator(n,Te(t))}async*streamLog(e,t,n){const s=new op({...n,autoClose:!1,_schemaFormat:"original"}),a=Te(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,n){const{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{const l=s.copy();l.addHandler(t,!0),n.callbacks=l}const a=this.stream(e,n);async function i(){try{const l=await a;for await(const u of l){const c=new Xr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}const o=i();try{for await(const l of t)yield l}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?YS(s):Ft.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){var p;const s=new rS({...n,autoClose:!1}),a=Te(t),i=a.runId??ht();a.runId=i;const o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{const m=o.copy();m.addHandler(s,!0),a.callbacks=m}const l=new AbortController,u=this;async function c(){try{let m;t!=null&&t.signal?"any"in AbortSignal?m=AbortSignal.any([l.signal,t.signal]):(m=t.signal,t.signal.addEventListener("abort",()=>{l.abort()},{once:!0})):m=l.signal;const g=await u.stream(e,{...a,signal:m}),_=s.tapOutputIterable(i,g);for await(const b of _)if(l.signal.aborted)break}finally{await s.finish()}}const d=c();let f=!1,h;try{for await(const m of s){if(!f){m.data.input=e,f=!0,h=m.run_id,yield m;continue}m.run_id===h&&m.event.endsWith("_end")&&(p=m.data)!=null&&p.input&&delete m.data.input,yield m}}finally{l.abort(),await d}}async*_streamEventsV1(e,t,n){let s,a=!1;const i=Te(t),o=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new op({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new aS({...n}),f=this._streamLog(e,c,i);for await(const p of f){if(s?s=s.concat(p):s=Ra.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const b={...s.state},y={run_id:b.id,event:`on_${b.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,b.type)&&(yield y)}const m=p.ops.filter(b=>b.path.startsWith("/logs/")).map(b=>b.path.split("/")[2]),g=[...new Set(m)];for(const b of g){let y,v={};const E=s.state.logs[b];if(E.end_time===void 0?E.streamed_output.length>0?y="stream":y="start":y="end",y==="start")E.inputs!==void 0&&(v.input=E.inputs);else if(y==="end")E.inputs!==void 0&&(v.input=E.inputs),v.output=E.final_output;else if(y==="stream"){const A=E.streamed_output.length;if(A!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${A} instead. Encountered in: "${E.name}"`);v={chunk:E.streamed_output[0]},E.streamed_output=[]}yield{event:`on_${E.type}_${y}`,name:E.name,run_id:E.id,tags:E.tags,metadata:E.metadata,data:v}}const{state:_}=s;if(_.streamed_output.length>0){const b=_.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${_.name}"`);const y={chunk:_.streamed_output[0]};_.streamed_output=[];const v={event:`on_${_.type}_stream`,run_id:_.id,tags:o,metadata:l,name:u,data:y};d.includeEvent(v,_.type)&&(yield v)}}const h=s==null?void 0:s.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(e){return wd(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new Pn({bound:this,config:{},configFactories:[s=>({callbacks:[new A_({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return sO(this,e)}}class Pn extends Xe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=sp(this.config,...e);return sp(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Te(t),this.kwargs))}async batch(e,t,n){const s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Te(a),this.kwargs))):await this._mergeConfig(Te(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Te(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Te(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Te(t),this.kwargs))}streamEvents(e,t,n){const s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Te(t),s.kwargs),version:t.version},n)};return Ft.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&Xe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new Pn({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new A_({config:s,onStart:e,onEnd:t,onError:n})]})]})}}class so extends Xe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new so({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,at(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new so({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class eO extends Pn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const s=e>1?`retry:attempt:${e}`:void 0;return at(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return Xi(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){const a={};try{await Xi(async i=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(i,t==null?void 0:t[f],n==null?void 0:n[f])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],p=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[p.toString()]=h}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class Lr extends Xe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var l;const n=Te(t),s=await nr(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;let i=e,o;try{const u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){const f=u[c].invoke(i,at(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));i=await fn(f,t==null?void 0:t.signal)}if((l=t==null?void 0:t.signal)!=null&&l.aborted)throw new Error("Aborted");o=await this.last.invoke(i,at(n,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(Ke(o,"output"))),o}async batch(e,t,n){var l;const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(nr)),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Ke(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const d=this.steps[u].batch(o,i.map((f,h)=>{const p=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return at(s[h],{callbacks:p})}),n);o=await fn(d,(l=s[0])==null?void 0:l.signal)}}catch(u){throw await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(i.map(u=>u==null?void 0:u.handleChainEnd(Ke(o,"output")))),o}async*_streamIterator(e,t){var d;const n=await nr(t),{runId:s,...a}=t??{},i=await(n==null?void 0:n.handleChainStart(this.toJSON(),Ke(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let f=o[0].transform(c(),at(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<o.length;h+=1)f=await o[h].transform(f,at(a,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of f)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield h,l)if(u===void 0)u=h;else try{u=sr(u,h)}catch{u=void 0,l=!1}}catch(f){throw await(i==null?void 0:i.handleChainError(f)),f}await(i==null?void 0:i.handleChainEnd(Ke(u,"output")))}getGraph(e){const t=new Zo;let n=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=i.lastNode()}),t}pipe(e){return Lr.isRunnableSequence(e)?new Lr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Lr({first:this.first,middle:[...this.middle,this.last],last:En(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Xe.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new Lr({...s,first:En(e),middle:t.slice(0,-1).map(En),last:En(t[t.length-1])})}}class Ps extends Xe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=En(n)}static from(e){return new Ps({steps:e})}async invoke(e,t){const n=Te(t),s=await nr(n),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));delete n.runId;const i={};try{const o=Object.entries(this.steps).map(async([l,u])=>{i[l]=await u.invoke(e,at(n,{callbacks:a==null?void 0:a.getChild(`map:key:${l}`)}))});await fn(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,t,n){const s={...this.steps},a=O_(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],u)=>{const c=l.transform(a[u],at(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:l,result:u,gen:c}=await fn(o,n==null?void 0:n.signal);i.delete(l),u.done||(yield{[l]:u.value},i.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new Ts({generator:this.transform(n(),s),config:s});return await a.setup,Ft.fromAsyncGenerator(a)}}class vd extends Xe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!_d(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),s=await nr(n),a=this.func(at(n,{callbacks:s}),e);return fn(a,n==null?void 0:n.signal)}async*_streamIterator(e,t){var a,i;const[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(lc(s)){for await(const o of s)(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),yield o;return}if(QS(s)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new vd({func:e})}}function tO(r){if(_d(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Is extends Xe{static lc_name(){return"RunnableLambda"}constructor(e){if(_d(e.func))return vd.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),tO(e.func),this.func=e.func}static from(e){return new Is({func:e})}async _invoke(e,t,n){return new Promise((s,a)=>{const i=at(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??bu)-1});dn.runWithConfig(gs(i),async()=>{var o,l;try{let u=await this.func(e,{...i});if(u&&Xe.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...i,recursionLimit:(i.recursionLimit??bu)-1})}else if(lc(u)){let c;for await(const d of uc(i,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),c===void 0)c=d;else try{c=sr(c,d)}catch{c=d}u=c}else if(hp(u)){let c;for(const d of pp(i,u))if((l=t==null?void 0:t.signal)==null||l.throwIfAborted(),c===void 0)c=d;else try{c=sr(c,d)}catch{c=d}u=c}s(u)}catch(u){a(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){var o,l;let s;for await(const u of e)if(s===void 0)s=u;else try{s=sr(s,u)}catch{s=u}const a=at(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??bu)-1}),i=await new Promise((u,c)=>{dn.runWithConfig(gs(a),async()=>{try{const d=await this.func(s,{...a,config:a});u(d)}catch(d){c(d)}})});if(i&&Xe.isRunnable(i)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await i.stream(s,a);for await(const c of u)yield c}else if(lc(i))for await(const u of uc(a,i))(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield u;else if(hp(i))for(const u of pp(a,i))(l=n==null?void 0:n.signal)==null||l.throwIfAborted(),yield u;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new Ts({generator:this.transform(n(),s),config:s});return await a.setup,Ft.fromAsyncGenerator(a)}}class rO extends Xe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Te(t),s=await nr(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),l=at(i,{callbacks:o==null?void 0:o.getChild()});return await dn.runWithConfig(l,async()=>{var d;let c;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const h=await f.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(Ke(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,t){var d;const n=Te(t),s=await nr(n),{runId:a,...i}=n,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ke(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName));let l,u;for(const f of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const h=at(i,{callbacks:o==null?void 0:o.getChild()});try{const p=await f.stream(e,h);u=uc(h,p);break}catch(p){l===void 0&&(l=p)}}if(u===void 0){const f=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let c;try{for await(const f of u){yield f;try{c=c===void 0?c:sr(c,f)}catch{c=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Ke(c,"output")))}async batch(e,t,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(u=>nr(u))),i=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Ke(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o;for(const u of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const c=await u.batch(e,i.map((d,f)=>at(s[f],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,f)=>d==null?void 0:d.handleChainEnd(Ke(c[f],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function En(r){if(typeof r=="function")return new Is({func:r});if(Xe.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){const e={};for(const[t,n]of Object.entries(r))e[t]=En(n);return new Ps({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class C_ extends Xe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ps&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const s=this.mapper.getStepsKeys(),[a,i]=O_(e),o=this.mapper.transform(i,at(n,{callbacks:t==null?void 0:t.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new Ts({generator:this.transform(n(),s),config:s});return await a.setup,Ft.fromAsyncGenerator(a)}}class nO extends Xe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const s=Te(t),a=new Ts({generator:this.transform(n(),s),config:s});return await a.setup,Ft.fromAsyncGenerator(a)}}class mp extends Pn{constructor(e){const t=Lr.from([Is.from(async n=>{let s;if(Qg(n))try{s=await this.schema.parseAsync(n.args)}catch{throw new Dv("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function sO(r,e){var s;const t=e.name??r.getName(),n=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===An.ZodString?new mp({name:t,description:n,schema:An.object({input:An.string()}).transform(a=>a.input),bound:r}):new mp({name:t,description:n,schema:e.schema,bound:r})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var aO=typeof window=="object"?window:{},fe="0123456789abcdef".split(""),iO=[-2147483648,8388608,32768,128],Gt=[24,16,8,0],We=[];function ir(r){r?(We[0]=We[16]=We[1]=We[2]=We[3]=We[4]=We[5]=We[6]=We[7]=We[8]=We[9]=We[10]=We[11]=We[12]=We[13]=We[14]=We[15]=0,this.blocks=We):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ir.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===aO.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,a=r.length||0,i=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;n<a&&s<64;++n)i[s>>2]|=r[n]<<Gt[s++&3];else for(s=this.start;n<a&&s<64;++n)t=r.charCodeAt(n),t<128?i[s>>2]|=t<<Gt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Gt[s++&3],i[s>>2]|=(128|t>>6&63)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),i[s>>2]|=(240|t>>18)<<Gt[s++&3],i[s>>2]|=(128|t>>12&63)<<Gt[s++&3],i[s>>2]|=(128|t>>6&63)<<Gt[s++&3],i[s>>2]|=(128|t&63)<<Gt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};ir.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=iO[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};ir.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&n,o=r<<5|r>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=r&e|~r&t,o=s<<5|s>>>27,n=o+a+n+1518500249+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|~s&e,o=n<<5|n>>>27,t=o+a+t+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|~n&r,o=t<<5|t>>>27,e=o+a+e+1518500249+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|~t&s,o=e<<5|e>>>27,r=o+a+r+1518500249+l[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n+1859775393+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e+1859775393+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r+1859775393+l[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+a+n-1894007588+l[i+1]<<0,r=r<<30|r>>>2,a=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+a+t-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+a+e-1894007588+l[i+3]<<0,n=n<<30|n>>>2,a=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+a+r-1894007588+l[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^n,o=r<<5|r>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=r^e^t,o=s<<5|s>>>27,n=o+a+n-899497514+l[i+1]<<0,r=r<<30|r>>>2,a=s^r^e,o=n<<5|n>>>27,t=o+a+t-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=n^s^r,o=t<<5|t>>>27,e=o+a+e-899497514+l[i+3]<<0,n=n<<30|n>>>2,a=t^n^s,o=e<<5|e>>>27,r=o+a+r-899497514+l[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};ir.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return fe[r>>28&15]+fe[r>>24&15]+fe[r>>20&15]+fe[r>>16&15]+fe[r>>12&15]+fe[r>>8&15]+fe[r>>4&15]+fe[r&15]+fe[e>>28&15]+fe[e>>24&15]+fe[e>>20&15]+fe[e>>16&15]+fe[e>>12&15]+fe[e>>8&15]+fe[e>>4&15]+fe[e&15]+fe[t>>28&15]+fe[t>>24&15]+fe[t>>20&15]+fe[t>>16&15]+fe[t>>12&15]+fe[t>>8&15]+fe[t>>4&15]+fe[t&15]+fe[n>>28&15]+fe[n>>24&15]+fe[n>>20&15]+fe[n>>16&15]+fe[n>>12&15]+fe[n>>8&15]+fe[n>>4&15]+fe[n&15]+fe[s>>28&15]+fe[s>>24&15]+fe[s>>20&15]+fe[s>>16&15]+fe[s>>12&15]+fe[s>>8&15]+fe[s>>4&15]+fe[s&15]};ir.prototype.toString=ir.prototype.hex;ir.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};ir.prototype.array=ir.prototype.digest;ir.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};const oO=r=>new ir(!0).update(r).hex(),gp=(...r)=>oO(r.join("_"));class lO{}const uO=new Map;class xd extends lO{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(gp(e,t))??null)}async update(e,t,n){this.cache.set(gp(e,t),n)}static global(){return new xd(uO)}}class $_ extends Rn{}class cO extends $_{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new jo(this.value)]}}class dO extends $_{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return e_(this.messages)}toChatMessages(){return this.messages}}var Ls={},_p;function fO(){if(_p)return Ls;_p=1,Ls.byteLength=o,Ls.toByteArray=u,Ls.fromByteArray=f;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=n.length;s<a;++s)r[s]=n[s],e[n.charCodeAt(s)]=s;e[45]=62,e[95]=63;function i(h){var p=h.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=h.indexOf("=");m===-1&&(m=p);var g=m===p?0:4-m%4;return[m,g]}function o(h){var p=i(h),m=p[0],g=p[1];return(m+g)*3/4-g}function l(h,p,m){return(p+m)*3/4-m}function u(h){var p,m=i(h),g=m[0],_=m[1],b=new t(l(h,g,_)),y=0,v=_>0?g-4:g,E;for(E=0;E<v;E+=4)p=e[h.charCodeAt(E)]<<18|e[h.charCodeAt(E+1)]<<12|e[h.charCodeAt(E+2)]<<6|e[h.charCodeAt(E+3)],b[y++]=p>>16&255,b[y++]=p>>8&255,b[y++]=p&255;return _===2&&(p=e[h.charCodeAt(E)]<<2|e[h.charCodeAt(E+1)]>>4,b[y++]=p&255),_===1&&(p=e[h.charCodeAt(E)]<<10|e[h.charCodeAt(E+1)]<<4|e[h.charCodeAt(E+2)]>>2,b[y++]=p>>8&255,b[y++]=p&255),b}function c(h){return r[h>>18&63]+r[h>>12&63]+r[h>>6&63]+r[h&63]}function d(h,p,m){for(var g,_=[],b=p;b<m;b+=3)g=(h[b]<<16&16711680)+(h[b+1]<<8&65280)+(h[b+2]&255),_.push(c(g));return _.join("")}function f(h){for(var p,m=h.length,g=m%3,_=[],b=16383,y=0,v=m-g;y<v;y+=b)_.push(d(h,y,y+b>v?v:y+b));return g===1?(p=h[m-1],_.push(r[p>>2]+r[p<<4&63]+"==")):g===2&&(p=(h[m-2]<<8)+h[m-1],_.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),_.join("")}return Ls}var hO=fO();const pO=xs(hO);var mO=Object.defineProperty,gO=(r,e,t)=>e in r?mO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_O=(r,e,t)=>(gO(r,e+"",t),t);function yO(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){const a=r.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,s])}if(n!=null){const s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function bO(r,e){return r.length===1?[e.get(r.join(","))]:yO(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function wO(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var cc=class{constructor(r,e){Hr(this,"specialTokens");Hr(this,"inverseSpecialTokens");Hr(this,"patStr");Hr(this,"textEncoder",new TextEncoder);Hr(this,"textDecoder",new TextDecoder("utf-8"));Hr(this,"rankMap",new Map);Hr(this,"textMap",new Map);this.patStr=r.pat_str;const t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{const[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((u,c)=>n[u]=l+c),n},{});for(const[n,s]of Object.entries(t)){const a=pO.toByteArray(n);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,a])=>(n[a]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){const n=new RegExp(this.patStr,"ug"),s=cc.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){const u=cc.specialTokenRegex([...o]),c=r.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(r),!(u==null||i.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??r.length;for(const h of r.substring(l,d).matchAll(n)){const p=this.textEncoder.encode(h[0]),m=this.rankMap.get(p.join(","));if(m!=null){a.push(m);continue}a.push(...bO(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),l=u.index+u[0].length}return a}decode(r){const e=[];let t=0;for(let a=0;a<r.length;++a){const i=r[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const n=new Uint8Array(t);let s=0;for(const a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},N_=cc;_O(N_,"specialTokenRegex",r=>new RegExp(r.map(e=>wO(e)).join("|"),"g"));function vO(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const pi={},xO=new bd({});async function EO(r){return r in pi||(pi[r]=xO.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new N_(e)).catch(e=>{throw delete pi[r],e})),await pi[r]}async function SO(r){return EO(vO(r))}const OO=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function j_(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}const AO=()=>!1;class TO extends Xe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??AO(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class PO extends TO{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){const{cache:s,...a}=n;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=xd.global():this.cache=void 0,this.caller=new bd(n??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await SO("modelName"in this?OO(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new cO(e):Array.isArray(e)?new dO(e.map(Zs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class ao extends Xe{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const n=Te(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){const n=Te(t);let s,a=!0;for await(const i of this._transformStreamWithConfig(e,o=>o,n))if(yield i,a)if(s===void 0)s=i;else try{s=sr(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new C_(new Ps({steps:e}))}}function L_(r){return typeof(r==null?void 0:r.parse)=="function"}class Yr extends PO{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){const n=Yr._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){var n;if(this._streamResponseChunks===Yr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const a=Yr._convertInputToPromptValue(e).toChatMessages(),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(t),l={...i.metadata,...this.getLsParams(o)},u=await St.configure(i.callbacks,this.callbacks,i.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[a],i.runId,void 0,c,void 0,void 0,i.runName));let f,h;try{for await(const p of this._streamResponseChunks(a,o,d==null?void 0:d[0])){if(p.message.id==null){const m=(n=d==null?void 0:d.at(0))==null?void 0:n.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,f?f=f.concat(p):f=p,Lf(p.message)&&p.message.usage_metadata!==void 0&&(h={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(m=>m==null?void 0:m.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[f]],llmOutput:h})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){var d,f;const a=e.map(h=>h.map(Zs));let i;if(s!==void 0&&s.length===a.length)i=s;else{const h={...n.metadata,...this.getLsParams(t)},p=await St.configure(n.callbacks,this.callbacks,n.tags,this.tags,h,this.metadata,{verbose:this.verbose}),m={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};i=await(p==null?void 0:p.handleChatModelStart(this.toJSON(),a,n.runId,void 0,m,void 0,void 0,n.runName))}const o=[],l=[];if(!!(i!=null&&i[0].handlers.find(RE))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==Yr.prototype._streamResponseChunks)try{const h=await this._streamResponseChunks(a[0],t,i==null?void 0:i[0]);let p,m;for await(const g of h){if(g.message.id==null){const _=(d=i==null?void 0:i.at(0))==null?void 0:d.runId;_!=null&&g.message._updateId(`run-${_}`)}p===void 0?p=g:p=sr(p,g),Lf(g.message)&&g.message.usage_metadata!==void 0&&(m={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}if(p===void 0)throw new Error("Received empty response from chat model call.");o.push([p]),await(i==null?void 0:i[0].handleLLMEnd({generations:o,llmOutput:m}))}catch(h){throw await(i==null?void 0:i[0].handleLLMError(h)),h}else{const h=await Promise.allSettled(a.map((p,m)=>this._generate(p,{...t,promptIndex:m},i==null?void 0:i[m])));await Promise.all(h.map(async(p,m)=>{var g,_,b;if(p.status==="fulfilled"){const y=p.value;for(const v of y.generations){if(v.message.id==null){const E=(g=i==null?void 0:i.at(0))==null?void 0:g.runId;E!=null&&v.message._updateId(`run-${E}`)}v.message.response_metadata={...v.generationInfo,...v.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[m]=y.generations,l[m]=y.llmOutput,(_=i==null?void 0:i[m])==null?void 0:_.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((b=i==null?void 0:i[m])==null?void 0:b.handleLLMError(p.reason)),Promise.reject(p.reason)}))}const c={generations:o,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(c,lp,{value:i?{runIds:i==null?void 0:i.map(h=>h.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:a}){const i=e.map(g=>g.map(Zs)),o={...a.metadata,...this.getLsParams(s)},l=await St.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},c=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),i,a.runId,void 0,u,void 0,void 0,a.runName)),d=[],h=(await Promise.allSettled(i.map(async(g,_)=>{const b=Yr._convertInputToPromptValue(g).toString(),y=await t.lookup(b,n);return y==null&&d.push(_),y}))).map((g,_)=>({result:g,runManager:c==null?void 0:c[_]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(h.map(async({result:g,runManager:_},b)=>{if(g.status==="fulfilled"){const y=g.value;return p[b]=y.map(v=>("message"in v&&Co(v.message)&&Ba(v.message)&&(v.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),v.generationInfo={...v.generationInfo,tokenUsage:{}},v)),y.length&&await(_==null?void 0:_.handleLLMNewToken(y[0].text)),_==null?void 0:_.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(g.reason)}));const m={generations:p,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,lp,{value:c?{runIds:c==null?void 0:c.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;const a=e.map(p=>p.map(Zs)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(a,o,i);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:f}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:i});let h={};if(d.length>0){const p=await this._generateUncached(d.map(m=>a[m]),o,i,f!==void 0?d.map(m=>f==null?void 0:f[m]):void 0);await Promise.all(p.generations.map(async(m,g)=>{const _=d[g];c[_]=m;const b=Yr._convertInputToPromptValue(a[_]).toString();return l.update(b,u,m)})),h=p.llmOutput??{}}return{generations:c,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const s=e.map(a=>a.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Zs)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const s=new jo(e),a=await this.call([s],t,n);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const n=e,s=t==null?void 0:t.name,a=n.description??"A function available to call.",i=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;L_(n)?u=[{type:"function",function:{name:l,description:a,parameters:Ga(n)}}]:("name"in n&&(l=n.name),u=[{type:"function",function:{name:l,description:a,parameters:n}}]);const c=this.bindTools(u),d=Is.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const g=m.tool_calls.find(_=>_.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});const f=ao.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),h=ao.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[h]});return Lr.from([{raw:c},p]).withConfig({runName:"StructuredOutputRunnable"})}}class IO extends Xe{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class M_ extends IO{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}class Ed extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Yg(this,"OUTPUT_PARSING_FAILURE")}}function dc(r,e){const t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;const n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!dc(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;const n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(const i of n)if(!dc(r[i],e[i]))return!1;return!0}return r===e}class kO extends M_{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class D_ extends kO{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,n;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(jv(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new jn({message:s,text:s.content})}else if(Co(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new jn({message:Bv(s),text:s.content})}else a=new _s({text:s});n===void 0?n=a:n=n.concat(a);const i=await this.parsePartialResult([n]);i!=null&&!dc(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}}class yp extends M_{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=An.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,An.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Ga(this.schema))}
\`\`\`
`}async parse(e){try{const n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(t){throw new Ed(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class bp extends D_{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?EE(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Cf(e[0].text)}async parse(e){return Cf(e,JSON.parse)}getFormatInstructions(){return""}}function Sd(r,e){if(r.function===void 0)return;let t;if(e!=null&&e.partial)try{t=ld(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new Ed([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const n={name:r.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(n.id=r.id),n}function RO(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function F_(r,e){var t,n;return{name:(t=r.function)==null?void 0:t.name,args:(n=r.function)==null?void 0:n.arguments,id:r.id,error:e,type:"invalid_tool_call"}}class CO extends D_{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var i;const n=e[0].message;let s;if(Ba(n)&&((i=n.tool_calls)!=null&&i.length)?s=n.tool_calls.map(o=>{const{id:l,...u}=o;return this.returnId?{id:l,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(l=>Sd(l,{returnId:this.returnId,partial:t}))),!s)return[];const a=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};a.push(l)}return a}}class wp extends CO{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Ed(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let s=n;if(n.length)return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName);let s=n;return n.length?(this.returnId||(s=n.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}}const $O=Symbol("Let zodToJsonSchema decide on which parser to use"),vp={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},NO=r=>typeof r=="string"?{...vp,basePath:["#"],definitions:{},name:r}:{...vp,basePath:["#"],definitions:{},...r},fc=r=>"_def"in r?r._def:r;function jO(r){if(!r)return!0;for(const e in r)return!1;return!0}const LO=r=>{const e=NO(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[fc(s),{def:fc(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function U_(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Re(r,e,t,n,s){r[e]=t,U_(r,e,n,s)}function MO(){return{}}function DO(r,e){var n,s;const t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==T.ZodAny&&(t.items=xe(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Re(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Re(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Re(t,"minItems",r.exactLength.value,r.exactLength.message,e),Re(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function FO(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Re(t,"minimum",n.value,n.message,e):Re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Re(t,"maximum",n.value,n.message,e):Re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Re(t,"maximum",n.value,n.message,e));break;case"multipleOf":Re(t,"multipleOf",n.value,n.message,e);break}return t}function UO(){return{type:"boolean"}}function BO(r,e){return xe(r.type._def,e)}const HO=(r,e)=>xe(r.innerType._def,e);function B_(r,e,t){const n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>B_(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return qO(r,e)}}const qO=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const n of r.checks)switch(n.kind){case"min":Re(t,"minimum",n.value,n.message,e);break;case"max":Re(t,"maximum",n.value,n.message,e);break}return t};function ZO(r,e){return{...xe(r.innerType._def,e),default:r.defaultValue()}}function VO(r,e,t){return e.effectStrategy==="input"?xe(r.schema._def,e,t):{}}function zO(r){return{type:"string",enum:[...r.values]}}const GO=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function WO(r,e){const t=[xe(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),xe(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(GO(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else n=void 0;s.push(i)}}),s.length?{allOf:s,...n}:void 0}function JO(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let Eu;const bn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Eu===void 0&&(Eu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Eu),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function H_(r,e){const t={type:"string"};function n(s){return e.patternStrategy==="escape"?KO(s):s}if(r.checks)for(const s of r.checks)switch(s.kind){case"min":Re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Wt(t,"email",s.message,e);break;case"format:idn-email":Wt(t,"idn-email",s.message,e);break;case"pattern:zod":Jt(t,bn.email,s.message,e);break}break;case"url":Wt(t,"uri",s.message,e);break;case"uuid":Wt(t,"uuid",s.message,e);break;case"regex":Jt(t,s.regex,s.message,e);break;case"cuid":Jt(t,bn.cuid,s.message,e);break;case"cuid2":Jt(t,bn.cuid2,s.message,e);break;case"startsWith":Jt(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":Jt(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Wt(t,"date-time",s.message,e);break;case"date":Wt(t,"date",s.message,e);break;case"time":Wt(t,"time",s.message,e);break;case"duration":Wt(t,"duration",s.message,e);break;case"length":Re(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Re(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Jt(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Wt(t,"ipv4",s.message,e),s.version!=="v4"&&Wt(t,"ipv6",s.message,e);break}case"emoji":Jt(t,bn.emoji,s.message,e);break;case"ulid":{Jt(t,bn.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Wt(t,"binary",s.message,e);break}case"contentEncoding:base64":{Re(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Jt(t,bn.base64,s.message,e);break}}break}case"nanoid":Jt(t,bn.nanoid,s.message,e)}return t}const KO=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Wt=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(a=>a.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Re(r,"format",e,t,n)},Jt=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(a=>a.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:xp(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Re(r,"pattern",xp(e,n),t,n)},xp=(r,e)=>{var u;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source;let a="",i=!1,o=!1,l=!1;for(let c=0;c<s.length;c++){if(i){a+=s[c],i=!1;continue}if(n.i){if(o){if(s[c].match(/[a-z]/)){l?(a+=s[c],a+=`${s[c-2]}-${s[c]}`.toUpperCase(),l=!1):s[c+1]==="-"&&((u=s[c+2])!=null&&u.match(/[a-z]/))?(a+=s[c],l=!0):a+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){a+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(n.m){if(s[c]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&s[c]==="."){a+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}a+=s[c],s[c]==="\\"?i=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{const c=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function q_(r,e){var n,s,a,i;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===T.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,l)=>({...o,[l]:xe(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:xe(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=r.keyType)==null?void 0:s._def.typeName)===T.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){const o=Object.entries(H_(r.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...t,propertyNames:o}}else if(((i=r.keyType)==null?void 0:i._def.typeName)===T.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function XO(r,e){if(e.mapStrategy==="record")return q_(r,e);const t=xe(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=xe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function YO(r){const e=r.values,n=Object.keys(r.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function QO(){return{not:{}}}function eA(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const io={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function tA(r,e){if(e.target==="openApi3")return Ep(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in io&&(!n._def.checks||!n._def.checks.length))){const n=t.reduce((s,a)=>{const i=io[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){const s=n.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return Ep(r,e)}const Ep=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>xe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function rA(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:io[r.innerType._def.typeName],nullable:!0}:{type:[io[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=xe(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const t=xe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function nA(r,e){const t={type:"number"};if(!r.checks)return t;for(const n of r.checks)switch(n.kind){case"int":t.type="integer",U_(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Re(t,"minimum",n.value,n.message,e):Re(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Re(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Re(t,"maximum",n.value,n.message,e):Re(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Re(t,"maximum",n.value,n.message,e));break;case"multipleOf":Re(t,"multipleOf",n.value,n.message,e);break}return t}function sA(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":xe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":xe(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function aA(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((n,[s,a])=>{if(a===void 0||a._def===void 0)return n;const i=xe(a._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return i===void 0?n:{properties:{...n.properties,[s]:i},required:a.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]}},{properties:{},required:[]}),additionalProperties:sA(r,e)};return t.required.length||delete t.required,t}const iA=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return xe(r.innerType._def,e);const t=xe(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},oA=(r,e)=>{if(e.pipeStrategy==="input")return xe(r.in._def,e);if(e.pipeStrategy==="output")return xe(r.out._def,e);const t=xe(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=xe(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function lA(r,e){return xe(r.type._def,e)}function uA(r,e){const n={type:"array",uniqueItems:!0,items:xe(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Re(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Re(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function cA(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>xe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:xe(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>xe(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function dA(){return{not:{}}}function fA(){return{}}const hA=(r,e)=>xe(r.innerType._def,e);function xe(r,e,t=!1){var i;const n=e.seen.get(r);if(e.override){const o=(i=e.override)==null?void 0:i.call(e,r,e,n,t);if(o!==$O)return o}if(n&&!t){const o=pA(n,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);const a=gA(r,r.typeName,e,t);return a&&_A(r,e,a),s.jsonSchema=a,a}const pA=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:mA(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},mA=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},gA=(r,e,t,n)=>{switch(e){case T.ZodString:return H_(r,t);case T.ZodNumber:return nA(r,t);case T.ZodObject:return aA(r,t);case T.ZodBigInt:return FO(r,t);case T.ZodBoolean:return UO();case T.ZodDate:return B_(r,t);case T.ZodUndefined:return dA();case T.ZodNull:return eA(t);case T.ZodArray:return DO(r,t);case T.ZodUnion:case T.ZodDiscriminatedUnion:return tA(r,t);case T.ZodIntersection:return WO(r,t);case T.ZodTuple:return cA(r,t);case T.ZodRecord:return q_(r,t);case T.ZodLiteral:return JO(r,t);case T.ZodEnum:return zO(r);case T.ZodNativeEnum:return YO(r);case T.ZodNullable:return rA(r,t);case T.ZodOptional:return iA(r,t);case T.ZodMap:return XO(r,t);case T.ZodSet:return uA(r,t);case T.ZodLazy:return xe(r.getter()._def,t);case T.ZodPromise:return lA(r,t);case T.ZodNaN:case T.ZodNever:return QO();case T.ZodEffects:return VO(r,t,n);case T.ZodAny:return MO();case T.ZodUnknown:return fA();case T.ZodDefault:return ZO(r,t);case T.ZodBranded:return BO(r,t);case T.ZodReadonly:return hA(r,t);case T.ZodCatch:return HO(r,t);case T.ZodPipeline:return oA(r,t);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(s=>{})()}},_A=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),yA=(r,e)=>{const t=LO(e),n=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=xe(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(jO(t.definitions))return;const l={},u=new Set;for(let c=0;c<500;c++){const d=Object.entries(t.definitions).filter(([f])=>!u.has(f));if(d.length===0)break;for(const[f,h]of d)l[f]=xe(fc(h),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},u.add(f)}return l})(),o=n===void 0?i?{...s,[t.definitionPath]:i}:s:t.nameStrategy==="duplicate-ref"?{...s,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Z_(r,e){return yA(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function bA(r,e,t){return rv({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Z_(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function wA(r){return nv({type:"function",function:{name:r.name,parameters:Z_(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function vA(r){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=r;if((n||i)&&s&&e)return`${s}/${e}`;if((n||i)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function xA(r,e){const t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:Ga(r.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function EA(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function SA(r){return r!==void 0&&Xe.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function OA(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&L_(r.schema)}function AA(r){return OA(r)||SA(r)||EA(r)}function mi(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Su(r){let e;return r.constructor.name===vo.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Lt.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=mi(r,"INVALID_TOOL_RESULTS"):r.status===401?e=mi(r,"MODEL_AUTHENTICATION"):r.status===429?e=mi(r,"MODEL_RATE_LIMIT"):r.status===404?e=mi(r,"MODEL_NOT_FOUND"):e=r,e}function Sp(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function TA(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function PA(r){const e=["namespace functions {",""];for(const t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(V_(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function V_(r,e){var n;const t=[];for(const[s,a]of Object.entries(r.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(n=r.required)!=null&&n.includes(s)?t.push(`${s}: ${oo(a,e)},`):t.push(`${s}?: ${oo(a,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function oo(r,e){if(TA(r))return r.anyOf.map(t=>oo(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",V_(r,e+2),"}"].join(`
`);case"array":return r.items?`${oo(r.items,e)}[]`:"any[]";default:return""}}function IA(r,e){let t;if(AA(r)){const n=wA({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:xA(r,e)}}else t=r;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function kA(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Od(r){const e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ha.isInstance(r))throw new Error("Invalid generic chat message");return kA(r)}default:throw new Error(`Unknown message type: ${e}`)}}function Op(r,e){return r.flatMap(t=>{var a;let n=Od(t);n==="system"&&Ad(e)&&(n="developer");const s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),Ba(t)&&((a=t.tool_calls)!=null&&a.length)?(s.tool_calls=t.tool_calls.map(RO),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}const Qn="__openai_function_call_ids__";function Ap(r,e){return r.flatMap(t=>{var s,a,i;let n=Od(t);if(n==="system"&&Ad(e)&&(n="developer"),n==="function")throw new Error("Function messages are not supported in Responses API");if(n==="tool"){const o=t;return((s=o.additional_kwargs)==null?void 0:s.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof o.content=="string")return{type:"computer_screenshot",image_url:o.content};if(Array.isArray(o.content)){const u=o.content.find(d=>d.type==="computer_screenshot");if(u)return u;const c=o.content.find(d=>d.type==="image_url");if(c)return{type:"computer_screenshot",image_url:typeof c.image_url=="string"?c.image_url:c.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:o.tool_call_id}:{type:"function_call_output",call_id:o.tool_call_id,id:o.id,output:typeof o.content!="string"?JSON.stringify(o.content):o.content}}if(n==="assistant"){const o=[];t.additional_kwargs.reasoning!=null&&(f=>typeof f=="object"&&f!=null&&"type"in f&&f.type==="reasoning")(t.additional_kwargs.reasoning)&&o.push(t.additional_kwargs.reasoning);let{content:l}=t;t.additional_kwargs.refusal!=null&&(typeof l=="string"&&(l=[{type:"output_text",text:l,annotations:[]}]),l=[...l,{type:"refusal",refusal:t.additional_kwargs.refusal}]),o.push({type:"message",role:"assistant",content:typeof l=="string"?l:l.flatMap(d=>d.type==="text"?{type:"output_text",text:d.text,annotations:d.annotations??[]}:d.type==="output_text"||d.type==="refusal"?d:[])});const u=t.additional_kwargs[Qn];Ba(t)&&((a=t.tool_calls)!=null&&a.length)?o.push(...t.tool_calls.map(d=>({type:"function_call",name:d.name,arguments:JSON.stringify(d.args),call_id:d.id,id:u==null?void 0:u[d.id]}))):t.additional_kwargs.tool_calls!=null&&o.push(...t.additional_kwargs.tool_calls.map(d=>({type:"function_call",name:d.function.name,call_id:d.id,id:u==null?void 0:u[d.id],arguments:d.function.arguments})));const c=(i=t.response_metadata.output)!=null&&i.length?t.response_metadata.output:t.additional_kwargs.tool_outputs;if(c!=null){const d=c,f=d==null?void 0:d.filter(p=>p.type==="reasoning"),h=d==null?void 0:d.filter(p=>p.type==="computer_call");f.length>0&&h.length>0&&o.push(...f),h.length>0&&o.push(...h)}return o}return n==="user"?{type:"message",role:"user",content:typeof t.content=="string"?t.content:t.content.flatMap(o=>{if(o.type==="text")return{type:"input_text",text:o.text};if(o.type==="image_url"){const l=typeof o.image_url=="string"?o.image_url:o.image_url.url,u=typeof o.image_url=="string"?"auto":o.image_url.detail;return{type:"input_image",image_url:l,detail:u}}return o.type==="input_text"||o.type==="input_image"||o.type==="input_file"?o:[]})}:[]})}function z_(r){if(r.error){const i=new Error(r.error.message);throw i.name=r.error.code,i}const e=[],t=[],n=[],s={model:r.model,created_at:r.created_at,id:r.id,incomplete_details:r.incomplete_details,metadata:r.metadata,object:r.object,status:r.status,user:r.user,model_name:r.model},a={};for(const i of r.output)if(i.type==="message")e.push(...i.content.flatMap(o=>o.type==="output_text"?("parsed"in o&&o.parsed!=null&&(a.parsed=o.parsed),{type:"text",text:o.text,annotations:o.annotations}):o.type==="refusal"?(a.refusal=o.refusal,[]):o));else if(i.type==="function_call"){const o={function:{name:i.name,arguments:i.arguments},id:i.call_id};try{t.push(Sd(o,{returnId:!0}))}catch(l){let u;typeof l=="object"&&l!=null&&"message"in l&&typeof l.message=="string"&&(u=l.message),n.push(F_(o,u))}a[Qn]??(a[Qn]={}),a[Qn][i.call_id]=i.id}else i.type==="reasoning"?a.reasoning=i:(a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(i));return new pa({id:r.id,content:e,tool_calls:t,invalid_tool_calls:n,usage_metadata:r.usage,additional_kwargs:a,response_metadata:s})}function RA(r){var l,u;const e=[];let t={},n;const s=[],a={},i={};let o;if(r.type==="response.output_text.delta")e.push({type:"text",text:r.delta,index:r.content_index});else if(r.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[r.annotation],index:r.content_index});else if(r.type==="response.output_item.added"&&r.item.type==="message")o=r.item.id;else if(r.type==="response.output_item.added"&&r.item.type==="function_call")s.push({type:"tool_call_chunk",name:r.item.name,args:r.item.arguments,id:r.item.id,index:r.output_index}),i[Qn]={[r.item.call_id]:r.item.id};else if(r.type==="response.output_item.done"&&(r.item.type==="web_search_call"||r.item.type==="file_search_call"||r.item.type==="computer_call"))i.tool_outputs=[r.item];else if(r.type==="response.created")a.id=r.response.id,a.model_name=r.response.model,a.model=r.response.model;else if(r.type==="response.completed"){const c=z_(r.response);n=r.response.usage,((u=(l=r.response.text)==null?void 0:l.format)==null?void 0:u.type)==="json_schema"&&(i.parsed??(i.parsed=JSON.parse(c.text)));for(const[d,f]of Object.entries(r.response))d!=="id"&&(a[d]=f)}else if(r.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:r.delta,index:r.output_index});else if(r.type==="response.web_search_call.completed"||r.type==="response.file_search_call.completed")t={tool_outputs:{id:r.item_id,type:r.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(r.type==="response.refusal.done")i.refusal=r.refusal;else return null;return new jn({text:e.map(c=>c.text).join(""),message:new an({id:o,content:e,tool_call_chunks:s,usage_metadata:n,additional_kwargs:i,response_metadata:a}),generationInfo:t})}function Ou(r){return"type"in r&&r.type!=="function"}function CA(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function Tp(r,e){return j_(r)?(e==null?void 0:e.strict)!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:IA(r,e)}function Ad(r){return(r==null?void 0:r.startsWith("o1"))||(r==null?void 0:r.startsWith("o3"))}class $A extends Yr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,n;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??vr("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((n=e==null?void 0:e.configuration)==null?void 0:n.organization)??vr("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Ou(s)?s:Tp(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&gi(e.json_schema.schema)?bA(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o,l;let n;if((e==null?void 0:e.strict)!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this._useResponseApi(e)){const u={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Ou(d)?d:j_(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:n}:null).filter(d=>d!==null):void 0,tool_choice:CA(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const d=Sp(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.modelKwargs},c=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return c!==void 0&&(u.reasoning={effort:c}),u}let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(u=>Tp(u,{strict:n})):void 0,tool_choice:Sp(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction);const i=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(a.reasoning_effort=i),Ad(a.model)?a.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:a.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,a}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const l of n??[])try{s.push(Sd(l,{returnId:!0}))}catch(u){a.push(F_(l,u.message))}const i={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(i.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new pa({content:e.content||"",tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:t.id})}default:return new Ha(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,n){var l,u;const s=e.role??n,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Lo({content:a,response_metadata:o});if(s==="assistant"){const c=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)c.push({name:(l=d.function)==null?void 0:l.name,args:(u=d.function)==null?void 0:u.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new an({content:a,tool_call_chunks:c,additional_kwargs:i,id:t.id,response_metadata:o})}else return s==="system"?new ma({content:a,response_metadata:o}):s==="developer"?new ma({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new No({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new ud({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new $o({content:a,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var u,c,d,f,h,p,m,g,_,b;if(this._useResponseApi(t)){const y=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:Ap(e,this.model),stream:!0},t);for await(const v of y){const E=RA(v);E!=null&&(yield E)}return}const s=Op(e,this.model),a={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,t);let l;for await(const y of o){const v=(u=y==null?void 0:y.choices)==null?void 0:u[0];if(y.usage&&(l=y.usage),!v)continue;const{delta:E}=v;if(!E)continue;const A=this._convertOpenAIDeltaToBaseMessageChunk(E,y,i);i=E.role??i;const S={prompt:t.promptIndex??0,completion:v.index??0};if(typeof A.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const O={...S};v.finish_reason!=null&&(O.finish_reason=v.finish_reason,O.system_fingerprint=y.system_fingerprint,O.model_name=y.model),this.logprobs&&(O.logprobs=v.logprobs);const k=new jn({message:A,text:A.content,generationInfo:O});yield k,await(n==null?void 0:n.handleLLMNewToken(k.text??"",S,void 0,void 0,void 0,{chunk:k}))}if(l){const y={...((c=l.prompt_tokens_details)==null?void 0:c.audio_tokens)!==null&&{audio:(d=l.prompt_tokens_details)==null?void 0:d.audio_tokens},...((f=l.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(h=l.prompt_tokens_details)==null?void 0:h.cached_tokens}},v={...((p=l.completion_tokens_details)==null?void 0:p.audio_tokens)!==null&&{audio:(m=l.completion_tokens_details)==null?void 0:m.audio_tokens},...((g=l.completion_tokens_details)==null?void 0:g.reasoning_tokens)!==null&&{reasoning:(_=l.completion_tokens_details)==null?void 0:_.reasoning_tokens}};yield new jn({message:new an({content:"",response_metadata:{usage:{...l}},usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens,...Object.keys(y).length>0&&{input_token_details:y},...Object.keys(v).length>0&&{output_token_details:v}}}),text:""})}if((b=t.signal)!=null&&b.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,n){var o;const s=this.invocationParams(t);if(s.stream){const l=this._streamResponseChunks(e,t,n);let u;for await(const c of l)c.message.response_metadata={...c.generationInfo,...c.message.response_metadata},u=(u==null?void 0:u.concat(c))??c;return{generations:u?[u]:[],llmOutput:{estimatedTokenUsage:(o=u==null?void 0:u.message)==null?void 0:o.usage_metadata}}}const a=Ap(e,this.model),i=await this.responseApiWithRetry({input:a,...s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:i.output_text,message:z_(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}_useResponseApi(e){var s;const t=(s=e==null?void 0:e.tools)==null?void 0:s.some(Ou),n=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null;return this.useResponsesApi||t||n}async _generate(e,t,n){var o,l;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,n);const s={},a=this.invocationParams(t),i=Op(e,this.model);if(a.stream){const u=this._streamResponseChunks(e,t,n),c={};for await(const g of u){g.message.response_metadata={...g.generationInfo,...g.message.response_metadata};const _=((o=g.generationInfo)==null?void 0:o.completion)??0;c[_]===void 0?c[_]=g:c[_]=c[_].concat(g)}const d=Object.entries(c).sort(([g],[_])=>parseInt(g,10)-parseInt(_,10)).map(([g,_])=>_),{functions:f,function_call:h}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,f,h),m=await this.getNumTokensFromGenerations(d);return s.input_tokens=p,s.output_tokens=m,s.total_tokens=p+m,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let u;t.response_format&&t.response_format.type==="json_schema"?u=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):u=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:c,prompt_tokens:d,total_tokens:f,prompt_tokens_details:h,completion_tokens_details:p}=(u==null?void 0:u.usage)??{};c&&(s.output_tokens=(s.output_tokens??0)+c),d&&(s.input_tokens=(s.input_tokens??0)+d),f&&(s.total_tokens=(s.total_tokens??0)+f),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.cached_tokens)!==null)&&(s.input_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.cached_tokens)!==null&&{cache_read:h==null?void 0:h.cached_tokens}}),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.reasoning_tokens)!==null)&&(s.output_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.reasoning_tokens)!==null&&{reasoning:p==null?void 0:p.reasoning_tokens}});const m=[];for(const g of(u==null?void 0:u.choices)??[]){const b={text:((l=g.message)==null?void 0:l.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(g.message??{role:"assistant"},u)};b.generationInfo={...g.finish_reason?{finish_reason:g.finish_reason}:{},...g.logprobs?{logprobs:g.logprobs}:{}},Ba(b.message)&&(b.message.usage_metadata=s),b.message=new pa(Object.fromEntries(Object.entries(b.message).filter(([y])=>!y.startsWith("lc_")))),m.push(b)}return{generations:m,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const a=PA(t);s+=await this.getNumTokens(a),s+=9}return t&&e.find(a=>a._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);const a=await Promise.all(e.map(async i=>{var f,h,p,m,g,_;const o=await this.getNumTokens(i.content),l=await this.getNumTokens(Od(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0;let c=o+n+l+u;const d=i;if(d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(c+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(b){console.error("Error parsing function arguments",b,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Su(s)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var s,a;const n=this._getClientOptions(t);try{return((a=(s=e.text)==null?void 0:s.format)==null?void 0:a.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(i){throw Su(i)}})}async betaParsedCompletionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Su(s)}})}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},s=vA(n),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new pe(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,a,i;NA(e)?(n=e.schema,s=e.name,a=e.method,i=e.includeRaw):(n=e,s=t==null?void 0:t.name,a=t==null?void 0:t.method,i=t==null?void 0:t.includeRaw);let o,l;if((t==null?void 0:t.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),gi(n)?l=yp.fromZodSchema(n):l=new bp;else if(a==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t==null?void 0:t.strict}}}),gi(n)){const f=yp.fromZodSchema(n);l=Is.from(h=>"parsed"in h.additional_kwargs?h.additional_kwargs.parsed:f)}else l=new bp;else{let f=s??"extract";if(gi(n)){const h=Ga(n);o=this.bind({tools:[{type:"function",function:{name:f,description:h.description,parameters:h}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new wp({returnSingle:!0,keyName:f,zodSchema:n})}else{let h;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(h=n,f=n.name):(f=n.title??f,h={name:f,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:h}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),l=new wp({returnSingle:!0,keyName:f})}}if(!i)return o.pipe(l);const u=ao.assign({parsed:(f,h)=>l.invoke(f.raw,h)}),c=ao.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return Lr.from([{raw:o},d])}}function gi(r){return typeof(r==null?void 0:r.parse)=="function"}function NA(r){return r!==void 0&&typeof r.schema=="object"}const _i={openai:{modelName:"gpt-4",temperature:.3,get apiKey(){return localStorage.getItem("openai_api_key")||""}}};class jA{constructor(){if(!_i.openai.apiKey)throw new Error("OpenAI API key is not configured. Please enter your API key in the settings.");this.model=new $A({modelName:_i.openai.modelName,temperature:_i.openai.temperature,openAIApiKey:_i.openai.apiKey})}async process(e,t){try{const n=await this.model.invoke([{role:"system",content:t},{role:"user",content:e}]);if(!n.content)throw new Error("No response received from the language model");return n.content}catch(n){throw n.message.includes("API key")?new Error("Invalid API key. Please check your configuration."):n.message.includes("429")?new Error("Rate limit exceeded. Please try again in a moment."):n.message.includes("500")?new Error("OpenAI service is currently experiencing issues. Please try again later."):new Error(n.message||"Failed to process text. Please try again.")}}}async function LA(r,e={onlyGrammar:!1,handleSpanish:!0,customInstructions:"",writingStyle:"preserve"}){const t=new jA,n={preserve:`
      - Maintain the original writing style, voice, and tone
      - Only fix errors while preserving the author's unique expression
      - Keep the same level of formality and complexity
    `,business:`
      - Use clear, concise, and professional language
      - Maintain a confident and direct tone
      - Focus on clarity and actionable information
      - Use business-appropriate terminology
      - Keep sentences brief and well-structured
      - Emphasize professionalism and efficiency
    `,technical:`
      - Use precise and specific terminology
      - Maintain a clear and methodical structure
      - Focus on accuracy and detail
      - Use technical terms appropriately
      - Ensure explanations are thorough and exact
      - Present information in a logical sequence
    `,casual:`
      - Use friendly and conversational language
      - Include natural expressions and colloquialisms
      - Keep sentences relatively simple and easy to read
      - Maintain an engaging and personal tone
      - Use contractions and informal phrases when appropriate
      - Write as if speaking to a friend
    `,marketing:`
      - Use engaging and benefit-focused language
      - Create emotional connections with readers
      - Include persuasive calls to action
      - Highlight unique value propositions
      - Use power words and emotional triggers
      - Maintain brand voice consistency
    `,simple:`
      - Use clear, straightforward language
      - Keep sentences short and direct
      - Avoid jargon and complex terminology
      - Explain concepts in simple terms
      - Use active voice consistently
      - Focus on readability for general audiences
    `};let s=`You are an expert English language editor with native-level mastery.
    Your task is to ${e.onlyGrammar?"fix grammar and spelling errors only":"improve the provided text"} while:

    ${e.onlyGrammar?`
    1. Fixing grammar and spelling errors
    2. Making minimal changes to preserve the original writing style
    3. Not changing word choice or phrasing unless necessary for grammar
    `:`
    Writing Style Instructions:
    ${n[e.writingStyle]}
    
    General Improvements:
    1. Enhancing clarity and flow while maintaining the intended meaning
    2. Using appropriate expressions based on the selected style
    3. Improving sentence structure for better readability
    4. Maintaining an appropriate tone for the selected style
    5. Fixing any grammar or spelling errors
    `}

    ${e.handleSpanish?`
    Additional Spanish handling:
    - Identify any Spanish words or phrases in the text
    - Translate them to natural, contextually appropriate English
    - Ensure the translations flow naturally with the rest of the text
    `:""}

    ${e.customInstructions?`
    Additional custom instructions:
    ${e.customInstructions}
    `:""}

    IMPORTANT FORMATTING RULES:
    - Preserve all line breaks exactly as they appear in the original text
    - Maintain paragraph structure and spacing
    - Keep any special formatting like bullet points, numbering, or indentation
    - Respect the original text's list formats and structural elements
    - If text has multiple paragraphs, maintain the same paragraph breaks
    
    The goal is to ${e.onlyGrammar?"fix grammar while preserving the original writing as much as possible":`improve the text according to the ${e.writingStyle==="preserve"?"original":e.writingStyle} style guidelines`} while keeping the exact same formatting.
    Return only the ${e.onlyGrammar?"corrected":"improved"} text without any explanations or comments.`;return await t.process(r,s)}const MA={name:"Improve Writing",processor:LA,description:"Enhances text to sound more natural and native-like while maintaining meaning"};var Au={exports:{}},Pp;function DA(){return Pp||(Pp=1,function(r){var e=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},t=-1,n=1,s=0;e.Diff=function(a,i){return[a,i]},e.prototype.diff_main=function(a,i,o,l){typeof l>"u"&&(this.Diff_Timeout<=0?l=Number.MAX_VALUE:l=new Date().getTime()+this.Diff_Timeout*1e3);var u=l;if(a==null||i==null)throw new Error("Null input. (diff_main)");if(a==i)return a?[new e.Diff(s,a)]:[];typeof o>"u"&&(o=!0);var c=o,d=this.diff_commonPrefix(a,i),f=a.substring(0,d);a=a.substring(d),i=i.substring(d),d=this.diff_commonSuffix(a,i);var h=a.substring(a.length-d);a=a.substring(0,a.length-d),i=i.substring(0,i.length-d);var p=this.diff_compute_(a,i,c,u);return f&&p.unshift(new e.Diff(s,f)),h&&p.push(new e.Diff(s,h)),this.diff_cleanupMerge(p),p},e.prototype.diff_compute_=function(a,i,o,l){var u;if(!a)return[new e.Diff(n,i)];if(!i)return[new e.Diff(t,a)];var c=a.length>i.length?a:i,d=a.length>i.length?i:a,f=c.indexOf(d);if(f!=-1)return u=[new e.Diff(n,c.substring(0,f)),new e.Diff(s,d),new e.Diff(n,c.substring(f+d.length))],a.length>i.length&&(u[0][0]=u[2][0]=t),u;if(d.length==1)return[new e.Diff(t,a),new e.Diff(n,i)];var h=this.diff_halfMatch_(a,i);if(h){var p=h[0],m=h[1],g=h[2],_=h[3],b=h[4],y=this.diff_main(p,g,o,l),v=this.diff_main(m,_,o,l);return y.concat([new e.Diff(s,b)],v)}return o&&a.length>100&&i.length>100?this.diff_lineMode_(a,i,l):this.diff_bisect_(a,i,l)},e.prototype.diff_lineMode_=function(a,i,o){var l=this.diff_linesToChars_(a,i);a=l.chars1,i=l.chars2;var u=l.lineArray,c=this.diff_main(a,i,!1,o);this.diff_charsToLines_(c,u),this.diff_cleanupSemantic(c),c.push(new e.Diff(s,""));for(var d=0,f=0,h=0,p="",m="";d<c.length;){switch(c[d][0]){case n:h++,m+=c[d][1];break;case t:f++,p+=c[d][1];break;case s:if(f>=1&&h>=1){c.splice(d-f-h,f+h),d=d-f-h;for(var g=this.diff_main(p,m,!1,o),_=g.length-1;_>=0;_--)c.splice(d,0,g[_]);d=d+g.length}h=0,f=0,p="",m="";break}d++}return c.pop(),c},e.prototype.diff_bisect_=function(a,i,o){for(var l=a.length,u=i.length,c=Math.ceil((l+u)/2),d=c,f=2*c,h=new Array(f),p=new Array(f),m=0;m<f;m++)h[m]=-1,p[m]=-1;h[d+1]=0,p[d+1]=0;for(var g=l-u,_=g%2!=0,b=0,y=0,v=0,E=0,A=0;A<c&&!(new Date().getTime()>o);A++){for(var S=-A+b;S<=A-y;S+=2){var O=d+S,k;S==-A||S!=A&&h[O-1]<h[O+1]?k=h[O+1]:k=h[O-1]+1;for(var K=k-S;k<l&&K<u&&a.charAt(k)==i.charAt(K);)k++,K++;if(h[O]=k,k>l)y+=2;else if(K>u)b+=2;else if(_){var Z=d+g-S;if(Z>=0&&Z<f&&p[Z]!=-1){var re=l-p[Z];if(k>=re)return this.diff_bisectSplit_(a,i,k,K,o)}}}for(var ye=-A+v;ye<=A-E;ye+=2){var Z=d+ye,re;ye==-A||ye!=A&&p[Z-1]<p[Z+1]?re=p[Z+1]:re=p[Z-1]+1;for(var L=re-ye;re<l&&L<u&&a.charAt(l-re-1)==i.charAt(u-L-1);)re++,L++;if(p[Z]=re,re>l)E+=2;else if(L>u)v+=2;else if(!_){var O=d+g-ye;if(O>=0&&O<f&&h[O]!=-1){var k=h[O],K=d+k-O;if(re=l-re,k>=re)return this.diff_bisectSplit_(a,i,k,K,o)}}}}return[new e.Diff(t,a),new e.Diff(n,i)]},e.prototype.diff_bisectSplit_=function(a,i,o,l,u){var c=a.substring(0,o),d=i.substring(0,l),f=a.substring(o),h=i.substring(l),p=this.diff_main(c,d,!1,u),m=this.diff_main(f,h,!1,u);return p.concat(m)},e.prototype.diff_linesToChars_=function(a,i){var o=[],l={};o[0]="";function u(h){for(var p="",m=0,g=-1,_=o.length;g<h.length-1;){g=h.indexOf(`
`,m),g==-1&&(g=h.length-1);var b=h.substring(m,g+1);(l.hasOwnProperty?l.hasOwnProperty(b):l[b]!==void 0)?p+=String.fromCharCode(l[b]):(_==c&&(b=h.substring(m),g=h.length),p+=String.fromCharCode(_),l[b]=_,o[_++]=b),m=g+1}return p}var c=4e4,d=u(a);c=65535;var f=u(i);return{chars1:d,chars2:f,lineArray:o}},e.prototype.diff_charsToLines_=function(a,i){for(var o=0;o<a.length;o++){for(var l=a[o][1],u=[],c=0;c<l.length;c++)u[c]=i[l.charCodeAt(c)];a[o][1]=u.join("")}},e.prototype.diff_commonPrefix=function(a,i){if(!a||!i||a.charAt(0)!=i.charAt(0))return 0;for(var o=0,l=Math.min(a.length,i.length),u=l,c=0;o<u;)a.substring(c,u)==i.substring(c,u)?(o=u,c=o):l=u,u=Math.floor((l-o)/2+o);return u},e.prototype.diff_commonSuffix=function(a,i){if(!a||!i||a.charAt(a.length-1)!=i.charAt(i.length-1))return 0;for(var o=0,l=Math.min(a.length,i.length),u=l,c=0;o<u;)a.substring(a.length-u,a.length-c)==i.substring(i.length-u,i.length-c)?(o=u,c=o):l=u,u=Math.floor((l-o)/2+o);return u},e.prototype.diff_commonOverlap_=function(a,i){var o=a.length,l=i.length;if(o==0||l==0)return 0;o>l?a=a.substring(o-l):o<l&&(i=i.substring(0,o));var u=Math.min(o,l);if(a==i)return u;for(var c=0,d=1;;){var f=a.substring(u-d),h=i.indexOf(f);if(h==-1)return c;d+=h,(h==0||a.substring(u-d)==i.substring(0,d))&&(c=d,d++)}},e.prototype.diff_halfMatch_=function(a,i){if(this.Diff_Timeout<=0)return null;var o=a.length>i.length?a:i,l=a.length>i.length?i:a;if(o.length<4||l.length*2<o.length)return null;var u=this;function c(y,v,E){for(var A=y.substring(E,E+Math.floor(y.length/4)),S=-1,O="",k,K,Z,re;(S=v.indexOf(A,S+1))!=-1;){var ye=u.diff_commonPrefix(y.substring(E),v.substring(S)),L=u.diff_commonSuffix(y.substring(0,E),v.substring(0,S));O.length<L+ye&&(O=v.substring(S-L,S)+v.substring(S,S+ye),k=y.substring(0,E-L),K=y.substring(E+ye),Z=v.substring(0,S-L),re=v.substring(S+ye))}return O.length*2>=y.length?[k,K,Z,re,O]:null}var d=c(o,l,Math.ceil(o.length/4)),f=c(o,l,Math.ceil(o.length/2)),h;if(!d&&!f)return null;f?d?h=d[4].length>f[4].length?d:f:h=f:h=d;var p,m,g,_;a.length>i.length?(p=h[0],m=h[1],g=h[2],_=h[3]):(g=h[0],_=h[1],p=h[2],m=h[3]);var b=h[4];return[p,m,g,_,b]},e.prototype.diff_cleanupSemantic=function(a){for(var i=!1,o=[],l=0,u=null,c=0,d=0,f=0,h=0,p=0;c<a.length;)a[c][0]==s?(o[l++]=c,d=h,f=p,h=0,p=0,u=a[c][1]):(a[c][0]==n?h+=a[c][1].length:p+=a[c][1].length,u&&u.length<=Math.max(d,f)&&u.length<=Math.max(h,p)&&(a.splice(o[l-1],0,new e.Diff(t,u)),a[o[l-1]+1][0]=n,l--,l--,c=l>0?o[l-1]:-1,d=0,f=0,h=0,p=0,u=null,i=!0)),c++;for(i&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a),c=1;c<a.length;){if(a[c-1][0]==t&&a[c][0]==n){var m=a[c-1][1],g=a[c][1],_=this.diff_commonOverlap_(m,g),b=this.diff_commonOverlap_(g,m);_>=b?(_>=m.length/2||_>=g.length/2)&&(a.splice(c,0,new e.Diff(s,g.substring(0,_))),a[c-1][1]=m.substring(0,m.length-_),a[c+1][1]=g.substring(_),c++):(b>=m.length/2||b>=g.length/2)&&(a.splice(c,0,new e.Diff(s,m.substring(0,b))),a[c-1][0]=n,a[c-1][1]=g.substring(0,g.length-b),a[c+1][0]=t,a[c+1][1]=m.substring(b),c++),c++}c++}},e.prototype.diff_cleanupSemanticLossless=function(a){function i(b,y){if(!b||!y)return 6;var v=b.charAt(b.length-1),E=y.charAt(0),A=v.match(e.nonAlphaNumericRegex_),S=E.match(e.nonAlphaNumericRegex_),O=A&&v.match(e.whitespaceRegex_),k=S&&E.match(e.whitespaceRegex_),K=O&&v.match(e.linebreakRegex_),Z=k&&E.match(e.linebreakRegex_),re=K&&b.match(e.blanklineEndRegex_),ye=Z&&y.match(e.blanklineStartRegex_);return re||ye?5:K||Z?4:A&&!O&&k?3:O||k?2:A||S?1:0}for(var o=1;o<a.length-1;){if(a[o-1][0]==s&&a[o+1][0]==s){var l=a[o-1][1],u=a[o][1],c=a[o+1][1],d=this.diff_commonSuffix(l,u);if(d){var f=u.substring(u.length-d);l=l.substring(0,l.length-d),u=f+u.substring(0,u.length-d),c=f+c}for(var h=l,p=u,m=c,g=i(l,u)+i(u,c);u.charAt(0)===c.charAt(0);){l+=u.charAt(0),u=u.substring(1)+c.charAt(0),c=c.substring(1);var _=i(l,u)+i(u,c);_>=g&&(g=_,h=l,p=u,m=c)}a[o-1][1]!=h&&(h?a[o-1][1]=h:(a.splice(o-1,1),o--),a[o][1]=p,m?a[o+1][1]=m:(a.splice(o+1,1),o--))}o++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(a){for(var i=!1,o=[],l=0,u=null,c=0,d=!1,f=!1,h=!1,p=!1;c<a.length;)a[c][0]==s?(a[c][1].length<this.Diff_EditCost&&(h||p)?(o[l++]=c,d=h,f=p,u=a[c][1]):(l=0,u=null),h=p=!1):(a[c][0]==t?p=!0:h=!0,u&&(d&&f&&h&&p||u.length<this.Diff_EditCost/2&&d+f+h+p==3)&&(a.splice(o[l-1],0,new e.Diff(t,u)),a[o[l-1]+1][0]=n,l--,u=null,d&&f?(h=p=!0,l=0):(l--,c=l>0?o[l-1]:-1,h=p=!1),i=!0)),c++;i&&this.diff_cleanupMerge(a)},e.prototype.diff_cleanupMerge=function(a){a.push(new e.Diff(s,""));for(var i=0,o=0,l=0,u="",c="",d;i<a.length;)switch(a[i][0]){case n:l++,c+=a[i][1],i++;break;case t:o++,u+=a[i][1],i++;break;case s:o+l>1?(o!==0&&l!==0&&(d=this.diff_commonPrefix(c,u),d!==0&&(i-o-l>0&&a[i-o-l-1][0]==s?a[i-o-l-1][1]+=c.substring(0,d):(a.splice(0,0,new e.Diff(s,c.substring(0,d))),i++),c=c.substring(d),u=u.substring(d)),d=this.diff_commonSuffix(c,u),d!==0&&(a[i][1]=c.substring(c.length-d)+a[i][1],c=c.substring(0,c.length-d),u=u.substring(0,u.length-d))),i-=o+l,a.splice(i,o+l),u.length&&(a.splice(i,0,new e.Diff(t,u)),i++),c.length&&(a.splice(i,0,new e.Diff(n,c)),i++),i++):i!==0&&a[i-1][0]==s?(a[i-1][1]+=a[i][1],a.splice(i,1)):i++,l=0,o=0,u="",c="";break}a[a.length-1][1]===""&&a.pop();var f=!1;for(i=1;i<a.length-1;)a[i-1][0]==s&&a[i+1][0]==s&&(a[i][1].substring(a[i][1].length-a[i-1][1].length)==a[i-1][1]?(a[i][1]=a[i-1][1]+a[i][1].substring(0,a[i][1].length-a[i-1][1].length),a[i+1][1]=a[i-1][1]+a[i+1][1],a.splice(i-1,1),f=!0):a[i][1].substring(0,a[i+1][1].length)==a[i+1][1]&&(a[i-1][1]+=a[i+1][1],a[i][1]=a[i][1].substring(a[i+1][1].length)+a[i+1][1],a.splice(i+1,1),f=!0)),i++;f&&this.diff_cleanupMerge(a)},e.prototype.diff_xIndex=function(a,i){var o=0,l=0,u=0,c=0,d;for(d=0;d<a.length&&(a[d][0]!==n&&(o+=a[d][1].length),a[d][0]!==t&&(l+=a[d][1].length),!(o>i));d++)u=o,c=l;return a.length!=d&&a[d][0]===t?c:c+(i-u)},e.prototype.diff_prettyHtml=function(a){for(var i=[],o=/&/g,l=/</g,u=/>/g,c=/\n/g,d=0;d<a.length;d++){var f=a[d][0],h=a[d][1],p=h.replace(o,"&amp;").replace(l,"&lt;").replace(u,"&gt;").replace(c,"&para;<br>");switch(f){case n:i[d]='<ins style="background:#e6ffe6;">'+p+"</ins>";break;case t:i[d]='<del style="background:#ffe6e6;">'+p+"</del>";break;case s:i[d]="<span>"+p+"</span>";break}}return i.join("")},e.prototype.diff_text1=function(a){for(var i=[],o=0;o<a.length;o++)a[o][0]!==n&&(i[o]=a[o][1]);return i.join("")},e.prototype.diff_text2=function(a){for(var i=[],o=0;o<a.length;o++)a[o][0]!==t&&(i[o]=a[o][1]);return i.join("")},e.prototype.diff_levenshtein=function(a){for(var i=0,o=0,l=0,u=0;u<a.length;u++){var c=a[u][0],d=a[u][1];switch(c){case n:o+=d.length;break;case t:l+=d.length;break;case s:i+=Math.max(o,l),o=0,l=0;break}}return i+=Math.max(o,l),i},e.prototype.diff_toDelta=function(a){for(var i=[],o=0;o<a.length;o++)switch(a[o][0]){case n:i[o]="+"+encodeURI(a[o][1]);break;case t:i[o]="-"+a[o][1].length;break;case s:i[o]="="+a[o][1].length;break}return i.join("	").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(a,i){for(var o=[],l=0,u=0,c=i.split(/\t/g),d=0;d<c.length;d++){var f=c[d].substring(1);switch(c[d].charAt(0)){case"+":try{o[l++]=new e.Diff(n,decodeURI(f))}catch{throw new Error("Illegal escape in diff_fromDelta: "+f)}break;case"-":case"=":var h=parseInt(f,10);if(isNaN(h)||h<0)throw new Error("Invalid number in diff_fromDelta: "+f);var p=a.substring(u,u+=h);c[d].charAt(0)=="="?o[l++]=new e.Diff(s,p):o[l++]=new e.Diff(t,p);break;default:if(c[d])throw new Error("Invalid diff operation in diff_fromDelta: "+c[d])}}if(u!=a.length)throw new Error("Delta length ("+u+") does not equal source text length ("+a.length+").");return o},e.prototype.match_main=function(a,i,o){if(a==null||i==null||o==null)throw new Error("Null input. (match_main)");return o=Math.max(0,Math.min(o,a.length)),a==i?0:a.length?a.substring(o,o+i.length)==i?o:this.match_bitap_(a,i,o):-1},e.prototype.match_bitap_=function(a,i,o){if(i.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var l=this.match_alphabet_(i),u=this;function c(k,K){var Z=k/i.length,re=Math.abs(o-K);return u.Match_Distance?Z+re/u.Match_Distance:re?1:Z}var d=this.Match_Threshold,f=a.indexOf(i,o);f!=-1&&(d=Math.min(c(0,f),d),f=a.lastIndexOf(i,o+i.length),f!=-1&&(d=Math.min(c(0,f),d)));var h=1<<i.length-1;f=-1;for(var p,m,g=i.length+a.length,_,b=0;b<i.length;b++){for(p=0,m=g;p<m;)c(b,o+m)<=d?p=m:g=m,m=Math.floor((g-p)/2+p);g=m;var y=Math.max(1,o-m+1),v=Math.min(o+m,a.length)+i.length,E=Array(v+2);E[v+1]=(1<<b)-1;for(var A=v;A>=y;A--){var S=l[a.charAt(A-1)];if(b===0?E[A]=(E[A+1]<<1|1)&S:E[A]=(E[A+1]<<1|1)&S|((_[A+1]|_[A])<<1|1)|_[A+1],E[A]&h){var O=c(b,A-1);if(O<=d)if(d=O,f=A-1,f>o)y=Math.max(1,2*o-f);else break}}if(c(b+1,o)>d)break;_=E}return f},e.prototype.match_alphabet_=function(a){for(var i={},o=0;o<a.length;o++)i[a.charAt(o)]=0;for(var o=0;o<a.length;o++)i[a.charAt(o)]|=1<<a.length-o-1;return i},e.prototype.patch_addContext_=function(a,i){if(i.length!=0){if(a.start2===null)throw Error("patch not initialized");for(var o=i.substring(a.start2,a.start2+a.length1),l=0;i.indexOf(o)!=i.lastIndexOf(o)&&o.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)l+=this.Patch_Margin,o=i.substring(a.start2-l,a.start2+a.length1+l);l+=this.Patch_Margin;var u=i.substring(a.start2-l,a.start2);u&&a.diffs.unshift(new e.Diff(s,u));var c=i.substring(a.start2+a.length1,a.start2+a.length1+l);c&&a.diffs.push(new e.Diff(s,c)),a.start1-=u.length,a.start2-=u.length,a.length1+=u.length+c.length,a.length2+=u.length+c.length}},e.prototype.patch_make=function(a,i,o){var l,u;if(typeof a=="string"&&typeof i=="string"&&typeof o>"u")l=a,u=this.diff_main(l,i,!0),u.length>2&&(this.diff_cleanupSemantic(u),this.diff_cleanupEfficiency(u));else if(a&&typeof a=="object"&&typeof i>"u"&&typeof o>"u")u=a,l=this.diff_text1(u);else if(typeof a=="string"&&i&&typeof i=="object"&&typeof o>"u")l=a,u=i;else if(typeof a=="string"&&typeof i=="string"&&o&&typeof o=="object")l=a,u=o;else throw new Error("Unknown call format to patch_make.");if(u.length===0)return[];for(var c=[],d=new e.patch_obj,f=0,h=0,p=0,m=l,g=l,_=0;_<u.length;_++){var b=u[_][0],y=u[_][1];switch(!f&&b!==s&&(d.start1=h,d.start2=p),b){case n:d.diffs[f++]=u[_],d.length2+=y.length,g=g.substring(0,p)+y+g.substring(p);break;case t:d.length1+=y.length,d.diffs[f++]=u[_],g=g.substring(0,p)+g.substring(p+y.length);break;case s:y.length<=2*this.Patch_Margin&&f&&u.length!=_+1?(d.diffs[f++]=u[_],d.length1+=y.length,d.length2+=y.length):y.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(d,m),c.push(d),d=new e.patch_obj,f=0,m=g,h=p);break}b!==n&&(h+=y.length),b!==t&&(p+=y.length)}return f&&(this.patch_addContext_(d,m),c.push(d)),c},e.prototype.patch_deepCopy=function(a){for(var i=[],o=0;o<a.length;o++){var l=a[o],u=new e.patch_obj;u.diffs=[];for(var c=0;c<l.diffs.length;c++)u.diffs[c]=new e.Diff(l.diffs[c][0],l.diffs[c][1]);u.start1=l.start1,u.start2=l.start2,u.length1=l.length1,u.length2=l.length2,i[o]=u}return i},e.prototype.patch_apply=function(a,i){if(a.length==0)return[i,[]];a=this.patch_deepCopy(a);var o=this.patch_addPadding(a);i=o+i+o,this.patch_splitMax(a);for(var l=0,u=[],c=0;c<a.length;c++){var d=a[c].start2+l,f=this.diff_text1(a[c].diffs),h,p=-1;if(f.length>this.Match_MaxBits?(h=this.match_main(i,f.substring(0,this.Match_MaxBits),d),h!=-1&&(p=this.match_main(i,f.substring(f.length-this.Match_MaxBits),d+f.length-this.Match_MaxBits),(p==-1||h>=p)&&(h=-1))):h=this.match_main(i,f,d),h==-1)u[c]=!1,l-=a[c].length2-a[c].length1;else{u[c]=!0,l=h-d;var m;if(p==-1?m=i.substring(h,h+f.length):m=i.substring(h,p+this.Match_MaxBits),f==m)i=i.substring(0,h)+this.diff_text2(a[c].diffs)+i.substring(h+f.length);else{var g=this.diff_main(f,m,!1);if(f.length>this.Match_MaxBits&&this.diff_levenshtein(g)/f.length>this.Patch_DeleteThreshold)u[c]=!1;else{this.diff_cleanupSemanticLossless(g);for(var _=0,b,y=0;y<a[c].diffs.length;y++){var v=a[c].diffs[y];v[0]!==s&&(b=this.diff_xIndex(g,_)),v[0]===n?i=i.substring(0,h+b)+v[1]+i.substring(h+b):v[0]===t&&(i=i.substring(0,h+b)+i.substring(h+this.diff_xIndex(g,_+v[1].length))),v[0]!==t&&(_+=v[1].length)}}}}}return i=i.substring(o.length,i.length-o.length),[i,u]},e.prototype.patch_addPadding=function(a){for(var i=this.Patch_Margin,o="",l=1;l<=i;l++)o+=String.fromCharCode(l);for(var l=0;l<a.length;l++)a[l].start1+=i,a[l].start2+=i;var u=a[0],c=u.diffs;if(c.length==0||c[0][0]!=s)c.unshift(new e.Diff(s,o)),u.start1-=i,u.start2-=i,u.length1+=i,u.length2+=i;else if(i>c[0][1].length){var d=i-c[0][1].length;c[0][1]=o.substring(c[0][1].length)+c[0][1],u.start1-=d,u.start2-=d,u.length1+=d,u.length2+=d}if(u=a[a.length-1],c=u.diffs,c.length==0||c[c.length-1][0]!=s)c.push(new e.Diff(s,o)),u.length1+=i,u.length2+=i;else if(i>c[c.length-1][1].length){var d=i-c[c.length-1][1].length;c[c.length-1][1]+=o.substring(0,d),u.length1+=d,u.length2+=d}return o},e.prototype.patch_splitMax=function(a){for(var i=this.Match_MaxBits,o=0;o<a.length;o++)if(!(a[o].length1<=i)){var l=a[o];a.splice(o--,1);for(var u=l.start1,c=l.start2,d="";l.diffs.length!==0;){var f=new e.patch_obj,h=!0;for(f.start1=u-d.length,f.start2=c-d.length,d!==""&&(f.length1=f.length2=d.length,f.diffs.push(new e.Diff(s,d)));l.diffs.length!==0&&f.length1<i-this.Patch_Margin;){var p=l.diffs[0][0],m=l.diffs[0][1];p===n?(f.length2+=m.length,c+=m.length,f.diffs.push(l.diffs.shift()),h=!1):p===t&&f.diffs.length==1&&f.diffs[0][0]==s&&m.length>2*i?(f.length1+=m.length,u+=m.length,h=!1,f.diffs.push(new e.Diff(p,m)),l.diffs.shift()):(m=m.substring(0,i-f.length1-this.Patch_Margin),f.length1+=m.length,u+=m.length,p===s?(f.length2+=m.length,c+=m.length):h=!1,f.diffs.push(new e.Diff(p,m)),m==l.diffs[0][1]?l.diffs.shift():l.diffs[0][1]=l.diffs[0][1].substring(m.length))}d=this.diff_text2(f.diffs),d=d.substring(d.length-this.Patch_Margin);var g=this.diff_text1(l.diffs).substring(0,this.Patch_Margin);g!==""&&(f.length1+=g.length,f.length2+=g.length,f.diffs.length!==0&&f.diffs[f.diffs.length-1][0]===s?f.diffs[f.diffs.length-1][1]+=g:f.diffs.push(new e.Diff(s,g))),h||a.splice(++o,0,f)}}},e.prototype.patch_toText=function(a){for(var i=[],o=0;o<a.length;o++)i[o]=a[o];return i.join("")},e.prototype.patch_fromText=function(a){var i=[];if(!a)return i;for(var o=a.split(`
`),l=0,u=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;l<o.length;){var c=o[l].match(u);if(!c)throw new Error("Invalid patch string: "+o[l]);var d=new e.patch_obj;for(i.push(d),d.start1=parseInt(c[1],10),c[2]===""?(d.start1--,d.length1=1):c[2]=="0"?d.length1=0:(d.start1--,d.length1=parseInt(c[2],10)),d.start2=parseInt(c[3],10),c[4]===""?(d.start2--,d.length2=1):c[4]=="0"?d.length2=0:(d.start2--,d.length2=parseInt(c[4],10)),l++;l<o.length;){var f=o[l].charAt(0);try{var h=decodeURI(o[l].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+h)}if(f=="-")d.diffs.push(new e.Diff(t,h));else if(f=="+")d.diffs.push(new e.Diff(n,h));else if(f==" ")d.diffs.push(new e.Diff(s,h));else{if(f=="@")break;if(f!=="")throw new Error('Invalid patch mode "'+f+'" in: '+h)}l++}}return i},e.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},e.patch_obj.prototype.toString=function(){var a,i;this.length1===0?a=this.start1+",0":this.length1==1?a=this.start1+1:a=this.start1+1+","+this.length1,this.length2===0?i=this.start2+",0":this.length2==1?i=this.start2+1:i=this.start2+1+","+this.length2;for(var o=["@@ -"+a+" +"+i+` @@
`],l,u=0;u<this.diffs.length;u++){switch(this.diffs[u][0]){case n:l="+";break;case t:l="-";break;case s:l=" ";break}o[u+1]=l+encodeURI(this.diffs[u][1])+`
`}return o.join("").replace(/%20/g," ")},r.exports=e,r.exports.diff_match_patch=e,r.exports.DIFF_DELETE=t,r.exports.DIFF_INSERT=n,r.exports.DIFF_EQUAL=s}(Au)),Au.exports}var FA=DA();const UA=xs(FA),dt={LIGHT:"light",DARK:"dark",SYSTEM:"system"},G_="flowpal-theme-preference";function W_(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}function hc(r){r===dt.DARK||r===dt.SYSTEM&&W_()?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))}function BA(r){Object.values(dt).includes(r)&&(localStorage.setItem(G_,r),hc(r))}function pc(){return localStorage.getItem(G_)||dt.SYSTEM}function HA(){const r=pc();if(hc(r),window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{pc()===dt.SYSTEM&&hc(dt.SYSTEM)};e.addEventListener?e.addEventListener("change",t):e.addListener&&e.addListener(t)}}const Td=(r,e)=>{const t=r.__vccOpts||r;for(const[n,s]of e)t[n]=s;return t},qA={},ZA={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function VA(r,e){return ge(),ve("svg",ZA,e[0]||(e[0]=[$b('<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>',9)]))}const Ip=Td(qA,[["render",VA]]),zA={},GA={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function WA(r,e){return ge(),ve("svg",GA,e[0]||(e[0]=[V("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},null,-1)]))}const kp=Td(zA,[["render",WA]]),JA={},KA={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function XA(r,e){return ge(),ve("svg",KA,e[0]||(e[0]=[V("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"},null,-1),V("line",{x1:"8",y1:"21",x2:"16",y2:"21"},null,-1),V("line",{x1:"12",y1:"17",x2:"12",y2:"21"},null,-1)]))}const Rp=Td(JA,[["render",XA]]),YA={class:"relative theme-switcher"},QA={key:0,class:"absolute right-0 mt-2 w-48 origin-top-right rounded-md bg-white ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-800 dark:ring-gray-700",role:"menu","aria-orientation":"vertical","aria-labelledby":"menu-button",tabindex:"-1"},eT={class:"py-1",role:"none"},tT={__name:"ThemeSwitcher",setup(r){const e=Se(!1),t=Se(pc()),n=()=>{e.value=!e.value},s=o=>{t.value=o,BA(o),e.value=!1},a=o=>{o.target.closest(".theme-switcher")||(e.value=!1)},i=$c(()=>t.value===dt.LIGHT?"sun":t.value===dt.DARK?"moon":t.value===dt.SYSTEM?"monitor":W_()?"moon":"sun");return go(()=>{document.addEventListener("click",a)}),cm(()=>{document.removeEventListener("click",a)}),(o,l)=>(ge(),ve("div",YA,[V("button",{onClick:n,class:"flex items-center rounded-md p-2 text-sm transition-colors hover:bg-gray-100 focus:outline-none dark:hover:bg-gray-800","aria-label":"Toggle theme"},[i.value==="sun"?(ge(),vi(Ip,{key:0,class:"h-5 w-5"})):i.value==="moon"?(ge(),vi(kp,{key:1,class:"h-5 w-5"})):(ge(),vi(Rp,{key:2,class:"h-5 w-5"}))]),e.value?(ge(),ve("div",QA,[V("div",eT,[V("button",{onClick:l[0]||(l[0]=u=>s(Wr(dt).LIGHT)),class:Mr(["flex w-full items-center px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",{"font-medium":t.value===Wr(dt).LIGHT}]),role:"menuitem",tabindex:"-1"},[qe(Ip,{class:"mr-2 h-4 w-4"}),l[3]||(l[3]=Ht(" Light "))],2),V("button",{onClick:l[1]||(l[1]=u=>s(Wr(dt).DARK)),class:Mr(["flex w-full items-center px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",{"font-medium":t.value===Wr(dt).DARK}]),role:"menuitem",tabindex:"-1"},[qe(kp,{class:"mr-2 h-4 w-4"}),l[4]||(l[4]=Ht(" Dark "))],2),V("button",{onClick:l[2]||(l[2]=u=>s(Wr(dt).SYSTEM)),class:Mr(["flex w-full items-center px-4 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",{"font-medium":t.value===Wr(dt).SYSTEM}]),role:"menuitem",tabindex:"-1"},[qe(Rp,{class:"mr-2 h-4 w-4"}),l[5]||(l[5]=Ht(" System "))],2)])])):Mt("",!0)]))}},rT={class:"sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},nT={class:"flex items-center justify-between p-4 sm:p-4"},sT={class:"flex items-center space-x-2"},aT={key:0,class:"mr-2 flex items-center text-sm text-gray-500 dark:text-gray-400"},iT={__name:"Header",props:{loadingApiKey:{type:Boolean,default:!1}},emits:["toggle-settings"],setup(r,{emit:e}){const t=e;function n(){t("toggle-settings")}return(s,a)=>(ge(),ve("header",rT,[V("div",nT,[a[2]||(a[2]=V("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"FlowPal",-1)),V("div",sT,[r.loadingApiKey?(ge(),ve("div",aT,a[0]||(a[0]=[V("span",{class:"mr-2"},"Loading settings...",-1),V("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-gray-300 border-t-blue-600"},null,-1)]))):Mt("",!0),V("button",{onClick:n,class:"flex items-center rounded-md p-2 text-sm transition-colors hover:bg-gray-100 focus:outline-none dark:hover:bg-gray-800","aria-label":"Settings"},a[1]||(a[1]=[V("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[V("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),V("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])),qe(tT)])])]))}},oT={class:"mb-4 flex flex-wrap justify-between items-center gap-2"},lT={class:"flex flex-wrap items-center gap-2"},uT={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},cT={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},dT={class:"flex items-center gap-2"},fT=["value","title"],hT={class:"flex items-center gap-2"},pT=["disabled"],mT={key:0},gT={key:1},_T={__name:"ProcessingControls",props:{onlyGrammar:{type:Boolean,default:!1},handleSpanish:{type:Boolean,default:!0},writingStyle:{type:String,default:"preserve"},isProcessing:{type:Boolean,default:!1},writingStyles:{type:Array,required:!0}},emits:["update:onlyGrammar","update:handleSpanish","update:writingStyle","process","clear"],setup(r,{emit:e}){const t=r,n=e,s=Se(t.onlyGrammar),a=Se(t.handleSpanish),i=Se(t.writingStyle);Ue(()=>t.onlyGrammar,f=>{s.value=f}),Ue(()=>t.handleSpanish,f=>{a.value=f}),Ue(()=>t.writingStyle,f=>{i.value=f});function o(){n("update:onlyGrammar",s.value)}function l(){n("update:handleSpanish",a.value)}function u(){n("update:writingStyle",i.value)}function c(){n("process")}function d(){n("clear")}return(f,h)=>(ge(),ve("div",oT,[V("div",lT,[V("label",uT,[nn(V("input",{type:"checkbox","onUpdate:modelValue":h[0]||(h[0]=p=>s.value=p),onChange:o,class:"rounded text-blue-600 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:border-gray-600"},null,544),[[Fi,s.value]]),h[3]||(h[3]=Ht(" Only Fix Grammar "))]),V("label",cT,[nn(V("input",{type:"checkbox","onUpdate:modelValue":h[1]||(h[1]=p=>a.value=p),onChange:l,class:"rounded text-blue-600 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:border-gray-600"},null,544),[[Fi,a.value]]),h[4]||(h[4]=Ht(" Handle Spanish Text "))]),V("div",dT,[h[5]||(h[5]=V("label",{for:"writing-style",class:"text-sm text-gray-600 dark:text-gray-300"},"Style:",-1)),nn(V("select",{id:"writing-style","onUpdate:modelValue":h[2]||(h[2]=p=>i.value=p),onChange:u,class:"rounded-md border-gray-300 px-2 py-1 text-xs sm:text-sm min-w-[120px] bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},[(ge(!0),ve(Et,null,fm(r.writingStyles,p=>(ge(),ve("option",{key:p.id,value:p.id,title:p.description},rn(p.label),9,fT))),128))],544),[[cw,i.value]])])]),V("div",hT,[V("button",{onClick:c,disabled:r.isProcessing,class:"btn btn-primary flex items-center gap-2"},[r.isProcessing?(ge(),ve("span",mT,"Processing...")):(ge(),ve("span",gT,"Improve Writing"))],8,pT),V("button",{onClick:d,class:"btn btn-secondary"}," Clear All ")])]))}},yT={class:"mb-4"},bT={class:"flex items-center"},wT=["title"],vT={key:0,class:"mb-4 transition-all duration-200"},xT={class:"flex-1"},ET={__name:"CustomInstructions",props:{instructions:{type:String,default:""},visible:{type:Boolean,default:!1}},emits:["update:instructions","update:visible"],setup(r,{emit:e}){const t=r,n=e,s=Se(t.instructions),a=Se(t.visible),i=Se(t.instructions);Ue(()=>t.instructions,u=>{s.value=u,i.value=u}),Ue(()=>t.visible,u=>{a.value=u});function o(){a.value=!a.value,n("update:visible",a.value)}function l(u){const c=u.target.value;s.value=c,n("update:instructions",c)}return(u,c)=>(ge(),ve("div",null,[V("div",yT,[V("button",{onClick:o,class:"text-xs sm:text-sm text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white flex items-center gap-1"},[(ge(),ve("svg",{class:Mr(["w-4 h-4 transform transition-transform",a.value?"rotate-0":"-rotate-90"]),viewBox:"0 0 24 24"},c[1]||(c[1]=[V("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",fill:"currentColor"},null,-1)]),2)),V("span",bT,[c[2]||(c[2]=Ht(" Custom Instructions ")),!a.value&&s.value.trim()?(ge(),ve("span",{key:0,class:Mr(["inline-flex items-center justify-center rounded-full ml-2",s.value.length>20?"px-1 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"w-1.5 h-1.5 bg-blue-500"]),title:s.value.length>100?"Custom instructions: "+s.value.substring(0,100)+"...":"Custom instructions: "+s.value},[s.value.length>20?(ge(),ve(Et,{key:0},[Ht(rn(Math.round(s.value.length/10)*10)+"c ",1)],64)):Mt("",!0)],10,wT)):Mt("",!0)])])]),a.value?(ge(),ve("div",vT,[V("div",xT,[nn(V("textarea",{"onUpdate:modelValue":c[0]||(c[0]=d=>i.value=d),placeholder:"Add your custom instructions for the AI here...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 text-xs sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:"2",onInput:l},null,544),[[Nc,i.value]])])])):Mt("",!0)]))}},ST={class:"bg-white dark:bg-gray-800 rounded-lg p-4 flex flex-col flex-1"},OT={class:"flex justify-between items-center mb-4"},AT={__name:"TextEditor",props:{text:{type:String,default:""}},emits:["update:text"],setup(r,{emit:e}){const t=r,n=e,s=Se(t.text),a=Se(!1),i=Se(null);Ue(()=>t.text,c=>{s.value=c,po(()=>{i.value&&l({target:i.value})})});function o(c){s.value=c.target.value,n("update:text",s.value),l(c)}function l(c){const d=c.target;d.style.height="auto",d.style.height=d.scrollHeight+"px"}async function u(){try{await navigator.clipboard.writeText(s.value),a.value=!0,setTimeout(()=>{a.value=!1},2e3)}catch{console.error("Failed to copy text to clipboard")}}return go(()=>{i.value&&l({target:i.value})}),(c,d)=>(ge(),ve("div",ST,[V("div",OT,[d[1]||(d[1]=V("h2",{class:"text-xl font-semibold text-gray-800 dark:text-white"},"Your Text",-1)),r.text?(ge(),ve("button",{key:0,onClick:u,class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 flex items-center gap-1 sm:gap-2"},rn(a.value?"Copied!":"Copy"),1)):Mt("",!0)]),nn(V("textarea",{ref_key:"textareaRef",ref:i,"onUpdate:modelValue":d[0]||(d[0]=f=>s.value=f),placeholder:"Start writing here...",class:"w-full p-4 border border-gray-200 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-serif text-base sm:text-lg leading-relaxed overflow-hidden resize-none min-h-[150px] flex-grow bg-white dark:bg-gray-700 text-gray-900 dark:text-white",onInput:o},null,544),[[Nc,s.value]])]))}};var TT="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z";const PT={class:"bg-white dark:bg-gray-800 rounded-lg p-4 flex flex-col min-h-0"},IT={class:"flex flex-wrap justify-between items-center mb-4 flex-none"},kT={class:"flex flex-wrap items-center gap-2 mb-2 sm:mb-0"},RT={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},CT={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300"},$T={class:"flex items-center gap-2"},NT={class:"w-3 h-3 sm:w-4 sm:h-4",viewBox:"0 0 24 24"},jT=["d"],LT={class:"flex-1 w-full p-4 border border-gray-200 dark:border-gray-600 rounded-md overflow-y-auto whitespace-pre-wrap font-serif text-base sm:text-lg leading-relaxed min-h-0 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},MT=["onClick","title"],DT={__name:"ProcessedText",props:{originalText:{type:String,default:""},processedText:{type:String,default:""},showDiff:{type:Boolean,default:!1},showOnlyAdditions:{type:Boolean,default:!1}},emits:["update:showDiff","update:showOnlyAdditions","apply","apply-change","change-applied"],setup(r,{emit:e}){const t=r,n=e,s=Se(t.showDiff),a=Se(t.showOnlyAdditions),i=Se(!1);Ue(()=>t.showDiff,h=>{s.value=h}),Ue(()=>t.showOnlyAdditions,h=>{a.value=h});const o=$c(()=>{if(!t.originalText||!t.processedText)return[];const h=new UA,p=h.diff_main(t.originalText,t.processedText);return h.diff_cleanupSemantic(p),p});function l(){n("update:showDiff",s.value)}function u(){n("update:showOnlyAdditions",a.value)}function c(){n("apply")}async function d(){try{await navigator.clipboard.writeText(t.processedText),i.value=!0,setTimeout(()=>{i.value=!1},2e3)}catch{console.error("Failed to copy text to clipboard")}}function f(h,p){h[0]===1&&(n("apply-change",{part:h,index:p,textDiff:o.value}),n("change-applied"))}return(h,p)=>(ge(),ve("div",PT,[V("div",IT,[V("div",kT,[p[4]||(p[4]=V("h2",{class:"text-xl font-semibold text-gray-800 dark:text-white"},"Processed Text",-1)),V("label",RT,[nn(V("input",{type:"checkbox","onUpdate:modelValue":p[0]||(p[0]=m=>s.value=m),onChange:l,class:"rounded text-blue-600 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:border-gray-600"},null,544),[[Fi,s.value]]),p[2]||(p[2]=Ht(" Show Changes "))]),V("label",CT,[nn(V("input",{type:"checkbox","onUpdate:modelValue":p[1]||(p[1]=m=>a.value=m),onChange:u,class:"rounded text-blue-600 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:border-gray-600"},null,544),[[Fi,a.value]]),p[3]||(p[3]=Ht(" Show Only Additions "))])]),V("div",$T,[r.processedText?(ge(),ve("button",{key:0,onClick:d,class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"},rn(i.value?"Copied!":"Copy"),1)):Mt("",!0),r.processedText?(ge(),ve("button",{key:1,onClick:c,class:"px-2 py-1 sm:px-3 sm:py-1 text-xs sm:text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 flex items-center gap-1 sm:gap-2"},[(ge(),ve("svg",NT,[V("path",{d:Wr(TT),fill:"currentColor"},null,8,jT)])),p[5]||(p[5]=Ht(" Apply "))])):Mt("",!0)])]),V("div",LT,[s.value&&r.processedText?(ge(!0),ve(Et,{key:0},fm(o.value,(m,g)=>(ge(),ve(Et,{key:g},[m[0]===0||a.value&&m[0]===1||!a.value&&m[0]!==0?(ge(),ve("span",{key:0,class:Mr({"bg-red-100 dark:bg-red-900/50 line-through":m[0]===-1&&!a.value,"bg-green-100 dark:bg-green-900/50 hover:bg-green-200 dark:hover:bg-green-800/70 cursor-pointer transition-colors duration-150 border-b border-dashed border-green-400 dark:border-green-600 hover:border-green-500 dark:hover:border-green-500":m[0]===1}),onClick:_=>m[0]===1?f(m,g):null,title:m[0]===1?"Click to apply this change":""},rn(m[1]),11,MT)):Mt("",!0)],64))),128)):(ge(),ve(Et,{key:1},[Ht(rn(r.processedText),1)],64))])]))}},FT={key:0,class:"settings-modal"},UT={class:"settings-content"},BT={class:"settings-body"},HT={class:"form-group"},qT={__name:"SettingsModal",props:{show:{type:Boolean,default:!1},initialApiKey:{type:String,default:""}},emits:["update:apiKey","close"],setup(r,{emit:e}){const t=r,n=e,s=Se(t.initialApiKey);Ue(()=>t.initialApiKey,o=>{s.value=o});function a(){n("close")}function i(){n("update:apiKey",s.value),n("close")}return(o,l)=>r.show?(ge(),ve("div",FT,[V("div",UT,[V("div",{class:"settings-header"},[l[2]||(l[2]=V("h2",{class:"text-lg sm:text-xl font-semibold dark:text-white"},"Settings",-1)),V("button",{onClick:a,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},l[1]||(l[1]=[V("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[V("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),V("div",BT,[V("div",HT,[l[3]||(l[3]=V("label",{for:"api-key",class:"form-label"}," OpenAI API Key ",-1)),nn(V("input",{id:"api-key",type:"password","onUpdate:modelValue":l[0]||(l[0]=u=>s.value=u),placeholder:"sk-...",class:"form-input"},null,512),[[Nc,s.value]]),l[4]||(l[4]=V("p",{class:"mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400"}," Your API key is stored locally in your browser and never sent to our servers. ",-1))]),V("div",{class:"flex justify-end"},[V("button",{onClick:i,class:"btn btn-primary"}," Save ")])])])])):Mt("",!0)}},ZT={class:"min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col text-gray-900 dark:text-white"},VT={class:"flex-1 p-4 sm:p-4 flex flex-col min-h-0"},zT={class:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-8 flex-1 min-h-0"},GT={key:0,class:"fixed bottom-4 right-4 bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-100 p-3 sm:p-4 rounded max-w-[90%] sm:max-w-md z-50 text-sm",role:"alert"},WT={class:"flex justify-between items-start"},JT={key:1,class:"fixed bottom-4 left-4 bg-blue-100 dark:bg-blue-900 border-l-4 border-blue-500 text-blue-700 dark:text-blue-100 p-3 sm:p-4 rounded z-50 text-sm"},KT={key:2,class:"fixed bottom-4 left-4 bg-green-100 dark:bg-green-900 border-l-4 border-green-500 text-green-700 dark:text-green-100 p-3 sm:p-4 rounded transition-opacity duration-300 z-50 text-sm"},XT={__name:"App",setup(r){const e={INPUT:"writer-input-text",PROCESSED:"writer-processed-text",ONLY_GRAMMAR:"writer-only-grammar",HANDLE_SPANISH:"writer-handle-spanish",SHOW_DIFF:"writer-show-diff",CUSTOM_INSTRUCTIONS:"writer-custom-instructions",SHOW_INSTRUCTIONS:"writer-show-instructions",WRITING_STYLE:"writer-style",SHOW_ONLY_ADDITIONS:"writer-show-only-additions",API_KEY:"openai_api_key"},t=[{id:"preserve",label:"Preserve Original Style",description:"Maintain the original writing style while fixing errors"},{id:"business",label:"Business",description:"Professional and clear tone for business communication"},{id:"technical",label:"Technical",description:"Precise and detailed tone for technical documentation"},{id:"casual",label:"Casual",description:"Friendly and conversational tone"},{id:"marketing",label:"Marketing",description:"Engaging and persuasive tone for promotional content"},{id:"simple",label:"Simple",description:"Clear and easy-to-understand language for general audiences"}],n=Se(localStorage.getItem(e.INPUT)||""),s=Se(localStorage.getItem(e.PROCESSED)||""),a=Se(localStorage.getItem(e.ONLY_GRAMMAR)==="true"),i=Se(localStorage.getItem(e.HANDLE_SPANISH)!=="false"),o=Se(localStorage.getItem(e.CUSTOM_INSTRUCTIONS)||""),l=Se(localStorage.getItem(e.SHOW_INSTRUCTIONS)==="true"),u=Se(!1),c=Se(null),d=Se(localStorage.getItem(e.SHOW_DIFF)==="true"),f=Se(localStorage.getItem(e.WRITING_STYLE)||"preserve"),h=Se(!1),p=Se(null),m=Se(localStorage.getItem(e.SHOW_ONLY_ADDITIONS)==="true"),g=Se(!1),_=Se(localStorage.getItem(e.API_KEY)||""),b=Se(!1);Ue(d,S=>{localStorage.setItem(e.SHOW_DIFF,S)}),Ue(l,S=>{localStorage.setItem(e.SHOW_INSTRUCTIONS,S)}),Ue(n,S=>{localStorage.setItem(e.INPUT,S)}),Ue(s,S=>{localStorage.setItem(e.PROCESSED,S)}),Ue(a,S=>{localStorage.setItem(e.ONLY_GRAMMAR,S)}),Ue(i,S=>{localStorage.setItem(e.HANDLE_SPANISH,S)}),Ue(o,S=>{localStorage.setItem(e.CUSTOM_INSTRUCTIONS,S)}),Ue(f,S=>{localStorage.setItem(e.WRITING_STYLE,S)}),Ue(m,S=>{localStorage.setItem(e.SHOW_ONLY_ADDITIONS,S)}),Ue(_,S=>{localStorage.setItem(e.API_KEY,S)});const y=async()=>{if(!n.value.trim()){c.value="Please enter some text to process.";return}u.value=!0,c.value=null;try{if(!_.value.trim()){c.value="OpenAI API key is not configured. Please enter your API key in the settings.",b.value=!0;return}const S=await MA.processor(n.value,{onlyGrammar:a.value,handleSpanish:i.value,customInstructions:o.value,writingStyle:f.value});if(!S)throw new Error("No result received from the processor.");s.value=S}catch(S){c.value=S.message}finally{u.value=!1}},v=()=>{s.value&&(n.value=s.value)},E=()=>{confirm("Are you sure you want to clear all text? This cannot be undone.")&&(n.value="",s.value="",c.value=null)},A=({part:S,index:O,textDiff:k})=>{if(S[0]===1)try{if(O>0&&k[O-1]&&k[O-1][0]===-1){let Z=0;for(let C=0;C<O-1;C++){const H=k[C];H&&(H[0]===0||H[0]===-1)&&(Z+=H[1].length)}const re=k[O-1][1],ye=n.value.substring(0,Z),L=n.value.substring(Z+re.length);n.value=ye+S[1]+L}else{let Z=0;for(let L=0;L<O;L++){const C=k[L];C&&(C[0]===0||C[0]===-1)&&(Z+=C[1].length)}const re=n.value.substring(0,Z),ye=n.value.substring(Z);n.value=re+S[1]+ye}po(()=>{var Z;if((Z=p.value)!=null&&Z.$el){const re=p.value.$el.querySelector("textarea");re&&(re.style.height="auto",re.style.height=re.scrollHeight+"px")}})}catch{c.value="Failed to apply change. Please try again."}};return go(()=>{g.value=!0,setTimeout(()=>{_.value.trim(),g.value=!1},500)}),(S,O)=>(ge(),ve("div",ZT,[qe(iT,{"loading-api-key":g.value,onToggleSettings:O[0]||(O[0]=k=>b.value=!b.value)},null,8,["loading-api-key"]),V("main",VT,[qe(_T,{"only-grammar":a.value,"onUpdate:onlyGrammar":O[1]||(O[1]=k=>a.value=k),"handle-spanish":i.value,"onUpdate:handleSpanish":O[2]||(O[2]=k=>i.value=k),"writing-style":f.value,"onUpdate:writingStyle":O[3]||(O[3]=k=>f.value=k),"is-processing":u.value,"writing-styles":t,onProcess:y,onClear:E},null,8,["only-grammar","handle-spanish","writing-style","is-processing"]),qe(ET,{instructions:o.value,"onUpdate:instructions":O[4]||(O[4]=k=>o.value=k),visible:l.value,"onUpdate:visible":O[5]||(O[5]=k=>l.value=k)},null,8,["instructions","visible"]),V("div",zT,[qe(AT,{text:n.value,"onUpdate:text":O[6]||(O[6]=k=>n.value=k),ref_key:"textareaRef",ref:p},null,8,["text"]),qe(DT,{"original-text":n.value,"processed-text":s.value,"show-diff":d.value,"onUpdate:showDiff":O[7]||(O[7]=k=>d.value=k),"show-only-additions":m.value,"onUpdate:showOnlyAdditions":O[8]||(O[8]=k=>m.value=k),onApply:v,onApplyChange:A,onChangeApplied:O[9]||(O[9]=k=>{h.value=!0,S.setTimeout(()=>h.value=!1,2e3)})},null,8,["original-text","processed-text","show-diff","show-only-additions"])])]),c.value?(ge(),ve("div",GT,[V("div",WT,[V("div",null,[O[13]||(O[13]=V("p",{class:"font-bold"},"Error",-1)),V("p",null,rn(c.value),1)]),V("button",{onClick:O[10]||(O[10]=k=>c.value=null),class:"ml-4 text-red-700 hover:text-red-900 dark:text-red-200 dark:hover:text-red-100"}," × ")])])):Mt("",!0),u.value?(ge(),ve("div",JT," Processing your text... ")):Mt("",!0),h.value?(ge(),ve("div",KT," Change applied! ")):Mt("",!0),qe(qT,{show:b.value,"initial-api-key":_.value,"onUpdate:apiKey":O[11]||(O[11]=k=>_.value=k),onClose:O[12]||(O[12]=k=>b.value=!1)},null,8,["show","initial-api-key"])]))}};HA();hw(XT).mount("#app");
